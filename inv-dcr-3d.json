{"version":2,"kind":"Notebook","sha256":"d33c3e2c666f04e0a51be502b9c0ca6426281e3c5d26d5f475ba65b70a779c4b","slug":"inv-dcr-3d","location":"/notebooks/05-dcr/inv_dcr_3d.ipynb","dependencies":[],"frontmatter":{"title":"3D DC Resistivity Inversion","authors":[{"id":"devincowan","nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","orcid":"0000-0002-0089-402X","roles":["Writing – original draft","Writing – review & editing","Software"],"affiliations":["ubc"]}],"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"github":"https://github.com/simpeg/user-tutorials","subject":"SimPEG User Tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"ubc","name":"University of British Columbia","department":"Department of Earth, Ocean and Atmospheric Sciences","address":"2020 – 2207 Main Mall","city":"Vancouver","state":"British Columbia","postal_code":"V6T 1Z4","country":"Canada","isni":"0000 0001 2288 9830","ror":"https://ror.org/03rmrcq20","phone":"604 822 2449"},{"id":"kobold","name":"Kobold Metals"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/simpeg/user-tutorials/blob/main/notebooks/05-dcr/inv_dcr_3d.ipynb","edit_url":"https://github.com/simpeg/user-tutorials/edit/main/notebooks/05-dcr/inv_dcr_3d.ipynb","exports":[{"format":"ipynb","filename":"inv_dcr_3d.ipynb","url":"/user-tutorials/build/inv_dcr_3d-60550ffb7e715c87619840716d7adbd8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Intermediate notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sXIiC67Myb"}],"key":"iA0Zwtu8rO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rQ0gGTZbcf"}],"key":"ohgX5jvMXO"}],"class":"caution","key":"VxCy2mHPQQ"}],"key":"WvjBhvtwZl"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Medium-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"keVadM9KRt"}],"key":"cxvwhd3u3b"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Requires moderate computational resources. Run-times may exceed several minutes and require up to 8 GB of available RAM.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lmKmJ6vCK7"}],"key":"S6F6fgW6OH"}],"class":"caution","key":"LEWEnwlPbK"}],"key":"zL04XjyThl"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nkLEsueLpB"}],"key":"VOaWvbxapx"},{"type":"text","value":" DC resistivity, 3D inversion, weighted least-squares, tree mesh.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LLhbioIHgi"}],"key":"MHX8JYUdq6"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iYfT8mWcq6"}],"key":"kF58juiTtR"},{"type":"text","value":" Here, DC resistivity data are inverted to recover a log-conductivity model using a weighted least-squares inversion approach. Most of the functionality required for this tutorial was presented in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RLivrwnX5g"},{"type":"link","url":"/fwd-dcr-3d","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"G7M77RHNPG"}],"urlSource":"fwd_dcr_3d.ipynb","dataUrl":"/fwd-dcr-3d.json","internal":true,"protocol":"file","key":"gAknkCXKpH"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Y91dcdey2T"},{"type":"link","url":"/inv-dcr-2d","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2.5D Inversion","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sx1DAkmFZl"}],"urlSource":"inv_dcr_2d.ipynb","dataUrl":"/inv-dcr-2d.json","internal":true,"protocol":"file","key":"DQDBC8Bt5y"},{"type":"text","value":" tutorials. We strongly urge the reader to work through the aforementioned tutorials prior to working through this one, as we will avoid significant repitition of content.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Nvd6eGkHnM"}],"key":"ejH5LUqetB"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vxRL4H7lYF"}],"key":"RdgfLGtvl6"}],"key":"wMCZXXBNCG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Demonstrate 3D DC resistivity inversion with SimPEG.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"M84MhG2CdU"}],"key":"NfhTWLRATN"}],"key":"Wyui5xKwGx"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Discuss practical aspects of 3D DC resistivity inversion.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"TvwLM37nbu"}],"key":"pduE4vDJHG"}],"key":"K5MayVoCK2"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Analyzing inversion outputs.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"UdjBDfHfA0"}],"key":"thcD2VXUbi"}],"key":"atNMAFn4hz"}],"key":"xtsdfOpaW2"}],"key":"xxRgo3mqwg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yGRXqNgtC3"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"JxS7wryV7V"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise.\nAll of the functionality specific to DC resistivity is imported from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"polYp308go"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.electromagnetics.static.resistivity.html#module-simpeg.electromagnetics.static.resistivity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg​.electromagnetics​.static​.resistivity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pqqZa0niVH"}],"urlSource":"xref:simpeg#simpeg.electromagnetics.static.resistivity","internal":false,"protocol":"xref:sphinx","key":"TonD0welyc"},{"type":"text","value":".\nWe also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uAmSdyzNpY"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jk0nudMlgZ"}],"urlSource":"xref:simpeg#simpeg.utils","internal":false,"protocol":"xref:sphinx","key":"a29INzZJlg"},{"type":"text","value":". Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jxeXUQnEPc"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mAmGt32HQd"}],"urlSource":"xref:simpeg#simpeg.utils","internal":false,"protocol":"xref:sphinx","key":"oCuy8z2tsB"},{"type":"text","value":". To generate the mesh used for the inversion, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RBOQBtRpOk"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QallYILyKX"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"H9dvsMcUFn"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"utDktC2W6j"}],"key":"WuvseCBZe6"}],"key":"cYBUTfzw8A"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:00.582145Z","iopub.status.busy":"2025-05-23T16:35:00.581708Z","iopub.status.idle":"2025-05-23T16:35:02.479307Z","shell.execute_reply":"2025-05-23T16:35:02.478366Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom simpeg.electromagnetics.static import resistivity as dc\nfrom simpeg.electromagnetics.static.utils.static_utils import (\n    plot_pseudosection,\n    apparent_resistivity_from_voltage,\n    convert_survey_3d_to_2d_lines,\n)\nfrom simpeg.utils.io_utils.io_utils_electromagnetics import read_dcip_xyz\nfrom simpeg.utils import download, model_builder\nfrom simpeg import (\n    maps,\n    data_misfit,\n    regularization,\n    optimization,\n    inverse_problem,\n    inversion,\n    directives,\n)\n\ntry:\n    import plotly\n    from simpeg.electromagnetics.static.utils.static_utils import plot_3d_pseudosection\n    from IPython.core.display import display, HTML\n\n    has_plotly = True\nexcept ImportError:\n    has_plotly = False\n    pass\n\n# discretize functionality\nfrom discretize import TreeMesh\nfrom discretize.utils import active_from_xyz\n\n# Basic Python functionality\nimport os\nimport tarfile\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom matplotlib.colors import LogNorm\n\nmpl.rcParams.update({\"font.size\": 16})","key":"rbqwxBL1Em"},{"type":"output","id":"b8guHopnGO3oI4BwTfEH0","data":[],"key":"iKPg12SQOo"}],"key":"IPg4Ti5PqN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Tutorial Data and Plot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cCHmX1u3Yg"}],"identifier":"load-tutorial-data-and-plot","label":"Load Tutorial Data and Plot","html_id":"load-tutorial-data-and-plot","implicit":true,"key":"Bu3xPt5PVJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data, the survey geometry and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fGIhM9Sprp"}],"key":"AHn0ttL0xZ"}],"key":"yRYwLWfSiH"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:02.482852Z","iopub.status.busy":"2025-05-23T16:35:02.482546Z","iopub.status.idle":"2025-05-23T16:35:03.269099Z","shell.execute_reply":"2025-05-23T16:35:03.267924Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# URL to download from repository assets\ndata_source = \"https://github.com/simpeg/user-tutorials/raw/main/assets/05-dcr/inv_dcr_3d_files.tar.gz\"\n\n# download the data\ndownloaded_data = download(data_source, overwrite=True)\n\n# unzip the tarfile\ntar = tarfile.open(downloaded_data, \"r\")\ntar.extractall()\ntar.close()\n\n# path to the directory containing our data\ndir_path = downloaded_data.split(\".\")[0] + os.path.sep\n\n# files to work with\ntopo_filename = dir_path + \"topo_xyz.txt\"\ndc_data_filename = dir_path + \"dc_data.xyz\"","key":"I2ydhABcRG"},{"type":"output","id":"olztXaXQgsw5dusCMQkux","data":[{"name":"stdout","output_type":"stream","text":"Downloading https://github.com/simpeg/user-tutorials/raw/main/assets/05-dcr/inv_dcr_3d_files.tar.gz\n"},{"name":"stdout","output_type":"stream","text":"   saved to: /home/ssoler/git/user-tutorials/notebooks/05-dcr/inv_dcr_3d_files.tar.gz\nDownload completed!\n"},{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_974186/2591142375.py:9: DeprecationWarning: Python 3.14 will, by default, filter extracted tar archives and reject files or modify their metadata. Use the filter argument to control this behavior.\n  tar.extractall()\n"}],"key":"at1JYkqCi0"}],"key":"TOWLgF7Xti"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load the Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tnp9HWBXq1"}],"identifier":"load-the-topography","label":"Load the Topography","html_id":"load-the-topography","implicit":true,"key":"K3f0xvfVo8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Surface topography is defined as an (N, 3) ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gJErkj3u4u"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ad8sPoo7cV"}],"urlSource":"xref:numpy#numpy.ndarray","internal":false,"protocol":"xref:sphinx","key":"khahcHFVHH"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"afI6HUcDK7"}],"key":"DbY96DAa6d"}],"key":"aYFIsxsfbA"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:03.273133Z","iopub.status.busy":"2025-05-23T16:35:03.272721Z","iopub.status.idle":"2025-05-23T16:35:03.286745Z","shell.execute_reply":"2025-05-23T16:35:03.286021Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"topo_xyz = np.loadtxt(str(topo_filename))","key":"hLslEYBLBM"},{"type":"output","id":"MjzZclg4-tlZKKJkkuV1p","data":[],"key":"rvIPz3KReu"}],"key":"IPhbfS7lkS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:03.290334Z","iopub.status.busy":"2025-05-23T16:35:03.290080Z","iopub.status.idle":"2025-05-23T16:35:04.634365Z","shell.execute_reply":"2025-05-23T16:35:04.633696Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(6, 6))\nax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=\"3d\")\nax.set_zlim([-400, 400])\nax.scatter3D(topo_xyz[:, 0], topo_xyz[:, 1], topo_xyz[:, 2], s=0.25, c=\"b\")\nax.set_box_aspect(aspect=None, zoom=0.85)\nax.set_xlabel(\"X (m)\", labelpad=10)\nax.set_ylabel(\"Y (m)\", labelpad=10)\nax.set_zlabel(\"Z (m)\", labelpad=10)\nax.set_title(\"Topography (Exaggerated z-axis)\", fontsize=16, pad=-20)\nax.view_init(elev=45.0, azim=-125)","key":"X3GhzbrmAY"},{"type":"output","id":"di2dkZsl856AyJzz55W3o","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e3e6dd1ee818179ff0219a11c7109a28","path":"/user-tutorials/build/e3e6dd1ee818179ff0219a11c7109a28.png"},"text/plain":{"content":"<Figure size 600x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"fAGSsbl3OD"}],"key":"gzRbwYs1KV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load DC Resistivity Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rjIS5QeU2y"}],"identifier":"load-dc-resistivity-data","label":"Load DC Resistivity Data","html_id":"load-dc-resistivity-data","implicit":true,"key":"yDpmnclqr4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Option A: DCIP3D formatted data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dVAmoDID4J"}],"key":"FzparL8RcV"}],"key":"jWozXYMDNL"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IVG4Ysj7Jx"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.utils.io_utils.read_dcip3d_ubc.html#simpeg.utils.io_utils.read_dcip3d_ubc","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"read_dcip3d_ubc","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dk0aTzrgMj"}],"urlSource":"xref:simpeg#simpeg.utils.io_utils.read_dcip3d_ubc","internal":false,"protocol":"xref:sphinx","key":"Ncp4YoLMYq"},{"type":"text","value":" utility function can be used to load DC/IP data stored in a UBC-GIF formatted file. This function outputs a SimPEG ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Yy7oPqbw1U"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data.Data.html#simpeg.data.data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MSa69UhNh9"}],"urlSource":"xref:simpeg#simpeg.data.Data","internal":false,"protocol":"xref:sphinx","key":"fXKwOvZvF1"},{"type":"text","value":" object.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"M0vqTfbkLg"}],"key":"mkY0hdiZhn"}],"key":"GX0oYAxcRi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Option B: Load XYZ formatted data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VlkqzAfXOl"}],"key":"qaXXSGuxt9"}],"key":"qezVtjsJrt"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For this tutorial, the observed data are organized within an XYZ formatted file. We can use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VDrjWQjEIp"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.utils.io_utils.read_dcip_xyz.html#simpeg.utils.io_utils.read_dcip_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"read_dcip_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zodZ4JyRnQ"}],"urlSource":"xref:simpeg#simpeg.utils.io_utils.read_dcip_xyz","internal":false,"protocol":"xref:sphinx","key":"SMEpRRyBUT"},{"type":"text","value":" utility function to load data in this format. This function outputs a SimPEG ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E0rJiIUo7g"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data.Data.html#simpeg.data.data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m93g4oej4W"}],"urlSource":"xref:simpeg#simpeg.data.Data","internal":false,"protocol":"xref:sphinx","key":"rEijYinTtt"},{"type":"text","value":" object. The data are normalized voltages in units V/A.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H90UwPZqnJ"}],"key":"w1A4GPzIBf"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cGOuB82HJY"},{"type":"inlineCode","value":"dict_headers","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TlcnFiu8Ui"},{"type":"text","value":" input argument can be used to import other data columns that are not required to define the SimPEG data object. In this case, we import a column that defines the survey line associated with each datum. We will use this to plot pseudosections for individual survey lines.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BaR95f6AaV"}],"key":"sjUt04Ea4D"}],"key":"JvaE0weRpG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.639324Z","iopub.status.busy":"2025-05-23T16:35:04.639080Z","iopub.status.idle":"2025-05-23T16:35:04.671370Z","shell.execute_reply":"2025-05-23T16:35:04.670494Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dc_data, out_dict = read_dcip_xyz(\n    dc_data_filename,\n    \"volt\",\n    data_header=\"V/A\",\n    uncertainties_header=\"UNCERT\",\n    is_surface_data=False,\n    dict_headers=[\"LINEID\"],\n)","key":"lcopH3Ntjl"},{"type":"output","id":"bKvaJCprgS6woludifeZd","data":[],"key":"XCgRPP6OSS"}],"key":"AK5riTnxQC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed Data in 3D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BmjzOSODKE"}],"identifier":"plot-observed-data-in-3d-pseudosection","label":"Plot Observed Data in 3D Pseudosection","html_id":"plot-observed-data-in-3d-pseudosection","implicit":true,"key":"HO0ZF4XGsg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qpgST0i2AF"},{"type":"link","url":"simpeg#simpeg.electromagnetics.static.utils.plot_3d_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot​_3d​_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VmokSkSptC"}],"urlSource":"simpeg#simpeg.electromagnetics.static.utils.plot_3d_pseudosection","key":"e73lIJ3Ihy"},{"type":"text","value":" utility function to represent the observed data in pseudosection. Although our original data are normalized voltages, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ELTbLQimZ6"},{"type":"link","url":"simpeg#simpeg.electromagnetics.static.utils.apparent_resistivity_from_voltage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"apparent​_resistivity​_from​_voltage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ehihri3qx7"}],"urlSource":"simpeg#simpeg.electromagnetics.static.utils.apparent_resistivity_from_voltage","key":"j84UhwM2YC"},{"type":"text","value":" utility function to convert the data to apparent resistivities.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xVekoFz6XK"}],"key":"u6ZldfOAlq"}],"key":"zL4NPrurf4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.674752Z","iopub.status.busy":"2025-05-23T16:35:04.674533Z","iopub.status.idle":"2025-05-23T16:35:04.683612Z","shell.execute_reply":"2025-05-23T16:35:04.683106Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"apparent_conductivities = 1 / apparent_resistivity_from_voltage(\n    dc_data.survey,\n    dc_data.dobs,\n)","key":"yzw5zXrWVt"},{"type":"output","id":"ONtAimY-cT42TMzEtHz8Z","data":[],"key":"Rb3jVuYioV"}],"key":"jJH5PapYre"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.686764Z","iopub.status.busy":"2025-05-23T16:35:04.686523Z","iopub.status.idle":"2025-05-23T16:35:04.691151Z","shell.execute_reply":"2025-05-23T16:35:04.690640Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"if has_plotly:\n    fig = plot_3d_pseudosection(\n        dc_data.survey,\n        apparent_conductivities,\n        scale=\"log\",\n        units=\"S/m\",\n        marker_opts={\"colorscale\": \"RdYlBu_r\"},\n    )\n\n    fig.update_layout(\n        title_text=\"Apparent Conductivity\",\n        title_x=0.5,\n        title_font_size=24,\n        width=650,\n        height=500,\n        scene_camera=dict(\n            center=dict(x=0, y=0, z=-0.4), eye=dict(x=1.5, y=-1.5, z=1.8)\n        ),\n    )\n\n    #     plotly.io.show(fig)\n    html_str = plotly.io.to_html(fig)\n    display(HTML(html_str))\n\nelse:\n    print(\"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\")","key":"QAAntsGmkg"},{"type":"output","id":"t0qK2W1bLRmZyMw96Efkr","data":[{"name":"stdout","output_type":"stream","text":"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\n"}],"key":"GiLHXXNXUZ"}],"key":"gjsZ2c27zD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed Data in 2D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"guQZtks9cf"}],"identifier":"plot-observed-data-in-2d-pseudosection","label":"Plot Observed Data in 2D Pseudosection","html_id":"plot-observed-data-in-2d-pseudosection","implicit":true,"key":"JjDFzYfldG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As demonstrated in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LyuQmHFdA3"},{"type":"link","url":"/fwd-dcr-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"snkFYYyHPz"}],"urlSource":"fwd_dcr_3d.ipynb","dataUrl":"/fwd-dcr-3d.json","internal":true,"protocol":"file","key":"Lz3TZzvCHj"},{"type":"text","value":" tutorial, we can parse the 3D survey into a set of 2D survey lines if we know which survey line is associated with each datum. Then we can plot individual pseudosections for each survey line. We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RhS2ktmQrf"},{"type":"link","url":"simpeg#simpeg.electromagnetics.static.utils.convert_survey_3d_to_2d_lines","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"convert​_survey​_3d​_to​_2d​_lines","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MCCqHRbKfV"}],"urlSource":"simpeg#simpeg.electromagnetics.static.utils.convert_survey_3d_to_2d_lines","key":"HMhjJYLYcn"},{"type":"text","value":" to generate the list of 2D surveys. And we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qATIh4X9YE"},{"type":"link","url":"simpeg#simpeg.electromagnetics.static.utils.plot_2d_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"plot​_2d​_pseudosection","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hZucPMccvs"}],"urlSource":"simpeg#simpeg.electromagnetics.static.utils.plot_2d_pseudosection","key":"XNFqAmDDNC"},{"type":"text","value":" utility function to plot the pseudosection for the desired survey line.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EgR6h3uqF0"}],"key":"fkDd9W2Cji"}],"key":"VI96Matbhj"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.694757Z","iopub.status.busy":"2025-05-23T16:35:04.694487Z","iopub.status.idle":"2025-05-23T16:35:04.698314Z","shell.execute_reply":"2025-05-23T16:35:04.697588Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Extract line IDs and make sure they are integers\nlineID = np.array(out_dict[\"LINEID\"], dtype=int)","key":"YwLnRGmsiQ"},{"type":"output","id":"3O-SMCKCMMC1Btc9Gxu58","data":[],"key":"KTLdFBXpY1"}],"key":"JKDl3qxZxT"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.700841Z","iopub.status.busy":"2025-05-23T16:35:04.700488Z","iopub.status.idle":"2025-05-23T16:35:04.735942Z","shell.execute_reply":"2025-05-23T16:35:04.735164Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"survey_2d_list, index_list = convert_survey_3d_to_2d_lines(\n    dc_data.survey, lineID, data_type=\"volt\", output_indexing=True\n)","key":"e8m4sk0Gfm"},{"type":"output","id":"KDX84Z62ioOCTCtit26sz","data":[],"key":"OMLQf2jJtN"}],"key":"S5QpzQ8B54"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.738315Z","iopub.status.busy":"2025-05-23T16:35:04.738030Z","iopub.status.idle":"2025-05-23T16:35:04.741234Z","shell.execute_reply":"2025-05-23T16:35:04.740733Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dobs_2d_list = []\napparent_conductivities_2d = []\nfor ind in index_list:\n    dobs_2d_list.append(dc_data.dobs[ind])\n    apparent_conductivities_2d.append(apparent_conductivities[ind])","key":"RIDT3ior6S"},{"type":"output","id":"fgu-bmyPgHHhkqSYPJizw","data":[],"key":"yoSECSyHex"}],"key":"fUU5KE0V4Y"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.743994Z","iopub.status.busy":"2025-05-23T16:35:04.743690Z","iopub.status.idle":"2025-05-23T16:35:04.917703Z","shell.execute_reply":"2025-05-23T16:35:04.916955Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"line_index = 0\n\nfig = plt.figure(figsize=(8, 2.75))\nax1 = fig.add_axes([0.1, 0.15, 0.75, 0.78])\nplot_pseudosection(\n    survey_2d_list[line_index],\n    dobs=apparent_conductivities_2d[line_index],\n    plot_type=\"contourf\",\n    ax=ax1,\n    scale=\"log\",\n    cbar_label=\"S/m\",\n    mask_topography=True,\n    contourf_opts={\"levels\": 20, \"cmap\": mpl.cm.RdYlBu_r},\n)\nax1.set_title(\"Apparent Conductivity\")\nplt.show()","key":"WK8PHyCDOf"},{"type":"output","id":"weRyfdkIOyFbTiqwq2aAJ","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bd7d94fd5924218dd37d5f87de0c9e0a","path":"/user-tutorials/build/bd7d94fd5924218dd37d5f87de0c9e0a.png"},"text/plain":{"content":"<Figure size 800x275 with 2 Axes>","content_type":"text/plain"}}}],"key":"eg88JoeVuN"}],"key":"ySiMY8H9E2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Assign Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NPACGXAviC"}],"identifier":"assign-uncertainties","label":"Assign Uncertainties","html_id":"assign-uncertainties","implicit":true,"key":"pYdwwyG5J4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Approaches for applying reasonable uncertainties to normalized voltage and apparent resistivity data were presented in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M4zXLUL7Vg"},{"type":"link","url":"/inv-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Inversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gSf1K9ubpl"}],"urlSource":"inv_dcr_2d.ipynb","dataUrl":"/inv-dcr-2d.json","internal":true,"protocol":"file","key":"XOVJxHlIZz"},{"type":"text","value":" tutorial. Here, we apply uncertainties of 1e-7 V/A + 10 % to the normalized voltage data being inverted.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oExopmw0qj"}],"key":"JKHMh6Q7kJ"}],"key":"GkHrqc4vgy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.920976Z","iopub.status.busy":"2025-05-23T16:35:04.920681Z","iopub.status.idle":"2025-05-23T16:35:04.924226Z","shell.execute_reply":"2025-05-23T16:35:04.923703Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dc_data.standard_deviation = 1e-7 + 0.1 * np.abs(dc_data.dobs)","key":"gC82l8XeT9"},{"type":"output","id":"TfvH9voEGXxf63kdHHJnO","data":[],"key":"HPmopLWS0q"}],"key":"SDz3vWcpOk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tree) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lmzBJfrBSr"}],"identifier":"design-a-tree-mesh","label":"Design a (Tree) Mesh","html_id":"design-a-tree-mesh","implicit":true,"key":"eAWGFmGAMD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Please visit the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uFdlQmt8MG"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dNOeJ085fb"}],"urlSource":"fwd_dcr_2d.ipynb","dataUrl":"/fwd-dcr-2d.json","internal":true,"protocol":"file","key":"oR9D5iL6WZ"},{"type":"text","value":" tutorial to see the best practices for mesh design. The same rules for defining appropriate meshes for 2.5D simulations and inversion apply to 3D simulations and inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kJmLCYZR7F"}],"key":"vRKh4XtryY"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Tutorial mesh:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EHvHp6IxHc"}],"key":"ReKPGl9SHk"},{"type":"text","value":" Here, a minimum cell width of 25 m (or 1/4 the minimum electrode spacing) is used within our survey region. The largest electrode spacing was 1000 m, so a the padding was extended at least 3000 m from the survey region. Using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"c0QdFrijZQ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_surface.html#discretize.treemesh.refine_surface","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"refine_surface","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Sl0R47fG7u"}],"urlSource":"xref:discretize#discretize.TreeMesh.refine_surface","internal":false,"protocol":"xref:sphinx","key":"ybzuutmpnz"},{"type":"text","value":" method, we refine the tree mesh where there is significant topography. And using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CaHlqrIc6N"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.refine_points.html#discretize.treemesh.refine_points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"refine_points","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aCOuzguLbn"}],"urlSource":"xref:discretize#discretize.TreeMesh.refine_points","internal":false,"protocol":"xref:sphinx","key":"OVCMJFtQU6"},{"type":"text","value":" methods, we refine based on electrodes locations. Visit the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xrPXRyKQK9"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"tree mesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Wfak7JxURl"}],"urlSource":"xref:discretize#discretize.TreeMesh","internal":false,"protocol":"xref:sphinx","key":"Mzy4gNYYsP"},{"type":"text","value":" API to see additional refinement methods.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"s7rGjgnV3J"}],"key":"oruYHX5nQj"}],"key":"zsHgM2sF1w"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:04.927567Z","iopub.status.busy":"2025-05-23T16:35:04.927275Z","iopub.status.idle":"2025-05-23T16:35:05.683783Z","shell.execute_reply":"2025-05-23T16:35:05.682940Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Defining domain size and minimum cell size\ndh = 25.0  # base cell width\ndom_width_x = 8000.0  # domain width x\ndom_width_y = 8000.0  # domain width y\ndom_width_z = 4000.0  # domain width z\n\n# Number of base mesh cells in each direction. Must be a power of 2\nnbcx = 2 ** int(np.round(np.log(dom_width_x / dh) / np.log(2.0)))  # num. base cells x\nnbcy = 2 ** int(np.round(np.log(dom_width_y / dh) / np.log(2.0)))  # num. base cells y\nnbcz = 2 ** int(np.round(np.log(dom_width_z / dh) / np.log(2.0)))  # num. base cells z\n\n# Define the base mesh\nhx = [(dh, nbcx)]\nhy = [(dh, nbcy)]\nhz = [(dh, nbcz)]\nmesh = TreeMesh([hx, hy, hz], x0=\"CCN\", diagonal_balance=True)\n\n# Shift top to maximum topography\nmesh.origin = mesh.origin + np.r_[0.0, 0.0, topo_xyz[:, -1].max()]\n\n# Mesh refinement based on surface topography\nk = np.sqrt(np.sum(topo_xyz[:, 0:2] ** 2, axis=1)) < 1200\nmesh.refine_surface(topo_xyz[k, :], padding_cells_by_level=[0, 4, 4], finalize=False)\n\n# Extract unique electrode locations.\nunique_locations = dc_data.survey.unique_electrode_locations\n\n# Mesh refinement near electrodes.\nmesh.refine_points(unique_locations, padding_cells_by_level=[6, 6, 4], finalize=False)\n\n# Finalize the mesh\nmesh.finalize()","key":"bmYs9zhcgN"},{"type":"output","id":"QA2mDo7ddfWoi4Z4XedJH","data":[],"key":"WfOKrqw6af"}],"key":"ZobDG7tTBT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OL4YWKI6UC"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells","implicit":true,"key":"lL3Djb4irZ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Simulated geophysical data are dependent on the subsurface distribution of physical property values. As a result, the cells lying below the surface topography are commonly referred to as ‘active cells’. And air cells, whose physical property values are fixed, are commonly referred to as ‘inactive cells’. Here, the discretize ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZC57r3dWJs"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fuH044rmqT"}],"urlSource":"xref:discretize#discretize.utils.active_from_xyz","internal":false,"protocol":"xref:sphinx","key":"aFc8KaixyP"},{"type":"text","value":" utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UXJ1LL6dMt"},{"type":"inlineCode","value":"bool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vVEXJOcULr"},{"type":"text","value":" array.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XPd0Tik9Pg"}],"key":"uxK8pUIth7"}],"key":"bBfQXm81xg"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:05.686824Z","iopub.status.busy":"2025-05-23T16:35:05.686586Z","iopub.status.idle":"2025-05-23T16:35:06.051155Z","shell.execute_reply":"2025-05-23T16:35:06.050449Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Indices of the active mesh cells from topography (e.g. cells below surface)\nactive_cells = active_from_xyz(mesh, topo_xyz)\n\n# number of active cells\nn_active = np.sum(active_cells)","key":"gFnPnI41Vj"},{"type":"output","id":"1QP0Jz1mEV6cAPtuqsT33","data":[],"key":"jj39x6I0AD"}],"key":"SQwyKsLepf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Project Electrodes to Discretized Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vsEjMk8o3I"}],"identifier":"project-electrodes-to-discretized-topography","label":"Project Electrodes to Discretized Topography","html_id":"project-electrodes-to-discretized-topography","implicit":true,"key":"MvbkN1nou7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Surface DC resistivity data will not be modeled accurately if the electrodes are modeled as living above or below the surface. It is especially problematic when electrodes are modeled as living in the air. Prior to inverting surface DC resistivity data, we must project the electrodes from their true elevation to the surface of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AKJvkoevBq"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretized","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GSWVORqebG"}],"key":"iDxc2nnqfW"},{"type":"text","value":" topography. This is done using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FyfHbidYKS"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography.html#simpeg.electromagnetics.static.resistivity.survey.drape_electrodes_on_topography","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"drape​_electrodes​_on​_topography","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fYaoGiL0qp"}],"urlSource":"xref:simpeg#simpeg.electromagnetics.static.resistivity.Survey.drape_electrodes_on_topography","internal":false,"protocol":"xref:sphinx","key":"uhx11SUV0T"},{"type":"text","value":" method.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"G2FzrpTPth"}],"key":"Ko5I7pQIhA"}],"key":"QbdR9z3JvA"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:06.054711Z","iopub.status.busy":"2025-05-23T16:35:06.054436Z","iopub.status.idle":"2025-05-23T16:35:06.087813Z","shell.execute_reply":"2025-05-23T16:35:06.087103Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dc_data.survey.drape_electrodes_on_topography(mesh, active_cells, option=\"top\")","key":"hzCHSIk13e"},{"type":"output","id":"Rg56PQI0vrJiy0hg5DMQF","data":[],"key":"xUPWrC1QV5"}],"key":"OYqftWkRpB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from the Model to the Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"s2ffvFxlNb"}],"identifier":"mapping-from-the-model-to-the-mesh","label":"Mapping from the Model to the Mesh","html_id":"mapping-from-the-model-to-the-mesh","implicit":true,"key":"DpJ6b1SWWd"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, the model defines the log-conductivity values for all active cells. We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SsMSIVZoX4"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.ExpMap.html#simpeg.maps.expmap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.maps.ExpMap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PCh2f667S4"}],"urlSource":"xref:simpeg#simpeg.maps.ExpMap","internal":false,"protocol":"xref:sphinx","key":"Far67AmzLz"},{"type":"text","value":" to map from the model parameters to the conductivity values for all active cells. Then we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NxIgK2Z4BJ"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.InjectActiveCells.html#simpeg.maps.injectactivecells","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg​.maps​.InjectActiveCells","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OXvDKc8oU8"}],"urlSource":"xref:simpeg#simpeg.maps.InjectActiveCells","internal":false,"protocol":"xref:sphinx","key":"arClvS4cJA"},{"type":"text","value":" map to project the active cell resisitivities to the entire mesh. As explained in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UELzono787"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"2.5D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PzDxSZBuu6"}],"urlSource":"fwd_dcr_2d.ipynb","dataUrl":"/fwd-dcr-2d.json","internal":true,"protocol":"file","key":"nWi8nLzYbG"},{"type":"text","value":" tutorial, air cells are given a fixed value of 1e-8 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"epUXYXYnYg"},{"type":"inlineMath","value":"S/m","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi mathvariant=\"normal\">/</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">S/m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"FPnqQCsMjX"},{"type":"text","value":" to ensure the forward problem is well-conditionned. And the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gv3LBKkUG6"},{"type":"inlineMath","value":"*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∗</mo></mrow><annotation encoding=\"application/x-tex\">*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4653em;\"></span><span class=\"mord\">∗</span></span></span></span>","key":"PimOXLtkDf"},{"type":"text","value":" operator is used to combine the separate mapping objects into a single mapping.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H8BLn5lOIQ"}],"key":"PdSxY2b3hx"}],"key":"k3McFvNGTj"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:06.091326Z","iopub.status.busy":"2025-05-23T16:35:06.091060Z","iopub.status.idle":"2025-05-23T16:35:06.099555Z","shell.execute_reply":"2025-05-23T16:35:06.098923Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Model parameters to all cells\nlog_conductivity_map = maps.InjectActiveCells(mesh, active_cells, 1e-8) * maps.ExpMap(\n    nP=n_active\n)","key":"VW3Y0kRUwv"},{"type":"output","id":"yCImTyOX1FLjLTcjccbTC","data":[],"key":"DBCMNAp203"}],"key":"tSBoozPd82"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting/Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tuPBXGX1BV"}],"identifier":"starting-reference-models","label":"Starting/Reference Models","html_id":"starting-reference-models","implicit":true,"key":"bLz7WoTmNj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"v2OqAW5rkO"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"starting model","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B6C7wBCl4H"}],"key":"CyA5l7wpjh"},{"type":"text","value":" defines a reasonable starting point for the inversion and does not necessarily represent an initial estimate of the true model. It should be noted that the starting model ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lX8e0STGpK"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cannot be vector of zeros,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o5UMBdNjaR"}],"key":"eBSKDfPQfv"},{"type":"text","value":" otherwise the inversion will be unable to compute a gradient direction at the first iteration. For DC resistivity inversion, the starting model is frequently a halfspace estimated from the set of apparent resistivities/conductivities.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GzVtQlV1Pg"}],"key":"w9bbT6KAMf"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FjzbJIhNwc"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"reference model","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"i5zipeFe0x"}],"key":"XxG7AiwXHd"},{"type":"text","value":" is used to include a-priori information. By default, the starting model is set as the reference model. The impact of the reference model on the inversion will be discussed in another tutorial.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"etS2p7zDcw"}],"key":"GXoWv5GLhL"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Notice that the length of the starting and reference models is equal to the number of model parameters!!!","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jwGgjZISkR"}],"key":"CyX6snQxj4"}],"key":"RikiSTD4IF"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:06.102824Z","iopub.status.busy":"2025-05-23T16:35:06.102577Z","iopub.status.idle":"2025-05-23T16:35:06.106332Z","shell.execute_reply":"2025-05-23T16:35:06.105700Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Median apparent resistivity\nmedian_conductivity = np.median(apparent_conductivities)\n\n# Create starting model from log-conductivity\nstarting_conductivity_model = np.log(median_conductivity) * np.ones(n_active)\n\n# Zero reference conductivity model\nreference_conductivity_model = starting_conductivity_model.copy()","key":"oqFIIO8UJG"},{"type":"output","id":"b3Ex0e_00E68g8SvzxcdH","data":[],"key":"pfXx4AQJb9"}],"key":"FGgAcD9i9R"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ng2VVlbGlg"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"kRygoHq39M"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for 3D DC resistivity was discussed in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fOZiuH90yr"},{"type":"link","url":"/fwd-dcr-2d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vSflQZGSjG"}],"urlSource":"fwd_dcr_2d.ipynb","dataUrl":"/fwd-dcr-2d.json","internal":true,"protocol":"file","key":"cGq0tV6X8L"},{"type":"text","value":" tutorial. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sUZKL6or8q"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.electromagnetics.static.resistivity.Simulation3DNodal.html#simpeg.electromagnetics.static.resistivity.simulation3dnodal","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Simulation3DNodal","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ub6NTg2DR5"}],"urlSource":"xref:simpeg#simpeg.electromagnetics.static.resistivity.Simulation3DNodal","internal":false,"protocol":"xref:sphinx","key":"sG76FsotbR"},{"type":"text","value":" simulation which solves for the electric potential on mesh nodes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dRsGmNs6Rc"}],"key":"zNxqJvgQ9n"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Since our model consists of log-conductivities, we use ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iM46hEjCdd"},{"type":"inlineCode","value":"sigmaMap","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"x3SDCCP2EK"},{"type":"text","value":" to set the mapping from the model to the mesh cells. For reasonable cases, we can compute and store the Jacobian explicitly for 3D problems by setting ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Y47Okv3dXQ"},{"type":"inlineCode","value":"storeJ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ouJrlcMGjP"},{"type":"text","value":" to ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RiSAezDNG8"},{"type":"inlineCode","value":"True","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GkC1B78Ria"},{"type":"text","value":". By doing this, we drastically reduce the run-time of the inversion. For larger problems being run on computers with insufficient RAM, you may need to set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SJvu0dX95v"},{"type":"inlineCode","value":"storeJ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uEsHRgDaGT"},{"type":"text","value":" to ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hyQjge458H"},{"type":"inlineCode","value":"False","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RJhf3jDmH6"},{"type":"text","value":" and invert the data without storing the sensitivities explicitly.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"r01PeYDBHa"}],"key":"kRv0u17fgL"}],"key":"rSR8pH5N6g"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:06.109434Z","iopub.status.busy":"2025-05-23T16:35:06.109182Z","iopub.status.idle":"2025-05-23T16:35:06.577232Z","shell.execute_reply":"2025-05-23T16:35:06.576481Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dc_simulation = dc.simulation.Simulation3DNodal(\n    mesh, survey=dc_data.survey, sigmaMap=log_conductivity_map, storeJ=True\n)","key":"qkvFlS9iJT"},{"type":"output","id":"wkU5n2heFEPgTxGKHsO7h","data":[],"key":"oMlAGpNS7S"}],"key":"DbINXLW1ne"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BXRChvn4mG"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit","implicit":true,"key":"Y0S2NlsAwD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To understand the role of the data misfit in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aIPtbYwqyE"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CMadqbdc5v"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"pXIJbVLLW2"},{"type":"text","value":".\nHere, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZJ2fWyO6AS"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"L2DataMisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tuVOJt1uIr"}],"urlSource":"xref:simpeg#simpeg.data_misfit.L2DataMisfit","internal":false,"protocol":"xref:sphinx","key":"vusc8pzfQi"},{"type":"text","value":" class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GDfg8TaYFD"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Q8MTD2oVVC"}],"key":"D7kawqLsRt"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Gt8ckY2LnQ"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simulation object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x0eurJJEFG"}],"key":"b3gV9ItqxQ"},{"type":"text","value":" as properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E1hsbpTogQ"}],"key":"Z8mHTtcDmC"}],"key":"CO9PE4H212"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:06.581009Z","iopub.status.busy":"2025-05-23T16:35:06.580762Z","iopub.status.idle":"2025-05-23T16:35:06.584012Z","shell.execute_reply":"2025-05-23T16:35:06.583498Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_L2 = data_misfit.L2DataMisfit(simulation=dc_simulation, data=dc_data)","key":"MuUfMPR5De"},{"type":"output","id":"VM6y1uScenX43UNyMrnWO","data":[],"key":"wv3c5MiDhW"}],"key":"ZWsc9UNnCO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K5y3D3uijM"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization","implicit":true,"key":"BmkOGp8Z3a"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To understand the role of the regularization in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rPonHVMyqL"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PWCpfBArip"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","key":"fLyarqXztJ"},{"type":"text","value":". Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AKnyDTGuVo"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"WeightedLeastSquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Gob8NXpBNn"}],"urlSource":"xref:simpeg#simpeg.regularization.WeightedLeastSquares","internal":false,"protocol":"xref:sphinx","key":"p2Ia0utNyQ"},{"type":"text","value":" regularization class to constrain the inversion result. Length scales along x, y and z are used to balance the smallness and smoothness terms. And the reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pvAgwtn9yZ"}],"key":"zQBHdzERhi"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"By default, the regularization acts on the model parameters; which in the case are the log-conductivities of the active cells. So we need to specify which cells are active in the regularization. And if we wanted to apply the regularization to a function of the model parameters, we would need to set an approprate mapping object using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vih0T4jT7j"},{"type":"inlineCode","value":"mapping","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NlhEjezhvA"},{"type":"text","value":" keyword argument.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yXtZKtr3B2"}],"key":"vjNrBqR82A"}],"key":"i0cqiKRcO5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:06.587224Z","iopub.status.busy":"2025-05-23T16:35:06.586994Z","iopub.status.idle":"2025-05-23T16:35:07.074798Z","shell.execute_reply":"2025-05-23T16:35:07.073955Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_L2 = regularization.WeightedLeastSquares(\n    mesh,\n    active_cells=active_cells,\n    length_scale_x=100.0,\n    length_scale_y=100.0,\n    length_scale_z=100.0,\n    reference_model=reference_conductivity_model,\n)","key":"KoTRQ6EHQK"},{"type":"output","id":"Qg6UR6JYi-QencMTfPg3O","data":[],"key":"xsAm6dEBiq"}],"key":"DXCsLTn5jH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G7LVLFg0No"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm","implicit":true,"key":"WTMAD1Jj3y"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pEmJvKlUk3"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.InexactGaussNewton.html#simpeg.optimization.inexactgaussnewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"InexactGaussNewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iOQpZisrE1"}],"urlSource":"xref:simpeg#simpeg.optimization.InexactGaussNewton","internal":false,"protocol":"xref:sphinx","key":"BehwdhNTSO"},{"type":"text","value":" class to solve the optimization problem using the inexact Gauss Newton with conjugate gradient solver. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kdvgNNis4w"}],"key":"yC3n2WEvD9"}],"key":"FbSuEamBGc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:07.078618Z","iopub.status.busy":"2025-05-23T16:35:07.078370Z","iopub.status.idle":"2025-05-23T16:35:07.081821Z","shell.execute_reply":"2025-05-23T16:35:07.081316Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_L2 = optimization.InexactGaussNewton(\n    maxIter=40, maxIterLS=20, maxIterCG=30, tolCG=1e-3\n)","key":"Vtr7ojViPy"},{"type":"output","id":"A0_KSc6IvDUFxyIlLSDzr","data":[],"key":"GFvSwkcjbZ"}],"key":"QALLUhAJu3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AKNYn589JT"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem","implicit":true,"key":"ftOCShvhU7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z2PHkIwuh7"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInvProblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ui3EPP1V0F"}],"urlSource":"xref:simpeg#simpeg.inverse_problem.BaseInvProblem","internal":false,"protocol":"xref:sphinx","key":"YgVHRad0Io"},{"type":"text","value":" class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o4dkDuMLip"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data misfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TrA87qFfVg"}],"key":"nyTkiBa879"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i7CL4N4ye3"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"regularization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m0Y2adcCgy"}],"key":"A26r2mtOAI"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qZxHhlaTYP"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yZbw3Ae77g"}],"key":"JGkIUmvx4z"},{"type":"text","value":" objects.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a9rx8EbTfo"}],"key":"hDXx3JD52f"}],"key":"Qtpvgr21vG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:07.085162Z","iopub.status.busy":"2025-05-23T16:35:07.084904Z","iopub.status.idle":"2025-05-23T16:35:07.087859Z","shell.execute_reply":"2025-05-23T16:35:07.087347Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)","key":"R5kbXFasiC"},{"type":"output","id":"QXDzlCIqcaJHvVmu4BxM5","data":[],"key":"gLZLhYqAva"}],"key":"ahljH8Ta6j"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zSk97DHLe2"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives","implicit":true,"key":"jX347ZRCKK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Directives represent operations that are carried out during the inversion. Here, we apply common directives for weighted least-squares inversion of DC resistivity data and describe their roles. These are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rZairh0SMB"}],"key":"Qz6SJgqsR4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iIfX9rap4J"}],"urlSource":"xref:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"OwI9qceuyz"},{"type":"text","value":": apply sensitivity weighting to counteract the natural tendency of DC resistivity inversion to place materials near the electrodes. Since the problem is non-linear and the sensitivities are updated with every model, we set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"r3X5MV6LQy"},{"type":"inlineCode","value":"every_iteration=True","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dePTtpw9MY"},{"type":"text","value":". For DC resistivity inversion, we do not want to use the entire dynamic range of the sensitivities to generate our weighting. So we generally set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lnOe1St4kM"},{"type":"inlineCode","value":"threshold_value","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Xr5dbwcF4Y"},{"type":"text","value":" to a value betwewen 1e-4 and 1e-1. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XuIZcCrg4d"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Warning: should not be used if storeJ set to False in the simulation class","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Xb5A9QkM3W"}],"key":"L0u3yY0YXh"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PMZCZHkMd5"}],"key":"HaY2aH72Sm"}],"key":"joZ2zOxejL"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fJ8rBnxmZJ"}],"urlSource":"xref:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"Ahf8vIzanp"},{"type":"text","value":": Apply Jacobi preconditioner when solving optimization problem to reduce the number of conjugate gradient iterations. We set ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"m7T5ALmdWI"},{"type":"inlineCode","value":"update_every_iteration=True","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OzCiKbzrrs"},{"type":"text","value":" because the ideal preconditioner is model-dependent. ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"H0reMOAhpH"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Warning: should not be used if storeJ set to False in the simulation class","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JzjR2HYn5N"}],"key":"oU9IBvo5Ch"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VMCEQ6E9om"}],"key":"uIVFgy19pb"}],"key":"oYgrsgIaB0"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"g8xR4WsXzV"}],"urlSource":"xref:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"QaSWlKvPoC"},{"type":"text","value":": Compute and set starting trade-off parameter (beta) based on largest eigenvalues.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ULWN6gbl1x"}],"key":"eZ02q7Kcbd"}],"key":"MjWyOg6a7X"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"n5Kdnurmhc"}],"urlSource":"xref:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"g76xytcWwc"},{"type":"text","value":": Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta. In general, a ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"hvYRuFDBa7"},{"type":"inlineCode","value":"coolingFactor","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"vyshB8q9BH"},{"type":"text","value":" between 1.5 and 2.5, and ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"a2PXavBIxj"},{"type":"inlineCode","value":"coolingRate","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"l4S5jgoVt5"},{"type":"text","value":" of 2 or 3 works well for DC resistivity inversion. Cooling beta too quickly will result in portions of the model getting trapped in local minima. And we will not be finding the solution that minimizes the optimization problem if the cooling rate is too small.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"tIVBlE1RpV"}],"key":"s2ohqljBAd"}],"key":"vT9C3Bgu43"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ETUEDT80Qp"}],"urlSource":"xref:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"nM2oMpJOv8"},{"type":"text","value":": Terminates the inversion when the data misfit equals the target misfit. A ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"u0SiwxrKYl"},{"type":"inlineCode","value":"chifact=1","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"omxaCBE1xz"},{"type":"text","value":" terminates the inversion when the data misfit equals the number of data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tBrJylFw6O"}],"key":"jizBSzqn9K"}],"key":"ZLSIKtRNVr"}],"key":"aatp8Gooog"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"The directive objects are organized in a ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"VNBVp8ye12"},{"type":"inlineCode","value":"list","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"puTBi7VJRJ"},{"type":"text","value":". Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"BEyxe9oYQ8"},{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"in order","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"sbyUCL7KhV"}],"key":"fzXOqtuFEp"},{"type":"text","value":". The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"at8Et8Wsn3"},{"type":"inlineCode","value":"BetaEstimate_ByEig","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"LYTBmZjTED"},{"type":"text","value":" are only used when starting the inversion. Other directives, like ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"a2DYxVUd3w"},{"type":"inlineCode","value":"UpdatePreconditionner","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"rr7x0tl68Z"},{"type":"text","value":", are used whenever the model is updated.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"cMXwZvw5FQ"}],"key":"agMKl3SU1b"}],"key":"tG9dTD4Iy2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:07.090161Z","iopub.status.busy":"2025-05-23T16:35:07.089939Z","iopub.status.idle":"2025-05-23T16:35:07.094653Z","shell.execute_reply":"2025-05-23T16:35:07.094089Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"if dc_simulation.storeJ:\n    sensitivity_weights = directives.UpdateSensitivityWeights(\n        every_iteration=True, threshold_value=1e-2\n    )\n    update_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)\n    directives_list_L2 = [\n        sensitivity_weights,\n        update_jacobi,\n    ]\nelse:\n    directives_list_L2 = []\n\nstarting_beta = directives.BetaEstimate_ByEig(beta0_ratio=100)\nbeta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=2)\ntarget_misfit = directives.TargetMisfit(chifact=1.0)\n\ndirectives_list_L2 += [starting_beta, beta_schedule, target_misfit]","key":"uxtYdnCFqT"},{"type":"output","id":"J8B0McDM4WbtSEBxeWCXo","data":[],"key":"XcstpBrhdD"}],"key":"ldxPrSSxQk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VVpGOgWXaK"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion","implicit":true,"key":"a1xhEaUzsE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We define the inversion using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ri1EUKyDDv"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inversion.BaseInversion.html#simpeg.inversion.baseinversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NJEj5Ogqlo"}],"urlSource":"xref:simpeg#simpeg.inversion.BaseInversion","internal":false,"protocol":"xref:sphinx","key":"apdZghNG1m"},{"type":"text","value":" class. The inversion class must be instantiated with an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jEkepsYVaj"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"inverse problem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j5fTDFYE11"}],"key":"q25oYxm9qo"},{"type":"text","value":" object and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XUDNOJc67j"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"directives list","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qzfnpnfktL"}],"key":"mvUveXd0a7"},{"type":"text","value":". The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n97e0uYiF4"},{"type":"inlineCode","value":"run","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YJJ7evpF8P"},{"type":"text","value":" method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Tb7K6M3Kvq"}],"key":"Z7MJ6pc7nz"}],"key":"oKJezA5w2o"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:35:07.097443Z","iopub.status.busy":"2025-05-23T16:35:07.096892Z","iopub.status.idle":"2025-05-23T16:55:17.874803Z","shell.execute_reply":"2025-05-23T16:55:17.874030Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Here we combine the inverse problem and the set of directives\ninv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)\n\n# Run the inversion\nrecovered_log_conductivity_model = inv_L2.run(starting_conductivity_model)","key":"o7keJb0XFG"},{"type":"output","id":"KWo6LxSarSbiDgCAF0d7p","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.24.0\n\n                        simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                        ***Done using same Solver, and solver_opts as the Simulation3DNodal problem***\n                        \n"},{"name":"stderr","output_type":"stream","text":"/t40array/ssoler/miniforge3/envs/simpeg-user-tutorials/lib/python3.12/site-packages/simpeg/base/pde_simulation.py:490: DefaultSolverWarning: Using the default solver: Pardiso. \n\nIf you would like to suppress this notification, add \nwarnings.filterwarnings('ignore', simpeg.utils.solver_utils.DefaultSolverWarning)\n to your script.\n  return get_default_solver(warn=True)\n"},{"name":"stderr","output_type":"stream","text":"/t40array/ssoler/miniforge3/envs/simpeg-user-tutorials/lib/python3.12/site-packages/pymatsolver/solvers.py:415: FutureWarning: In Future pymatsolver v0.4.0, passing a vector of shape (n, 1) to the solve method will return an array with shape (n, 1), instead of always returning a flattened array. This is to be consistent with numpy.linalg.solve broadcasting.\n  return self.solve(val)\n"},{"name":"stdout","output_type":"stream","text":"model has any nan: 0\n============================ Inexact Gauss Newton ============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n"},{"name":"stdout","output_type":"stream","text":"   0  7.57e-06  1.57e+04  0.00e+00  1.57e+04    1.18e+03      0              \n"},{"name":"stdout","output_type":"stream","text":"   1  7.57e-06  7.33e+03  1.82e+08  8.71e+03    1.14e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   2  3.79e-06  7.44e+03  1.51e+08  8.02e+03    2.64e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  3.79e-06  6.34e+03  3.77e+08  7.76e+03    3.40e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"   4  1.89e-06  6.41e+03  3.52e+08  7.08e+03    2.35e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   5  1.89e-06  5.20e+03  8.37e+08  6.78e+03    2.52e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"   6  9.47e-07  5.23e+03  8.10e+08  5.99e+03    2.12e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   7  9.47e-07  3.97e+03  1.78e+09  5.66e+03    2.19e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"   8  4.73e-07  3.96e+03  1.77e+09  4.80e+03    1.84e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   9  4.73e-07  2.83e+03  3.51e+09  4.49e+03    1.98e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  10  2.37e-07  2.81e+03  3.50e+09  3.64e+03    1.50e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  11  2.37e-07  1.95e+03  6.18e+09  3.42e+03    1.61e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  12  1.18e-07  1.96e+03  6.08e+09  2.68e+03    1.13e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  13  1.18e-07  1.37e+03  9.88e+09  2.54e+03    1.24e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  14  5.92e-08  1.39e+03  9.61e+09  1.96e+03    7.95e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  15  5.92e-08  9.92e+02  1.51e+10  1.88e+03    9.99e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  16  2.96e-08  1.01e+03  1.46e+10  1.44e+03    5.43e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  17  2.96e-08  7.36e+02  2.22e+10  1.39e+03    7.82e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  18  1.48e-08  7.44e+02  2.17e+10  1.07e+03    3.57e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 <= tolF*(1+|f0|) = 1.5668e+03\n1 : |xc-x_last| = 2.5603e+01 <= tolX*(1+|x0|) = 1.2249e+02\n0 : |proj(x-g)-x|    = 3.5715e+01 <= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 3.5715e+01 <= 1e3*eps       = 1.0000e-02\n0 : maxIter   =      40    <= iter          =     19\n------------------------- DONE! -------------------------\n"}],"key":"Dc0NPbWDhr"}],"key":"SjVgBDC3Yj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analyzing Inversion Outputs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oJ0iBT5udg"}],"identifier":"analyzing-inversion-outputs","label":"Analyzing Inversion Outputs","html_id":"analyzing-inversion-outputs","implicit":true,"key":"hw8bvpUb0I"}],"key":"PHWTjC5Foc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Normalized Data Misfit in 3D Pseudosection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x2y0EfxHex"}],"identifier":"plot-normalized-data-misfit-in-3d-pseudosection","label":"Plot Normalized Data Misfit in 3D Pseudosection","html_id":"plot-normalized-data-misfit-in-3d-pseudosection","implicit":true,"key":"FVrhlkaQN2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To see how well the recovered model reproduces the observed data, it is a good idea to compare the predicted and observed data.\nHere, we plot the normalized data misfit to determine whether the observed data are fit evenly. Correlated signatures in the normalized data misfits indicate we are overfitting/underfitting certain data. And that we must modify our uncertainties and re-run the inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ufs8uZdSqe"}],"key":"FrIWvYwbwe"}],"key":"GxyDKQVQzm"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:55:17.879376Z","iopub.status.busy":"2025-05-23T16:55:17.878058Z","iopub.status.idle":"2025-05-23T16:55:17.887806Z","shell.execute_reply":"2025-05-23T16:55:17.887111Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Predicted data from recovered model\ndpred_dc = inv_prob_L2.dpred\n\n# Compute the normalized data misfit\ndc_normalized_misfit = (dc_data.dobs - dpred_dc) / dc_data.standard_deviation\n\nif has_plotly:\n    fig = plot_3d_pseudosection(\n        dc_data.survey,\n        dc_normalized_misfit,\n        scale=\"linear\",\n        units=\"\",\n        vlim=[-2.5, 2.5],\n        marker_opts={\"colorscale\": \"RdBu\"},\n    )\n\n    fig.update_layout(\n        title_text=\"Normalized Data Misfit\",\n        title_x=0.5,\n        title_font_size=24,\n        width=650,\n        height=500,\n        scene_camera=dict(\n            center=dict(x=0, y=0, z=-0.4), eye=dict(x=1.5, y=-1.5, z=1.8)\n        ),\n    )\n\n    #     plotly.io.show(fig)\n    html_str = plotly.io.to_html(fig)\n    display(HTML(html_str))\n\nelse:\n    print(\"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\")","key":"qEjsckxQA5"},{"type":"output","id":"ywPF1yEdFdpZYzOUqX5yC","data":[{"name":"stdout","output_type":"stream","text":"INSTALL 'PLOTLY' TO VISUALIZE 3D PSEUDOSECTIONS\n"}],"key":"UzrUy2KioZ"}],"key":"oOXjTwokNM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot 2D Pseudosections for Individual Survey Lines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NtZQLlRwiP"}],"identifier":"plot-2d-pseudosections-for-individual-survey-lines","label":"Plot 2D Pseudosections for Individual Survey Lines","html_id":"plot-2d-pseudosections-for-individual-survey-lines","implicit":true,"key":"Z7IYvIg8xs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For large datasets comprised of many survey lines, interpretation can be challenging if we plot every datum. Here, we plot the observed data, predicted data and normalized data misfit for a specified survey line.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"drb4VjbZN7"}],"key":"GPcjOISXuI"}],"key":"RLkANEJt3h"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:55:17.891944Z","iopub.status.busy":"2025-05-23T16:55:17.890876Z","iopub.status.idle":"2025-05-23T16:55:18.432112Z","shell.execute_reply":"2025-05-23T16:55:18.431291Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Data associated with the line index provided\nline_index = 0\nk = lineID == line_index + 1\ndata_array = [\n    np.abs(dc_data.dobs[k]),\n    np.abs(dpred_dc[k]),\n    (dc_data.dobs[k] - dpred_dc[k]) / dc_data.standard_deviation[k],\n]\n\n# Plot 2D pseudosections (observed, predicted, normalized misfit)\nfig = plt.figure(figsize=(9, 11))\nplot_title = [\"Observed Voltage\", \"Predicted Voltage\", \"Normalized Misfit\"]\nplot_units = [\"V/A\", \"V/A\", \"\"]\nscale = [\"log\", \"log\", \"linear\"]\ncmap_list = [mpl.cm.viridis, mpl.cm.viridis, mpl.cm.RdYlBu]\n\nax1 = 3 * [None]\ncax1 = 3 * [None]\ncbar = 3 * [None]\ncplot = 3 * [None]\n\nfor ii in range(0, 3):\n    ax1[ii] = fig.add_axes([0.15, 0.72 - 0.33 * ii, 0.65, 0.21])\n    cax1[ii] = fig.add_axes([0.81, 0.72 - 0.33 * ii, 0.03, 0.21])\n    cplot[ii] = plot_pseudosection(\n        survey_2d_list[line_index],\n        data_array[ii],\n        \"contourf\",\n        ax=ax1[ii],\n        cax=cax1[ii],\n        scale=scale[ii],\n        cbar_label=plot_units[ii],\n        mask_topography=True,\n        contourf_opts={\"levels\": 25, \"cmap\": cmap_list[ii]},\n    )\n    ax1[ii].set_title(plot_title[ii])\n\nplt.show()","key":"uKD3fNO610"},{"type":"output","id":"ZGiasylCCMJKxqFHhskXs","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d162ce7bceaed9591f24f16312f67aca","path":"/user-tutorials/build/d162ce7bceaed9591f24f16312f67aca.png"},"text/plain":{"content":"<Figure size 900x1100 with 6 Axes>","content_type":"text/plain"}}}],"key":"EzLiy2u67M"}],"key":"Wrl6DexxHu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot True and Recovered Conductivity Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kEXVRADaJB"}],"identifier":"plot-true-and-recovered-conductivity-model","label":"Plot True and Recovered Conductivity Model","html_id":"plot-true-and-recovered-conductivity-model","implicit":true,"key":"xka68So8ij"}],"key":"jO5CB2dejB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:55:18.434765Z","iopub.status.busy":"2025-05-23T16:55:18.434396Z","iopub.status.idle":"2025-05-23T16:55:18.446473Z","shell.execute_reply":"2025-05-23T16:55:18.445806Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define conductivity model in S/m\nbackground_value = 1e-2\nconductor_value = 1e-1\nresistor_value = 1e-3\n\n# Define true model\ntrue_conductivity_model = background_value * np.ones(n_active)\n\nind_conductor = model_builder.get_indices_sphere(\n    np.r_[-300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\ntrue_conductivity_model[ind_conductor] = conductor_value\n\nind_resistor = model_builder.get_indices_sphere(\n    np.r_[300.0, 0.0, 100.0], 165.0, mesh.cell_centers[active_cells, :]\n)\ntrue_conductivity_model[ind_resistor] = resistor_value","key":"j1ZhULVEeI"},{"type":"output","id":"3XBhjqg7uon6YNDp1Azny","data":[],"key":"xYo3TbzJHW"}],"key":"bbpTfrgfMk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:55:18.448416Z","iopub.status.busy":"2025-05-23T16:55:18.448172Z","iopub.status.idle":"2025-05-23T16:55:18.451685Z","shell.execute_reply":"2025-05-23T16:55:18.450748Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Convert log-conductivities to conductivities\nrecovered_conductivity_L2 = np.exp(recovered_log_conductivity_model)","key":"fFSaMYrggz"},{"type":"output","id":"ExjQZqDPwKEqOGKNoUsKY","data":[],"key":"xlwQQqyeYE"}],"key":"DHAgac6rjw"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:55:18.454029Z","iopub.status.busy":"2025-05-23T16:55:18.453785Z","iopub.status.idle":"2025-05-23T16:55:18.460998Z","shell.execute_reply":"2025-05-23T16:55:18.460342Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define a mapping to ignore inactive cells in plot\nplotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)","key":"DQaIlzRlBJ"},{"type":"output","id":"py4XXlHaxIiFidL2dr0sW","data":[],"key":"PccfCAzex8"}],"key":"NBmVa51XAQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-05-23T16:55:18.463564Z","iopub.status.busy":"2025-05-23T16:55:18.463309Z","iopub.status.idle":"2025-05-23T16:55:19.128281Z","shell.execute_reply":"2025-05-23T16:55:19.127537Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"norm = LogNorm(vmin=1e-3, vmax=1e-1)\n\nfig = plt.figure(figsize=(10, 9))\nax1 = 2 * [None]\nax2 = 2 * [None]\ncbar = 2 * [None]\ntitle_str = [\n    \"True Conductivity Model\",\n    \"Recovered Model (L2)\",\n]\nplotting_model = [\n    true_conductivity_model,\n    recovered_conductivity_L2,\n]\n\nfor ii in range(0, 2):\n    ax1[ii] = fig.add_axes([0.14, 0.6 - 0.5 * ii, 0.68, 0.35])\n\n    temp = plotting_map * plotting_model[ii]\n\n    mesh.plot_slice(\n        temp,\n        ax=ax1[ii],\n        normal=\"Y\",\n        ind=int(len(mesh.h[1]) / 2),\n        grid=False,\n        pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm},\n    )\n    ax1[ii].set_title(title_str[ii])\n    ax1[ii].set_xlabel(\"x (m)\")\n    ax1[ii].set_ylabel(\"z (m)\")\n    ax1[ii].set_xlim([-1200, 1200])\n    ax1[ii].set_ylim([topo_xyz[:, -1].max() - 1200, topo_xyz[:, -1].max()])\n\n    ax2[ii] = fig.add_axes([0.84, 0.6 - 0.5 * ii, 0.03, 0.35])\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm, orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n    )\n    cbar[ii].set_label(r\"$\\sigma$ (S/m)\", rotation=270, labelpad=15, size=16)","key":"NMNWcRzqBt"},{"type":"output","id":"uJ6xKJgB-Ed0k1ITkG3l9","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d3a8425fd896f836a33f3bd9c1fdc6f5","path":"/user-tutorials/build/d3a8425fd896f836a33f3bd9c1fdc6f5.png"},"text/plain":{"content":"<Figure size 1000x900 with 4 Axes>","content_type":"text/plain"}}}],"key":"nJkMAyGI0k"}],"key":"bA8YTRDCju"}],"key":"GqDSaVWXAe"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"2.5D DC Resistivity Inversion","url":"/inv-dcr-2d","group":"SimPEG User Tutorials"},"next":{"title":"Induced Polarization","url":"/ip-index","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"}