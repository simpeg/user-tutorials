{"kind":"Notebook","sha256":"87ce3ec6f30bfd81560f41a45d077d400f0473f11d4465419ce08b07ed960dfc","slug":"inv-dcr-1d","location":"/notebooks/05-dcr/inv_dcr_1d.ipynb","dependencies":[],"frontmatter":{"title":"1D Inversion for a Single Sounding","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"github":"https://github.com/simpeg/user-tutorials","subject":"SimPEG User Tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"exports":[{"format":"ipynb","filename":"inv_dcr_1d.ipynb","url":"/user-tutorials/build/inv_dcr_1d-5d4783687429d011ac53988871b7115f.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Intermediate notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"anr81be2hu"}],"key":"QbkrzEqKoZ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mSw03kKFo1"}],"key":"oLIaVw4Eo3"}],"key":"EFhzrr2Du9"}],"key":"AZayeWJgQf"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Light-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FCX1iDnPmP"}],"key":"g6h9oifpJk"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial requires minimal computational resources and can be executed quickly in the background while other computer processes are running.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fQE9EMtgFR"}],"key":"cEOiKNpQGb"}],"key":"iE0EGoXieP"}],"key":"vltMgoLyQj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vVd428t7Yf"}],"key":"Wrd4rYrXgk"},{"type":"text","value":" Devin C. Cowan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"THyuHGsg1r"}],"key":"mS4KuxOGwM"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"r1wG67SZd3"}],"key":"QdwEEPBWHo"},{"type":"text","value":" DC resistivity, 1D sounding, inversion, parametric, sparse norm, apparent resistivity, wires mapping.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bglY2IXUsP"}],"key":"Jw2rXNrC5H"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Yj2GuI4zNj"}],"key":"vD6vnSkY9y"},{"type":"text","value":" Here we invert DC resistivity data for a single Wenner sounding. We demonstrate 3 approaches that can be used to invert 1D data in SimPEG:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"DqkvdW9Igj"}],"key":"UFtwGNYmld"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"A weighted least-squares inversion where the number of layers and their thicknesses are fixed.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"y3anFIRSoC"}],"key":"RSdJPzTtY0"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"An iteratively reweighted least-squares (IRLS) inversion to recover sparse and/or blocky structures.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"LfjTyfWDCK"}],"key":"uH6gy4Hykf"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"A parametric inversion where we invert for the layer thicknesses and electrical properties assuming a 3-layered Earth.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"onwRDcSOWq"}],"key":"ln8D87aNpP"}],"key":"tMXaL1lLAA"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"sqElzde5rX"},{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"weighted least-squares","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"rvt61hXfOz"}],"key":"bURIYgfkIH"},{"type":"text","value":" approach is a great introduction to geophysical inversion with SimPEG. One drawback however, is that it recovers smooth structures which may not be representative of the true model. To recover sparse and/or blocky 1D structures, we demonstrate an ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"gc3EegGaoV"},{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"iteratively reweighted least-squares","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"pwYdCoBQ9M"}],"key":"ju0djVjReo"},{"type":"text","value":" approach. If the number of layers is known, but their depths, thicknesses and conductivities are not, we can use a ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"A3php9Htcq"},{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"parametric inversion","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Rye6tsvL8U"}],"key":"bbwvW4q1RH"},{"type":"text","value":" approach.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Mbkx0u6pdF"}],"key":"Ljiz7klaSr"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"L5RgCUfQHb"}],"key":"PosqUtPHtp"},{"type":"text","value":" Because this tutorial focusses primarily on inversion-related functionality, we urge the reader to become familiar with functionality explained in the ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"yhD0i6iLzZ"},{"type":"link","url":"/fwd-dcr-1d","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"1D Forward Simulation of DC Resistivity Data","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Kt4xT09yKn"}],"urlSource":"fwd_dcr_1d.ipynb","dataUrl":"/fwd-dcr-1d.json","internal":true,"protocol":"file","key":"Xc2no32Gd0"},{"type":"text","value":" tutorial before working through this one. For this tutorial, we focus on:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"xOdnQCG1fe"}],"key":"NCzvXO3uSZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"General approaches for 1D inversion with SimPEG.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"qrKWppyaIM"}],"key":"Jl7pRURLyD"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"How to assign appropriate uncertainties to apparent resistivity or normalized voltage data.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"IA8ayMgnj9"}],"key":"k9xBiAUx4V"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Choosing suitable parameters for the inversion.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Fn6I2m1k9q"}],"key":"Fm7C8huYVH"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Specifying directives that are applied throughout the inversion.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"S4nYe3dYVe"}],"key":"uxJ3ZtadzJ"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Weighted least-squares, sparse-norm and parametric inversion.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"zoBqWmJREJ"}],"key":"NfgknPL4Kb"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Analyzing inversion outputs.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"V380hs0q2m"}],"key":"SY3JwGs9RO"}],"key":"kU2au6cEQy"}],"key":"VZ4zRhud17"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AyXTj2Y9lC"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"Jl1Xrj1U0u"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise.\nAll of the functionality specific to the forward simulation of 1D DC resistivity data are imported from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yOUc8N1Vj3"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.electromagnetics.static.resistivity.html#module-simpeg.electromagnetics.static.resistivity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg​.electromagnetics​.static​.resistivity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ib8v2TZ2ia"}],"urlSource":"myst:simpeg#simpeg.electromagnetics.static.resistivity","internal":false,"protocol":"xref:sphinx","key":"fEPpsLMdOg"},{"type":"text","value":" module. Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JvpP9S1lEp"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OACT3fCWnv"}],"urlSource":"myst:simpeg#simpeg.utils","internal":false,"protocol":"xref:sphinx","key":"S0hu7msi5M"},{"type":"text","value":". To generate the mesh used for the inversion, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dE9U4De2zE"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pzKj3BUblw"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"wgLQOtEiUK"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"evVcMmhosu"}],"key":"iQIlNS7GnV"}],"key":"aoLPOE2VXh"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:28.200413Z","iopub.status.busy":"2024-07-17T17:50:28.199792Z","iopub.status.idle":"2024-07-17T17:50:30.357648Z","shell.execute_reply":"2024-07-17T17:50:30.356315Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom simpeg.electromagnetics.static import resistivity as dc\nfrom simpeg.utils import plot_1d_layer_model, download\nfrom simpeg import (\n    maps,\n    data,\n    data_misfit,\n    regularization,\n    optimization,\n    inverse_problem,\n    inversion,\n    directives,\n)\n\n# discretize functionality\nfrom discretize import TensorMesh\n\n# Basic Python functionality\nimport os\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport tarfile\n\nmpl.rcParams.update({\"font.size\": 14})","key":"WqPQzysfAn"},{"type":"output","id":"DdiCEFophS0aQJxlI12g8","data":[],"key":"AwltkGJDs6"}],"key":"dUPR26e1rj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Download Tutorial Files","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rqKj3z01O3"}],"identifier":"download-tutorial-files","label":"Download Tutorial Files","html_id":"download-tutorial-files","implicit":true,"key":"UoEEUmXfUC"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For this tutorial, the observed data for the Wenner sounding are stored within a tar-file. Here, we download and extract the data file.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l964vVpBsw"}],"key":"tuKZvJrBRV"}],"key":"UzP9LQySh8"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:30.369285Z","iopub.status.busy":"2024-07-17T17:50:30.368219Z","iopub.status.idle":"2024-07-17T17:50:30.892771Z","shell.execute_reply":"2024-07-17T17:50:30.891331Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# URL to download from repository assets\ndata_source = \"https://github.com/simpeg/user-tutorials/raw/main/assets/05-dcr/inv_dcr_1d_files.tar.gz\"\n\n# download the data\ndownloaded_data = download(data_source, overwrite=True)\n\n# unzip the tarfile\ntar = tarfile.open(downloaded_data, \"r\")\ntar.extractall()\ntar.close()\n\n# path to the directory containing our data\ndir_path = downloaded_data.split(\".\")[0] + os.path.sep\n\n# files to work with\ndata_filename = dir_path + \"app_res_1d_data.dobs\"","key":"t0LMPdoW4E"},{"type":"output","id":"Yq2wmmVWRIgkTM_KxhbT9","data":[{"name":"stdout","output_type":"stream","text":"Downloading https://github.com/simpeg/user-tutorials/raw/main/assets/05-dcr/inv_dcr_1d_files.tar.gz\n"},{"name":"stdout","output_type":"stream","text":"   saved to: /home/ssoler/git/user-tutorials/notebooks/05-dcr/inv_dcr_1d_files.tar.gz\nDownload completed!\n"}],"key":"AFOPTkbWdp"}],"key":"pA7THkjFNZ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load and Plot the Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uv6w8yTdC4"}],"identifier":"load-and-plot-the-data","label":"Load and Plot the Data","html_id":"load-and-plot-the-data","implicit":true,"key":"vpTvJfMVhf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we load and parse the data file containing observed data and survey geometry. The data file contains the xyz locations for the A, B, M and N electrodes, in order, as well as the observed data. We then compute the AB/2 (half separation distance) and plot the Wenner sounding data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uiR1bsUZdm"}],"key":"JM90WsfhtO"}],"key":"xBWvbPb5fM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:30.897646Z","iopub.status.busy":"2024-07-17T17:50:30.897281Z","iopub.status.idle":"2024-07-17T17:50:30.903283Z","shell.execute_reply":"2024-07-17T17:50:30.902041Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load data\ndobs = np.loadtxt(str(data_filename))","key":"qbXOJjSJdr"},{"type":"output","id":"IySxQkUp8ophoWhm6Oytt","data":[],"key":"Q9eAJvSp9u"}],"key":"R1QO2rgFnY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:30.907440Z","iopub.status.busy":"2024-07-17T17:50:30.907038Z","iopub.status.idle":"2024-07-17T17:50:30.913203Z","shell.execute_reply":"2024-07-17T17:50:30.912160Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Extract A, B, M and N electrode locations and the observed data\nA_electrodes = dobs[:, 0:3]\nB_electrodes = dobs[:, 3:6]\nM_electrodes = dobs[:, 6:9]\nN_electrodes = dobs[:, 9:12]\ndobs = dobs[:, -1]","key":"qBlNaeA8we"},{"type":"output","id":"7GdwDBLBroKKieqOMw9Qa","data":[],"key":"yPQfK2ceLb"}],"key":"DOuIuKHwua"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:30.917104Z","iopub.status.busy":"2024-07-17T17:50:30.916730Z","iopub.status.idle":"2024-07-17T17:50:30.922451Z","shell.execute_reply":"2024-07-17T17:50:30.921188Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute the AB/2 separation for the 1D Wenner array\nAB_separations = np.sqrt(np.sum((A_electrodes - B_electrodes) ** 2, axis=1))","key":"Po57T8xiZX"},{"type":"output","id":"4ZcrrfDezsNRCfGc2J6AM","data":[],"key":"wHNuDQ2WnT"}],"key":"RsEYcrInks"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:30.926650Z","iopub.status.busy":"2024-07-17T17:50:30.926259Z","iopub.status.idle":"2024-07-17T17:50:31.274878Z","shell.execute_reply":"2024-07-17T17:50:31.274104Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot apparent resistivity as a function of AB/2\nfig = plt.figure(figsize=(8, 4))\nmpl.rcParams.update({\"font.size\": 14})\nax1 = fig.add_axes([0.15, 0.1, 0.7, 0.85])\nax1.semilogy(AB_separations / 2, dobs, \"b-o\")\nax1.grid(which=\"both\")\nax1.set_xlabel(\"AB/2 (m)\")\nax1.set_ylabel(r\"Apparent Resistivity ($\\Omega m$)\")\nplt.show()","key":"RTeKQiOeAo"},{"type":"output","id":"oNaEo9cmeq3pNFPKO0rrv","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"55ff44bc4f0212838d66c6f21415943b","path":"/user-tutorials/build/55ff44bc4f0212838d66c6f21415943b.png"},"text/plain":{"content":"<Figure size 800x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"kCw0vIEKHx"}],"key":"WTP0NaXibK"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Assign Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gj3U6rKXcM"}],"identifier":"assign-uncertainties","label":"Assign Uncertainties","html_id":"assign-uncertainties","implicit":true,"key":"F8nwZo3GDF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Inversion with SimPEG requires that we define the uncertainties on our data; that is, an estimate of the standard deviation of the noise on our data assuming it is uncorrelated Gaussian with zero mean. An online resource explaining uncertainties and their role in the inversion can be found ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NViioIc3MK"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iZePogwVya"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"C0aEToNGhi"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UEIyztd77G"}],"key":"R3qCHznZ2b"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For 1D apparent resistivity data,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pZMskRdveN"}],"key":"VOix8HWbUj"},{"type":"text","value":" we generally apply a percent uncertainty to all data. A percent uncertainty will fit conductive and resistive structures equally; unlike a floor uncertainty which will prioritize fitting more resistive structures. For this tutorial, we apply a 2% uncertainty to all data. Depending on the quality of the data, we may choose a percent uncertainty between 2% - 10%.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uHQBC7upvR"}],"key":"n3VrxtVTdr"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For 1D normalized voltage data,","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WAk3pKtzgO"}],"key":"HFbAqN0hQl"},{"type":"text","value":" we also tend to apply a percent uncertainty to all data. Differences in electrode spacing and subsurface conductivity result in measured voltages that span many orders of magnitude. A percent uncertainty ensures all data are fit equally. Like apparent resistivity, a percent uncertainty of 2% - 10% is a good initial guess.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OXhDPK75Uv"}],"key":"rMzJw9s6PL"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"NOTE: if the data contain very small values that you feel could be erroneous, a small floor value can be added to ensure stability of the inversion.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Dnx7I20qt3"}],"key":"gDyAC0C5km"}],"key":"W3GbRZkX8N"}],"key":"aTeZAyVIXW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.280128Z","iopub.status.busy":"2024-07-17T17:50:31.279812Z","iopub.status.idle":"2024-07-17T17:50:31.283171Z","shell.execute_reply":"2024-07-17T17:50:31.282571Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add 2.5% uncertainties to all data.\nuncertainties = 0.025 * np.abs(dobs)","key":"eGPhZOWCF3"},{"type":"output","id":"0gmzx-Bq-ko0gBY_VKXXC","data":[],"key":"nQ7aI3twWv"}],"key":"SPYd96RPpD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Survey","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VrFtjwG57c"}],"identifier":"define-the-survey","label":"Define the Survey","html_id":"define-the-survey","implicit":true,"key":"SpCdJTKIHo"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we define the survey geometry. Although the survey consists of a single 1D Wenner sounding, the approach is generalized for 2D and 3D surveys where the electrode locations may not be sorted. For a comprehensive description of constructing DC resistivity surveys in SimPEG, see the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Wk0xEtYwp8"},{"type":"link","url":"/fwd-dcr-1d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1D Forward Simulation of DC Resistivity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Uslkx46lob"}],"urlSource":"fwd_dcr_1d.ipynb","dataUrl":"/fwd-dcr-1d.json","internal":true,"protocol":"file","key":"e2hMROeFp2"},{"type":"text","value":" tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pwJEZpG9IE"}],"key":"Ne178pl519"}],"key":"Z8K82qNFT2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.287690Z","iopub.status.busy":"2024-07-17T17:50:31.287338Z","iopub.status.idle":"2024-07-17T17:50:31.292577Z","shell.execute_reply":"2024-07-17T17:50:31.291931Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Sort by unique current electrode locations\nunique_tx, k = np.unique(np.c_[A_electrodes, B_electrodes], axis=0, return_index=True)\nn_sources = len(k)\nk = np.sort(k)\nk = np.r_[k, len(k) + 1]","key":"Bv3Qgm0kVI"},{"type":"output","id":"hwh5B5QC6KntM6k2Z_thN","data":[],"key":"TbX2bIUqmt"}],"key":"hqeB7wp7md"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.295501Z","iopub.status.busy":"2024-07-17T17:50:31.295201Z","iopub.status.idle":"2024-07-17T17:50:31.305561Z","shell.execute_reply":"2024-07-17T17:50:31.304844Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define empty list for sources to live\nsource_list = []\n\n# Loop over all sources\nfor ii in range(0, n_sources):\n    # MN electrode locations for receivers. Each is an (N, 3) numpy array\n    M_locations = M_electrodes[k[ii] : k[ii + 1], :]\n    N_locations = N_electrodes[k[ii] : k[ii + 1], :]\n    receiver_list = [\n        dc.receivers.Dipole(\n            M_locations,\n            N_locations,\n            data_type=\"apparent_resistivity\",\n        )\n    ]\n\n    # AB electrode locations for source. Each is a (1, 3) numpy array\n    A_location = A_electrodes[k[ii], :]\n    B_location = B_electrodes[k[ii], :]\n    source_list.append(dc.sources.Dipole(receiver_list, A_location, B_location))\n\n# Define survey\nsurvey = dc.Survey(source_list)","key":"P181GCBs3F"},{"type":"output","id":"6iB8NjCJ61y_mBk8K3zNF","data":[],"key":"hE6yVaHS5V"}],"key":"SwtyKQYK2s"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C0paYNbW9i"}],"identifier":"define-the-data","label":"Define the Data","html_id":"define-the-data","implicit":true,"key":"KD7G7dYlWk"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The SimPEG ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S7eyymiroD"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data.Data.html#simpeg.data.data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pSI9AeMlCb"}],"urlSource":"myst:simpeg#simpeg.data.Data","internal":false,"protocol":"xref:sphinx","key":"geZ92t2BTE"},{"type":"text","value":" class is required for inversion and connects the observed data, uncertainties and survey geometry.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PfggFS9XMr"}],"key":"QBnkMX21nW"}],"key":"dV9yjToMi8"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.308943Z","iopub.status.busy":"2024-07-17T17:50:31.308712Z","iopub.status.idle":"2024-07-17T17:50:31.312580Z","shell.execute_reply":"2024-07-17T17:50:31.311927Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"data_object = data.Data(survey, dobs=dobs, standard_deviation=uncertainties)","key":"KzsFLtu6GE"},{"type":"output","id":"5g22HG_FsV8sfqwVQQ6Le","data":[],"key":"kI9eyzoxVX"}],"key":"r0C5C7jnlI"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Weighted Least-Squares Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RP15C7y4tj"}],"identifier":"weighted-least-squares-inversion","label":"Weighted Least-Squares Inversion","html_id":"weighted-least-squares-inversion","implicit":true,"key":"BInnNabnZQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the weighted least-squares inversion approach to recover the log-conductivities on a 1D layered Earth. We impose no a-priori information about the number of layers (geological units) or their thicknesses. Instead, we define a large number of layers with exponentially increasing thicknesses. And the depth, thickness and electrical properties of the Earth are inferred from the recovered model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Nl8fbJ9kiG"}],"key":"OkkijbWeuF"}],"key":"i1E0HEIAMz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a 1D Layered Earth","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J6LptLEiag"}],"identifier":"design-a-1d-layered-earth","label":"Design a 1D Layered Earth","html_id":"design-a-1d-layered-earth","implicit":true,"key":"LwcU4zwISh"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When the spacings between the electrodes are small, we are obtaining higher resolution information about the conductivity near the Earth’s surface. As a result, we define much thinner layers near the Earth’s surface. When the spacings between electrodes are large, we are obtaining lower resolution information about the conductivity at depth. So at depth, we can define layers that are much thicker. The thickness defining the top layer is ultimately determined by the minimum electrode spacing. And the thickness and depth to the lower layer is determined by the largest electrode spacing. The rate at which the layer thicknesses increase with depth is determined by the user.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vSsagNQvkY"}],"key":"JYDOGDy3FP"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For Wenner soundings:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JOXEFTEcmf"}],"key":"Aqmu49zzFD"},{"type":"text","value":" For the 1D Wenner array, the layer thicknesses and largest depth are determined by the AB/2 spacing. A reasonable minimum layer thickness is 10% the minimum AB/2 spacing. And the depth to the bottom layer should be roughly equal to the largest AB/2 spacing.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sDcGSg7Rd3"}],"key":"f2gPqbTFoZ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For dipole-dipole, pole-dipole, etc...:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VLp9CCQCXF"}],"key":"oQVUJY0rDr"},{"type":"text","value":" For these surveys, the source electrodes AB and receiver electrodes MN are offset from one another. For a particular set of electrodes ABMN, we consider the distance between the average source location and average receiver location. For a dipole-dipole survey, this would be:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sckcVk1SOH"}],"key":"QLvlgS4lA4"},{"type":"math","value":"d = \\Bigg | \\frac{\\vec{r}_A+\\vec{r}_B}{2} - \\frac{\\vec{r}_M+\\vec{r}_N}{2} \\Bigg |","position":{"start":{"line":9,"column":1},"end":{"line":11,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>d</mi><mo>=</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"3em\" maxsize=\"3em\">∣</mo><mfrac><mrow><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>A</mi></msub><mo>+</mo><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>B</mi></msub></mrow><mn>2</mn></mfrac><mo>−</mo><mfrac><mrow><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>M</mi></msub><mo>+</mo><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>N</mi></msub></mrow><mn>2</mn></mfrac><mo fence=\"false\" stretchy=\"true\" minsize=\"3em\" maxsize=\"3em\">∣</mo></mrow><annotation encoding=\"application/x-tex\">d = \\Bigg | \\frac{\\vec{r}_A+\\vec{r}_B}{2} - \\frac{\\vec{r}_M+\\vec{r}_N}{2} \\Bigg |</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.012em;vertical-align:-1.25em;\"></span><span class=\"mord\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.762em;\"><span style=\"top:-2.566em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.164em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span style=\"height:1.816em;width:0.3333em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='1.816em' style='width:0.3333em' viewBox='0 0 333.33000000000004 1816' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V1816 H145z M145 0 H188 V1816 H145z'/></svg></span></span><span style=\"top:-4.972em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.391em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.012em;vertical-align:-1.25em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.391em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.762em;\"><span style=\"top:-2.566em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.164em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span style=\"height:1.816em;width:0.3333em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='1.816em' style='width:0.3333em' viewBox='0 0 333.33000000000004 1816' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V1816 H145z M145 0 H188 V1816 H145z'/></svg></span></span><span style=\"top:-4.972em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"1","key":"mMCVMtOOcq"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"For a pole-dipole survey, this would be:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"fheYOWaa0i"}],"key":"MZSmUrMzmP"},{"type":"math","value":"\\, \nd = \\Bigg | \\, \\vec{r}_A - \\frac{\\vec{r}_M+\\vec{r}_N}{2} \\Bigg |","position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext> </mtext><mi>d</mi><mo>=</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"3em\" maxsize=\"3em\">∣</mo><mtext> </mtext><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>A</mi></msub><mo>−</mo><mfrac><mrow><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>M</mi></msub><mo>+</mo><msub><mover accent=\"true\"><mi>r</mi><mo>⃗</mo></mover><mi>N</mi></msub></mrow><mn>2</mn></mfrac><mo fence=\"false\" stretchy=\"true\" minsize=\"3em\" maxsize=\"3em\">∣</mo></mrow><annotation encoding=\"application/x-tex\">\\, \nd = \\Bigg | \\, \\vec{r}_A - \\frac{\\vec{r}_M+\\vec{r}_N}{2} \\Bigg |</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.012em;vertical-align:-1.25em;\"></span><span class=\"mord\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.762em;\"><span style=\"top:-2.566em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.164em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span style=\"height:1.816em;width:0.3333em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='1.816em' style='width:0.3333em' viewBox='0 0 333.33000000000004 1816' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V1816 H145z M145 0 H188 V1816 H145z'/></svg></span></span><span style=\"top:-4.972em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.012em;vertical-align:-1.25em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.391em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">M</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1799em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.762em;\"><span style=\"top:-2.566em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.164em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span style=\"height:1.816em;width:0.3333em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='1.816em' style='width:0.3333em' viewBox='0 0 333.33000000000004 1816' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V1816 H145z M145 0 H188 V1816 H145z'/></svg></span></span><span style=\"top:-4.972em;\"><span class=\"pstrut\" style=\"height:3.816em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"2","key":"svrloF0GXW"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Pole sources penetrate the Earth more deeply and produce smoother fields within the source region, so we can get away with a larger layer thickness for the top layer but we need to discretize deeper. But in general, it is easy to make your your top layer equal to 10% of your smallest distance. And to make the depth to the lower layer equal to the largest distance.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"iAnJ2UuDjT"}],"key":"YXGcMCdNkf"}],"key":"APgFODQLXb"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.316234Z","iopub.status.busy":"2024-07-17T17:50:31.315930Z","iopub.status.idle":"2024-07-17T17:50:31.320443Z","shell.execute_reply":"2024-07-17T17:50:31.319821Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Use Wenner electrode spacings to set discretization parameters\nprint(\"AB separations: {}\".format(AB_separations))\ndepth_min = 5.0  # top layer thickness\ndepth_max = np.max(AB_separations / 2)  # depth to lowest layer\ngeometric_factor = 1.1  # rate of thickness increase","key":"DN7IdrPBcq"},{"type":"output","id":"ngyM8miOjMROOH1l7JgHU","data":[{"name":"stdout","output_type":"stream","text":"AB separations: [  60.  120.  180.  240.  300.  360.  420.  480.  540.  600.  660.  720.\n  780.  840.  900.  960. 1020. 1080. 1140. 1200. 1260. 1320. 1380. 1440.\n 1500.]\n"}],"key":"fSv8DazuAW"}],"key":"qE4tfb3oha"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.324380Z","iopub.status.busy":"2024-07-17T17:50:31.324141Z","iopub.status.idle":"2024-07-17T17:50:31.328154Z","shell.execute_reply":"2024-07-17T17:50:31.327501Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Increase subsequent layer thicknesses by the geometric factors until\n# it reaches the maximum layer depth.\nlayer_thicknesses = [depth_min]\nwhile np.sum(layer_thicknesses) < depth_max:\n    layer_thicknesses.append(geometric_factor * layer_thicknesses[-1])\n\nn_layers = len(layer_thicknesses) + 1  # Number of layers","key":"qDcLbHzVU5"},{"type":"output","id":"aVeIBoGGr71UXNNnBm25H","data":[],"key":"pdwqFQuKLf"}],"key":"QAlygs5sB9"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define a Model and Mapping","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c4AigwYD6l"}],"identifier":"define-a-model-and-mapping","label":"Define a Model and Mapping","html_id":"define-a-model-and-mapping","implicit":true,"key":"KBf2u3cGoT"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Recall from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QLQtpX2YV6"},{"type":"link","url":"/fwd-dcr-1d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Forward Simulation of 1D Sounding DC Resistivity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lTzwvYBWNV"}],"urlSource":"fwd_dcr_1d.ipynb","dataUrl":"/fwd-dcr-1d.json","internal":true,"protocol":"file","key":"AflNIn24yo"},{"type":"text","value":" tutorial that the ‘model’ is not necessarily synonymous with physical property values. And that we need to define a mapping from the model to the set of input parameters required by the forward simulation. When inverting to recover electrical resistivities (or conductivities), it is best to use the log-value, as electrical resistivities (or conductivities) of rocks span many order of magnitude.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eDNhP0tONI"}],"key":"eDKFQ59A4C"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here, the model defines the log-resistivity values for a defined set of subsurface layers. And we use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"I3DmxjPuXa"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.ExpMap.html#simpeg.maps.expmap","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"simpeg.maps.ExpMap","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"t5ybP8ILES"}],"urlSource":"myst:simpeg#simpeg.maps.ExpMap","internal":false,"protocol":"xref:sphinx","key":"Vc1KSwKeVj"},{"type":"text","value":" to map from the model parameters to the resistivity values required by the forward simulation.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aRvRV6j8F1"}],"key":"MAM0zgJUTL"}],"key":"Ud2UrUVviX"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.331202Z","iopub.status.busy":"2024-07-17T17:50:31.330854Z","iopub.status.idle":"2024-07-17T17:50:31.334824Z","shell.execute_reply":"2024-07-17T17:50:31.334135Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"log_resistivity_map = maps.ExpMap(nP=n_layers)","key":"mU8eRKmS78"},{"type":"output","id":"Lyrnu0vvrjOqWleuTEHib","data":[],"key":"EF3nmEd9nm"}],"key":"XlqRLRTiAC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting/Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IZG6in6Sef"}],"identifier":"starting-reference-models","label":"Starting/Reference Models","html_id":"starting-reference-models","implicit":true,"key":"IkoczsNy1s"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YSMONMNWCb"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"starting model","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nG83gYcryo"}],"key":"b76WQF2LXg"},{"type":"text","value":" defines a reasonable starting point for the inversion. Because electromagnetic problems are non-linear, your choice in starting model does have an impact on the recovered model. For DC resistivity inversion, we generally choose our starting model based on apparent resistivities. For the tutorial example, the apparent resistivities were near 1000 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cjnkPDDztD"},{"type":"inlineMath","value":"\\Omega m","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Ω</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">\\Omega m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Ω</span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"cs17Ogey3n"},{"type":"text","value":". It should be noted that the starting model ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MizBtS2GMS"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cannot be vector of zeros,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cXdkHT2Eco"}],"key":"qGPyhP7EHS"},{"type":"text","value":" otherwise the inversion will be unable to compute a gradient direction at the first iteration.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FggxmwVpop"}],"key":"cZYrYCgY2I"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"o4hT3e0Cjl"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"reference model","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NtekUX08wu"}],"key":"CgOK8drHeu"},{"type":"text","value":" is used to include a-priori information. The impact of the reference model on the inversion will be discussed in another tutorial. The reference model for basic inversion approaches is either zero or equal to the starting model.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"x4d75DH2KS"}],"key":"ldSy9TDKnG"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Notice that the length of the starting and reference models is equal to the number of model parameters!!!","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cOAPsSexwu"}],"key":"OAwuyIKhnf"}],"key":"rpGaTSC7wG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.338244Z","iopub.status.busy":"2024-07-17T17:50:31.337890Z","iopub.status.idle":"2024-07-17T17:50:31.342121Z","shell.execute_reply":"2024-07-17T17:50:31.341372Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Starting model is log-resistivity values (Ohmm)\nstarting_resistivity_model = np.log(1e3 * np.ones(n_layers))\n\n# Reference model is also log-resistivity values (Ohmm)\nreference_resistivity_model = starting_resistivity_model.copy()","key":"qGfIHoLyXn"},{"type":"output","id":"d8ZnE4_2TJeI37ss9piD6","data":[],"key":"heDH1cuUxf"}],"key":"KCDhNEeSN3"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T57ZVk24mW"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"ciOcHOHTMN"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for 1D DC resistivity was discussed in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yaYUejy2M4"},{"type":"link","url":"/fwd-dcr-1d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1D Forward Simulation of DC Resistivity Data for a Single Sounding","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"giwNzd2kd5"}],"urlSource":"fwd_dcr_1d.ipynb","dataUrl":"/fwd-dcr-1d.json","internal":true,"protocol":"file","key":"oye8ouQ4E3"},{"type":"text","value":" tutorial. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uX79Ey6aH1"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.electromagnetics.static.resistivity.Simulation1DLayers.html#simpeg.electromagnetics.static.resistivity.simulation1dlayers","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Simulation1DLayers","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AnHkjTg9mR"}],"urlSource":"myst:simpeg#simpeg.electromagnetics.static.resistivity.Simulation1DLayers","internal":false,"protocol":"xref:sphinx","key":"b1xYOiGHXb"},{"type":"text","value":" which simulates the data according to a 1D Hankel transform solution.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yhtJZwHB9i"}],"key":"H6YbIhUzF4"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The layer thicknesses are a static property of the simulation, and we set them using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bgMeLzPo3c"},{"type":"inlineCode","value":"thicknessess","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DZetJ9HRix"},{"type":"text","value":" keyword argument. Since our model consists of log-resistivities, we use ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jK8c9WMRfc"},{"type":"inlineCode","value":"rhoMap","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GBUhApmhk7"},{"type":"text","value":" to set the mapping from the model to the layer resistivities.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RoCyaXwOuS"}],"key":"PtQwCt9eSR"}],"key":"SMHxehcwua"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.345537Z","iopub.status.busy":"2024-07-17T17:50:31.345209Z","iopub.status.idle":"2024-07-17T17:50:31.352001Z","shell.execute_reply":"2024-07-17T17:50:31.351339Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_L2 = dc.simulation_1d.Simulation1DLayers(\n    survey=survey,\n    rhoMap=log_resistivity_map,\n    thicknesses=layer_thicknesses,\n)","key":"zkJzdYiNqk"},{"type":"output","id":"F8GxMtz_0v-EtUqOTIkV_","data":[],"key":"ldmFivtaMX"}],"key":"hSN2IFBXzD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iRvgZBxBQV"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit","implicit":true,"key":"Ii7MQpApDF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To understand the role of the data misfit in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H5VhzTSkfs"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U4VCy4xJAz"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"Ptu4XYx4Ep"},{"type":"text","value":".\nHere, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kyQFkH1gu1"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"L2DataMisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QEiRx3CoId"}],"urlSource":"myst:simpeg#simpeg.data_misfit.L2DataMisfit","internal":false,"protocol":"xref:sphinx","key":"k8kNjFcPVW"},{"type":"text","value":" class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iFQYB3ny5w"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zx9sm3p8fG"}],"key":"cC1W87Rxad"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GPrU6hK4I9"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simulation object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dkkKmTA3cS"}],"key":"n1cggwv6sK"},{"type":"text","value":" as properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BYqXUYgYaI"}],"key":"PCqKqE4Ql4"}],"key":"iF5agxoSqK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.355579Z","iopub.status.busy":"2024-07-17T17:50:31.355236Z","iopub.status.idle":"2024-07-17T17:50:31.358999Z","shell.execute_reply":"2024-07-17T17:50:31.358390Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_L2 = data_misfit.L2DataMisfit(simulation=simulation_L2, data=data_object)","key":"WV4sebr3n6"},{"type":"output","id":"G10dr-b9oEw3gCk6RgGy_","data":[],"key":"rs5Q5bwOgB"}],"key":"m7MGIo9qtJ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"taiffNJKWQ"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization","implicit":true,"key":"nAbkHuQjI3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To understand the role of the regularization in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TqYncq2bsw"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HWXU7J9HMx"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","key":"BF5XhdJGTE"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gTT0HhJclc"}],"key":"G4UdBP5CoT"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"To define the regularization within SimPEG, we must define a 1D ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"X51t788E3D"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"tensor mesh","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Mr2dN8mrjQ"}],"urlSource":"myst:discretize#discretize.TensorMesh","internal":false,"protocol":"xref:sphinx","key":"GzTmvK787v"},{"type":"text","value":". Meshes are designed using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aQMHrId9RD"},{"type":"link","url":"https://discretize.simpeg.xyz","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"discretize package","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JXpFDNVpi5"}],"urlSource":"https://discretize.simpeg.xyz","key":"eTHbtaxgZT"},{"type":"text","value":". Whereas layer ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"a1EopEzEVj"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"thicknesses","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZHoFxVLOH4"}],"key":"POeSPw36ry"},{"type":"text","value":" and our ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ynXNzFTD8V"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"model","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sRhAGAmKrQ"}],"key":"XJtSwGVezL"},{"type":"text","value":" are defined from our top-layer down, tensor meshes are defined from the bottom up. So to define a 1D tensor mesh for the regularization, we:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UV07DGFCWc"}],"key":"eoCQLuTvM9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"add an extra layer to the end of our thicknesses so that the number of cells in the 1D mesh equals the number of model parameters","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xQr0B8LMqo"}],"key":"iIt2kyvMxw"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"reverse the order so that the model parameters in the regularization match up with the appropriate cell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"I5WX1EYB64"}],"key":"RyHzA4zvYB"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"define the tensor mesh from the cell widths","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zyq0Wx0Pco"}],"key":"QuVtLbCVUt"}],"key":"FnHugepUlD"}],"key":"aqu4SQI7Xu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.362489Z","iopub.status.busy":"2024-07-17T17:50:31.362200Z","iopub.status.idle":"2024-07-17T17:50:31.368395Z","shell.execute_reply":"2024-07-17T17:50:31.367614Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define 1D cell widths\nh = np.r_[layer_thicknesses, layer_thicknesses[-1]]\nh = np.flipud(h)\n\n# Create regularization mesh\nregularization_mesh = TensorMesh([h], \"N\")\nprint(regularization_mesh)","key":"GXtfW6BJvr"},{"type":"output","id":"aBP3f0t2kCXlUdBuwnc-V","data":[{"name":"stdout","output_type":"stream","text":"\n  TensorMesh: 31 cells\n\n                      MESH EXTENT             CELL WIDTH      FACTOR\n  dir    nC        min           max         min       max      max\n  ---   ---  ---------------------------  ------------------  ------\n   x     31       -901.79         -0.00      5.00     79.32    1.10\n\n\n"}],"key":"RWvuJD3s66"}],"key":"wQdBgH6pEq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"By default, the regularization acts on the model parameters. In this case, the model parameters are the log-resistivities, not the electric resistivities!!! Here, we use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OD3ZIVBBie"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"WeightedLeastSquares","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RKmT4c6zwJ"}],"urlSource":"myst:simpeg#simpeg.regularization.WeightedLeastSquares","internal":false,"protocol":"xref:sphinx","key":"ZErvQRFdcg"},{"type":"text","value":" regularization class to constrain the inversion result. Here, length scale along x are used to balance the smallness and smoothness terms; yes, x is smoothness along the vertical direction. And the reference model is only applied to the smallness term. If we wanted to apply the regularization to a function of the model parameters, we would need to set an approprate mapping object using the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ltiHGm43fe"},{"type":"inlineCode","value":"mapping","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oiZzfM5jkH"},{"type":"text","value":" keyword argument.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dzpik2Wi3A"}],"key":"C9cdLNHTjb"}],"key":"DRaWATCwvy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.372223Z","iopub.status.busy":"2024-07-17T17:50:31.371837Z","iopub.status.idle":"2024-07-17T17:50:31.380441Z","shell.execute_reply":"2024-07-17T17:50:31.379751Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_L2 = regularization.WeightedLeastSquares(\n    regularization_mesh,\n    length_scale_x=1.0,\n    reference_model=reference_resistivity_model,\n    reference_model_in_smooth=False,\n)","key":"AKqCyGgSkF"},{"type":"output","id":"NTevS5mcn8t3KQM3agLpf","data":[],"key":"EfRtn49hwt"}],"key":"LbAdYaPi1B"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sF019c9fFe"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm","implicit":true,"key":"IjcUqw7lGa"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"azVdQ9VbPW"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.InexactGaussNewton.html#simpeg.optimization.inexactgaussnewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"InexactGaussNewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RSLrMz3kBE"}],"urlSource":"myst:simpeg#simpeg.optimization.InexactGaussNewton","internal":false,"protocol":"xref:sphinx","key":"XoYlhAjjfc"},{"type":"text","value":" class to solve the optimization problem using the inexact Gauss Newton with conjugate gradient solver. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EHamrP8hlM"}],"key":"plm0SIJiS1"}],"key":"BznHRwi67o"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.383699Z","iopub.status.busy":"2024-07-17T17:50:31.383324Z","iopub.status.idle":"2024-07-17T17:50:31.387356Z","shell.execute_reply":"2024-07-17T17:50:31.386720Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_L2 = optimization.InexactGaussNewton(\n    maxIter=100, maxIterLS=20, maxIterCG=20, tolCG=1e-3\n)","key":"PKmUNc8omo"},{"type":"output","id":"4h3QeaXkhQ5FPgHGSuzhK","data":[],"key":"Fe9DS4H9E8"}],"key":"Sc64DPl9ij"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qtk1CpGHau"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem","implicit":true,"key":"Mu7REV2Ti5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wSChpTMBBh"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInvProblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tAMc10yX3z"}],"urlSource":"myst:simpeg#simpeg.inverse_problem.BaseInvProblem","internal":false,"protocol":"xref:sphinx","key":"ddVzq6ai8K"},{"type":"text","value":" class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"y56cZDoCea"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data misfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l9JgoD384D"}],"key":"OaT80TRjNP"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T9t9U9Ck7K"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"regularization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zrAueCfZHf"}],"key":"XMdLStifY8"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"staRHrpWpF"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TPG7Fc6FM7"}],"key":"tGkJoRYWDD"},{"type":"text","value":" objects.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"F9K9sA9MGt"}],"key":"Z2IQfnGdrW"}],"key":"jtfIj91mhf"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.390648Z","iopub.status.busy":"2024-07-17T17:50:31.390412Z","iopub.status.idle":"2024-07-17T17:50:31.393999Z","shell.execute_reply":"2024-07-17T17:50:31.393396Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)","key":"Z6WiJVWOux"},{"type":"output","id":"cCNdJ_IofMs2RhtC_JVbb","data":[],"key":"vkWvCxBYrO"}],"key":"MZFKvMuxqe"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KT5lelDAGX"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives","implicit":true,"key":"ybSSVNcSaS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Directives represent operations that are carried out during the inversion. Here, we apply common directives for weighted least-squares inversion of DC resistivity data and describe their roles. These are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ujwo3hRYnj"}],"key":"oGnBo54zJW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hcEkvE8SJn"}],"urlSource":"myst:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"EXOOhTWfwS"},{"type":"text","value":": Apply sensitivity weighting to counteract the natural tendency of DC resistivity inversion to place materials near the electrodes. Since the problem is non-linear and the sensitivities are updated with every model, we set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RuxR6HSh2J"},{"type":"inlineCode","value":"every_iteration=True","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HDrIdHbgiE"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OsE2unX2ZS"}],"key":"dGa7g2iZn7"}],"key":"npjO1ajnnK"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xqBj46zpBw"}],"urlSource":"myst:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"cwgoPqNsJB"},{"type":"text","value":": Apply Jacobi preconditioner when solving optimization problem to reduce the number of conjugate gradient iterations. We set ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Bq2XT95h0i"},{"type":"inlineCode","value":"update_every_iteration=True","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"LBYYAufKC7"},{"type":"text","value":" because the ideal preconditioner is model-dependent.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KyLd1kqhuf"}],"key":"RngnTFnRZH"}],"key":"w3IH5K5WE0"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Nvk96rZfHs"}],"urlSource":"myst:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"vHthxie1K4"},{"type":"text","value":": Compute and set starting trade-off parameter (beta) based on largest eigenvalues.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GhtR2e6zpL"}],"key":"VTI2qts6AX"}],"key":"r1hmG3f3x7"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"uzs0pgo6MC"}],"urlSource":"myst:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"OxCCYGpxj6"},{"type":"text","value":": Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta. In general, a ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"i36qKLmTR5"},{"type":"inlineCode","value":"coolingFactor","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"XPGL3QVsYw"},{"type":"text","value":" between 1.5 and 2.5, and ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DDlRekMoFc"},{"type":"inlineCode","value":"coolingRate","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gAOHpu7Pqg"},{"type":"text","value":" of 2 or 3 works well for DC resistivity inversion. Cooling beta too quickly will result in portions of the model getting trapped in local minima. And we will not be finding the solution that minimizes the optimization problem if the cooling rate is too small.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"NY5GT3asrE"}],"key":"ZWwzjDLh1U"}],"key":"MPWMcqjbW2"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"H6R83vkyZO"}],"urlSource":"myst:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"qKnLLXzDSu"},{"type":"text","value":": Terminates the inversion when the data misfit equals the target misfit. A ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"vlOo1KPtnV"},{"type":"inlineCode","value":"chifact=1","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"MANXqdXR99"},{"type":"text","value":" terminates the inversion when the data misfit equals the number of data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xZIXLhVcBP"}],"key":"VqX8MlNkbf"}],"key":"ym0pljWri1"}],"key":"AM4l1tTwAV"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"The directive objects are organized in a ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Vin7wTlDnw"},{"type":"inlineCode","value":"list","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"xTnWL4nqc1"},{"type":"text","value":". Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"DonhAsJ4i4"},{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"in order","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zbf19IEQ11"}],"key":"e4VjPv3DE2"},{"type":"text","value":". The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Nu20SLLyDa"},{"type":"inlineCode","value":"BetaEstimate_ByEig","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"eT3o0wRDtr"},{"type":"text","value":" are only used when starting the inversion. Other directives, like ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Sy4TrIaWa3"},{"type":"inlineCode","value":"UpdatePreconditionner","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"WxGbCzmHVb"},{"type":"text","value":", are used whenever the model is updated.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"AsTA4LWnDM"}],"key":"BR6uEt7HIw"}],"key":"cMzAnYMQcO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.397658Z","iopub.status.busy":"2024-07-17T17:50:31.397337Z","iopub.status.idle":"2024-07-17T17:50:31.403375Z","shell.execute_reply":"2024-07-17T17:50:31.402635Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights = directives.UpdateSensitivityWeights(every_iteration=True)\nupdate_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)\nstarting_beta = directives.BetaEstimate_ByEig(beta0_ratio=5)\nbeta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=2)\ntarget_misfit = directives.TargetMisfit(chifact=1.0)\n\ndirectives_list_L2 = [\n    sensitivity_weights,\n    update_jacobi,\n    starting_beta,\n    beta_schedule,\n    target_misfit,\n]","key":"hd4JeMOotR"},{"type":"output","id":"63-9YEWBPZHzK46AXDYEV","data":[],"key":"YeSGqQs8ca"}],"key":"WGOdMcc4DT"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tkR7alsMQi"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion","implicit":true,"key":"mFjDb5t2Yz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We define the inversion using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TdJ7zDjDDq"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inversion.BaseInversion.html#simpeg.inversion.baseinversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oIcWocsEDy"}],"urlSource":"myst:simpeg#simpeg.inversion.BaseInversion","internal":false,"protocol":"xref:sphinx","key":"ZzuRo3FuQ6"},{"type":"text","value":" class. The inversion class must be instantiated with an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IBG7tzoVH0"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"inverse problem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FOU9Geapwa"}],"key":"mFQnkjuB0E"},{"type":"text","value":" object and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ukGbsO8cXq"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"directives list","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CKutCwOT8B"}],"key":"cyaYZirEYQ"},{"type":"text","value":". The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n28Njz4UfU"},{"type":"inlineCode","value":"run","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZfVhHvsSYD"},{"type":"text","value":" method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aW1vnxdkQP"}],"key":"TepoDQDjUz"}],"key":"YgREOdfzE7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:31.407000Z","iopub.status.busy":"2024-07-17T17:50:31.406629Z","iopub.status.idle":"2024-07-17T17:50:35.931743Z","shell.execute_reply":"2024-07-17T17:50:35.930908Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Here we combine the inverse problem and the set of directives\ninv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)\n\n# Run the inversion\nrecovered_model_L2 = inv_L2.run(starting_resistivity_model)","key":"sNc1weHWcL"},{"type":"output","id":"3GBmvZhHOyq-aSkC9Xaxd","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\n\n                        simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                        ***Done using same Solver, and solver_opts as the Simulation1DLayers problem***\n                        \n"},{"name":"stdout","output_type":"stream","text":"model has any nan: 0\n============================ Inexact Gauss Newton ============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n"},{"name":"stdout","output_type":"stream","text":"   0  4.63e+02  1.42e+03  0.00e+00  1.42e+03    1.88e+03      0              \n   1  4.63e+02  1.08e+03  3.18e-01  1.23e+03    4.59e+01      0              \n"},{"name":"stderr","output_type":"stream","text":"/home/ssoler/mambaforge/envs/simpeg-user-tutorials/lib/python3.10/site-packages/simpeg/optimization.py:1072: UserWarning: tol is not a valid keyword for cg and will be ignored\n  Hinv = SolverICG(\n"},{"name":"stdout","output_type":"stream","text":"   2  2.31e+02  1.08e+03  3.32e-01  1.15e+03    7.61e+02      0   Skip BFGS  \n   3  2.31e+02  8.95e+02  9.08e-01  1.11e+03    2.34e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"   4  1.16e+02  8.91e+02  9.27e-01  9.98e+02    6.40e+02      0   Skip BFGS  \n   5  1.16e+02  6.98e+02  2.15e+00  9.47e+02    1.97e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"   6  5.78e+01  6.95e+02  2.17e+00  8.21e+02    4.95e+02      0   Skip BFGS  \n   7  5.78e+01  5.20e+02  4.45e+00  7.78e+02    1.80e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"   8  2.89e+01  5.21e+02  4.43e+00  6.50e+02    3.57e+02      0              \n   9  2.89e+01  3.70e+02  8.58e+00  6.19e+02    2.41e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  10  1.45e+01  3.78e+02  8.31e+00  4.98e+02    2.48e+02      0              \n  11  1.45e+01  2.52e+02  1.56e+01  4.78e+02    3.24e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  12  7.23e+00  2.64e+02  1.46e+01  3.70e+02    1.69e+02      0              \n  13  7.23e+00  1.66e+02  2.69e+01  3.60e+02    3.99e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  14  3.61e+00  1.80e+02  2.44e+01  2.68e+02    1.14e+02      0              \n  15  3.61e+00  1.09e+02  4.35e+01  2.66e+02    4.59e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  16  1.81e+00  1.22e+02  3.84e+01  1.92e+02    7.60e+01      0              \n  17  1.81e+00  7.33e+01  6.65e+01  1.93e+02    5.03e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  18  9.04e-01  8.42e+01  5.76e+01  1.36e+02    4.95e+01      0              \n  19  9.04e-01  5.20e+01  9.73e+01  1.40e+02    5.36e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  20  4.52e-01  6.01e+01  8.32e+01  9.77e+01    3.10e+01      0              \n  21  4.52e-01  3.95e+01  1.32e+02  9.90e+01    5.32e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  22  2.26e-01  4.38e+01  1.21e+02  7.11e+01    1.73e+01      0              \n  23  2.26e-01  3.21e+01  1.50e+02  6.59e+01    4.05e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  24  1.13e-01  3.20e+01  1.47e+02  4.86e+01    9.77e+00      0              \n  25  1.13e-01  2.67e+01  1.71e+02  4.60e+01    3.03e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  26  5.65e-02  2.66e+01  1.70e+02  3.62e+01    4.58e+00      0              \n------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 <= tolF*(1+|f0|) = 1.4241e+02\n1 : |xc-x_last| = 4.9959e-01 <= tolX*(1+|x0|) = 3.9461e+00\n0 : |proj(x-g)-x|    = 4.5814e+00 <= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 4.5814e+00 <= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    <= iter          =     27\n------------------------- DONE! -------------------------\n"}],"key":"rLRoCpI9WK"}],"key":"jLfKsDUNxi"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed and Predicted Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qgibin6gUJ"}],"identifier":"plot-observed-and-predicted-data","label":"Plot Observed and Predicted Data","html_id":"plot-observed-and-predicted-data","implicit":true,"key":"BAbKNFAE98"}],"key":"Px0RbQMO1T"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:35.936435Z","iopub.status.busy":"2024-07-17T17:50:35.936191Z","iopub.status.idle":"2024-07-17T17:50:36.202819Z","shell.execute_reply":"2024-07-17T17:50:36.201638Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the true and apparent resistivities on a sounding curve\nfig = plt.figure(figsize=(11, 5))\nax1 = fig.add_axes([0.2, 0.1, 0.6, 0.8])\nax1.semilogy(AB_separations / 2, dobs, \"k\")\nax1.semilogy(AB_separations / 2, simulation_L2.dpred(recovered_model_L2), \"b\")\nax1.grid(which=\"both\")\nax1.set_xlabel(\"AB/2 (m)\")\nax1.set_ylabel(r\"Apparent Resistivity ($\\Omega m$)\")\nax1.legend([\"Observed\", \"L2 Inversion\"])\nplt.show()","key":"gz2IMAP8XL"},{"type":"output","id":"gDTd_JVzstoHLBWdi7seG","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2917c684354ad34dcb55d491eb4ef466","path":"/user-tutorials/build/2917c684354ad34dcb55d491eb4ef466.png"},"text/plain":{"content":"<Figure size 1100x500 with 1 Axes>","content_type":"text/plain"}}}],"key":"JWoyKgIqKJ"}],"key":"JtjJxMsMpi"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Recovered Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m8cSoIbdw9"}],"identifier":"plot-the-recovered-model","label":"Plot the Recovered Model","html_id":"plot-the-recovered-model","implicit":true,"key":"ZzFtcS1x4t"}],"key":"RBy36h8OiY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.208038Z","iopub.status.busy":"2024-07-17T17:50:36.207492Z","iopub.status.idle":"2024-07-17T17:50:36.213192Z","shell.execute_reply":"2024-07-17T17:50:36.212384Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define true model and layer thicknesses\ntrue_resistivities = np.r_[1e3, 4e3, 2e2]\ntrue_layers = np.r_[100.0, 100.0]","key":"fMAqp1iKZB"},{"type":"output","id":"OlQzz-Wf76nOEFlznbtLQ","data":[],"key":"GjL9DEDY5b"}],"key":"kOzRMZnedO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.217726Z","iopub.status.busy":"2024-07-17T17:50:36.217359Z","iopub.status.idle":"2024-07-17T17:50:36.431037Z","shell.execute_reply":"2024-07-17T17:50:36.430285Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot true model and recovered model\nfig = plt.figure(figsize=(6, 6))\n\nax1 = fig.add_axes([0.2, 0.15, 0.7, 0.7])\nplot_1d_layer_model(true_layers, true_resistivities, ax=ax1, color=\"k\")\nplot_1d_layer_model(\n    layer_thicknesses, log_resistivity_map * recovered_model_L2, ax=ax1, color=\"b\"\n)\nx_min, x_max = true_resistivities.min(), true_resistivities.max()\nax1.set_xlim(0.9 * x_min, 1.1 * x_max)\nax1.grid()\nax1.set_xlabel(r\"Resistivity ($\\Omega m$)\")\nax1.legend([\"True Model\", \"L2-Model\"])\nplt.show()","key":"KT9gKwMWlU"},{"type":"output","id":"NcOXlNHFt6gu8ifrTzv8o","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e368017b6cfc6fb7fd94cd2ae690517e","path":"/user-tutorials/build/e368017b6cfc6fb7fd94cd2ae690517e.png"},"text/plain":{"content":"<Figure size 600x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"JKPhlkJj6Z"}],"key":"Q1O1KWrASF"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Iteratively Re-weighted Least-Squares Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OlILzVcFio"}],"identifier":"iteratively-re-weighted-least-squares-inversion","label":"Iteratively Re-weighted Least-Squares Inversion","html_id":"iteratively-re-weighted-least-squares-inversion","implicit":true,"key":"qC7dUAvW7y"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the iteratively reweighted least-squares (IRLS) inversion approach to recover sparse and/or blocky models on the set layers.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SNyLfmf1ep"}],"key":"RQwrvwOlMk"}],"key":"ECJboZBqYM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NRtGi2NWXH"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation-1","implicit":true,"key":"TN7Qf3b0Pr"}],"key":"zHzqqYce5A"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.435652Z","iopub.status.busy":"2024-07-17T17:50:36.435299Z","iopub.status.idle":"2024-07-17T17:50:36.439594Z","shell.execute_reply":"2024-07-17T17:50:36.438919Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_irls = dc.simulation_1d.Simulation1DLayers(\n    survey=survey,\n    rhoMap=log_resistivity_map,\n    thicknesses=layer_thicknesses,\n)","key":"s8jaMPtSEz"},{"type":"output","id":"NhlPXG4ZlY0pXZrcNUXev","data":[],"key":"TgN3vcNzpd"}],"key":"sknbrioo0O"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fycGdpF6tE"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit-1","implicit":true,"key":"mnOeTDqlEB"}],"key":"Ml06eYwkMG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.443970Z","iopub.status.busy":"2024-07-17T17:50:36.443673Z","iopub.status.idle":"2024-07-17T17:50:36.448242Z","shell.execute_reply":"2024-07-17T17:50:36.447437Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_irls = data_misfit.L2DataMisfit(simulation=simulation_irls, data=data_object)","key":"Pz4t6VuhUN"},{"type":"output","id":"oU667RWTDWYnKTClDQf-o","data":[],"key":"slnk1woAgs"}],"key":"LbeOBquFmZ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SDGAMDQQmm"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization-1","implicit":true,"key":"DHFx7BW8ti"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ac88lK62em"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.Sparse.html#simpeg.regularization.sparse","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Sparse","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vn0kEXZgp0"}],"urlSource":"myst:simpeg#simpeg.regularization.Sparse","internal":false,"protocol":"xref:sphinx","key":"OqY8QDW3Sk"},{"type":"text","value":" regularization class to constrain the inversion result using an IRLS approach. Here, the scaling constants that balance the smallness and smoothness terms are set directly. Equal emphasis on smallness and smoothness is generally applied by using the inverse square of the smallest cell dimension. The reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros. Here, we apply a 1-norm to the smallness term and a 1-norm to first-order smoothness along the x (vertical direction).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jjTgNuzRl1"}],"key":"w19mnTe6it"}],"key":"vWb8SKry5z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.451432Z","iopub.status.busy":"2024-07-17T17:50:36.451146Z","iopub.status.idle":"2024-07-17T17:50:36.460130Z","shell.execute_reply":"2024-07-17T17:50:36.459107Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_irls = regularization.Sparse(\n    regularization_mesh,\n    alpha_s=0.1,\n    alpha_x=1,\n    reference_model_in_smooth=False,\n    norms=[1.0, 1.0],\n)","key":"ktkAKtJrOa"},{"type":"output","id":"jX_He7WKmDGV2iJqi01PX","data":[],"key":"AMe5XPwNIN"}],"key":"iYFIOAnh3C"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PJQnM2WZRn"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm-1","implicit":true,"key":"SBURycZzaf"}],"key":"lJZmiQIYyx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.464181Z","iopub.status.busy":"2024-07-17T17:50:36.463753Z","iopub.status.idle":"2024-07-17T17:50:36.467787Z","shell.execute_reply":"2024-07-17T17:50:36.467084Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_irls = optimization.InexactGaussNewton(\n    maxIter=100, maxIterLS=20, maxIterCG=30, tolCG=1e-3\n)","key":"Y0YhFCq93y"},{"type":"output","id":"mP-GgQJYtVO4G0YKf0yzb","data":[],"key":"IRQ9IxyUoW"}],"key":"kUQINe5ab0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wv6AQWB3Mw"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem-1","implicit":true,"key":"AVXxEALaqi"}],"key":"dXw5aHsABp"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.471498Z","iopub.status.busy":"2024-07-17T17:50:36.471213Z","iopub.status.idle":"2024-07-17T17:50:36.475342Z","shell.execute_reply":"2024-07-17T17:50:36.474590Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_irls = inverse_problem.BaseInvProblem(dmis_irls, reg_irls, opt_irls)","key":"buUb1ClCAS"},{"type":"output","id":"W1D1722tkAd5caonTqZ_c","data":[],"key":"NJuDjC8wtH"}],"key":"AZmNXiNU5X"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l9ctBRleUE"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives-1","implicit":true,"key":"AdzzyqWiXU"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we create common directives for IRLS inversion of DC resistivity data and describe their roles. In additon to the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IbTGjVnFLc"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dV5vXlULF9"}],"urlSource":"myst:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"VPswXigeFP"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m3DiswUv70"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CJ22TRqRKU"}],"urlSource":"myst:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"lZ312uSWWZ"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jNxGpkGjFi"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"piz4oGEoCd"}],"urlSource":"myst:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"X6kvITsKlQ"},{"type":"text","value":"  directives (described before), inversion with sparse-norms requires the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M4dLmZ6sBf"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Update_IRLS","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"teJEIbBQc4"}],"urlSource":"myst:simpeg#simpeg.directives.Update_IRLS","internal":false,"protocol":"xref:sphinx","key":"sk4y9kI22m"},{"type":"text","value":" directive.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i2WO2MhVPx"}],"key":"Fr0DkFt5oZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"You will notice that we don’t use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VVdhC6R33W"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"U3PNr0eHc9"}],"urlSource":"myst:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"vy7x62Iq21"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dmbmjkdO9U"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BxtHujAEXd"}],"urlSource":"myst:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"JSJ19bOXCy"},{"type":"text","value":" directives. Here, the beta cooling schedule is set in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CYwxGjg5ON"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Update_IRLS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fFBWVH83zb"}],"urlSource":"myst:simpeg#simpeg.directives.Update_IRLS","internal":false,"protocol":"xref:sphinx","key":"z8FmYhyQat"},{"type":"text","value":" directive using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"M9wm0QvVMK"},{"type":"inlineCode","value":"coolingFactor","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aCDz7QphhS"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mgZgOKfFbT"},{"type":"inlineCode","value":"coolingRate","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VShDNWh22d"},{"type":"text","value":" properties. The target misfit for the L2 portion of the IRLS approach is set with the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QuLLEKAr5j"},{"type":"inlineCode","value":"chifact_start","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OlJAdvtpfz"},{"type":"text","value":" property.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"W2EI6Auwz0"}],"key":"Av0JoA6NxL"}],"key":"lbweyi6d1l"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.478976Z","iopub.status.busy":"2024-07-17T17:50:36.478646Z","iopub.status.idle":"2024-07-17T17:50:36.485108Z","shell.execute_reply":"2024-07-17T17:50:36.484347Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights_irls = directives.UpdateSensitivityWeights(every_iteration=True)\nstarting_beta_irls = directives.BetaEstimate_ByEig(beta0_ratio=1)\nupdate_jacobi_irls = directives.UpdatePreconditioner(update_every_iteration=True)\nupdate_irls = directives.Update_IRLS(\n    coolingFactor=2,\n    coolingRate=2,\n    f_min_change=1e-4,\n    max_irls_iterations=30,\n    chifact_start=1.0,\n)\n\ndirectives_list_irls = [\n    update_irls,\n    sensitivity_weights_irls,\n    starting_beta_irls,\n    update_jacobi_irls,\n]","key":"v4ooqrKAwO"},{"type":"output","id":"ncMKf8KoGFaF2kGx7Em71","data":[],"key":"foJb7lnYAd"}],"key":"ErmtHS3iHl"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uEzV10uV2i"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion-1","implicit":true,"key":"ivq9IlFm83"}],"key":"LaRFDMh5wJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:36.489096Z","iopub.status.busy":"2024-07-17T17:50:36.488804Z","iopub.status.idle":"2024-07-17T17:50:45.528812Z","shell.execute_reply":"2024-07-17T17:50:45.527798Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Here we combine the inverse problem and the set of directives\ninv_irls = inversion.BaseInversion(inv_prob_irls, directives_list_irls)\n\n# Run the inversion\nrecovered_model_irls = inv_irls.run(starting_resistivity_model)","key":"RK08IAbnkn"},{"type":"output","id":"Qpq6ow-W3UQq0YGvx06Cl","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\nsimpeg.InvProblem will set Regularization.reference_model to m0.\nsimpeg.InvProblem will set Regularization.reference_model to m0.\n\n                        simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                        ***Done using same Solver, and solver_opts as the Simulation1DLayers problem***\n                        \nmodel has any nan: 0\n============================ Inexact Gauss Newton ============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  9.19e+02  1.42e+03  0.00e+00  1.42e+03    1.88e+03      0              \n"},{"name":"stdout","output_type":"stream","text":"   1  9.19e+02  6.40e+02  2.72e-01  8.90e+02    4.39e+01      0              \n   2  4.60e+02  6.34e+02  2.79e-01  7.62e+02    4.46e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  4.60e+02  4.67e+02  5.58e-01  7.23e+02    1.95e+01      0              \n   4  2.30e+02  4.70e+02  5.50e-01  5.97e+02    3.17e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   5  2.30e+02  3.27e+02  1.05e+00  5.70e+02    2.69e+01      0              \n   6  1.15e+02  3.36e+02  1.01e+00  4.52e+02    2.19e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   7  1.15e+02  2.20e+02  1.89e+00  4.36e+02    3.52e+01      0              \n   8  5.74e+01  2.33e+02  1.75e+00  3.33e+02    1.49e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   9  5.74e+01  1.44e+02  3.18e+00  3.26e+02    4.22e+01      0              \n  10  2.87e+01  1.58e+02  2.85e+00  2.40e+02    9.98e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  11  2.87e+01  9.48e+01  5.04e+00  2.39e+02    4.76e+01      0              \n  12  1.44e+01  1.08e+02  4.41e+00  1.71e+02    6.61e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  13  1.44e+01  6.49e+01  7.58e+00  1.74e+02    5.16e+01      0              \n  14  7.18e+00  7.49e+01  6.53e+00  1.22e+02    4.26e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  15  7.18e+00  4.71e+01  1.10e+01  1.26e+02    5.43e+01      0              \n  16  3.59e+00  5.43e+01  9.35e+00  8.78e+01    2.63e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  17  3.59e+00  3.66e+01  1.38e+01  8.60e+01    5.15e+01      0              \n  18  1.80e+00  3.89e+01  1.30e+01  6.22e+01    1.44e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  19  1.80e+00  2.98e+01  1.56e+01  5.79e+01    3.73e+01      0              \n  20  8.98e-01  2.97e+01  1.55e+01  4.36e+01    7.62e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  21  8.98e-01  2.57e+01  1.77e+01  4.16e+01    2.77e+01      0              \n  22  4.49e-01  2.56e+01  1.75e+01  3.35e+01    3.43e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"Reached starting chifact with l2-norm regularization: Start IRLS steps...\nirls_threshold 2.266469699581706\n  23  4.49e-01  2.39e+01  2.63e+01  3.58e+01    2.64e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  24  4.49e-01  2.49e+01  2.94e+01  3.81e+01    3.73e+01      0              \n  25  4.49e-01  2.50e+01  3.38e+01  4.02e+01    7.94e+00      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  26  4.49e-01  2.56e+01  3.93e+01  4.32e+01    8.88e+00      0   Skip BFGS  \n  27  4.49e-01  2.64e+01  4.58e+01  4.69e+01    9.78e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  28  4.49e-01  2.73e+01  5.35e+01  5.14e+01    1.04e+01      0              \n  29  3.65e-01  2.86e+01  6.24e+01  5.13e+01    6.72e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  30  2.97e-01  2.85e+01  7.20e+01  4.99e+01    4.50e+00      1   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  31  2.42e-01  2.83e+01  8.39e+01  4.86e+01    4.63e+00      1              \n  32  1.99e-01  2.80e+01  9.73e+01  4.74e+01    5.18e+00      1   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  33  1.65e-01  2.76e+01  1.23e+02  4.78e+01    1.33e+01      0   Skip BFGS  \n  34  1.36e-01  2.77e+01  1.34e+02  4.59e+01    4.15e+00      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  35  1.36e-01  2.72e+01  1.44e+02  4.69e+01    7.20e+00      0   Skip BFGS  \n  36  1.36e-01  2.75e+01  1.50e+02  4.80e+01    3.52e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  37  1.12e-01  2.78e+01  1.54e+02  4.51e+01    1.47e+00      0   Skip BFGS  \n  38  1.12e-01  2.71e+01  1.70e+02  4.62e+01    6.94e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  39  1.12e-01  2.74e+01  1.68e+02  4.62e+01    1.53e+00      0              \n  40  1.12e-01  2.74e+01  1.78e+02  4.74e+01    2.68e+00      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  41  9.31e-02  2.76e+01  1.72e+02  4.36e+01    2.68e+00      0              \n  42  9.31e-02  2.69e+01  2.00e+02  4.55e+01    8.18e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  43  9.31e-02  2.72e+01  1.75e+02  4.35e+01    1.48e+00      0              \n  44  9.31e-02  2.68e+01  2.14e+02  4.67e+01    5.85e+00      0              \n"},{"name":"stdout","output_type":"stream","text":"  45  9.31e-02  2.74e+01  1.61e+02  4.25e+01    2.85e+00      0              \n  46  9.31e-02  2.67e+01  2.29e+02  4.80e+01    1.20e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  47  7.70e-02  2.76e+01  1.52e+02  3.93e+01    5.45e+00      0              \n  48  7.70e-02  2.63e+01  2.47e+02  4.53e+01    3.08e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  49  7.70e-02  2.70e+01  1.64e+02  3.97e+01    3.39e+00      0              \n  50  7.70e-02  2.62e+01  2.47e+02  4.53e+01    1.63e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  51  7.70e-02  2.70e+01  1.64e+02  3.96e+01    4.24e+00      0              \n  52  7.70e-02  2.62e+01  2.49e+02  4.54e+01    1.67e+01      0              \nReach maximum number of IRLS cycles: 30\n------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 <= tolF*(1+|f0|) = 1.4241e+02\n0 : |xc-x_last| = 7.7441e+00 <= tolX*(1+|x0|) = 3.9461e+00\n0 : |proj(x-g)-x|    = 1.6708e+01 <= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 1.6708e+01 <= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    <= iter          =     53\n------------------------- DONE! -------------------------\n"}],"key":"Q7XDgV6pb9"}],"key":"yYN8b8KL7y"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed and Predicted Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o5gwllQd1q"}],"identifier":"plot-observed-and-predicted-data","label":"Plot Observed and Predicted Data","html_id":"plot-observed-and-predicted-data-1","implicit":true,"key":"BIta6B32UF"}],"key":"SxCVoc236k"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:45.533369Z","iopub.status.busy":"2024-07-17T17:50:45.533118Z","iopub.status.idle":"2024-07-17T17:50:45.777863Z","shell.execute_reply":"2024-07-17T17:50:45.777228Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the true and apparent resistivities on a sounding curve\nfig = plt.figure(figsize=(11, 5))\nax1 = fig.add_axes([0.2, 0.1, 0.6, 0.8])\nax1.semilogy(AB_separations / 2, dobs, \"k\")\nax1.semilogy(AB_separations / 2, simulation_L2.dpred(recovered_model_L2), \"b\")\nax1.semilogy(AB_separations / 2, simulation_irls.dpred(recovered_model_irls), \"r\")\nax1.grid(which=\"both\")\nax1.set_xlabel(\"AB/2 (m)\")\nax1.set_ylabel(r\"Apparent Resistivity ($\\Omega m$)\")\nax1.legend([\"Observed\", \"L2 Inversion\", \"IRLS Inversion\"])\nplt.show()","key":"WW17x1FM3O"},{"type":"output","id":"qos90MZWPnTgYYenPz11B","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"75a2a35949cc64b2e4c17bc768ed92a0","path":"/user-tutorials/build/75a2a35949cc64b2e4c17bc768ed92a0.png"},"text/plain":{"content":"<Figure size 1100x500 with 1 Axes>","content_type":"text/plain"}}}],"key":"wOzRkwdP08"}],"key":"kDc3N3XseO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Recovered Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gLRyorAZII"}],"identifier":"plot-recovered-models","label":"Plot Recovered Models","html_id":"plot-recovered-models","implicit":true,"key":"NOZL3O67OB"}],"key":"eOrdfmAT93"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:45.783591Z","iopub.status.busy":"2024-07-17T17:50:45.783340Z","iopub.status.idle":"2024-07-17T17:50:45.992346Z","shell.execute_reply":"2024-07-17T17:50:45.991551Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot true model and recovered model\nfig = plt.figure(figsize=(6, 6))\n\nax1 = fig.add_axes([0.2, 0.15, 0.7, 0.7])\nplot_1d_layer_model(true_layers, true_resistivities, ax=ax1, color=\"k\")\nplot_1d_layer_model(\n    layer_thicknesses, log_resistivity_map * recovered_model_L2, ax=ax1, color=\"b\"\n)\nplot_1d_layer_model(\n    layer_thicknesses, log_resistivity_map * recovered_model_irls, ax=ax1, color=\"r\"\n)\nx_min, x_max = true_resistivities.min(), true_resistivities.max()\nax1.set_xlim(0.9 * x_min, 1.1 * x_max)\nax1.grid()\nax1.set_xlabel(r\"Resistivity ($\\Omega m$)\")\nax1.legend([\"True Model\", \"L2 Model\", \"IRLS Model\"])\nplt.show()","key":"DYDFjddmP9"},{"type":"output","id":"Omfol5LgpEW1vAw2vqLrI","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7b32859ac67cb372d714dea18273dc2c","path":"/user-tutorials/build/7b32859ac67cb372d714dea18273dc2c.png"},"text/plain":{"content":"<Figure size 600x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"DK4wdxRAeQ"}],"key":"Ws4dYLHxDj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parametric Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XmSn1VMfl0"}],"identifier":"parametric-inversion","label":"Parametric Inversion","html_id":"parametric-inversion","implicit":true,"key":"aziSdYTVM2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we assume the subsurface is defined by a 3-layered Earth. However, the electrical properties and thicknesses of the layers are unknown. Here, we define our model to include log-conductivities and log-thicknesses. When including quantities that span different scales, it is frequently best to define the model in terms of log-values so that each quantity influences the predicted data evenly.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jNtd82pOOF"}],"key":"UxhpQJGfJN"}],"key":"ajeztzgKPA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Models and Mappings","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XLHyieT6Tm"}],"identifier":"models-and-mappings","label":"Models and Mappings","html_id":"models-and-mappings","implicit":true,"key":"N0ApoC1QEo"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For a 3-layered Earth model, the model consists of 2 log-thicknesses and 3 log-conductivities. Similar to the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FGmtDfa114"},{"type":"link","url":"/fwd-dcr-1d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1D Forward Simulation of DC Resistivity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mHRFxrMetY"}],"urlSource":"fwd_dcr_1d.ipynb","dataUrl":"/fwd-dcr-1d.json","internal":true,"protocol":"file","key":"CTcU1YNrjm"},{"type":"text","value":" tutorial, need a mapping that extract log-thicknesses and log-conductivities from the model, and mappings that convert log-values to property values. For this, we require the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZBnwp8T4Bg"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.Wires.html#simpeg.maps.wires","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.maps.Wires","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qrZkuXmTXa"}],"urlSource":"myst:simpeg#simpeg.maps.Wires","internal":false,"protocol":"xref:sphinx","key":"PVCwKR4RgT"},{"type":"text","value":" mapping and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qm2IYtdzee"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.ExpMap.html#simpeg.maps.expmap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.maps.ExpMap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E05wtja5ic"}],"urlSource":"myst:simpeg#simpeg.maps.ExpMap","internal":false,"protocol":"xref:sphinx","key":"cS5C7O2DG3"},{"type":"text","value":" mapping classes. Note that successive mappings can be chained together using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"y7KUyjodk3"},{"type":"inlineMath","value":"*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∗</mo></mrow><annotation encoding=\"application/x-tex\">*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4653em;\"></span><span class=\"mord\">∗</span></span></span></span>","key":"W88WYxeLAW"},{"type":"text","value":" operator.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qpaI353H29"}],"key":"DkYHgLBdKp"}],"key":"ut97cGnHpJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:45.997594Z","iopub.status.busy":"2024-07-17T17:50:45.997256Z","iopub.status.idle":"2024-07-17T17:50:46.001947Z","shell.execute_reply":"2024-07-17T17:50:46.001314Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Wire maps to extract log-thicknesses and log-conductivities\nwire_map = maps.Wires((\"log_thicknesses\", 2), (\"log_conductivity\", 3))\n\n# Maping for layer thicknesses\nlog_thicknesses_map = maps.ExpMap() * wire_map.log_thicknesses\n\n# Mapping for conductivities\nlog_conductivity_map = maps.ExpMap() * wire_map.log_conductivity","key":"xKIQ29XdiX"},{"type":"output","id":"ciaaliTVFDhl6assbKBWy","data":[],"key":"U70T0p6bW6"}],"key":"XwHGQzUNyg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting and Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JKZNttkNVb"}],"identifier":"starting-and-reference-models","label":"Starting and Reference Models","html_id":"starting-and-reference-models","implicit":true,"key":"cEoaA8if24"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This problem is highly non-linear so it is important to have a reasonable estimate of the true model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U57YPFsbyd"}],"key":"cYaelQ95tU"}],"key":"etmIL3E3ky"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.005856Z","iopub.status.busy":"2024-07-17T17:50:46.005624Z","iopub.status.idle":"2024-07-17T17:50:46.009930Z","shell.execute_reply":"2024-07-17T17:50:46.009190Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"starting_parametric_model = np.log(np.r_[125.0, 50.0, 1e-3, 2e-3, 5e-2])\n\nreference_parametric_model = starting_parametric_model.copy()","key":"QCcalE8CWn"},{"type":"output","id":"VFpmUNmaebRNiSXiE05UK","data":[],"key":"gYPXCGWFOC"}],"key":"UTSdIHkQHk"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ubHaELn85B"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation-2","implicit":true,"key":"Scp6lyK3l1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Because the layer thicknesses are part of the model, we define the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XTq8bfGgTE"},{"type":"inlineCode","value":"thicknessesMap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UYBEJXdxUG"},{"type":"text","value":". Because we are working in terms of electrical conductivity, we must define the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zK4v1NQHn4"},{"type":"inlineCode","value":"sigmaMap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZZ6PhJZx2y"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SDk2QB8m3U"}],"key":"deNQlvaYWl"}],"key":"neCffDmGwB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.013255Z","iopub.status.busy":"2024-07-17T17:50:46.013024Z","iopub.status.idle":"2024-07-17T17:50:46.017190Z","shell.execute_reply":"2024-07-17T17:50:46.016349Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_parametric = dc.simulation_1d.Simulation1DLayers(\n    survey=survey,\n    sigmaMap=log_conductivity_map,\n    thicknessesMap=log_thicknesses_map,\n)","key":"QBfB5bPyaN"},{"type":"output","id":"huS1NIIejidTAUGgcLZww","data":[],"key":"nx834ZAgFP"}],"key":"Dq1naBSSGC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"woVG66ZPM4"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit-2","implicit":true,"key":"lEpJ6MIGQ5"}],"key":"Yb3fKEEsNL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.020724Z","iopub.status.busy":"2024-07-17T17:50:46.020329Z","iopub.status.idle":"2024-07-17T17:50:46.024466Z","shell.execute_reply":"2024-07-17T17:50:46.023761Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_parametric = data_misfit.L2DataMisfit(\n    simulation=simulation_parametric, data=data_object\n)","key":"FEizyHH922"},{"type":"output","id":"YR-c-ts3MHAmKc5IY9Rdp","data":[],"key":"ePUyIqdzBm"}],"key":"Ze8YKkibrq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define a (Combo) Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XmfhVxvUoL"}],"identifier":"define-a-combo-regularization","label":"Define a (Combo) Regularization","html_id":"define-a-combo-regularization","implicit":true,"key":"pmfo5nFlcX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We need to define a regularization for each model parameter type. In this case, we have log-thicknesses and log-conductivities. For each model parameter type, we create a 1D ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"s2JwmD39CD"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tensor mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B1WkDPcYyL"}],"urlSource":"myst:discretize#discretize.TensorMesh","internal":false,"protocol":"xref:sphinx","key":"pWweXoF7Re"},{"type":"text","value":" with length equal to the number of parameters. In the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VeBBeltjnt"},{"type":"inlineCode","value":"mapping","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JlcShmOMcS"},{"type":"text","value":" keyword argument, we used the wire map that extracts the specific model parameters from the model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qpc7DFSs1a"}],"key":"jdd2MK2k5l"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"AV242SZQu8"},{"type":"inlineMath","value":"*","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∗</mo></mrow><annotation encoding=\"application/x-tex\">*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4653em;\"></span><span class=\"mord\">∗</span></span></span></span>","key":"G2gkG5Lkob"},{"type":"text","value":" operator, separate regularizations can be summed to form a regularization that is also a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rCC870CiAZ"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.objective_function.ComboObjectiveFunction.html#simpeg.objective_function.comboobjectivefunction","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ComboObjectiveFunction","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Uw6qSUBEpD"}],"urlSource":"myst:simpeg#simpeg.objective_function.ComboObjectiveFunction","internal":false,"protocol":"xref:sphinx","key":"Wpo70BxrvN"},{"type":"text","value":". By setting the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Xst11bG74w"},{"type":"inlineCode","value":"multipliers","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yNGIpr5J7l"},{"type":"text","value":" property, we can emphasis the relative contributions of the log-thicknesses and log-conductivities regularizations.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"T9FrAsPS19"}],"key":"YiLOYSzgK2"}],"key":"vdFXUiOvNP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.028200Z","iopub.status.busy":"2024-07-17T17:50:46.027767Z","iopub.status.idle":"2024-07-17T17:50:46.034433Z","shell.execute_reply":"2024-07-17T17:50:46.033636Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_1 = regularization.Smallness(\n    TensorMesh([(np.ones(2))], \"0\"),\n    mapping=wire_map.log_thicknesses,\n    reference_model=reference_parametric_model,\n)\n\nreg_2 = regularization.Smallness(\n    TensorMesh([(np.ones(3))], \"0\"),\n    mapping=wire_map.log_conductivity,\n    reference_model=reference_parametric_model,\n)\n\nreg_parametric = reg_1 + reg_2\nreg_parametric.multipliers = [1.0, 0.1]","key":"G7tOGbuEJ9"},{"type":"output","id":"VpivMYtXp5cXnmEhRSmtI","data":[],"key":"iJBREuU34n"}],"key":"sSroUk73Az"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k9St7PEMJC"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm-2","implicit":true,"key":"pH0r1uDSfM"}],"key":"VtcEaYOl0A"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.037888Z","iopub.status.busy":"2024-07-17T17:50:46.037598Z","iopub.status.idle":"2024-07-17T17:50:46.042095Z","shell.execute_reply":"2024-07-17T17:50:46.041385Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_parametric = optimization.InexactGaussNewton(\n    maxIter=100, maxIterLS=20, maxIterCG=20, tolCG=1e-3\n)","key":"iNuZQG4ZKR"},{"type":"output","id":"Lfq6UC0scKLOrm-hfwOTJ","data":[],"key":"U4EwjHaPPG"}],"key":"Z5kHAqEcGN"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ctci0XQwjA"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem-2","implicit":true,"key":"Ky105XFttc"}],"key":"NnO2sbPECM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.046103Z","iopub.status.busy":"2024-07-17T17:50:46.045816Z","iopub.status.idle":"2024-07-17T17:50:46.050080Z","shell.execute_reply":"2024-07-17T17:50:46.049310Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_parametric = inverse_problem.BaseInvProblem(\n    dmis_parametric, reg_parametric, opt_parametric\n)","key":"GeIodBLQI6"},{"type":"output","id":"cxuG4FsTO8KxwD4Y4zT1g","data":[],"key":"oYCo0ke0x9"}],"key":"zOsZRGa0TB"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KSpm14qZCt"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives-2","implicit":true,"key":"PdMs8QXd9s"}],"key":"cz4jSdhpUB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.054058Z","iopub.status.busy":"2024-07-17T17:50:46.053728Z","iopub.status.idle":"2024-07-17T17:50:46.060404Z","shell.execute_reply":"2024-07-17T17:50:46.059442Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights = directives.UpdateSensitivityWeights(every_iteration=True)\nupdate_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)\nstarting_beta = directives.BetaEstimate_ByEig(beta0_ratio=10)\nbeta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=2)\ntarget_misfit = directives.TargetMisfit(chifact=1.0)\n\ndirectives_list_parametric = [\n    sensitivity_weights,\n    update_jacobi,\n    starting_beta,\n    beta_schedule,\n    target_misfit,\n]","key":"zPdm8t0y7n"},{"type":"output","id":"mMpV7gO77n8X9p3H0xyl8","data":[],"key":"RcgntjTqYL"}],"key":"xtTLLGuxru"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YVQ1EFZBan"}],"identifier":"define-and-run-inversion","label":"Define and Run Inversion","html_id":"define-and-run-inversion","implicit":true,"key":"pjU4kMkmcf"}],"key":"lzjMFipGED"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:46.064007Z","iopub.status.busy":"2024-07-17T17:50:46.063629Z","iopub.status.idle":"2024-07-17T17:50:50.075622Z","shell.execute_reply":"2024-07-17T17:50:50.074257Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_parametric = inversion.BaseInversion(\n    inv_prob_parametric, directives_list_parametric\n)\nrecovered_model_parametric = inv_parametric.run(starting_parametric_model)","key":"Fei3SKRnlV"},{"type":"output","id":"aWcy6Ho3r7z1V5MrWaaUk","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\n\n                        simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                        ***Done using same Solver, and solver_opts as the Simulation1DLayers problem***\n                        \nmodel has any nan: 0\n============================ Inexact Gauss Newton ============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  1.36e+05  1.95e+04  0.00e+00  1.95e+04    1.72e+04      0              \n"},{"name":"stdout","output_type":"stream","text":"   1  1.36e+05  1.35e+04  2.04e-02  1.63e+04    3.54e+03      0              \n   2  6.81e+04  1.24e+04  2.92e-02  1.43e+04    8.80e+03      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  6.81e+04  7.15e+03  9.98e-02  1.39e+04    1.25e+03      0              \n   4  3.41e+04  6.84e+03  1.04e-01  1.04e+04    7.29e+03      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   5  3.41e+04  2.56e+03  2.27e-01  1.03e+04    1.31e+03      0              \n   6  1.70e+04  2.75e+03  2.17e-01  6.45e+03    4.96e+03      0              \n"},{"name":"stdout","output_type":"stream","text":"   7  1.70e+04  8.86e+02  3.22e-01  6.37e+03    9.63e+02      0              \n   8  8.51e+03  9.84e+02  3.26e-01  3.76e+03    2.94e+03      0              \n"},{"name":"stdout","output_type":"stream","text":"   9  8.51e+03  3.41e+02  4.05e-01  3.79e+03    5.31e+02      0              \n  10  4.26e+03  3.56e+02  4.29e-01  2.18e+03    1.71e+03      0              \n"},{"name":"stdout","output_type":"stream","text":"  11  4.26e+03  1.37e+02  4.99e-01  2.26e+03    2.65e+02      0              \n  12  2.13e+03  1.38e+02  5.17e-01  1.24e+03    9.96e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  13  2.13e+03  6.26e+01  5.76e-01  1.29e+03    1.34e+02      0              \n  14  1.06e+03  6.34e+01  5.82e-01  6.82e+02    5.64e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  15  1.06e+03  3.67e+01  6.29e-01  7.06e+02    6.75e+01      0              \n  16  5.32e+02  3.72e+01  6.29e-01  3.72e+02    3.08e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  17  5.32e+02  2.79e+01  6.64e-01  3.81e+02    2.69e+01      0              \n"},{"name":"stdout","output_type":"stream","text":"  18  2.66e+02  2.80e+01  6.64e-01  2.05e+02    1.63e+02      0              \n------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 <= tolF*(1+|f0|) = 1.9497e+03\n1 : |xc-x_last| = 4.6444e-02 <= tolX*(1+|x0|) = 1.2573e+00\n0 : |proj(x-g)-x|    = 1.6254e+02 <= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 1.6254e+02 <= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    <= iter          =     19\n------------------------- DONE! -------------------------\n"}],"key":"W7pdLjeOx9"}],"key":"MI6lhSepC2"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed and Predicted Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bi6ThfPq7w"}],"identifier":"plot-observed-and-predicted-data","label":"Plot Observed and Predicted Data","html_id":"plot-observed-and-predicted-data-2","implicit":true,"key":"qE4oOLhXzw"}],"key":"M9r4RQy00Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:50.081727Z","iopub.status.busy":"2024-07-17T17:50:50.081207Z","iopub.status.idle":"2024-07-17T17:50:50.408612Z","shell.execute_reply":"2024-07-17T17:50:50.407661Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the true and apparent resistivities on a sounding curve\nfig = plt.figure(figsize=(11, 5))\nax1 = fig.add_axes([0.2, 0.1, 0.6, 0.8])\nax1.semilogy(AB_separations / 2, dobs, \"k\")\nax1.semilogy(AB_separations / 2, simulation_L2.dpred(recovered_model_L2), \"b\")\nax1.semilogy(AB_separations / 2, simulation_irls.dpred(recovered_model_irls), \"r\")\nax1.semilogy(\n    AB_separations / 2, simulation_parametric.dpred(recovered_model_parametric), \"g\"\n)\nax1.grid(which=\"both\")\nax1.set_xlabel(\"AB/2 (m)\")\nax1.set_ylabel(r\"Apparent Resistivity ($\\Omega m$)\")\nax1.legend([\"Observed\", \"L2 Inversion\", \"IRLS Inversion\", \"Parametric Inversion\"])\nplt.show()","key":"NU9X6p9sTk"},{"type":"output","id":"RkLAnj6yEMcz5fwWK8qGy","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a4a0deefd0497d3bab15384828110302","path":"/user-tutorials/build/a4a0deefd0497d3bab15384828110302.png"},"text/plain":{"content":"<Figure size 1100x500 with 1 Axes>","content_type":"text/plain"}}}],"key":"Ja2D1ATyqw"}],"key":"pnh8CDpS5b"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Recovered Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vLAA5nGKvT"}],"identifier":"plot-recovered-models","label":"Plot Recovered Models","html_id":"plot-recovered-models-1","implicit":true,"key":"rY7k75v21A"}],"key":"yWWSHRwXU4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:50:50.413651Z","iopub.status.busy":"2024-07-17T17:50:50.413409Z","iopub.status.idle":"2024-07-17T17:50:50.657665Z","shell.execute_reply":"2024-07-17T17:50:50.657023Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(6, 6))\n\nax1 = fig.add_axes([0.2, 0.15, 0.7, 0.7])\nplot_1d_layer_model(true_layers, true_resistivities, ax=ax1, color=\"k\")\nplot_1d_layer_model(\n    layer_thicknesses, log_resistivity_map * recovered_model_L2, ax=ax1, color=\"b\"\n)\nplot_1d_layer_model(\n    layer_thicknesses, log_resistivity_map * recovered_model_irls, ax=ax1, color=\"r\"\n)\nplot_1d_layer_model(\n    log_thicknesses_map * recovered_model_parametric,\n    1 / (log_conductivity_map * recovered_model_parametric),\n    ax=ax1,\n    color=\"g\",\n)\nx_min, x_max = true_resistivities.min(), true_resistivities.max()\nax1.set_xlim(0.8 * x_min, 2 * x_max)\nax1.set_ylim([np.sum(layer_thicknesses), 0])\nax1.grid()\nax1.set_xlabel(r\"Resistivity ($\\Omega m$)\")\nax1.legend([\"True Model\", \"L2 Model\", \"IRLS Model\", \"Parametric Model\"])\nplt.show()","key":"MlYxHid1G5"},{"type":"output","id":"RYf97biHPzpWAiRUWbhxC","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4ae42c418946f9a616ddf887abe32e24","path":"/user-tutorials/build/4ae42c418946f9a616ddf887abe32e24.png"},"text/plain":{"content":"<Figure size 600x600 with 1 Axes>","content_type":"text/plain"}}}],"key":"MWRiulnndQ"}],"key":"xEIPJ2m1nn"}],"key":"RtQ2b85a1f"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"3D Forward Simulation","url":"/fwd-dcr-3d","group":"SimPEG User Tutorials"},"next":{"title":"2.5D DC Resistivity Inversion","url":"/inv-dcr-2d","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"}