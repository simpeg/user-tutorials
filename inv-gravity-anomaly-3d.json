{"kind":"Notebook","sha256":"72e5ac0c5d919e3680ecd37d6b9ecabe391ed5d61caab725a9028a22ea3e0c1f","slug":"inv-gravity-anomaly-3d","location":"/notebooks/03-gravity/inv_gravity_anomaly_3d.ipynb","dependencies":[],"frontmatter":{"title":"3D Inversion of Gravity Anomaly Data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"github":"https://github.com/simpeg/user-tutorials","subject":"SimPEG User Tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"exports":[{"format":"ipynb","filename":"inv_gravity_anomaly_3d.ipynb","url":"/user-tutorials/build/inv_gravity_anomaly_-cab2be719500649c684aa73c68282f80.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Intermediate notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FyOJ8OzuQ9"}],"key":"jCfLcoiee5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TkPahx3sUg"}],"key":"K8MnceKZhs"}],"key":"RestFpZQdo"}],"key":"MchV8YATTi"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Light-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uoT6gS8ydl"}],"key":"UaddJLfaT6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial requires minimal computational resources and can be executed quickly in the background while other computer processes are running.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S6sXkaWNkk"}],"key":"fmVvBlVCzM"}],"key":"ixeDatCDdP"}],"key":"WKpb6ndgzO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cWQsCW8al5"}],"key":"c4k0sLwpZO"},{"type":"text","value":" Devin C. Cowan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bvm3kvFVFn"}],"key":"mnWP0tOEGi"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V5nJYxxSAT"}],"key":"v8Za6ihtr2"},{"type":"text","value":" gravity anomaly, integral formulation, inversion, sparse norm, tensor mesh, tree mesh.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"icx8c6Gn67"}],"key":"aCICqfS1zw"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TE032kEwpS"}],"key":"J4wGORY24E"},{"type":"text","value":" Here we invert gravity anomaly data to recover a density contrast model. We demonstrate two approaches for recovering a density contrast model:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"o6Kg0sELlq"}],"key":"ORA0CQNpb9"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Weighted least-squares inversion for a tensor mesh","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZdgQQdHkOq"}],"key":"KiojpZqksQ"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Iteratively re-weighted least-squares (IRLS) inversion for a tree mesh","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ViES4SlpD5"}],"key":"mXq79d81Ev"}],"key":"pqRLjDvR9M"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"se8XQX075s"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"weighted least-squares","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"glvqAciobW"}],"key":"o4bW6gOpN2"},{"type":"text","value":" approach is a great introduction to geophysical inversion with SimPEG. One drawback however, is that it recovers smooth structures which may not be representative of the true model. To recover sparse and/or blocky structures, we also demonstrate the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"EIFO05KyoO"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"iteratively re-weighted least-squares","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"affkb4UTD0"}],"key":"OUznhNruMI"},{"type":"text","value":" approach. Because this tutorial focusses primarily on inversion-related functionality, we urge the reader to become familiar with functionality explained in the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"G8nVJV6iPg"},{"type":"link","url":"/fwd-gravity-anomaly-3d","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Gravity Anomaly Data","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"cmZAfJ4zNf"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","dataUrl":"/fwd-gravity-anomaly-3d.json","internal":true,"protocol":"file","key":"GbJKRcFVeY"},{"type":"text","value":" tutorial before working through this one.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Il9zzc3TlT"}],"key":"iKoQz4iJI9"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"PzQPCex3zq"}],"key":"PtVplLg5Mk"}],"key":"csMLN27WXe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"How geophysical inversion is carried out using SimPEG.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"aHg6rGRFXE"}],"key":"OrN9IFLGD0"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"How to assign appropriate uncertainties to gravity anomaly data.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"XqDR2aVABC"}],"key":"TX1kol1uOT"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"How to design a suitable mesh for gravity inversion when using the integral formulation.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ZBGlEIGbwH"}],"key":"h5LsCxV8Ry"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"How to choose and set parameters for the inversion.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"HG54IZEOm3"}],"key":"CGJ49rZGif"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"How to define directives that are applied and updated throughout the inversion.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"bNk9078Fw2"}],"key":"k1AV5Mqh0V"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"How to applying the sensitivity weighting generally used in 3D gravity inversion.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"ZCJhaGDlp9"}],"key":"X5MmPr6ZO5"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"How to invert data using weighted least-squares and sparse-norm regularization.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"c2hbWdfDcH"}],"key":"me7BVEBnBB"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"How to analyse inversion results.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"TpS023bnxs"}],"key":"LsufIEM5ud"}],"key":"VGkcM7s7jT"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Although we consider gravity anomaly data in this tutorial, the same approach\ncan be used to invert gravity gradiometry data.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"m17TxEZL6W"}],"key":"HMhFysPZb6"}],"key":"BQ6sy6Mb9q"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kFcp7mVvKW"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"gZgbz4aSpc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise.\nAll of the functionality specific to the forward simulation of gravity data are imported from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qnHcwV8QZi"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.potential_fields.gravity.html#module-simpeg.potential_fields.gravity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg​.potential​_fields​.gravity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dzVMFs3CAe"}],"urlSource":"myst:simpeg#simpeg.potential_fields.gravity","internal":false,"protocol":"xref:sphinx","key":"WehSzl41cG"},{"type":"text","value":" module. Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AOXwYQ06K6"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fGRNNzHRit"}],"urlSource":"myst:simpeg#simpeg.utils","internal":false,"protocol":"xref:sphinx","key":"hFuzLXTPZt"},{"type":"text","value":". To generate the mesh used for the inversion, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"frmjCdheR2"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VlYI5Mwnxa"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"cyYRpttKmb"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cQnZt9BMn6"}],"key":"kRJ0TlyqDU"}],"key":"jexXnhHHO5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:32.087738Z","iopub.status.busy":"2024-07-24T17:50:32.087152Z","iopub.status.idle":"2024-07-24T17:50:33.960921Z","shell.execute_reply":"2024-07-24T17:50:33.959878Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom simpeg.potential_fields import gravity\nfrom simpeg.utils import plot2Ddata, model_builder, download\nfrom simpeg import (\n    maps,\n    data,\n    data_misfit,\n    inverse_problem,\n    regularization,\n    optimization,\n    directives,\n    inversion,\n)\n\n# discretize functionality\nfrom discretize import TensorMesh, TreeMesh\nfrom discretize.utils import active_from_xyz\n\n# Common Python functionality\nimport os\nimport numpy as np\nfrom scipy.interpolate import griddata\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport tarfile\n\nmpl.rcParams.update({\"font.size\": 14})","key":"WExPfART1B"},{"type":"output","id":"SMTPSsDLg_yzcpWmSg35s","data":[],"key":"zpVvWA95Li"}],"key":"MQAL557Szj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Tutorial Files","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M5oTf5qW1i"}],"identifier":"load-tutorial-files","label":"Load Tutorial Files","html_id":"load-tutorial-files","implicit":true,"key":"t8i5mTZv2c"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"huUgzuMf7a"}],"key":"ul2ZDGJqAq"}],"key":"sPaIcx8qKf"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:33.966289Z","iopub.status.busy":"2024-07-24T17:50:33.965981Z","iopub.status.idle":"2024-07-24T17:50:34.467681Z","shell.execute_reply":"2024-07-24T17:50:34.466309Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# URL to download from repository assets\ndata_source = \"https://github.com/simpeg/user-tutorials/raw/main/assets/03-gravity/inv_gravity_anomaly_3d_files.tar.gz\"\n\n# download the data\ndownloaded_data = download(data_source, overwrite=True)\n\n# unzip the tarfile\ntar = tarfile.open(downloaded_data, \"r\")\ntar.extractall()\ntar.close()\n\n# path to the directory containing our data\ndir_path = downloaded_data.split(\".\")[0] + os.path.sep\n\n# files to work with\ntopo_filename = dir_path + \"gravity_topo.txt\"\ndata_filename = dir_path + \"gravity_data.obs\"","key":"bw161X7bLC"},{"type":"output","id":"dm8DmLG8wY1m6z8kTHKPy","data":[{"name":"stdout","output_type":"stream","text":"Downloading https://github.com/simpeg/user-tutorials/raw/main/assets/03-gravity/inv_gravity_anomaly_3d_files.tar.gz\n"},{"name":"stdout","output_type":"stream","text":"   saved to: /home/ssoler/git/user-tutorials/notebooks/03-gravity/inv_gravity_anomaly_3d_files.tar.gz\nDownload completed!\n"}],"key":"Ym2G1NuADr"}],"key":"HpuSDyDJxU"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For this tutorial, the data are organized within basic XYZ files. However, SimPEG does allow the user to import UBC-GIF formatted gravity data files; see ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r8qgHuNfu9"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.utils.io_utils.read_grav3d_ubc.html#simpeg.utils.io_utils.read_grav3d_ubc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"read_grav3d_ubc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ai1MGPaIzS"}],"urlSource":"myst:simpeg#simpeg.utils.io_utils.read_grav3d_ubc","internal":false,"protocol":"xref:sphinx","key":"JfKCiPG0mQ"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I8YBFDXTaA"}],"key":"BWlh3kx01F"}],"key":"lc1bmVka4B"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:34.473474Z","iopub.status.busy":"2024-07-24T17:50:34.473072Z","iopub.status.idle":"2024-07-24T17:50:34.481873Z","shell.execute_reply":"2024-07-24T17:50:34.480491Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load topography (xyz file)\ntopo_xyz = np.loadtxt(str(topo_filename))\n\n# Load field data (xyz file)\ndobs = np.loadtxt(str(data_filename))","key":"oq9oJebpGw"},{"type":"output","id":"N4kfVybS0ZSbQYHzMiRMj","data":[],"key":"F9qDjtcM0S"}],"key":"QamzJ8Zxp0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed Data and Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dWP78V5duj"}],"identifier":"plot-observed-data-and-topography","label":"Plot Observed Data and Topography","html_id":"plot-observed-data-and-topography","implicit":true,"key":"PGTUXhkhIb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we plot the synthetic gravity anomaly data and local topography.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zJiMseaDx0"}],"key":"BpjCxKJOar"}],"key":"amQgj2NNTC"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:34.486181Z","iopub.status.busy":"2024-07-24T17:50:34.485768Z","iopub.status.idle":"2024-07-24T17:50:34.491373Z","shell.execute_reply":"2024-07-24T17:50:34.490277Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define receiver locations and observed data\nreceiver_locations = dobs[:, 0:3]\ndobs = dobs[:, -1]","key":"JY3OkeVSOl"},{"type":"output","id":"hdeVx5nz6SOUMefEnWwIg","data":[],"key":"siSRQzogu0"}],"key":"K2Oy6oSBpP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:34.495756Z","iopub.status.busy":"2024-07-24T17:50:34.495409Z","iopub.status.idle":"2024-07-24T17:50:35.094066Z","shell.execute_reply":"2024-07-24T17:50:35.093295Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(9, 5))\n\nax1 = fig.add_axes([0.05, 0.35, 0.35, 0.6])\nplot2Ddata(\n    receiver_locations,\n    dobs,\n    ax=ax1,\n    dataloc=True,\n    ncontour=40,\n    contourOpts={\"cmap\": \"bwr\"},\n)\nax1.set_title(\"Gravity Anomaly\", pad=15)\nax1.set_xlabel(\"x (m)\")\nax1.set_ylabel(\"y (m)\")\n\ncx1 = fig.add_axes([0.05, 0.18, 0.35, 0.04])\nnorm1 = mpl.colors.Normalize(vmin=-np.max(np.abs(dobs)), vmax=np.max(np.abs(dobs)))\ncbar1 = mpl.colorbar.ColorbarBase(\n    cx1, norm=norm1, orientation=\"horizontal\", cmap=mpl.cm.bwr\n)\ncbar1.set_label(\"$mGal$\", size=16)\n\nax2 = fig.add_axes([0.55, 0.35, 0.35, 0.6])\nplot2Ddata(\n    topo_xyz[:, 0:2],\n    topo_xyz[:, -1],\n    ax=ax2,\n    ncontour=50,\n    contourOpts={\"cmap\": \"gist_earth\"},\n)\nax2.set_title(\"Topography\", pad=15)\nax2.set_xlabel(\"x (m)\")\nax2.set_ylabel(\"y (m)\")\n\ncx2 = fig.add_axes([0.55, 0.18, 0.35, 0.04])\nnorm2 = mpl.colors.Normalize(vmin=np.min(topo_xyz[:, -1]), vmax=np.max(topo_xyz[:, -1]))\ncbar2 = mpl.colorbar.ColorbarBase(\n    cx2, norm=norm2, orientation=\"horizontal\", cmap=mpl.cm.gist_earth\n)\ncbar2.set_label(\"$m$\", size=16)\n\nplt.show()","key":"LhYojniC6i"},{"type":"output","id":"3RQYS6wNzBf67NSUiRKQX","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0bf249abac5c458cc6d71d9bdee73faf","path":"/user-tutorials/build/0bf249abac5c458cc6d71d9bdee73faf.png"},"text/plain":{"content":"<Figure size 900x500 with 4 Axes>","content_type":"text/plain"}}}],"key":"vzo3YyuSvH"}],"key":"kGrbdzwJ7a"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Assign Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e9OUZe4Mde"}],"identifier":"assign-uncertainties","label":"Assign Uncertainties","html_id":"assign-uncertainties","implicit":true,"key":"PQg3AC2nBp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Inversion with SimPEG requires that we define the uncertainties on our data; that is, an estimate of the standard deviation of the noise on our data assuming it is uncorrelated Gaussian with zero mean. An online resource explaining uncertainties and their role in the inversion can be found ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ytfY6OoHQi"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KwF94z8aVy"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"dQ3qq3hbpf"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KiDhbBBd8A"}],"key":"XBAq9j5y9H"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For gravity anomaly data,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gMBq0AFYSD"}],"key":"TolQxLeaJE"},{"type":"text","value":" a constant floor value is generally applied to all data. We usually avoid assigning percent uncertainties because the inversion would prioritize fitting the background over fitting anomalies. The floor value for the uncertainties may be chosen based on some knowledge of the instrument error, or it may be chosen as some fraction of the largest anomaly value. For this tutorial, the floor uncertainty assigned to all data is 2.5% of the maximum observed gravity anomaly value. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ro8ULKZfpY"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For gravity gradiometry data,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ISuyyIi4jy"}],"key":"m9uKMxB3KF"},{"type":"text","value":" you may choose to assign a different floor value to each data component.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KlUKYlnPbk"}],"key":"IPmlTgputo"}],"key":"K0Xr3FlYYk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.099828Z","iopub.status.busy":"2024-07-24T17:50:35.099521Z","iopub.status.idle":"2024-07-24T17:50:35.105071Z","shell.execute_reply":"2024-07-24T17:50:35.104269Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"maximum_anomaly = np.max(np.abs(dobs))\nfloor_uncertainty = 0.02 * maximum_anomaly\nuncertainties = floor_uncertainty * np.ones(np.shape(dobs))\nprint(\"Floor uncertainty: {}\".format(floor_uncertainty))","key":"T1moyS6cIu"},{"type":"output","id":"8aXHsFp-tMKbH6_7nUcsB","data":[{"name":"stdout","output_type":"stream","text":"Floor uncertainty: 0.00037204\n"}],"key":"xzUJKcxkjP"}],"key":"xDT2oni1Eh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Survey","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lCcrIqGYtK"}],"identifier":"define-the-survey","label":"Define the Survey","html_id":"define-the-survey","implicit":true,"key":"w8jEe9WqyK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here, we define the survey geometry. The survey consists of a 160 m x 160 m grid of equally spaced receivers located 5 m\nabove the surface topography. For a more comprehensive description of constructing gravity surveys in SimPEG, see the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"diKk1Qq5no"},{"type":"link","url":"/fwd-gravity-anomaly-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Gravity Anomaly Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hHdxxyrcJa"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","dataUrl":"/fwd-gravity-anomaly-3d.json","internal":true,"protocol":"file","key":"fRRaEXmdmF"},{"type":"text","value":" tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qYym3buxBx"}],"key":"Dv4v6i6a8N"}],"key":"swdz9Du1zt"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.110340Z","iopub.status.busy":"2024-07-24T17:50:35.109975Z","iopub.status.idle":"2024-07-24T17:50:35.115710Z","shell.execute_reply":"2024-07-24T17:50:35.114801Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the receivers. The data consist of vertical gravity anomaly measurements.\n# The set of receivers must be defined as a list.\nreceiver_list = gravity.receivers.Point(receiver_locations, components=\"gz\")\nreceiver_list = [receiver_list]\n\n# Define the source field\nsource_field = gravity.sources.SourceField(receiver_list=receiver_list)\n\n# Define the survey\nsurvey = gravity.survey.Survey(source_field)","key":"CGrMraGtUs"},{"type":"output","id":"rY2uS7mcycDeJ5cVcGliI","data":[],"key":"CApws525ES"}],"key":"KP4Nj5boo0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hcVaMYW2mT"}],"identifier":"define-the-data","label":"Define the Data","html_id":"define-the-data","implicit":true,"key":"CG1OHCKVgJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The SimPEG ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Gqe7qqh1gy"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data.Data.html#simpeg.data.data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LtEgCe6NiU"}],"urlSource":"myst:simpeg#simpeg.data.Data","internal":false,"protocol":"xref:sphinx","key":"av52g4gFXi"},{"type":"text","value":" class is required for inversion and connects the observed data, uncertainties and survey geometry.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RznTlKEHQK"}],"key":"dTmczwg0i1"}],"key":"p4QLN6SoFY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.119301Z","iopub.status.busy":"2024-07-24T17:50:35.118959Z","iopub.status.idle":"2024-07-24T17:50:35.124138Z","shell.execute_reply":"2024-07-24T17:50:35.123111Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"data_object = data.Data(survey, dobs=dobs, standard_deviation=uncertainties)","key":"Xe1awakAuc"},{"type":"output","id":"KAPMBgA7MvLg5upIR78Hn","data":[],"key":"sDnB5uTGjj"}],"key":"eZ1YVG3fm1"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Weighted Least-Squares Inversion on a Tensor Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"woRkfyGWlD"}],"identifier":"weighted-least-squares-inversion-on-a-tensor-mesh","label":"Weighted Least-Squares Inversion on a Tensor Mesh","html_id":"weighted-least-squares-inversion-on-a-tensor-mesh","implicit":true,"key":"SnU8732qX1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we provide a step-by-step best-practices approach for weighted least-squares inversion of gravity anomaly data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TDQRxb3uZn"}],"key":"yDjQwCDpAZ"}],"key":"kHljx5cyVn"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tensor) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JnPjl1EOoE"}],"identifier":"design-a-tensor-mesh","label":"Design a (Tensor) Mesh","html_id":"design-a-tensor-mesh","implicit":true,"key":"Mmcjjtnbbi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Meshes are designed using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LZFxi6I1RT"},{"type":"link","url":"https://discretize.simpeg.xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize package","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fdW0nSZ6M8"}],"urlSource":"https://discretize.simpeg.xyz","key":"gB4cug5kvO"},{"type":"text","value":". Here, we design a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Qdg93eOzeZ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tensor mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LzBkkTjmEH"}],"urlSource":"myst:discretize#discretize.TensorMesh","internal":false,"protocol":"xref:sphinx","key":"luSXriZdRg"},{"type":"text","value":". See the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gzT04QEmJt"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize user tutorials","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W8Rk9fSXFU"}],"urlSource":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","key":"PSAnD7pJXK"},{"type":"text","value":" to learn more about creating meshes. When designing a mesh for gravity inversion, we must consider the spatial wavelengths of the signals contained within the data. If the data spacing is large and/or the signals present in the data are smooth, larger cells can be used to construct the mesh. If the data spacing is smaller and compact anomalies are observed, smaller cells are needed to characterize the structures responsible. And smaller cells are required when the effects of surface topography are significant.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pHg9IBTFxF"}],"key":"CNcAuXgVXu"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"General rule of thumb:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kswderB8nU"}],"key":"Jf44QaWZSj"},{"type":"text","value":" The minimum cell size in each direction is at most 0.5 - 1 times the station spacing. And the thickness of the padding is at least 1 - 2 times the width of the survey region.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"J4JgqmZA4c"}],"key":"uxYqm47wqD"}],"key":"iATJEkEY0U"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.128034Z","iopub.status.busy":"2024-07-24T17:50:35.127697Z","iopub.status.idle":"2024-07-24T17:50:35.134740Z","shell.execute_reply":"2024-07-24T17:50:35.133917Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Generate tensor mesh with top at z = 0 m\ndh = 5.0  # minimum cell size\nhx = [(dh, 5, -1.3), (dh, 40), (dh, 5, 1.3)]  # discretization along x\nhy = [(dh, 5, -1.3), (dh, 40), (dh, 5, 1.3)]  # discretization along y\nhz = [(dh, 5, -1.3), (dh, 15)]  # discretization along z\ntensor_mesh = TensorMesh([hx, hy, hz], \"CCN\")\n\n# Shift vertically to top same as maximum topography\ntensor_mesh.origin += np.r_[0.0, 0.0, topo_xyz[:, -1].max()]","key":"FzcuumS5g9"},{"type":"output","id":"XDWuTst_UK9FgaD3NPRxf","data":[],"key":"dntfRwmxM5"}],"key":"lk63KIruQz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iYRYTjOKRR"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells","implicit":true,"key":"I2XefSb5K9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Whereas cells below the Earth’s surface contribute towards the simulated gravity anomaly, air cells do not.\nThe set of mesh cells used in the forward simulation are referred to as ‘active cells’. Unused cells (air cells) are ‘inactive cells’. Here, the discretize ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hI9WsJt6qd"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KFqa1Y7ztw"}],"urlSource":"myst:discretize#discretize.utils.active_from_xyz","internal":false,"protocol":"xref:sphinx","key":"ycMszS5euH"},{"type":"text","value":" utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ipf5KfIDB7"},{"type":"inlineCode","value":"bool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VJe7hyFiXh"},{"type":"text","value":" array.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"efPXRgSIQ1"}],"key":"XP7dUnGR7s"}],"key":"eQeqorzFBH"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.139123Z","iopub.status.busy":"2024-07-24T17:50:35.138748Z","iopub.status.idle":"2024-07-24T17:50:35.195173Z","shell.execute_reply":"2024-07-24T17:50:35.194453Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"active_tensor_cells = active_from_xyz(tensor_mesh, topo_xyz)\nn_tensor_active = int(active_tensor_cells.sum())","key":"fg0kMQljOg"},{"type":"output","id":"YnpX_VjS2l0XCegiQeiMG","data":[],"key":"T4l1BjkTX0"}],"key":"RgMzn4v0NA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from the Model to Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x3uOmQVTzl"}],"identifier":"mapping-from-the-model-to-active-cells","label":"Mapping from the Model to Active Cells","html_id":"mapping-from-the-model-to-active-cells","implicit":true,"key":"m9LoYitXfE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For whatever model we choose, we must define a mapping from the set of model parameters (a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dpE6Sv1WjJ"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1D numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mfQsy0KRDi"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"xref:sphinx","key":"opwYhGya68"},{"type":"text","value":") to the active cells in the mesh. Mappings are created using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"atDMC7wywl"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.IdentityMap.html#simpeg.maps.identitymap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.maps","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GdbohLqdMB"}],"urlSource":"myst:simpeg#simpeg.maps.IdentityMap","internal":false,"protocol":"xref:sphinx","key":"PwQWft38qa"},{"type":"text","value":" module. For the tutorial exercise, the model is the density contrast values for all active cells. As such, our mapping is an identity mapping, whose dimensions are equal to the number of active cells.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NGIIn6rpaV"}],"key":"in9hdL7Sfi"}],"key":"CezqK4WMO7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.199514Z","iopub.status.busy":"2024-07-24T17:50:35.199250Z","iopub.status.idle":"2024-07-24T17:50:35.203140Z","shell.execute_reply":"2024-07-24T17:50:35.202539Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tensor_model_map = maps.IdentityMap(nP=n_tensor_active)","key":"Tr2X71JUgb"},{"type":"output","id":"9iC42w7Qma-9aGj4ULlij","data":[],"key":"MqQu0fUgd2"}],"key":"tk55arARPM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting/Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GEyCnJ3qhu"}],"identifier":"starting-reference-models","label":"Starting/Reference Models","html_id":"starting-reference-models","implicit":true,"key":"BnQgvdhVpY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Z64WZ0okec"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"starting model","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JdrM3L3RVh"}],"key":"TE00yj23HY"},{"type":"text","value":" defines a reasonable starting point for the inversion and does not necessarily represent an initial estimate of the true model. Because the integral formulation used to solve the gravity forward simulation is linear, the optimization problem we must solve is a linear least-squares problem, making the choice in starting model insignificant. It should be noted that the starting model ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g5sDcQfeDM"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cannot be vector of zeros,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"laWrejtrjf"}],"key":"jcJB4cDp4G"},{"type":"text","value":" otherwise the inversion will be unable to compute a gradient direction at the first iteration. For gravity inversion, the starting model is frequently a constant vector with a very small value.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gO4SmncGa0"}],"key":"sTTzi9x9kV"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fUTwU4e1BV"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"reference model","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DqlDVkbKMc"}],"key":"gLRplYpjYD"},{"type":"text","value":" is used to include a-prior information. The impact of the reference model on the inversion will be discussed in another tutorial. Assuming the contribution from all background structures has been removed from the gravity anomaly data, and assuming we have not a-priori information, the reference model for basic inversion of gravity data is zero.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HkeNbShKBv"}],"key":"HvrapLP4Nk"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Notice that the length of the starting and reference models is equal to the number of active mesh cells!!!","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uyKILbC5Zr"}],"key":"f15TDqUDl3"}],"key":"zn33thF31m"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.207503Z","iopub.status.busy":"2024-07-24T17:50:35.207240Z","iopub.status.idle":"2024-07-24T17:50:35.211994Z","shell.execute_reply":"2024-07-24T17:50:35.211238Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"starting_tensor_model = 1e-6 * np.ones(n_tensor_active)\nreference_tensor_model = np.zeros_like(starting_tensor_model)","key":"WNVN4PvuQ2"},{"type":"output","id":"dSXY80PBMET_xMlTJ0r4o","data":[],"key":"uW3xVWK4AG"}],"key":"MaYGkGOjjG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.215439Z","iopub.status.busy":"2024-07-24T17:50:35.215118Z","iopub.status.idle":"2024-07-24T17:50:35.222209Z","shell.execute_reply":"2024-07-24T17:50:35.221525Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Map for ignoring inactive cells when plotting\ntensor_plotting_map = maps.InjectActiveCells(tensor_mesh, active_tensor_cells, np.nan)","key":"jOJwKKII3w"},{"type":"output","id":"tjPYEkFDEeDU_ztujhY6t","data":[],"key":"ZLe5miLyyB"}],"key":"GfVW9aNava"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.225855Z","iopub.status.busy":"2024-07-24T17:50:35.225570Z","iopub.status.idle":"2024-07-24T17:50:35.419411Z","shell.execute_reply":"2024-07-24T17:50:35.418810Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(7, 3))\nax1 = fig.add_axes([0.1, 0.1, 0.73, 0.8])\n\nnorm = mpl.colors.Normalize(vmin=-0.1, vmax=0.1)\ntensor_mesh.plot_slice(\n    tensor_plotting_map * starting_tensor_model,\n    normal=\"Y\",\n    ax=ax1,\n    ind=int(tensor_mesh.shape_cells[1] / 2),\n    grid=True,\n    pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm},\n)\nax1.set_title(\"Starting Model (slice at y = 0 m)\")\n\nax2 = fig.add_axes([0.85, 0.1, 0.03, 0.8])\ncbar = mpl.colorbar.ColorbarBase(\n    ax2, norm=norm, orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n)\ncbar.set_label(\"$g/cm^3$\", rotation=270, labelpad=15, size=16)\n\nplt.show()","key":"TqNn0OzL1B"},{"type":"output","id":"KzAmZSGPI1Qcla9a-yeqw","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"46ff3e21c1af38ff0f166ec4e97215dd","path":"/user-tutorials/build/46ff3e21c1af38ff0f166ec4e97215dd.png"},"text/plain":{"content":"<Figure size 700x300 with 2 Axes>","content_type":"text/plain"}}}],"key":"KKPNqZRito"}],"key":"XizQWwjntg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zwFrHld2fv"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"w2eMHAv08c"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for gravity anomaly data was discussed in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OZODAKErPL"},{"type":"link","url":"/fwd-gravity-anomaly-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Gravity Anomaly Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E0tooRbJBT"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","dataUrl":"/fwd-gravity-anomaly-3d.json","internal":true,"protocol":"file","key":"FK6h3YkLZn"},{"type":"text","value":" tutorial. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hKwCisZcT7"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.potential_fields.gravity.Simulation3DIntegral.html#simpeg.potential_fields.gravity.Simulation3DIntegral","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D integral formulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Mttqux3wDr"}],"urlSource":"myst:simpeg#simpeg.potential_fields.gravity.simulation.Simulation3DIntegral","internal":false,"protocol":"xref:sphinx","key":"GGCJjNy7Cx"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i162vJtRLg"}],"key":"PIlttFQDjy"}],"key":"dbtGiHimEG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.424361Z","iopub.status.busy":"2024-07-24T17:50:35.424019Z","iopub.status.idle":"2024-07-24T17:50:35.466644Z","shell.execute_reply":"2024-07-24T17:50:35.465850Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_L2 = gravity.simulation.Simulation3DIntegral(\n    survey=survey,\n    mesh=tensor_mesh,\n    rhoMap=tensor_model_map,\n    ind_active=active_tensor_cells,\n    engine=\"geoana\",\n)","key":"UcKKvBGopO"},{"type":"output","id":"pNXfYnRbLxXcygoCyTXVl","data":[],"key":"ObYlm1RcWm"}],"key":"goKE5OHzwu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"o7fU5gjQdt"}],"key":"CSXHDIrrzz"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"By choosing ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bhicWLrGzh"},{"type":"inlineCode","value":"engine=\"choclo\"","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xc70A8U7iT"},{"type":"text","value":" we can make our simulation to run the faster and more memory efficient implementation of the gravity forward that uses ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gL09EL5ubV"},{"type":"link","url":"https://numba.pydata.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Numba","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pHCUQqa2ag"}],"urlSource":"https://numba.pydata.org/","key":"D6OmOPOLHg"},{"type":"text","value":" and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hkV6lNUbuZ"},{"type":"link","url":"https://www.fatiando.org/choclo","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Choclo","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lWYFlW2hU7"}],"urlSource":"https://www.fatiando.org/choclo","key":"A5LnZcdOZb"},{"type":"text","value":" under the hood. To do so, we need to have ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VL3pOc4Bv9"},{"type":"link","url":"https://www.fatiando.org/choclo/latest/install.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Choclo installed","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dKLugqJufT"}],"urlSource":"https://www.fatiando.org/choclo/latest/install.html","key":"vVF3P9na1q"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"erv0MXuoLO"}],"key":"Dzj8OEk6JX"}],"key":"MOrjxdN68C"}],"key":"W8whCFgVfz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CQGmPD2oLh"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit","implicit":true,"key":"GwxqMOIPOe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To understand the role of the data misfit in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"O09N7qOcd1"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jsrFRhywLL"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"nnYx9BZI0s"},{"type":"text","value":".\nHere, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a87PZk53LA"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"L2DataMisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fbkCC2Hiv4"}],"urlSource":"myst:simpeg#simpeg.data_misfit.L2DataMisfit","internal":false,"protocol":"xref:sphinx","key":"GXUdVBcwQQ"},{"type":"text","value":" class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NlhwdIgbLc"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PXiM3S5ryx"}],"key":"rwR0N7OuKS"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i6veq6ysj8"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simulation object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QxR5RKyM0k"}],"key":"m7IUwQ2WcF"},{"type":"text","value":" as properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xgmc2fLp8F"}],"key":"GSs0aQPxjK"}],"key":"txIHYqXD2Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.471697Z","iopub.status.busy":"2024-07-24T17:50:35.471446Z","iopub.status.idle":"2024-07-24T17:50:35.475502Z","shell.execute_reply":"2024-07-24T17:50:35.474902Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_L2 = data_misfit.L2DataMisfit(data=data_object, simulation=simulation_L2)","key":"va5tSYCU0h"},{"type":"output","id":"YCrs7V8UkIcV6XkMGKjyP","data":[],"key":"ngCpkTsacP"}],"key":"kTyq9XKV7T"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DYrENk5yVt"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization","implicit":true,"key":"iB9bf2nYnA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To understand the role of the regularization in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AXxEyXW44n"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iNhhgvsXpb"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","key":"USKeTbJQtn"},{"type":"text","value":". Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Trev4isqil"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"WeightedLeastSquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bph1FwkK1i"}],"urlSource":"myst:simpeg#simpeg.regularization.WeightedLeastSquares","internal":false,"protocol":"xref:sphinx","key":"v6NyfmAQDl"},{"type":"text","value":" regularization class to constrain the inversion result. Here, length scales along x, y and z are used to balance the smallness and smoothness terms. And the reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K2Vut7aH0t"}],"key":"O6UqurV2gh"}],"key":"w3WQX9oUy7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.481223Z","iopub.status.busy":"2024-07-24T17:50:35.480978Z","iopub.status.idle":"2024-07-24T17:50:35.586932Z","shell.execute_reply":"2024-07-24T17:50:35.586114Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_L2 = regularization.WeightedLeastSquares(\n    tensor_mesh,\n    active_cells=active_tensor_cells,\n    length_scale_x=1.0,\n    length_scale_y=1.0,\n    length_scale_z=1.0,\n    reference_model=reference_tensor_model,\n    reference_model_in_smooth=False,\n)","key":"z3otv1KaRD"},{"type":"output","id":"sEIIcV-HY_T9A7jW3d0MO","data":[],"key":"zzeypzZa6C"}],"key":"H2jyyy97Hl"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fddNbPo0kb"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm","implicit":true,"key":"JOpqzep1Gv"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jWEAGLgwug"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.InexactGaussNewton.html#simpeg.optimization.inexactgaussnewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"InexactGaussNewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eiOTs20wPq"}],"urlSource":"myst:simpeg#simpeg.optimization.InexactGaussNewton","internal":false,"protocol":"xref:sphinx","key":"QPDWeV7C2i"},{"type":"text","value":" class to solve the optimization problem using inexact Gauss-Newton. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ArkRVTiCvM"}],"key":"WyBLyJkzCL"}],"key":"TnMYDwRNWb"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.592389Z","iopub.status.busy":"2024-07-24T17:50:35.592029Z","iopub.status.idle":"2024-07-24T17:50:35.596340Z","shell.execute_reply":"2024-07-24T17:50:35.595611Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_L2 = optimization.InexactGaussNewton(\n    maxIter=100, maxIterLS=20, maxIterCG=10, tolCG=1e-2\n)","key":"xHZRHgzNiF"},{"type":"output","id":"0x5AcDxaR4VWrx7YvFnlW","data":[],"key":"l4tXE3dlB9"}],"key":"n2QUmkTIF9"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CxsrzUVoZS"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem","implicit":true,"key":"HgzP64FQtA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kmQMVH2L9n"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInvProblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"saWYBjFrtr"}],"urlSource":"myst:simpeg#simpeg.inverse_problem.BaseInvProblem","internal":false,"protocol":"xref:sphinx","key":"J91vUkzlVs"},{"type":"text","value":" class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TLvC1e8xD6"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data misfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"laikdjOrTW"}],"key":"HRvsIvpoRJ"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u96BwRj5vp"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"regularization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"feupCFHO6T"}],"key":"Abzbjh0Fg6"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wNIms9N2r8"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IDxPnQk1qz"}],"key":"nlujlNuPZb"},{"type":"text","value":" objects.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"enEPKEfPSo"}],"key":"S4VcVNdMkw"}],"key":"OkszjiSsIW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.601516Z","iopub.status.busy":"2024-07-24T17:50:35.601271Z","iopub.status.idle":"2024-07-24T17:50:35.605495Z","shell.execute_reply":"2024-07-24T17:50:35.604547Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)","key":"Job8LDGX31"},{"type":"output","id":"Fwnb-gcjx0OLBg-DwCHYN","data":[],"key":"vGHfK5ZelO"}],"key":"IVMXWZBaIh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E84iXDW4W8"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives","implicit":true,"key":"CicmN1Ngwj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Directives represent operations that are carried out during the inversion. Here, we apply common directives for weighted least-squares inversion of gravity data and describe their roles. These are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wJcMuw5Xb9"}],"key":"F9acYNVbvl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"h7IzBq3qlH"}],"urlSource":"myst:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"d5ZL51hhnq"},{"type":"text","value":": Apply sensitivity weighting to counteract the natural tendancy of potential field inversion to cluster recovered structures near the receivers. Because the 3D integral formulation is linear, the sensitivity weighting is independent of the model and does not need to be updated throughout the inversion, so we set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"upibYRQ6Yx"},{"type":"inlineCode","value":"every_iteration=False","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V28J2DE6be"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nWesjG6Dpd"}],"key":"cTi2HK9WeT"}],"key":"wMzRNn61dE"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YiG7kIfsyC"}],"urlSource":"myst:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"nAVBSAJaG5"},{"type":"text","value":": Apply Jacobi preconditioner when solving optimization problem.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jtzR2tS25N"}],"key":"kfcM6Grr88"}],"key":"KiVTEL6Ueg"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gxzM2X40lO"}],"urlSource":"myst:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"XpagHmzXsP"},{"type":"text","value":": Compute and set starting trade-off parameter (beta) based on largest eigenvalues.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qmxLZ9W0Oo"}],"key":"G89ipaBYA6"}],"key":"u1U6lesml9"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DaITsaCIum"}],"urlSource":"myst:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"nNBvnWCwcs"},{"type":"text","value":": Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VYROvyvMjf"}],"key":"EEwCGr702k"}],"key":"xYjSegFC4W"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"V4rGOwYWHP"}],"urlSource":"myst:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"GlUwS8d1F6"},{"type":"text","value":": Terminates the inversion when the data misfit equals the target misfit. A ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BGm6OwtOhq"},{"type":"inlineCode","value":"chifact=1","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ZgTmxFpdcQ"},{"type":"text","value":" terminates the inversion when the data misfit equals the number of data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"lL0eNYhWse"}],"key":"q7BNc0JU2j"}],"key":"viSiht5Ex1"}],"key":"vlP6eOzBAW"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"The directive objects are organized in a ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FGN6QcLJVe"},{"type":"inlineCode","value":"list","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"lmtcp1nbic"},{"type":"text","value":". Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"AfkOnul1uq"},{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"in order","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FYgRSuqtgV"}],"key":"EuesLlenHx"},{"type":"text","value":". The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"pOoDAQ3Rab"},{"type":"inlineCode","value":"BetaEstimate_ByEig","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"UtauI7X5KU"},{"type":"text","value":" are only used when starting the inversion. Other directives, like ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"atS4gcHapJ"},{"type":"inlineCode","value":"UpdatePreconditionner","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ahK3MVerN1"},{"type":"text","value":", are used whenever the model is updated.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"wlZtpYT4Uy"}],"key":"MWMovDHfod"}],"key":"wPPhgS4oZS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.609573Z","iopub.status.busy":"2024-07-24T17:50:35.609275Z","iopub.status.idle":"2024-07-24T17:50:35.615304Z","shell.execute_reply":"2024-07-24T17:50:35.614572Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights = directives.UpdateSensitivityWeights(every_iteration=False)\nupdate_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)\nstarting_beta = directives.BetaEstimate_ByEig(beta0_ratio=10)\nbeta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=1)\ntarget_misfit = directives.TargetMisfit(chifact=1.0)\n\ndirectives_list_L2 = [\n    sensitivity_weights,\n    update_jacobi,\n    starting_beta,\n    beta_schedule,\n    target_misfit,\n]","key":"sGkI5FQWBe"},{"type":"output","id":"bvHSH3JnCzDoDkVbPJPrT","data":[],"key":"NmDuJ6bxd4"}],"key":"xvggyWhMG8"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bZlLOSGb0H"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion","implicit":true,"key":"Epw0YV7PyG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We define the inversion using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"laxt3QEEXz"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inversion.BaseInversion.html#simpeg.inversion.baseinversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U3T16oEYWC"}],"urlSource":"myst:simpeg#simpeg.inversion.BaseInversion","internal":false,"protocol":"xref:sphinx","key":"DIBHCuf17I"},{"type":"text","value":" class. The inversion class must be instantiated with an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"srKl5qNjPB"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"inverse problem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uimaY5Er0r"}],"key":"lygk4y2x2t"},{"type":"text","value":" object and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wfMGpHwvoJ"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"directives list","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ly2fmwPI1M"}],"key":"kfcWSJiQVw"},{"type":"text","value":". The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UT9tgaGO97"},{"type":"inlineCode","value":"run","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A0VY7Liukm"},{"type":"text","value":" method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Bu9efQ1DdE"}],"key":"W4vkWFSnxD"}],"key":"OcecxbsXm0"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.619925Z","iopub.status.busy":"2024-07-24T17:50:35.619475Z","iopub.status.idle":"2024-07-24T17:50:41.439734Z","shell.execute_reply":"2024-07-24T17:50:41.438631Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Here we combine the inverse problem and the set of directives\ninv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)\n\n# Run inversion\nrecovered_tensor_model = inv_L2.run(starting_tensor_model)","key":"GYr1s7ceuW"},{"type":"output","id":"WCcGnF82Vp5wd2n3O7kFa","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\n\n                    simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                    ***Done using the default solver Pardiso and no solver_opts.***\n                    \n"},{"name":"stdout","output_type":"stream","text":"model has any nan: 0\n============================ Inexact Gauss Newton ============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  8.32e+03  5.58e+04  6.08e-07  5.58e+04    2.09e+05      0              \n"},{"name":"stderr","output_type":"stream","text":"/home/ssoler/mambaforge/envs/simpeg-user-tutorials/lib/python3.10/site-packages/simpeg/optimization.py:1072: UserWarning: tol is not a valid keyword for cg and will be ignored\n  Hinv = SolverICG(\n"},{"name":"stdout","output_type":"stream","text":"   1  4.16e+03  2.22e+04  1.25e+00  2.74e+04    4.98e+04      0              \n"},{"name":"stdout","output_type":"stream","text":"   2  2.08e+03  1.48e+04  2.52e+00  2.00e+04    3.74e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  1.04e+03  8.73e+03  4.59e+00  1.35e+04    2.65e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   4  5.20e+02  4.53e+03  7.43e+00  8.39e+03    1.75e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   5  2.60e+02  2.12e+03  1.07e+01  4.89e+03    1.08e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   6  1.30e+02  9.60e+02  1.37e+01  2.74e+03    6.32e+03      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   7  6.50e+01  4.63e+02  1.64e+01  1.52e+03    3.55e+03      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 <= tolF*(1+|f0|) = 5.5789e+03\n1 : |xc-x_last| = 5.3003e-02 <= tolX*(1+|x0|) = 1.0002e-01\n0 : |proj(x-g)-x|    = 3.5454e+03 <= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 3.5454e+03 <= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    <= iter          =      8\n------------------------- DONE! -------------------------\n"}],"key":"ggMOCQrgON"}],"key":"ScZuutz27x"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IFHza8mYVS"}],"identifier":"plot-the-data-misfit","label":"Plot the Data Misfit","html_id":"plot-the-data-misfit","implicit":true,"key":"ptfaTHcJY2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This step is necessary for determining whether the recovered model accurately reproduces observed anomalies. Here, we plot the observed data, predicted data for the recovered model, and the misfit. As we can see, the predicted data fits the background somewhat better than the anomalies. As a result, you may reassign smaller uncertainties in these areas and re-run the inversion in order to better fit the anomalies. We will do this for the iteratively reweighted least-squares inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Pvhg8S4VcQ"}],"key":"VYE5kJ21lx"}],"key":"hcxBGpINqd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:41.445364Z","iopub.status.busy":"2024-07-24T17:50:41.443508Z","iopub.status.idle":"2024-07-24T17:50:41.907631Z","shell.execute_reply":"2024-07-24T17:50:41.906997Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Predicted data with final recovered model.\ndpred = inv_prob_L2.dpred\n\n# Observed data | Predicted data | Data misfit\ndata_array = np.c_[dobs, dpred, dobs - dpred]\n\nfig = plt.figure(figsize=(12, 5))\nplot_title = [\"Observed\", \"Predicted\", \"Data Misfit\"]\nplot_units = [\"mGal\", \"mGal\", \"mGal\"]\n\nax1 = 3 * [None]\nax2 = 3 * [None]\nnorm = 3 * [None]\ncbar = 3 * [None]\ncplot = 3 * [None]\nv_lim = [np.max(np.abs(dobs)), np.max(np.abs(dobs)), np.max(np.abs(dobs - dpred))]\n\nfor ii in range(0, 3):\n    ax1[ii] = fig.add_axes([0.3 * ii + 0.1, 0.2, 0.27, 0.75])\n    norm[ii] = mpl.colors.Normalize(vmin=-v_lim[ii], vmax=v_lim[ii])\n    cplot[ii] = plot2Ddata(\n        receiver_list[0].locations,\n        data_array[:, ii],\n        ax=ax1[ii],\n        ncontour=30,\n        contourOpts={\"cmap\": \"bwr\", \"norm\": norm[ii]},\n    )\n    ax1[ii].set_title(plot_title[ii])\n    ax1[ii].set_xlabel(\"x (m)\")\n    if ii == 0:\n        ax1[ii].set_ylabel(\"y (m)\")\n    else:\n        ax1[ii].set_yticks([])\n\n    ax2[ii] = fig.add_axes([0.3 * ii + 0.1, 0.05, 0.27, 0.05])\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"horizontal\", cmap=mpl.cm.bwr\n    )\n    cbar[ii].ax.locator_params(nbins=3)\n    cbar[ii].set_label(plot_units[ii], labelpad=5)\n\nplt.show()","key":"mQiUocpqXQ"},{"type":"output","id":"Jkn1st-ruRBzb9VrAsJad","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"dbc0d62577be40427df1291063fdb8c0","path":"/user-tutorials/build/dbc0d62577be40427df1291063fdb8c0.png"},"text/plain":{"content":"<Figure size 1200x500 with 6 Axes>","content_type":"text/plain"}}}],"key":"lqJr1hIJRN"}],"key":"iZJBL81P8y"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Recovered Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JtwQ8N3QJR"}],"identifier":"plot-the-recovered-model","label":"Plot the Recovered Model","html_id":"plot-the-recovered-model","implicit":true,"key":"UdbP0lrOOn"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As we can see, weighted least-squares regularization leads to the recovery of smooth models. And even with sensitivity weighting, there is a tendancy for gravity anomaly inversion to place recovered structures near the Earth’s surface.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mmkI8drWUM"}],"key":"do0sRHo8wS"}],"key":"ZFo7u7Xe2Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:41.910690Z","iopub.status.busy":"2024-07-24T17:50:41.910363Z","iopub.status.idle":"2024-07-24T17:50:42.091377Z","shell.execute_reply":"2024-07-24T17:50:42.090635Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot Recovered Model\nfig = plt.figure(figsize=(7, 3))\nax1 = fig.add_axes([0.1, 0.1, 0.73, 0.8])\n\nnorm = mpl.colors.Normalize(\n    vmin=np.min(recovered_tensor_model), vmax=np.max(recovered_tensor_model)\n)\ntensor_mesh.plot_slice(\n    tensor_plotting_map * recovered_tensor_model,\n    normal=\"Y\",\n    ax=ax1,\n    ind=int(tensor_mesh.shape_cells[1] / 2),\n    grid=False,\n    pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm},\n)\nax1.set_title(\"Model slice at y = 0 m\")\n\nax2 = fig.add_axes([0.85, 0.1, 0.03, 0.8])\ncbar = mpl.colorbar.ColorbarBase(\n    ax2, norm=norm, orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n)\ncbar.set_label(\"$g/cm^3$\", rotation=270, labelpad=15, size=16)\n\nplt.show()","key":"fnprXFgTL4"},{"type":"output","id":"-aJEctKnaguOoj5d5t59q","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"975a831f19b18935fe5dde45efcbf15e","path":"/user-tutorials/build/975a831f19b18935fe5dde45efcbf15e.png"},"text/plain":{"content":"<Figure size 700x300 with 2 Axes>","content_type":"text/plain"}}}],"key":"cbvNt5bQyJ"}],"key":"hr584b1u5R"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Iteratively Re-weighted Least-Squares (IRLS) Inversion on a Tree Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o9fZmokumT"}],"identifier":"iteratively-re-weighted-least-squares-irls-inversion-on-a-tree-mesh","label":"Iteratively Re-weighted Least-Squares (IRLS) Inversion on a Tree Mesh","html_id":"iteratively-re-weighted-least-squares-irls-inversion-on-a-tree-mesh","implicit":true,"key":"qrxP4XfP9z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we provide a step-by-step best-practices approach for iteratively IRLS inversion of gravity anomaly data on a tree mesh. Many of the steps are the same as our previous approach. As a result, we will avoid repeating information whenever possible. For the tutorial example, any datum whose normalized data misfit is outside of (-2, 2) will have its uncertainty decreased by a factor of 2.5. This choice was problem dependent!","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wuMOFcJTga"}],"key":"EJa0a6JxZR"}],"key":"WR05j3glZ2"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reassign the Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vwNf6fFx1q"}],"identifier":"reassign-the-uncertainties","label":"Reassign the Uncertainties","html_id":"reassign-the-uncertainties","implicit":true,"key":"jVN814GHRO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Prior to performing the IRLS inversion, we decrease the uncertainties at the locations we observed the largest data misfits. Here, our goal is to recover a model that better fits the anomalies.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oSeAuehUTZ"}],"key":"u6uddtSmQw"}],"key":"T23edj70QS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.096895Z","iopub.status.busy":"2024-07-24T17:50:42.096661Z","iopub.status.idle":"2024-07-24T17:50:42.099979Z","shell.execute_reply":"2024-07-24T17:50:42.099362Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute normalized data misfits\nnormalized_data_misfits = (dobs - dpred) / uncertainties","key":"OASBEgeFbg"},{"type":"output","id":"DRE-_eEowng3kyCxExGjJ","data":[],"key":"LYTEzUHgIB"}],"key":"JjD9zrZvDh"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.105491Z","iopub.status.busy":"2024-07-24T17:50:42.105193Z","iopub.status.idle":"2024-07-24T17:50:42.225438Z","shell.execute_reply":"2024-07-24T17:50:42.224841Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the normalized data misfits\nfig = plt.figure(figsize=(6, 3))\nax = fig.add_subplot(111)\nax.plot(np.sort(normalized_data_misfits))\nax.set_title(\"Normalized Data Misfits (sorted)\")\nax.grid()\nplt.show(fig)","key":"IZFG21vd8T"},{"type":"output","id":"lxpqLcwOFBUxdeNms_6ps","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4196f1a825382912512c2252dd138e40","path":"/user-tutorials/build/4196f1a825382912512c2252dd138e40.png"},"text/plain":{"content":"<Figure size 600x300 with 1 Axes>","content_type":"text/plain"}}}],"key":"d12Ujlw2wI"}],"key":"MGO1YaDz13"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.229086Z","iopub.status.busy":"2024-07-24T17:50:42.228851Z","iopub.status.idle":"2024-07-24T17:50:42.232800Z","shell.execute_reply":"2024-07-24T17:50:42.232119Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Generate new uncertainties\nnew_uncertainties = uncertainties.copy()\nnew_uncertainties[np.abs(normalized_data_misfits) > 2.0] /= 2.5","key":"ej7GXt9fED"},{"type":"output","id":"VGPscd5XCbSQaJPsNApb8","data":[],"key":"xy0q9WUj79"}],"key":"m6SAKwrOmq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.236283Z","iopub.status.busy":"2024-07-24T17:50:42.235989Z","iopub.status.idle":"2024-07-24T17:50:42.239516Z","shell.execute_reply":"2024-07-24T17:50:42.238990Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Generate new data object\nnew_data_object = data.Data(survey, dobs=dobs, standard_deviation=new_uncertainties)","key":"yeEeZJxaEb"},{"type":"output","id":"6TjCojdzEQVO4Mi_o_Jhk","data":[],"key":"yA0VD7GTVX"}],"key":"b63zvEyjUc"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tree) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rS4DvybBgS"}],"identifier":"design-a-tree-mesh","label":"Design a (Tree) Mesh","html_id":"design-a-tree-mesh","implicit":true,"key":"grIUUgw2p6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we design a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PL29VJXUXj"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tree mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U6Gqemr8OS"}],"urlSource":"myst:discretize#discretize.TreeMesh","internal":false,"protocol":"xref:sphinx","key":"CRyfovR3Xu"},{"type":"text","value":". See the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jt4M21hTsm"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize user tutorials","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hIikqKlsgS"}],"urlSource":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","key":"tfyIYzjazn"},{"type":"text","value":" to learn more about creating tree meshes. The same approach used to construct the tensor mesh used in the weighted least-squares inversion example applies to tree meshes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ByIIEBRQBf"}],"key":"c9vb5DZkEh"}],"key":"SYO0ZnmEQA"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.242874Z","iopub.status.busy":"2024-07-24T17:50:42.242591Z","iopub.status.idle":"2024-07-24T17:50:42.540246Z","shell.execute_reply":"2024-07-24T17:50:42.539356Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dx = 5  # minimum cell width (base tree_mesh cell width) in x\ndy = 5  # minimum cell width (base tree_mesh cell width) in y\ndz = 5  # minimum cell width (base tree_mesh cell width) in z\n\nx_length = 240.0  # domain width in x\ny_length = 240.0  # domain width in y\nz_length = 120.0  # domain width in z\n\n# Compute number of base tree_mesh cells required in x and y\nnbcx = 2 ** int(np.round(np.log(x_length / dx) / np.log(2.0)))\nnbcy = 2 ** int(np.round(np.log(y_length / dy) / np.log(2.0)))\nnbcz = 2 ** int(np.round(np.log(z_length / dz) / np.log(2.0)))\n\n# Define the base tree_mesh\nhx = [(dx, nbcx)]\nhy = [(dy, nbcy)]\nhz = [(dz, nbcz)]\ntree_mesh = TreeMesh([hx, hy, hz], x0=\"CCN\")\n\n# Shift vertically to top same as maximum topography\ntree_mesh.origin += np.r_[0.0, 0.0, topo_xyz[:, -1].max()]\n\n# Refine based on surface topography\ntree_mesh.refine_surface(topo_xyz, padding_cells_by_level=[2, 2], finalize=False)\n\n# Refine box based on region of interest\nwsb_corner = np.c_[-100, -100, 20]\nent_corner = np.c_[100, 100, 100]\n# Note -1 is a flag for smallest cell size\ntree_mesh.refine_box(wsb_corner, ent_corner, levels=[-1], finalize=False)\n\ntree_mesh.finalize()","key":"QkVgksaGKM"},{"type":"output","id":"sM-rAQCh3yq7wvNhn_Hj-","data":[],"key":"O9CXdV704w"}],"key":"LscXDc2Sl6"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BmuBXNLTnz"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells-1","implicit":true,"key":"xxDDvfng2Q"}],"key":"mjYkVQttqP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.544638Z","iopub.status.busy":"2024-07-24T17:50:42.544384Z","iopub.status.idle":"2024-07-24T17:50:42.597733Z","shell.execute_reply":"2024-07-24T17:50:42.597087Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"active_tree_cells = active_from_xyz(tree_mesh, topo_xyz)\nn_tree_active = int(active_tree_cells.sum())","key":"vh3fXNSLe1"},{"type":"output","id":"Sj6_rKu3im0RqHQkA1ZWJ","data":[],"key":"qCgO7a2MCa"}],"key":"LPNRITWbHO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from Model to Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YyB1epslBL"}],"identifier":"mapping-from-model-to-active-cells","label":"Mapping from Model to Active Cells","html_id":"mapping-from-model-to-active-cells","implicit":true,"key":"efvPrxCP4u"}],"key":"WBGZ46LSK9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.602572Z","iopub.status.busy":"2024-07-24T17:50:42.602317Z","iopub.status.idle":"2024-07-24T17:50:42.606142Z","shell.execute_reply":"2024-07-24T17:50:42.605519Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tree_model_map = maps.IdentityMap(nP=n_tree_active)","key":"VvChTcDx64"},{"type":"output","id":"57yPlx2HHXlPYGDGUpBce","data":[],"key":"nm7kOlv6Tw"}],"key":"WlWaj9rkvg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting and Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BzjeSFT1dt"}],"identifier":"starting-and-reference-models","label":"Starting and Reference Models","html_id":"starting-and-reference-models","implicit":true,"key":"b8boHVgg64"}],"key":"rVM9KR84Zy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.611118Z","iopub.status.busy":"2024-07-24T17:50:42.610871Z","iopub.status.idle":"2024-07-24T17:50:42.614968Z","shell.execute_reply":"2024-07-24T17:50:42.614229Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"starting_tree_model = 1e-6 * np.ones(n_tree_active)\nreference_tree_model = np.zeros_like(starting_tree_model)","key":"mg2jkkOL8c"},{"type":"output","id":"SDP8VIaQbdnf2jWT99tRA","data":[],"key":"tOxrVT64kS"}],"key":"yjLJC7nqTU"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"totTJuQV05"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation-1","implicit":true,"key":"xHRry2D1ox"}],"key":"BwPtt59erM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.618456Z","iopub.status.busy":"2024-07-24T17:50:42.618145Z","iopub.status.idle":"2024-07-24T17:50:42.681047Z","shell.execute_reply":"2024-07-24T17:50:42.680116Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_irls = gravity.simulation.Simulation3DIntegral(\n    survey=survey, mesh=tree_mesh, rhoMap=tree_model_map, ind_active=active_tree_cells\n)","key":"XoENQfpriq"},{"type":"output","id":"iLSPYbWa7lvbvSe86-CCY","data":[],"key":"RiPvUPqXHI"}],"key":"MoOY5kEjVb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wan0ZGY1ga"}],"identifier":"define-data-misfit","label":"Define Data Misfit","html_id":"define-data-misfit","implicit":true,"key":"gSr22aifta"}],"key":"fkSgYfTULU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.685756Z","iopub.status.busy":"2024-07-24T17:50:42.685491Z","iopub.status.idle":"2024-07-24T17:50:42.689694Z","shell.execute_reply":"2024-07-24T17:50:42.689094Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_irls = data_misfit.L2DataMisfit(data=new_data_object, simulation=simulation_irls)","key":"XncVjpkj6l"},{"type":"output","id":"tvTs5FUE0fZyxZNC4orBV","data":[],"key":"OepQiaqQCt"}],"key":"YvwMK6vsix"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z8ci68pp5A"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization-1","implicit":true,"key":"OshBMNFNVb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TGj20gEoJS"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.Sparse.html#simpeg.regularization.sparse","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Sparse","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KDyqqoJBsd"}],"urlSource":"myst:simpeg#simpeg.regularization.Sparse","internal":false,"protocol":"xref:sphinx","key":"EMO2eBos5e"},{"type":"text","value":" regularization class to constrain the inversion result using an IRLS approach. Here, the scaling constants that balance the smallness and smoothness terms are set directly. Equal emphasis on smallness and smoothness is generally applied by using the inverse square of the smallest cell dimension. The reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros. Here, we apply a 0-norm to the smallness term and a 1-norm to first-order smoothness along the x, y and z directions.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rGbpUeeriI"}],"key":"U896pYJRrm"}],"key":"gSzgbnaVsD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.693612Z","iopub.status.busy":"2024-07-24T17:50:42.693372Z","iopub.status.idle":"2024-07-24T17:50:42.754759Z","shell.execute_reply":"2024-07-24T17:50:42.753782Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_irls = regularization.Sparse(\n    tree_mesh,\n    active_cells=active_tree_cells,\n    alpha_s=dh**-2,\n    alpha_x=1,\n    alpha_y=1,\n    alpha_z=1,\n    reference_model=reference_tree_model,\n    reference_model_in_smooth=False,\n    norms=[0, 1, 1, 1],\n)","key":"Agc6ep5xeY"},{"type":"output","id":"m3Onc0cvcthbJv9wyWvLG","data":[],"key":"V9LiqQYi3B"}],"key":"gYfYwV9PbN"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ID5qxIwR6q"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm-1","implicit":true,"key":"FOs9qRvvV3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tOzzTFECiy"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.ProjectedGNCG.html#simpeg.optimization.projectedgncg","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ProjectedGNCG","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"twucPYA7Q5"}],"urlSource":"myst:simpeg#simpeg.optimization.ProjectedGNCG","internal":false,"protocol":"xref:sphinx","key":"fDmg2ioqBa"},{"type":"text","value":" class to solve the optimization problem using projected Gauss-Newton conjugate gradient. This opimization class allows the user to set upper and lower bounds for the recovered model using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jc2b0EEVMb"},{"type":"inlineCode","value":"upper","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZkoYhyGovN"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CluybMYSez"},{"type":"inlineCode","value":"lower","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TJGPxOstIk"},{"type":"text","value":" properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yh7Vok6HrY"}],"key":"VleN8t1fXU"}],"key":"COFSJ3rCKu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.759223Z","iopub.status.busy":"2024-07-24T17:50:42.758984Z","iopub.status.idle":"2024-07-24T17:50:42.763350Z","shell.execute_reply":"2024-07-24T17:50:42.762674Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_irls = optimization.ProjectedGNCG(\n    maxIter=100, lower=-1.0, upper=1.0, maxIterLS=20, maxIterCG=10, tolCG=1e-2\n)","key":"EQR6iPRMg7"},{"type":"output","id":"qDCZQC9baG0Z5936zfx-R","data":[],"key":"H9BGjiGVN7"}],"key":"Tj6Wa3Pta2"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HT0eh9R1qK"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem-1","implicit":true,"key":"m4QSq4vEy5"}],"key":"r3wk6QOhj3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.767534Z","iopub.status.busy":"2024-07-24T17:50:42.767213Z","iopub.status.idle":"2024-07-24T17:50:42.771180Z","shell.execute_reply":"2024-07-24T17:50:42.770461Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_irls = inverse_problem.BaseInvProblem(dmis_irls, reg_irls, opt_irls)","key":"oB4P9y4YWD"},{"type":"output","id":"OFffeOG3LDLA60Hp9Bczr","data":[],"key":"ISZJUDNO9b"}],"key":"fqj9ciWDJa"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pqasLNSpLC"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives-1","implicit":true,"key":"HpKLx7Zwxr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we create common directives for IRLS inversion of gravity data and describe their roles. In additon to the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JDlvvLmTFD"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Utk2UIkVia"}],"urlSource":"myst:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"Wj1tpUo41V"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"niWMzsGV9J"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JSI1U3ZKvP"}],"urlSource":"myst:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"UNvoZss9Oz"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NXVGuhIkg6"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U8MyuiH3UW"}],"urlSource":"myst:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"DOZb4XF0rH"},{"type":"text","value":"  (described before), inversion with sparse-norms requires the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HLIyHo87H8"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Update_IRLS","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gWfQ6qWe5x"}],"urlSource":"myst:simpeg#simpeg.directives.Update_IRLS","internal":false,"protocol":"xref:sphinx","key":"mzFMr00Jvu"},{"type":"text","value":" directive.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rpRYXpDIma"}],"key":"LyTLwcxSmP"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"You will notice that we don’t use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YUz9S30Gt5"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xjsBsimzoI"}],"urlSource":"myst:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"WRZ3qPMdZ7"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QqE55dnFHu"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e1BIQeSBXf"}],"urlSource":"myst:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"N5i43rVVrk"},{"type":"text","value":" directives. Here, the beta cooling schedule is set in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NatiHGKLvO"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Update_IRLS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IqyWD8YxtX"}],"urlSource":"myst:simpeg#simpeg.directives.Update_IRLS","internal":false,"protocol":"xref:sphinx","key":"KqbSdPJoeH"},{"type":"text","value":" directive using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ymRMQFiyJl"},{"type":"inlineCode","value":"coolingFactor","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FOx493Qu4l"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gVzOP9DS4f"},{"type":"inlineCode","value":"coolingRate","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DihKep92yF"},{"type":"text","value":" properties. The target misfit for the L2 portion of the IRLS approach is set with the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nSgi10YwSH"},{"type":"inlineCode","value":"chifact_start","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ch85okvZye"},{"type":"text","value":" property.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CSQyhQHUEX"}],"key":"Jxb8swLYvx"}],"key":"RkIniLWmyU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.774758Z","iopub.status.busy":"2024-07-24T17:50:42.774451Z","iopub.status.idle":"2024-07-24T17:50:42.780562Z","shell.execute_reply":"2024-07-24T17:50:42.779928Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights_irls = directives.UpdateSensitivityWeights(every_iteration=False)\nstarting_beta_irls = directives.BetaEstimate_ByEig(beta0_ratio=10)\nupdate_jacobi_irls = directives.UpdatePreconditioner(update_every_iteration=True)\nupdate_irls = directives.Update_IRLS(\n    coolingFactor=2,\n    coolingRate=1,\n    chifact_start=1.0,\n    f_min_change=1e-4,\n    max_irls_iterations=25,\n)\n\ndirectives_list_irls = [\n    update_irls,\n    sensitivity_weights_irls,\n    starting_beta_irls,\n    update_jacobi_irls,\n]","key":"rdNghMocqv"},{"type":"output","id":"tE-kg2-K_lIitQxnT-742","data":[],"key":"zSM1Rjw0y2"}],"key":"T4wP3KGwHz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GoMEXM4SGK"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion-1","implicit":true,"key":"eWwTCYs1Up"}],"key":"Ou7F74IbDc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.784574Z","iopub.status.busy":"2024-07-24T17:50:42.784349Z","iopub.status.idle":"2024-07-24T17:51:03.370386Z","shell.execute_reply":"2024-07-24T17:51:03.369483Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_irls = inversion.BaseInversion(inv_prob_irls, directives_list_irls)\nrecovered_tree_model = inv_irls.run(starting_tree_model)","key":"Q6zIhUchqc"},{"type":"output","id":"lZac0JZu_JM_Dpmq9G8iO","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\n\n                    simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                    ***Done using the default solver Pardiso and no solver_opts.***\n                    \n"},{"name":"stdout","output_type":"stream","text":"model has any nan: 0\n=============================== Projected GNCG ===============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  5.66e+06  1.17e+05  1.34e-08  1.17e+05    1.99e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   1  2.83e+06  9.76e+04  1.53e-03  1.02e+05    1.98e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   2  1.42e+06  8.57e+04  4.61e-03  9.23e+04    1.97e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  7.08e+05  7.04e+04  1.25e-02  7.93e+04    1.97e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   4  3.54e+05  5.31e+04  3.02e-02  6.38e+04    1.96e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   5  1.77e+05  3.60e+04  6.49e-02  4.75e+04    1.94e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   6  8.84e+04  2.14e+04  1.24e-01  3.23e+04    1.93e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   7  4.42e+04  1.10e+04  2.07e-01  2.01e+04    1.92e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   8  2.21e+04  4.93e+03  3.01e-01  1.16e+04    1.88e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   9  1.11e+04  2.08e+03  3.90e-01  6.39e+03    1.80e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  10  5.53e+03  9.03e+02  4.63e-01  3.46e+03    1.68e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  11  2.76e+03  4.42e+02  5.20e-01  1.88e+03    1.55e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"Reached starting chifact with l2-norm regularization: Start IRLS steps...\nirls_threshold 0.03781349714154632\n"},{"name":"stdout","output_type":"stream","text":"  12  1.38e+03  2.52e+02  9.07e-01  1.51e+03    1.21e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  13  2.47e+03  1.83e+02  1.15e+00  3.02e+03    1.74e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  14  2.03e+03  3.25e+02  1.09e+00  2.53e+03    1.36e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  15  2.03e+03  2.73e+02  1.19e+00  2.68e+03    1.57e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  16  2.03e+03  3.04e+02  1.19e+00  2.73e+03    1.51e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  17  2.03e+03  3.17e+02  1.19e+00  2.74e+03    1.51e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  18  1.64e+03  3.34e+02  1.17e+00  2.25e+03    1.05e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  19  1.64e+03  3.08e+02  1.15e+00  2.19e+03    1.48e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  20  1.35e+03  3.21e+02  1.11e+00  1.82e+03    1.00e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  21  1.35e+03  3.02e+02  1.06e+00  1.73e+03    1.46e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  22  1.35e+03  3.10e+02  9.99e-01  1.66e+03    1.48e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  23  1.12e+03  3.18e+02  9.62e-01  1.40e+03    1.11e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  24  1.12e+03  3.04e+02  9.28e-01  1.34e+03    1.44e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  25  1.12e+03  3.09e+02  8.80e-01  1.29e+03    1.46e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  26  1.12e+03  3.13e+02  8.31e-01  1.24e+03    1.44e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  27  1.12e+03  3.17e+02  7.81e-01  1.19e+03    1.45e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  28  9.25e+02  3.20e+02  7.55e-01  1.02e+03    8.04e+01      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  29  9.25e+02  3.10e+02  7.11e-01  9.68e+02    1.38e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  30  9.25e+02  3.10e+02  6.62e-01  9.22e+02    1.40e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  31  9.25e+02  3.11e+02  6.32e-01  8.96e+02    1.39e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  32  9.25e+02  3.13e+02  5.75e-01  8.45e+02    1.36e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  33  9.25e+02  3.13e+02  5.29e-01  8.03e+02    1.33e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  34  9.25e+02  3.13e+02  5.10e-01  7.85e+02    1.31e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  35  9.25e+02  3.14e+02  4.77e-01  7.55e+02    1.26e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  36  9.25e+02  3.13e+02  4.43e-01  7.23e+02    1.22e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"Reach maximum number of IRLS cycles: 25\n------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 <= tolF*(1+|f0|) = 1.1702e+04\n1 : |xc-x_last| = 4.6569e-02 <= tolX*(1+|x0|) = 1.0002e-01\n0 : |proj(x-g)-x|    = 1.2210e+02 <= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 1.2210e+02 <= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    <= iter          =     37\n------------------------- DONE! -------------------------\n"}],"key":"ejDj0T14as"}],"key":"b8Wd2QXuRu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fz06Zx7MyK"}],"identifier":"plot-the-data-misfit","label":"Plot the Data Misfit","html_id":"plot-the-data-misfit-1","implicit":true,"key":"IS4AY10nXi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we plot the observed data, predicted and misfit for the IRLS inversion. As we can see from the misfit map, the observed data is now fit equally at all locations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KqXhqq2MWm"}],"key":"KdVXJlolAi"}],"key":"DAuuShtDs1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:51:03.375741Z","iopub.status.busy":"2024-07-24T17:51:03.373941Z","iopub.status.idle":"2024-07-24T17:51:03.840964Z","shell.execute_reply":"2024-07-24T17:51:03.839875Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Predicted data with final recovered model.\ndpred_new = inv_prob_irls.dpred\n\n# Observed data | Predicted data | Data misfit\ndata_array = np.c_[dobs, dpred_new, dobs - dpred_new]\n\nfig = plt.figure(figsize=(12, 5))\nplot_title = [\"Observed\", \"Predicted\", \"Data Misfit\"]\nplot_units = [\"mGal\", \"mGal\", \"mGal\"]\n\nax1 = 3 * [None]\nax2 = 3 * [None]\nnorm = 3 * [None]\ncbar = 3 * [None]\ncplot = 3 * [None]\nv_lim = [np.max(np.abs(dobs)), np.max(np.abs(dobs)), np.max(np.abs(dobs - dpred_new))]\n\nfor ii in range(0, 3):\n    ax1[ii] = fig.add_axes([0.3 * ii + 0.1, 0.2, 0.27, 0.75])\n    norm[ii] = mpl.colors.Normalize(vmin=-v_lim[ii], vmax=v_lim[ii])\n    cplot[ii] = plot2Ddata(\n        receiver_list[0].locations,\n        data_array[:, ii],\n        ax=ax1[ii],\n        ncontour=30,\n        contourOpts={\"cmap\": \"bwr\", \"norm\": norm[ii]},\n    )\n    ax1[ii].set_title(plot_title[ii])\n    ax1[ii].set_xlabel(\"x (m)\")\n    if ii == 0:\n        ax1[ii].set_ylabel(\"y (m)\")\n    else:\n        ax1[ii].set_yticks([])\n\n    ax2[ii] = fig.add_axes([0.3 * ii + 0.1, 0.05, 0.27, 0.05])\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"horizontal\", cmap=mpl.cm.bwr\n    )\n    cbar[ii].ax.locator_params(nbins=3)\n    cbar[ii].set_label(plot_units[ii], labelpad=5)\n\nplt.show()","key":"U0w9oJKe4g"},{"type":"output","id":"O6G3qlgSh_0UO3loTwy5f","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5af2221ebe833732004fbc1e7f34754e","path":"/user-tutorials/build/5af2221ebe833732004fbc1e7f34754e.png"},"text/plain":{"content":"<Figure size 1200x500 with 6 Axes>","content_type":"text/plain"}}}],"key":"R9KxsOmODX"}],"key":"JoqfBAh4oa"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot True, L2 and IRLS Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i5avDCcxZf"}],"identifier":"plot-true-l2-and-irls-models","label":"Plot True, L2 and IRLS Models","html_id":"plot-true-l2-and-irls-models","implicit":true,"key":"GK34YS8oeO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we compare the models recovered from weighted least-squares and iteratively re-weighted least-squares inversion to the true model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X21bDzw56l"}],"key":"BEQ6cqnfgG"}],"key":"MFBgPfgHTN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:51:03.845460Z","iopub.status.busy":"2024-07-24T17:51:03.845096Z","iopub.status.idle":"2024-07-24T17:51:03.857965Z","shell.execute_reply":"2024-07-24T17:51:03.856941Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Recreate True Model on a Tensor Mesh\nbackground_density = 0.0\nblock_density = -0.2\nsphere_density = 0.2\n\ntrue_model = background_density * np.ones(n_tensor_active)\n\nind_block = model_builder.get_indices_block(\n    [-50, -15, 50], [-20, 15, 70], tensor_mesh.cell_centers[active_tensor_cells]\n)\ntrue_model[ind_block] = block_density\n\nind_sphere = model_builder.get_indices_sphere(\n    np.r_[35.0, 0.0, 60.0], 14.0, tensor_mesh.cell_centers[active_tensor_cells]\n)\ntrue_model[ind_sphere] = sphere_density","key":"ZW1gCvsj0I"},{"type":"output","id":"Gzzn63ivIzPLeejqqzABi","data":[],"key":"jYVEMiHhCc"}],"key":"kbSJVkmmGz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:51:03.861366Z","iopub.status.busy":"2024-07-24T17:51:03.861133Z","iopub.status.idle":"2024-07-24T17:51:04.373352Z","shell.execute_reply":"2024-07-24T17:51:04.372738Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot all models\nmesh_list = [tensor_mesh, tensor_mesh, tree_mesh]\nind_list = [active_tensor_cells, active_tensor_cells, active_tree_cells]\nmodel_list = [true_model, recovered_tensor_model, recovered_tree_model]\ntitle_list = [\"True Model\", \"L2 Tensor Model\", \"IRLS Tree Model\"]\ncplot = 3 * [None]\ncbar = 3 * [None]\nnorm = 3 * [None]\n\nfig = plt.figure(figsize=(7, 8))\nax1 = [fig.add_axes([0.1, 0.7 - 0.3 * ii, 0.75, 0.23]) for ii in range(0, 3)]\nax2 = [fig.add_axes([0.88, 0.7 - 0.3 * ii, 0.025, 0.23]) for ii in range(0, 3)]\n\nfor ii, mesh in enumerate(mesh_list):\n    plotting_map = maps.InjectActiveCells(mesh, ind_list[ii], np.nan)\n    max_abs = np.max(np.abs(model_list[ii]))\n    norm[ii] = mpl.colors.Normalize(vmin=-max_abs, vmax=max_abs)\n\n    cplot[ii] = mesh.plot_slice(\n        plotting_map * model_list[ii],\n        normal=\"Y\",\n        ax=ax1[ii],\n        ind=int(mesh.shape_cells[1] / 2),\n        grid=False,\n        pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm[ii]},\n    )\n    ax1[ii].set_xlim([-150, 150])\n    ax1[ii].set_ylim([topo_xyz[:, -1].max() - 100, topo_xyz[:, -1].max()])\n    if ii < 2:\n        ax1[ii].set_xlabel(\"\")\n        ax1[ii].set_xticks([])\n    ax1[ii].set_title(title_list[ii])\n\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n    )\n    cbar[ii].set_label(\"$g/cm^3$\", labelpad=0)","key":"Y9eCLlsUqs"},{"type":"output","id":"AIzAJGzKc1Q_4O8SFtJf9","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7097d700ed56128bc35d6c70dbfd32c3","path":"/user-tutorials/build/7097d700ed56128bc35d6c70dbfd32c3.png"},"text/plain":{"content":"<Figure size 700x800 with 6 Axes>","content_type":"text/plain"}}}],"key":"vQjra7eATa"}],"key":"QaycGv1T79"}],"key":"v1dI5LvL3v"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"3D Forward Simulation of Gravity Gradiometry Data","url":"/fwd-gravity-gradiometry-3d","group":"SimPEG User Tutorials"},"next":{"title":"Magnetics","url":"/magnetics-index","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"}