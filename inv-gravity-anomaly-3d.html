<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>3D Inversion of Gravity Anomaly Data - SimPEG User Tutorials</title><meta property="og:title" content="3D Inversion of Gravity Anomaly Data - SimPEG User Tutorials"/><meta name="generator" content="mystmd"/><meta name="description" content="SimPEG user tutorials"/><meta property="og:description" content="SimPEG user tutorials"/><meta name="keywords" content="geophysics, inversions, python, open-source"/><meta name="image" content="/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png"/><meta property="og:image" content="/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/user-tutorials/build/_assets/app-KFPMNUQ2.css"/><link rel="stylesheet" href="/user-tutorials/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="/myst-theme.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script defer="" data-domain="simpeg.xyz" src="https://plausible.io/js/plausible.js"></script><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/user-tutorials/"><div class="p-1 mr-3 dark:bg-white dark:rounded"><img src="/user-tutorials/build/simpeg-logo-8e384bdbcd0a580c9ad2f1e67fcc0bfe.png" class="h-9" alt="User Tutorials" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5">User Tutorials</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0" data-headlessui-state=""><div class="inline-block"><button class="inline-flex items-center justify-center w-full py-1 mx-2 font-medium rounded-md text-md text-stone-900 dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" id="headlessui-menu-button-:Rpiop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span>SimPEG</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="ml-2 -mr-1 text-violet-200 hover:text-violet-100"><path fill-rule="evenodd" d="M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div></div></div><div class="flex-grow block"></div><button class="theme rounded-full border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"><div class="relative" data-headlessui-state=""><div><button class="flex text-sm bg-transparent rounded-full focus:outline-none" id="headlessui-menu-button-:Rciop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open Menu</span><div class="flex items-center text-stone-200 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="p-1"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="hidden sm:block"><a href="https://mystmd.org/guide" target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 mx-1 mt-0 leading-none border rounded text-md border-stone-700 dark:border-white text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 hover:bg-neutral-100">Learn More</a></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white"><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a class="py-2 grow" href="/">SimPEG</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R5d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R5d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="SimPEG User Tutorials" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/user-tutorials/">SimPEG User Tutorials</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Gravity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/gravity-index">Gravity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rbd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rbd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Magnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/magnetics-index">Magnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rfd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rfd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Direct Current Resistivity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/dcr-index">Direct Current Resistivity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rjd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rjd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Induced Polarization" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/ip-index">Induced Polarization</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rnd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rnd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Frequency-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/fdem-index">Frequency-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rrd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rrd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/tdem-index">Time-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rvd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rvd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-none pr-2 smallcaps">SimPEG User Tutorials</div><div class="flex-grow"></div><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer" class="opacity-50 hover:opacity-100 text-inherit hover:text-inherit" aria-label="Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mx-1"><title>Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)</title><path d="M12 2.2c2.7 0 5 1 7 2.9.9.9 1.6 2 2.1 3.1.5 1.2.7 2.4.7 3.8 0 1.3-.2 2.6-.7 3.8-.5 1.2-1.2 2.2-2.1 3.1-1 .9-2 1.7-3.2 2.2-1.2.5-2.5.7-3.7.7s-2.6-.3-3.8-.8c-1.2-.5-2.2-1.2-3.2-2.1s-1.6-2-2.1-3.2-.8-2.4-.8-3.7c0-1.3.2-2.5.7-3.7S4.2 6 5.1 5.1C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C5.6 7.1 5 8 4.6 9c-.4 1-.6 2-.6 3s.2 2.1.6 3c.4 1 1 1.8 1.8 2.6S8 19 9 19.4c1 .4 2 .6 3 .6s2.1-.2 3-.6c1-.4 1.9-1 2.7-1.8 1.5-1.5 2.3-3.3 2.3-5.6 0-1.1-.2-2.1-.6-3.1-.4-1-1-1.8-1.7-2.6C16.1 4.8 14.2 4 12 4zm-.1 6.4l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.5.3-1 .4-1.5.4-.9 0-1.6-.3-2.1-.8-.5-.6-.8-1.3-.8-2.3 0-.9.3-1.7.8-2.2.6-.6 1.3-.8 2.1-.8 1.2 0 2.1.4 2.6 1.4zm5.6 0l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.4.2-.9.3-1.4.3-.9 0-1.6-.3-2.1-.8s-.8-1.3-.8-2.2c0-.9.3-1.7.8-2.2.5-.5 1.2-.8 2-.8 1.2 0 2.1.4 2.6 1.4z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1"><title>Credit must be given to the creator</title><path d="M12 2.2c2.7 0 5 .9 6.9 2.8 1.9 1.9 2.8 4.2 2.8 6.9s-.9 5-2.8 6.8c-2 1.9-4.3 2.9-7 2.9-2.6 0-4.9-1-6.9-2.9-1.8-1.7-2.8-4-2.8-6.7s1-5 2.9-6.9C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C4.8 8 4 9.9 4 12c0 2.2.8 4 2.4 5.6C8 19.2 9.8 20 12 20c2.2 0 4.1-.8 5.7-2.4 1.5-1.5 2.3-3.3 2.3-5.6 0-2.2-.8-4.1-2.3-5.7C16.1 4.8 14.2 4 12 4zm2.6 5.6v4h-1.1v4.7h-3v-4.7H9.4v-4c0-.2.1-.3.2-.4.1-.2.2-.2.4-.2h4c.2 0 .3.1.4.2.2.1.2.2.2.4zm-4-2.5c0-.9.5-1.4 1.4-1.4s1.4.5 1.4 1.4c0 .9-.5 1.4-1.4 1.4s-1.4-.5-1.4-1.4z"></path></svg></a><a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer" title="Code License: MIT License (MIT)" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="mx-1 inline-block opacity-60 hover:opacity-100 hover:text-[#599F46]"><path d="M13.2 15.6c1.4-.5 2.1-1.6 2.1-3.3S13.8 8.9 12 8.9c-1.9 0-3.3 1.6-3.3 3.3 0 1.8.8 3 2.2 3.4l-2.3 5.9c-3.1-.8-6.3-4.6-6.3-9.3 0-5.5 4.3-10 9.7-10s9.8 4.5 9.8 10c0 4.7-3.1 8.5-6.3 9.3l-2.3-5.9z"></path></svg></a><a href="https://github.com/simpeg/user-tutorials" title="GitHub Repository: simpeg/user-tutorials" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">3D Inversion of Gravity Anomaly Data</h1><header class="mt-4 not-prose"><div class="grid grid-cols-1 sm:grid-cols-2 gap-y-1"><div class="pb-2 text-xs font-thin uppercase">Authors</div><div class="pb-2 text-xs font-thin uppercase">Affiliations</div><div><span class="font-semibold text-sm"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2mkfop:" data-state="closed">Devin Cowan</button></span></div><div class="text-sm"><div>University of British Columbia<!-- --> </div></div><div><span class="font-semibold text-sm"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2qkfop:" data-state="closed">Santiago Soler</button></span></div><div class="text-sm"><div>University of British Columbia<!-- --> </div></div></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="MchV8YATTi" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-amber-600 caution"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Intermediate notebook</div></div><div class="px-4 py-1"><p>This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.</p></div></aside></div><div id="WKpb6ndgzO" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-green-600 hint"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Light-weight notebook</div></div><div class="px-4 py-1"><p>This tutorial requires minimal computational resources and can be executed quickly in the background while other computer processes are running.</p></div></aside></div><div id="BQ6sy6Mb9q" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Author:</strong> Devin C. Cowan</p><p><strong>Keywords:</strong> gravity anomaly, integral formulation, inversion, sparse norm, tensor mesh, tree mesh.</p><p><strong>Summary:</strong> Here we invert gravity anomaly data to recover a density contrast model. We demonstrate two approaches for recovering a density contrast model:</p><ol start="1"><li>Weighted least-squares inversion for a tensor mesh</li><li>Iteratively re-weighted least-squares (IRLS) inversion for a tree mesh</li></ol><p>The <em>weighted least-squares</em> approach is a great introduction to geophysical inversion with SimPEG. One drawback however, is that it recovers smooth structures which may not be representative of the true model. To recover sparse and/or blocky structures, we also demonstrate the <em>iteratively re-weighted least-squares</em> approach. Because this tutorial focusses primarily on inversion-related functionality, we urge the reader to become familiar with functionality explained in the <a href="/user-tutorials/fwd-gravity-anomaly-3d">3D Forward Simulation of Gravity Anomaly Data</a> tutorial before working through this one.</p><p><strong>Learning Objectives:</strong></p><ul><li>How geophysical inversion is carried out using SimPEG.</li><li>How to assign appropriate uncertainties to gravity anomaly data.</li><li>How to design a suitable mesh for gravity inversion when using the integral formulation.</li><li>How to choose and set parameters for the inversion.</li><li>How to define directives that are applied and updated throughout the inversion.</li><li>How to applying the sensitivity weighting generally used in 3D gravity inversion.</li><li>How to invert data using weighted least-squares and sparse-norm regularization.</li><li>How to analyse inversion results.</li></ul><p>Although we consider gravity anomaly data in this tutorial, the same approach
can be used to invert gravity gradiometry data.</p></div><div id="jexXnhHHO5" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="import-modules" class="relative group"><span class="heading-text">Import Modules</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#import-modules" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we import all of the functionality required to run the notebook for the tutorial exercise.
All of the functionality specific to the forward simulation of gravity data are imported from the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/simpeg.potential_fields.gravity.html#module-simpeg.potential_fields.gravity" rel="noreferrer">simpeg<wbr/>.potential<wbr/>_fields<wbr/>.gravity</a> module. Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/simpeg.utils.html#module-simpeg.utils" rel="noreferrer">simpeg.utils</a>. To generate the mesh used for the inversion, we use the <a target="_blank" href="https://discretize.simpeg.xyz/en/main" rel="noreferrer">discretize</a> package.</p></div><div id="MQAL557Szj" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># SimPEG functionality
from simpeg.potential_fields import gravity
from simpeg.utils import plot2Ddata, model_builder, download
from simpeg import (
    maps,
    data,
    data_misfit,
    inverse_problem,
    regularization,
    optimization,
    directives,
    inversion,
)

# discretize functionality
from discretize import TensorMesh, TreeMesh
from discretize.utils import active_from_xyz

# Common Python functionality
import os
import numpy as np
from scipy.interpolate import griddata
import matplotlib as mpl
import matplotlib.pyplot as plt
import tarfile

mpl.rcParams.update({&quot;font.size&quot;: 14})</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SMTPSsDLg_yzcpWmSg35s" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="sPaIcx8qKf" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="load-tutorial-files" class="relative group"><span class="heading-text">Load Tutorial Files</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#load-tutorial-files" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.</p></div><div id="HpuSDyDJxU" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># URL to download from repository assets
data_source = &quot;https://github.com/simpeg/user-tutorials/raw/main/assets/03-gravity/inv_gravity_anomaly_3d_files.tar.gz&quot;

# download the data
downloaded_data = download(data_source, overwrite=True)

# unzip the tarfile
tar = tarfile.open(downloaded_data, &quot;r&quot;)
tar.extractall()
tar.close()

# path to the directory containing our data
dir_path = downloaded_data.split(&quot;.&quot;)[0] + os.path.sep

# files to work with
topo_filename = dir_path + &quot;gravity_topo.txt&quot;
data_filename = dir_path + &quot;gravity_data.obs&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dm8DmLG8wY1m6z8kTHKPy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Downloading https://github.com/simpeg/user-tutorials/raw/main/assets/03-gravity/inv_gravity_anomaly_3d_files.tar.gz
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   saved to: /home/ssoler/git/user-tutorials/notebooks/03-gravity/inv_gravity_anomaly_3d_files.tar.gz
Download completed!
</span></code></pre></div></div></div><div id="lc1bmVka4B" class="relative group/block article-grid subgrid-gap col-screen"><p>For this tutorial, the data are organized within basic XYZ files. However, SimPEG does allow the user to import UBC-GIF formatted gravity data files; see <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.utils.io_utils.read_grav3d_ubc.html#simpeg.utils.io_utils.read_grav3d_ubc" rel="noreferrer">read_grav3d_ubc</a>.</p></div><div id="QamzJ8Zxp0" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Load topography (xyz file)
topo_xyz = np.loadtxt(str(topo_filename))

# Load field data (xyz file)
dobs = np.loadtxt(str(data_filename))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="N4kfVybS0ZSbQYHzMiRMj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="amQgj2NNTC" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="plot-observed-data-and-topography" class="relative group"><span class="heading-text">Plot Observed Data and Topography</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-observed-data-and-topography" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here we plot the synthetic gravity anomaly data and local topography.</p></div><div id="K2Oy6oSBpP" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define receiver locations and observed data
receiver_locations = dobs[:, 0:3]
dobs = dobs[:, -1]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="hdeVx5nz6SOUMefEnWwIg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kGrbdzwJ7a" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(9, 5))

ax1 = fig.add_axes([0.05, 0.35, 0.35, 0.6])
plot2Ddata(
    receiver_locations,
    dobs,
    ax=ax1,
    dataloc=True,
    ncontour=40,
    contourOpts={&quot;cmap&quot;: &quot;bwr&quot;},
)
ax1.set_title(&quot;Gravity Anomaly&quot;, pad=15)
ax1.set_xlabel(&quot;x (m)&quot;)
ax1.set_ylabel(&quot;y (m)&quot;)

cx1 = fig.add_axes([0.05, 0.18, 0.35, 0.04])
norm1 = mpl.colors.Normalize(vmin=-np.max(np.abs(dobs)), vmax=np.max(np.abs(dobs)))
cbar1 = mpl.colorbar.ColorbarBase(
    cx1, norm=norm1, orientation=&quot;horizontal&quot;, cmap=mpl.cm.bwr
)
cbar1.set_label(&quot;$mGal$&quot;, size=16)

ax2 = fig.add_axes([0.55, 0.35, 0.35, 0.6])
plot2Ddata(
    topo_xyz[:, 0:2],
    topo_xyz[:, -1],
    ax=ax2,
    ncontour=50,
    contourOpts={&quot;cmap&quot;: &quot;gist_earth&quot;},
)
ax2.set_title(&quot;Topography&quot;, pad=15)
ax2.set_xlabel(&quot;x (m)&quot;)
ax2.set_ylabel(&quot;y (m)&quot;)

cx2 = fig.add_axes([0.55, 0.18, 0.35, 0.04])
norm2 = mpl.colors.Normalize(vmin=np.min(topo_xyz[:, -1]), vmax=np.max(topo_xyz[:, -1]))
cbar2 = mpl.colorbar.ColorbarBase(
    cx2, norm=norm2, orientation=&quot;horizontal&quot;, cmap=mpl.cm.gist_earth
)
cbar2.set_label(&quot;$m$&quot;, size=16)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3RQYS6wNzBf67NSUiRKQX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/0bf249abac5c458cc6d71d9bdee73faf.png" alt="&lt;Figure size 900x500 with 4 Axes&gt;"/></div></div><div id="K0Xr3FlYYk" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="assign-uncertainties" class="relative group"><span class="heading-text">Assign Uncertainties</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#assign-uncertainties" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Inversion with SimPEG requires that we define the uncertainties on our data; that is, an estimate of the standard deviation of the noise on our data assuming it is uncorrelated Gaussian with zero mean. An online resource explaining uncertainties and their role in the inversion can be found <a target="_blank" href="https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html" rel="noreferrer">here</a>.</p><p><strong>For gravity anomaly data,</strong> a constant floor value is generally applied to all data. We usually avoid assigning percent uncertainties because the inversion would prioritize fitting the background over fitting anomalies. The floor value for the uncertainties may be chosen based on some knowledge of the instrument error, or it may be chosen as some fraction of the largest anomaly value. For this tutorial, the floor uncertainty assigned to all data is 2.5% of the maximum observed gravity anomaly value. <strong>For gravity gradiometry data,</strong> you may choose to assign a different floor value to each data component.</p></div><div id="xDT2oni1Eh" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">maximum_anomaly = np.max(np.abs(dobs))
floor_uncertainty = 0.02 * maximum_anomaly
uncertainties = floor_uncertainty * np.ones(np.shape(dobs))
print(&quot;Floor uncertainty: {}&quot;.format(floor_uncertainty))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8aXHsFp-tMKbH6_7nUcsB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Floor uncertainty: 0.00037204
</span></code></pre></div></div></div><div id="swdz9Du1zt" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-survey" class="relative group"><span class="heading-text">Define the Survey</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-survey" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we define the survey geometry. The survey consists of a 160 m x 160 m grid of equally spaced receivers located 5 m
above the surface topography. For a more comprehensive description of constructing gravity surveys in SimPEG, see the <a href="/user-tutorials/fwd-gravity-anomaly-3d">3D Forward Simulation of Gravity Anomaly Data</a> tutorial.</p></div><div id="KP4Nj5boo0" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define the receivers. The data consist of vertical gravity anomaly measurements.
# The set of receivers must be defined as a list.
receiver_list = gravity.receivers.Point(receiver_locations, components=&quot;gz&quot;)
receiver_list = [receiver_list]

# Define the source field
source_field = gravity.sources.SourceField(receiver_list=receiver_list)

# Define the survey
survey = gravity.survey.Survey(source_field)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rY2uS7mcycDeJ5cVcGliI" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="p4QLN6SoFY" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-data" class="relative group"><span class="heading-text">Define the Data</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The SimPEG <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data.Data.html#simpeg.data.data" rel="noreferrer">Data</a> class is required for inversion and connects the observed data, uncertainties and survey geometry.</p></div><div id="eZ1YVG3fm1" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">data_object = data.Data(survey, dobs=dobs, standard_deviation=uncertainties)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="KAPMBgA7MvLg5upIR78Hn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kHljx5cyVn" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="weighted-least-squares-inversion-on-a-tensor-mesh" class="relative group"><span class="heading-text">Weighted Least-Squares Inversion on a Tensor Mesh</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#weighted-least-squares-inversion-on-a-tensor-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we provide a step-by-step best-practices approach for weighted least-squares inversion of gravity anomaly data.</p></div><div id="iATJEkEY0U" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="design-a-tensor-mesh" class="relative group"><span class="heading-text">Design a (Tensor) Mesh</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#design-a-tensor-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Meshes are designed using the <a target="_blank" href="https://discretize.simpeg.xyz" rel="noreferrer">discretize package</a>. Here, we design a <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh" rel="noreferrer">tensor mesh</a>. See the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html" rel="noreferrer">discretize user tutorials</a> to learn more about creating meshes. When designing a mesh for gravity inversion, we must consider the spatial wavelengths of the signals contained within the data. If the data spacing is large and/or the signals present in the data are smooth, larger cells can be used to construct the mesh. If the data spacing is smaller and compact anomalies are observed, smaller cells are needed to characterize the structures responsible. And smaller cells are required when the effects of surface topography are significant.</p><p><strong>General rule of thumb:</strong> The minimum cell size in each direction is at most 0.5 - 1 times the station spacing. And the thickness of the padding is at least 1 - 2 times the width of the survey region.</p></div><div id="lk63KIruQz" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Generate tensor mesh with top at z = 0 m
dh = 5.0  # minimum cell size
hx = [(dh, 5, -1.3), (dh, 40), (dh, 5, 1.3)]  # discretization along x
hy = [(dh, 5, -1.3), (dh, 40), (dh, 5, 1.3)]  # discretization along y
hz = [(dh, 5, -1.3), (dh, 15)]  # discretization along z
tensor_mesh = TensorMesh([hx, hy, hz], &quot;CCN&quot;)

# Shift vertically to top same as maximum topography
tensor_mesh.origin += np.r_[0.0, 0.0, topo_xyz[:, -1].max()]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="XDWuTst_UK9FgaD3NPRxf" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eQeqorzFBH" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-active-cells" class="relative group"><span class="heading-text">Define the Active Cells</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Whereas cells below the Earth’s surface contribute towards the simulated gravity anomaly, air cells do not.
The set of mesh cells used in the forward simulation are referred to as ‘active cells’. Unused cells (air cells) are ‘inactive cells’. Here, the discretize <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz" rel="noreferrer">active_from_xyz</a> utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a <code>bool</code> array.</p></div><div id="RgMzn4v0NA" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">active_tensor_cells = active_from_xyz(tensor_mesh, topo_xyz)
n_tensor_active = int(active_tensor_cells.sum())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="YnpX_VjS2l0XCegiQeiMG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CezqK4WMO7" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="mapping-from-the-model-to-active-cells" class="relative group"><span class="heading-text">Mapping from the Model to Active Cells</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-from-the-model-to-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For whatever model we choose, we must define a mapping from the set of model parameters (a <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">1D numpy.ndarray</a>) to the active cells in the mesh. Mappings are created using the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.IdentityMap.html#simpeg.maps.identitymap" rel="noreferrer">simpeg.maps</a> module. For the tutorial exercise, the model is the density contrast values for all active cells. As such, our mapping is an identity mapping, whose dimensions are equal to the number of active cells.</p></div><div id="tk55arARPM" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">tensor_model_map = maps.IdentityMap(nP=n_tensor_active)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9iC42w7Qma-9aGj4ULlij" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zn33thF31m" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="starting-reference-models" class="relative group"><span class="heading-text">Starting/Reference Models</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#starting-reference-models" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The <strong>starting model</strong> defines a reasonable starting point for the inversion and does not necessarily represent an initial estimate of the true model. Because the integral formulation used to solve the gravity forward simulation is linear, the optimization problem we must solve is a linear least-squares problem, making the choice in starting model insignificant. It should be noted that the starting model <strong>cannot be vector of zeros,</strong> otherwise the inversion will be unable to compute a gradient direction at the first iteration. For gravity inversion, the starting model is frequently a constant vector with a very small value.</p><p>The <strong>reference model</strong> is used to include a-prior information. The impact of the reference model on the inversion will be discussed in another tutorial. Assuming the contribution from all background structures has been removed from the gravity anomaly data, and assuming we have not a-priori information, the reference model for basic inversion of gravity data is zero.</p><p>Notice that the length of the starting and reference models is equal to the number of active mesh cells!!!</p></div><div id="MaYGkGOjjG" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">starting_tensor_model = 1e-6 * np.ones(n_tensor_active)
reference_tensor_model = np.zeros_like(starting_tensor_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dSXY80PBMET_xMlTJ0r4o" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GfVW9aNava" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Map for ignoring inactive cells when plotting
tensor_plotting_map = maps.InjectActiveCells(tensor_mesh, active_tensor_cells, np.nan)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="tjPYEkFDEeDU_ztujhY6t" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="XizQWwjntg" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(7, 3))
ax1 = fig.add_axes([0.1, 0.1, 0.73, 0.8])

norm = mpl.colors.Normalize(vmin=-0.1, vmax=0.1)
tensor_mesh.plot_slice(
    tensor_plotting_map * starting_tensor_model,
    normal=&quot;Y&quot;,
    ax=ax1,
    ind=int(tensor_mesh.shape_cells[1] / 2),
    grid=True,
    pcolor_opts={&quot;cmap&quot;: mpl.cm.RdYlBu_r, &quot;norm&quot;: norm},
)
ax1.set_title(&quot;Starting Model (slice at y = 0 m)&quot;)

ax2 = fig.add_axes([0.85, 0.1, 0.03, 0.8])
cbar = mpl.colorbar.ColorbarBase(
    ax2, norm=norm, orientation=&quot;vertical&quot;, cmap=mpl.cm.RdYlBu_r
)
cbar.set_label(&quot;$g/cm^3$&quot;, rotation=270, labelpad=15, size=16)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="KzAmZSGPI1Qcla9a-yeqw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/46ff3e21c1af38ff0f166ec4e97215dd.png" alt="&lt;Figure size 700x300 with 2 Axes&gt;"/></div></div><div id="dbtGiHimEG" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-forward-simulation" class="relative group"><span class="heading-text">Define the Forward Simulation</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-forward-simulation" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for gravity anomaly data was discussed in the <a href="/user-tutorials/fwd-gravity-anomaly-3d">3D Forward Simulation of Gravity Anomaly Data</a> tutorial. Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.potential_fields.gravity.Simulation3DIntegral.html#simpeg.potential_fields.gravity.Simulation3DIntegral" rel="noreferrer">3D integral formulation</a>.</p></div><div id="goKE5OHzwu" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">simulation_L2 = gravity.simulation.Simulation3DIntegral(
    survey=survey,
    mesh=tensor_mesh,
    rhoMap=tensor_model_map,
    ind_active=active_tensor_cells,
    engine=&quot;geoana&quot;,
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="pNXfYnRbLxXcygoCyTXVl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="W8whCFgVfz" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-green-600"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="px-4 py-1"><p>By choosing <code>engine=&quot;choclo&quot;</code> we can make our simulation to run the faster and more memory efficient implementation of the gravity forward that uses <a target="_blank" href="https://numba.pydata.org/" rel="noreferrer">Numba</a> and <a target="_blank" href="https://www.fatiando.org/choclo" rel="noreferrer">Choclo</a> under the hood. To do so, we need to have <a target="_blank" href="https://www.fatiando.org/choclo/latest/install.html" rel="noreferrer">Choclo installed</a>.</p></div></aside></div><div id="txIHYqXD2Z" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-data-misfit" class="relative group"><span class="heading-text">Define the Data Misfit</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-data-misfit" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To understand the role of the data misfit in the inversion, please visit <a target="_blank" href="https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html" rel="noreferrer">this online resource</a>.
Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit" rel="noreferrer">L2DataMisfit</a> class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate <em>data object</em> and <em>simulation object</em> as properties.</p></div><div id="kTyq9XKV7T" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">dmis_L2 = data_misfit.L2DataMisfit(data=data_object, simulation=simulation_L2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="YCrs7V8UkIcV6XkMGKjyP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="w3WQX9oUy7" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-regularization" class="relative group"><span class="heading-text">Define the Regularization</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-regularization" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To understand the role of the regularization in the inversion, please visit <a target="_blank" href="https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html" rel="noreferrer">this online resource</a>. Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares" rel="noreferrer">WeightedLeastSquares</a> regularization class to constrain the inversion result. Here, length scales along x, y and z are used to balance the smallness and smoothness terms. And the reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros.</p></div><div id="H2jyyy97Hl" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">reg_L2 = regularization.WeightedLeastSquares(
    tensor_mesh,
    active_cells=active_tensor_cells,
    length_scale_x=1.0,
    length_scale_y=1.0,
    length_scale_z=1.0,
    reference_model=reference_tensor_model,
    reference_model_in_smooth=False,
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="sEIIcV-HY_T9A7jW3d0MO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="TnMYDwRNWb" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-optimization-algorithm" class="relative group"><span class="heading-text">Define the Optimization Algorithm</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-optimization-algorithm" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.InexactGaussNewton.html#simpeg.optimization.inexactgaussnewton" rel="noreferrer">InexactGaussNewton</a> class to solve the optimization problem using inexact Gauss-Newton. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches.</p></div><div id="n2QUmkTIF9" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">opt_L2 = optimization.InexactGaussNewton(
    maxIter=100, maxIterLS=20, maxIterCG=10, tolCG=1e-2
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0x5AcDxaR4VWrx7YvFnlW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OkszjiSsIW" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-inverse-problem" class="relative group"><span class="heading-text">Define the Inverse Problem</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-inverse-problem" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem" rel="noreferrer">BaseInvProblem</a> class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate <em>data misfit</em>, <em>regularization</em> and <em>optimization</em> objects.</p></div><div id="IVMXWZBaIh" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Fwnb-gcjx0OLBg-DwCHYN" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="wPPhgS4oZS" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="provide-inversion-directives" class="relative group"><span class="heading-text">Provide Inversion Directives</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#provide-inversion-directives" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Directives represent operations that are carried out during the inversion. Here, we apply common directives for weighted least-squares inversion of gravity data and describe their roles. These are:</p><ul><li><p><a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights" rel="noreferrer">UpdateSensitivityWeights</a>: Apply sensitivity weighting to counteract the natural tendancy of potential field inversion to cluster recovered structures near the receivers. Because the 3D integral formulation is linear, the sensitivity weighting is independent of the model and does not need to be updated throughout the inversion, so we set <code>every_iteration=False</code>.</p></li><li><p><a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner" rel="noreferrer">UpdatePreconditioner</a>: Apply Jacobi preconditioner when solving optimization problem.</p></li><li><p><a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig" rel="noreferrer">BetaEstimate_ByEig</a>: Compute and set starting trade-off parameter (beta) based on largest eigenvalues.</p></li><li><p><a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule" rel="noreferrer">BetaSchedule</a>: Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta.</p></li><li><p><a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit" rel="noreferrer">TargetMisfit</a>: Terminates the inversion when the data misfit equals the target misfit. A <code>chifact=1</code> terminates the inversion when the data misfit equals the number of data.</p></li></ul><p>The directive objects are organized in a <code>list</code>. Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list <strong>in order</strong>. The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the <code>BetaEstimate_ByEig</code> are only used when starting the inversion. Other directives, like <code>UpdatePreconditionner</code>, are used whenever the model is updated.</p></div><div id="xvggyWhMG8" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">sensitivity_weights = directives.UpdateSensitivityWeights(every_iteration=False)
update_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)
starting_beta = directives.BetaEstimate_ByEig(beta0_ratio=10)
beta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=1)
target_misfit = directives.TargetMisfit(chifact=1.0)

directives_list_L2 = [
    sensitivity_weights,
    update_jacobi,
    starting_beta,
    beta_schedule,
    target_misfit,
]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="bvHSH3JnCzDoDkVbPJPrT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OcecxbsXm0" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-and-run-the-inversion" class="relative group"><span class="heading-text">Define and Run the Inversion</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-and-run-the-inversion" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We define the inversion using the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inversion.BaseInversion.html#simpeg.inversion.baseinversion" rel="noreferrer">BaseInversion</a> class. The inversion class must be instantiated with an appropriate <em>inverse problem</em> object and <em>directives list</em>. The <code>run</code> method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters</p></div><div id="ScZuutz27x" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Here we combine the inverse problem and the set of directives
inv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)

# Run inversion
recovered_tensor_model = inv_L2.run(starting_tensor_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WCcGnF82Vp5wd2n3O7kFa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>
Running inversion with SimPEG v0.22.1

                    simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.
                    ***Done using the default solver Pardiso and no solver_opts.***
                    
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>model has any nan: 0
============================ Inexact Gauss Newton ============================
  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   
-----------------------------------------------------------------------------
x0 has any nan: 0
   0  8.32e+03  5.58e+04  6.08e-07  5.58e+04    2.09e+05      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/home/ssoler/mambaforge/envs/simpeg-user-tutorials/lib/python3.10/site-packages/simpeg/optimization.py:1072: UserWarning: tol is not a valid keyword for cg and will be ignored
  Hinv = SolverICG(
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   1  4.16e+03  2.22e+04  1.25e+00  2.74e+04    4.98e+04      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   2  2.08e+03  1.48e+04  2.52e+00  2.00e+04    3.74e+04      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   3  1.04e+03  8.73e+03  4.59e+00  1.35e+04    2.65e+04      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   4  5.20e+02  4.53e+03  7.43e+00  8.39e+03    1.75e+04      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   5  2.60e+02  2.12e+03  1.07e+01  4.89e+03    1.08e+04      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   6  1.30e+02  9.60e+02  1.37e+01  2.74e+03    6.32e+03      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   7  6.50e+01  4.63e+02  1.64e+01  1.52e+03    3.55e+03      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>------------------------- STOP! -------------------------
1 : |fc-fOld| = 0.0000e+00 &lt;= tolF*(1+|f0|) = 5.5789e+03
1 : |xc-x_last| = 5.3003e-02 &lt;= tolX*(1+|x0|) = 1.0002e-01
0 : |proj(x-g)-x|    = 3.5454e+03 &lt;= tolG          = 1.0000e-01
0 : |proj(x-g)-x|    = 3.5454e+03 &lt;= 1e3*eps       = 1.0000e-02
0 : maxIter   =     100    &lt;= iter          =      8
------------------------- DONE! -------------------------
</span></code></pre></div></div></div><div id="hcxBGpINqd" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-the-data-misfit" class="relative group"><span class="heading-text">Plot the Data Misfit</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-the-data-misfit" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>This step is necessary for determining whether the recovered model accurately reproduces observed anomalies. Here, we plot the observed data, predicted data for the recovered model, and the misfit. As we can see, the predicted data fits the background somewhat better than the anomalies. As a result, you may reassign smaller uncertainties in these areas and re-run the inversion in order to better fit the anomalies. We will do this for the iteratively reweighted least-squares inversion.</p></div><div id="iZJBL81P8y" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Predicted data with final recovered model.
dpred = inv_prob_L2.dpred

# Observed data | Predicted data | Data misfit
data_array = np.c_[dobs, dpred, dobs - dpred]

fig = plt.figure(figsize=(12, 5))
plot_title = [&quot;Observed&quot;, &quot;Predicted&quot;, &quot;Data Misfit&quot;]
plot_units = [&quot;mGal&quot;, &quot;mGal&quot;, &quot;mGal&quot;]

ax1 = 3 * [None]
ax2 = 3 * [None]
norm = 3 * [None]
cbar = 3 * [None]
cplot = 3 * [None]
v_lim = [np.max(np.abs(dobs)), np.max(np.abs(dobs)), np.max(np.abs(dobs - dpred))]

for ii in range(0, 3):
    ax1[ii] = fig.add_axes([0.3 * ii + 0.1, 0.2, 0.27, 0.75])
    norm[ii] = mpl.colors.Normalize(vmin=-v_lim[ii], vmax=v_lim[ii])
    cplot[ii] = plot2Ddata(
        receiver_list[0].locations,
        data_array[:, ii],
        ax=ax1[ii],
        ncontour=30,
        contourOpts={&quot;cmap&quot;: &quot;bwr&quot;, &quot;norm&quot;: norm[ii]},
    )
    ax1[ii].set_title(plot_title[ii])
    ax1[ii].set_xlabel(&quot;x (m)&quot;)
    if ii == 0:
        ax1[ii].set_ylabel(&quot;y (m)&quot;)
    else:
        ax1[ii].set_yticks([])

    ax2[ii] = fig.add_axes([0.3 * ii + 0.1, 0.05, 0.27, 0.05])
    cbar[ii] = mpl.colorbar.ColorbarBase(
        ax2[ii], norm=norm[ii], orientation=&quot;horizontal&quot;, cmap=mpl.cm.bwr
    )
    cbar[ii].ax.locator_params(nbins=3)
    cbar[ii].set_label(plot_units[ii], labelpad=5)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Jkn1st-ruRBzb9VrAsJad" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/dbc0d62577be40427df1291063fdb8c0.png" alt="&lt;Figure size 1200x500 with 6 Axes&gt;"/></div></div><div id="ZFo7u7Xe2Z" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-the-recovered-model" class="relative group"><span class="heading-text">Plot the Recovered Model</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-the-recovered-model" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>As we can see, weighted least-squares regularization leads to the recovery of smooth models. And even with sensitivity weighting, there is a tendancy for gravity anomaly inversion to place recovered structures near the Earth’s surface.</p></div><div id="hr584b1u5R" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Plot Recovered Model
fig = plt.figure(figsize=(7, 3))
ax1 = fig.add_axes([0.1, 0.1, 0.73, 0.8])

norm = mpl.colors.Normalize(
    vmin=np.min(recovered_tensor_model), vmax=np.max(recovered_tensor_model)
)
tensor_mesh.plot_slice(
    tensor_plotting_map * recovered_tensor_model,
    normal=&quot;Y&quot;,
    ax=ax1,
    ind=int(tensor_mesh.shape_cells[1] / 2),
    grid=False,
    pcolor_opts={&quot;cmap&quot;: mpl.cm.RdYlBu_r, &quot;norm&quot;: norm},
)
ax1.set_title(&quot;Model slice at y = 0 m&quot;)

ax2 = fig.add_axes([0.85, 0.1, 0.03, 0.8])
cbar = mpl.colorbar.ColorbarBase(
    ax2, norm=norm, orientation=&quot;vertical&quot;, cmap=mpl.cm.RdYlBu_r
)
cbar.set_label(&quot;$g/cm^3$&quot;, rotation=270, labelpad=15, size=16)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-aJEctKnaguOoj5d5t59q" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/975a831f19b18935fe5dde45efcbf15e.png" alt="&lt;Figure size 700x300 with 2 Axes&gt;"/></div></div><div id="WR05j3glZ2" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="iteratively-re-weighted-least-squares-irls-inversion-on-a-tree-mesh" class="relative group"><span class="heading-text">Iteratively Re-weighted Least-Squares (IRLS) Inversion on a Tree Mesh</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#iteratively-re-weighted-least-squares-irls-inversion-on-a-tree-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we provide a step-by-step best-practices approach for iteratively IRLS inversion of gravity anomaly data on a tree mesh. Many of the steps are the same as our previous approach. As a result, we will avoid repeating information whenever possible. For the tutorial example, any datum whose normalized data misfit is outside of (-2, 2) will have its uncertainty decreased by a factor of 2.5. This choice was problem dependent!</p></div><div id="T23edj70QS" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="reassign-the-uncertainties" class="relative group"><span class="heading-text">Reassign the Uncertainties</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#reassign-the-uncertainties" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Prior to performing the IRLS inversion, we decrease the uncertainties at the locations we observed the largest data misfits. Here, our goal is to recover a model that better fits the anomalies.</p></div><div id="JjD9zrZvDh" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Compute normalized data misfits
normalized_data_misfits = (dobs - dpred) / uncertainties</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="DRE-_eEowng3kyCxExGjJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MGO1YaDz13" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Plot the normalized data misfits
fig = plt.figure(figsize=(6, 3))
ax = fig.add_subplot(111)
ax.plot(np.sort(normalized_data_misfits))
ax.set_title(&quot;Normalized Data Misfits (sorted)&quot;)
ax.grid()
plt.show(fig)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="lxpqLcwOFBUxdeNms_6ps" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/4196f1a825382912512c2252dd138e40.png" alt="&lt;Figure size 600x300 with 1 Axes&gt;"/></div></div><div id="m6SAKwrOmq" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Generate new uncertainties
new_uncertainties = uncertainties.copy()
new_uncertainties[np.abs(normalized_data_misfits) &gt; 2.0] /= 2.5</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VGPscd5XCbSQaJPsNApb8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="b63zvEyjUc" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Generate new data object
new_data_object = data.Data(survey, dobs=dobs, standard_deviation=new_uncertainties)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="6TjCojdzEQVO4Mi_o_Jhk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SYO0ZnmEQA" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="design-a-tree-mesh" class="relative group"><span class="heading-text">Design a (Tree) Mesh</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#design-a-tree-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here, we design a <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh" rel="noreferrer">tree mesh</a>. See the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html" rel="noreferrer">discretize user tutorials</a> to learn more about creating tree meshes. The same approach used to construct the tensor mesh used in the weighted least-squares inversion example applies to tree meshes.</p></div><div id="LscXDc2Sl6" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">dx = 5  # minimum cell width (base tree_mesh cell width) in x
dy = 5  # minimum cell width (base tree_mesh cell width) in y
dz = 5  # minimum cell width (base tree_mesh cell width) in z

x_length = 240.0  # domain width in x
y_length = 240.0  # domain width in y
z_length = 120.0  # domain width in z

# Compute number of base tree_mesh cells required in x and y
nbcx = 2 ** int(np.round(np.log(x_length / dx) / np.log(2.0)))
nbcy = 2 ** int(np.round(np.log(y_length / dy) / np.log(2.0)))
nbcz = 2 ** int(np.round(np.log(z_length / dz) / np.log(2.0)))

# Define the base tree_mesh
hx = [(dx, nbcx)]
hy = [(dy, nbcy)]
hz = [(dz, nbcz)]
tree_mesh = TreeMesh([hx, hy, hz], x0=&quot;CCN&quot;)

# Shift vertically to top same as maximum topography
tree_mesh.origin += np.r_[0.0, 0.0, topo_xyz[:, -1].max()]

# Refine based on surface topography
tree_mesh.refine_surface(topo_xyz, padding_cells_by_level=[2, 2], finalize=False)

# Refine box based on region of interest
wsb_corner = np.c_[-100, -100, 20]
ent_corner = np.c_[100, 100, 100]
# Note -1 is a flag for smallest cell size
tree_mesh.refine_box(wsb_corner, ent_corner, levels=[-1], finalize=False)

tree_mesh.finalize()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="sM-rAQCh3yq7wvNhn_Hj-" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="mjYkVQttqP" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-active-cells-1" class="relative group"><span class="heading-text">Define the Active Cells</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-active-cells-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="LPNRITWbHO" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">active_tree_cells = active_from_xyz(tree_mesh, topo_xyz)
n_tree_active = int(active_tree_cells.sum())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Sj6_rKu3im0RqHQkA1ZWJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="WBGZ46LSK9" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="mapping-from-model-to-active-cells" class="relative group"><span class="heading-text">Mapping from Model to Active Cells</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-from-model-to-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="WlWaj9rkvg" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">tree_model_map = maps.IdentityMap(nP=n_tree_active)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="57yPlx2HHXlPYGDGUpBce" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="rVM9KR84Zy" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="starting-and-reference-models" class="relative group"><span class="heading-text">Starting and Reference Models</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#starting-and-reference-models" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="yjLJC7nqTU" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">starting_tree_model = 1e-6 * np.ones(n_tree_active)
reference_tree_model = np.zeros_like(starting_tree_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SDP8VIaQbdnf2jWT99tRA" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BwPtt59erM" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-forward-simulation-1" class="relative group"><span class="heading-text">Define the Forward Simulation</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-forward-simulation-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="MoOY5kEjVb" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">simulation_irls = gravity.simulation.Simulation3DIntegral(
    survey=survey, mesh=tree_mesh, rhoMap=tree_model_map, ind_active=active_tree_cells
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="iLSPYbWa7lvbvSe86-CCY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fkSgYfTULU" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-data-misfit" class="relative group"><span class="heading-text">Define Data Misfit</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-data-misfit" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="YvwMK6vsix" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">dmis_irls = data_misfit.L2DataMisfit(data=new_data_object, simulation=simulation_irls)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="tvTs5FUE0fZyxZNC4orBV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="gSzgbnaVsD" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-regularization-1" class="relative group"><span class="heading-text">Define the Regularization</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-regularization-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.Sparse.html#simpeg.regularization.sparse" rel="noreferrer">Sparse</a> regularization class to constrain the inversion result using an IRLS approach. Here, the scaling constants that balance the smallness and smoothness terms are set directly. Equal emphasis on smallness and smoothness is generally applied by using the inverse square of the smallest cell dimension. The reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros. Here, we apply a 0-norm to the smallness term and a 1-norm to first-order smoothness along the x, y and z directions.</p></div><div id="gYfYwV9PbN" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">reg_irls = regularization.Sparse(
    tree_mesh,
    active_cells=active_tree_cells,
    alpha_s=dh**-2,
    alpha_x=1,
    alpha_y=1,
    alpha_z=1,
    reference_model=reference_tree_model,
    reference_model_in_smooth=False,
    norms=[0, 1, 1, 1],
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="m3Onc0cvcthbJv9wyWvLG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="COFSJ3rCKu" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-optimization-algorithm-1" class="relative group"><span class="heading-text">Define the Optimization Algorithm</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-optimization-algorithm-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here, we use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.ProjectedGNCG.html#simpeg.optimization.projectedgncg" rel="noreferrer">ProjectedGNCG</a> class to solve the optimization problem using projected Gauss-Newton conjugate gradient. This opimization class allows the user to set upper and lower bounds for the recovered model using the <code>upper</code> and <code>lower</code> properties.</p></div><div id="Tj6Wa3Pta2" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">opt_irls = optimization.ProjectedGNCG(
    maxIter=100, lower=-1.0, upper=1.0, maxIterLS=20, maxIterCG=10, tolCG=1e-2
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qDCZQC9baG0Z5936zfx-R" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="r3wk6QOhj3" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-the-inverse-problem-1" class="relative group"><span class="heading-text">Define the Inverse Problem</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-inverse-problem-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="fqj9ciWDJa" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">inv_prob_irls = inverse_problem.BaseInvProblem(dmis_irls, reg_irls, opt_irls)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="OFffeOG3LDLA60Hp9Bczr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="RkIniLWmyU" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="provide-inversion-directives-1" class="relative group"><span class="heading-text">Provide Inversion Directives</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#provide-inversion-directives-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here, we create common directives for IRLS inversion of gravity data and describe their roles. In additon to the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights" rel="noreferrer">UpdateSensitivityWeights</a>, <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner" rel="noreferrer">UpdatePreconditioner</a> and <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig" rel="noreferrer">BetaEstimate_ByEig</a>  (described before), inversion with sparse-norms requires the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls" rel="noreferrer">Update_IRLS</a> directive.</p><p>You will notice that we don’t use the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule" rel="noreferrer">BetaSchedule</a> and <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit" rel="noreferrer">TargetMisfit</a> directives. Here, the beta cooling schedule is set in the <a target="_blank" href="https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls" rel="noreferrer">Update_IRLS</a> directive using the <code>coolingFactor</code> and <code>coolingRate</code> properties. The target misfit for the L2 portion of the IRLS approach is set with the <code>chifact_start</code> property.</p></div><div id="T4wP3KGwHz" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">sensitivity_weights_irls = directives.UpdateSensitivityWeights(every_iteration=False)
starting_beta_irls = directives.BetaEstimate_ByEig(beta0_ratio=10)
update_jacobi_irls = directives.UpdatePreconditioner(update_every_iteration=True)
update_irls = directives.Update_IRLS(
    coolingFactor=2,
    coolingRate=1,
    chifact_start=1.0,
    f_min_change=1e-4,
    max_irls_iterations=25,
)

directives_list_irls = [
    update_irls,
    sensitivity_weights_irls,
    starting_beta_irls,
    update_jacobi_irls,
]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="tE-kg2-K_lIitQxnT-742" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Ou7F74IbDc" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="define-and-run-the-inversion-1" class="relative group"><span class="heading-text">Define and Run the Inversion</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-and-run-the-inversion-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="b8Wd2QXuRu" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">inv_irls = inversion.BaseInversion(inv_prob_irls, directives_list_irls)
recovered_tree_model = inv_irls.run(starting_tree_model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="lZac0JZu_JM_Dpmq9G8iO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>
Running inversion with SimPEG v0.22.1

                    simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.
                    ***Done using the default solver Pardiso and no solver_opts.***
                    
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>model has any nan: 0
=============================== Projected GNCG ===============================
  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   
-----------------------------------------------------------------------------
x0 has any nan: 0
   0  5.66e+06  1.17e+05  1.34e-08  1.17e+05    1.99e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   1  2.83e+06  9.76e+04  1.53e-03  1.02e+05    1.98e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   2  1.42e+06  8.57e+04  4.61e-03  9.23e+04    1.97e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   3  7.08e+05  7.04e+04  1.25e-02  7.93e+04    1.97e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   4  3.54e+05  5.31e+04  3.02e-02  6.38e+04    1.96e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   5  1.77e+05  3.60e+04  6.49e-02  4.75e+04    1.94e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   6  8.84e+04  2.14e+04  1.24e-01  3.23e+04    1.93e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   7  4.42e+04  1.10e+04  2.07e-01  2.01e+04    1.92e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   8  2.21e+04  4.93e+03  3.01e-01  1.16e+04    1.88e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>   9  1.11e+04  2.08e+03  3.90e-01  6.39e+03    1.80e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  10  5.53e+03  9.03e+02  4.63e-01  3.46e+03    1.68e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  11  2.76e+03  4.42e+02  5.20e-01  1.88e+03    1.55e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Reached starting chifact with l2-norm regularization: Start IRLS steps...
irls_threshold 0.03781349714154632
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  12  1.38e+03  2.52e+02  9.07e-01  1.51e+03    1.21e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  13  2.47e+03  1.83e+02  1.15e+00  3.02e+03    1.74e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  14  2.03e+03  3.25e+02  1.09e+00  2.53e+03    1.36e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  15  2.03e+03  2.73e+02  1.19e+00  2.68e+03    1.57e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  16  2.03e+03  3.04e+02  1.19e+00  2.73e+03    1.51e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  17  2.03e+03  3.17e+02  1.19e+00  2.74e+03    1.51e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  18  1.64e+03  3.34e+02  1.17e+00  2.25e+03    1.05e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  19  1.64e+03  3.08e+02  1.15e+00  2.19e+03    1.48e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  20  1.35e+03  3.21e+02  1.11e+00  1.82e+03    1.00e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  21  1.35e+03  3.02e+02  1.06e+00  1.73e+03    1.46e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  22  1.35e+03  3.10e+02  9.99e-01  1.66e+03    1.48e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  23  1.12e+03  3.18e+02  9.62e-01  1.40e+03    1.11e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  24  1.12e+03  3.04e+02  9.28e-01  1.34e+03    1.44e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  25  1.12e+03  3.09e+02  8.80e-01  1.29e+03    1.46e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  26  1.12e+03  3.13e+02  8.31e-01  1.24e+03    1.44e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  27  1.12e+03  3.17e+02  7.81e-01  1.19e+03    1.45e+02      0              
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  28  9.25e+02  3.20e+02  7.55e-01  1.02e+03    8.04e+01      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  29  9.25e+02  3.10e+02  7.11e-01  9.68e+02    1.38e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  30  9.25e+02  3.10e+02  6.62e-01  9.22e+02    1.40e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  31  9.25e+02  3.11e+02  6.32e-01  8.96e+02    1.39e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  32  9.25e+02  3.13e+02  5.75e-01  8.45e+02    1.36e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  33  9.25e+02  3.13e+02  5.29e-01  8.03e+02    1.33e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  34  9.25e+02  3.13e+02  5.10e-01  7.85e+02    1.31e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  35  9.25e+02  3.14e+02  4.77e-01  7.55e+02    1.26e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>  36  9.25e+02  3.13e+02  4.43e-01  7.23e+02    1.22e+02      0   Skip BFGS  
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Reach maximum number of IRLS cycles: 25
------------------------- STOP! -------------------------
1 : |fc-fOld| = 0.0000e+00 &lt;= tolF*(1+|f0|) = 1.1702e+04
1 : |xc-x_last| = 4.6569e-02 &lt;= tolX*(1+|x0|) = 1.0002e-01
0 : |proj(x-g)-x|    = 1.2210e+02 &lt;= tolG          = 1.0000e-01
0 : |proj(x-g)-x|    = 1.2210e+02 &lt;= 1e3*eps       = 1.0000e-02
0 : maxIter   =     100    &lt;= iter          =     37
------------------------- DONE! -------------------------
</span></code></pre></div></div></div><div id="DAuuShtDs1" class="relative group/block article-grid subgrid-gap col-screen"><h3 id="plot-the-data-misfit-1" class="relative group"><span class="heading-text">Plot the Data Misfit</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-the-data-misfit-1" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here we plot the observed data, predicted and misfit for the IRLS inversion. As we can see from the misfit map, the observed data is now fit equally at all locations.</p></div><div id="JoqfBAh4oa" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Predicted data with final recovered model.
dpred_new = inv_prob_irls.dpred

# Observed data | Predicted data | Data misfit
data_array = np.c_[dobs, dpred_new, dobs - dpred_new]

fig = plt.figure(figsize=(12, 5))
plot_title = [&quot;Observed&quot;, &quot;Predicted&quot;, &quot;Data Misfit&quot;]
plot_units = [&quot;mGal&quot;, &quot;mGal&quot;, &quot;mGal&quot;]

ax1 = 3 * [None]
ax2 = 3 * [None]
norm = 3 * [None]
cbar = 3 * [None]
cplot = 3 * [None]
v_lim = [np.max(np.abs(dobs)), np.max(np.abs(dobs)), np.max(np.abs(dobs - dpred_new))]

for ii in range(0, 3):
    ax1[ii] = fig.add_axes([0.3 * ii + 0.1, 0.2, 0.27, 0.75])
    norm[ii] = mpl.colors.Normalize(vmin=-v_lim[ii], vmax=v_lim[ii])
    cplot[ii] = plot2Ddata(
        receiver_list[0].locations,
        data_array[:, ii],
        ax=ax1[ii],
        ncontour=30,
        contourOpts={&quot;cmap&quot;: &quot;bwr&quot;, &quot;norm&quot;: norm[ii]},
    )
    ax1[ii].set_title(plot_title[ii])
    ax1[ii].set_xlabel(&quot;x (m)&quot;)
    if ii == 0:
        ax1[ii].set_ylabel(&quot;y (m)&quot;)
    else:
        ax1[ii].set_yticks([])

    ax2[ii] = fig.add_axes([0.3 * ii + 0.1, 0.05, 0.27, 0.05])
    cbar[ii] = mpl.colorbar.ColorbarBase(
        ax2[ii], norm=norm[ii], orientation=&quot;horizontal&quot;, cmap=mpl.cm.bwr
    )
    cbar[ii].ax.locator_params(nbins=3)
    cbar[ii].set_label(plot_units[ii], labelpad=5)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="O6G3qlgSh_0UO3loTwy5f" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/5af2221ebe833732004fbc1e7f34754e.png" alt="&lt;Figure size 1200x500 with 6 Axes&gt;"/></div></div><div id="MFBgPfgHTN" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="plot-true-l2-and-irls-models" class="relative group"><span class="heading-text">Plot True, L2 and IRLS Models</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-true-l2-and-irls-models" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we compare the models recovered from weighted least-squares and iteratively re-weighted least-squares inversion to the true model.</p></div><div id="kbSJVkmmGz" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Recreate True Model on a Tensor Mesh
background_density = 0.0
block_density = -0.2
sphere_density = 0.2

true_model = background_density * np.ones(n_tensor_active)

ind_block = model_builder.get_indices_block(
    [-50, -15, 50], [-20, 15, 70], tensor_mesh.cell_centers[active_tensor_cells]
)
true_model[ind_block] = block_density

ind_sphere = model_builder.get_indices_sphere(
    np.r_[35.0, 0.0, 60.0], 14.0, tensor_mesh.cell_centers[active_tensor_cells]
)
true_model[ind_sphere] = sphere_density</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Gzzn63ivIzPLeejqqzABi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="QaycGv1T79" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Plot all models
mesh_list = [tensor_mesh, tensor_mesh, tree_mesh]
ind_list = [active_tensor_cells, active_tensor_cells, active_tree_cells]
model_list = [true_model, recovered_tensor_model, recovered_tree_model]
title_list = [&quot;True Model&quot;, &quot;L2 Tensor Model&quot;, &quot;IRLS Tree Model&quot;]
cplot = 3 * [None]
cbar = 3 * [None]
norm = 3 * [None]

fig = plt.figure(figsize=(7, 8))
ax1 = [fig.add_axes([0.1, 0.7 - 0.3 * ii, 0.75, 0.23]) for ii in range(0, 3)]
ax2 = [fig.add_axes([0.88, 0.7 - 0.3 * ii, 0.025, 0.23]) for ii in range(0, 3)]

for ii, mesh in enumerate(mesh_list):
    plotting_map = maps.InjectActiveCells(mesh, ind_list[ii], np.nan)
    max_abs = np.max(np.abs(model_list[ii]))
    norm[ii] = mpl.colors.Normalize(vmin=-max_abs, vmax=max_abs)

    cplot[ii] = mesh.plot_slice(
        plotting_map * model_list[ii],
        normal=&quot;Y&quot;,
        ax=ax1[ii],
        ind=int(mesh.shape_cells[1] / 2),
        grid=False,
        pcolor_opts={&quot;cmap&quot;: mpl.cm.RdYlBu_r, &quot;norm&quot;: norm[ii]},
    )
    ax1[ii].set_xlim([-150, 150])
    ax1[ii].set_ylim([topo_xyz[:, -1].max() - 100, topo_xyz[:, -1].max()])
    if ii &lt; 2:
        ax1[ii].set_xlabel(&quot;&quot;)
        ax1[ii].set_xticks([])
    ax1[ii].set_title(title_list[ii])

    cbar[ii] = mpl.colorbar.ColorbarBase(
        ax2[ii], norm=norm[ii], orientation=&quot;vertical&quot;, cmap=mpl.cm.RdYlBu_r
    )
    cbar[ii].set_label(&quot;$g/cm^3$&quot;, labelpad=0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="AIzAJGzKc1Q_4O8SFtJf9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/7097d700ed56128bc35d6c70dbfd32c3.png" alt="&lt;Figure size 700x800 with 6 Axes&gt;"/></div></div><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/fwd-gravity-gradiometry-3d"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>3D Forward Simulation of Gravity Gradiometry Data</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/magnetics-index"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>Magnetics</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/user-tutorials/build/entry.client-J4K7GZUA.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-YSSYBPCA.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-Z2EBYAAY.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-YAIQ7LUU.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-HTHE5KDW.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-JCLNTD6A.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-NF5NQVJX.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-5CFTM6YW.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/user-tutorials/build/root-MROHD4U6.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-625TU2HY.js"/><link rel="modulepreload" href="/user-tutorials/build/routes/$-INRYMPN2.js"/><script>window.__remixContext = {"url":"/inv-gravity-anomaly-3d","state":{"loaderData":{"root":{"config":{"title":"SimPEG User Tutorials","options":{"logo":"/user-tutorials/build/simpeg-logo-8e384bdbcd0a580c9ad2f1e67fcc0bfe.png","logo_text":"User Tutorials","analytics_plausible":"simpeg.xyz"},"myst":"1.3.8","nav":[{"title":"SimPEG","children":[{"title":"Project website","url":"https://simpeg.xyz"},{"title":"Documentation","url":"https://docs.simpeg.xyz"}]}],"actions":[{"title":"Learn More","url":"https://mystmd.org/guide","internal":false,"static":false}],"projects":[{"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"subject":"SimPEG User Tutorials","title":"SimPEG User Tutorials","description":"SimPEG user tutorials","authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/simpeg/user-tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"references":{"python":{"url":"https://docs.python.org/3"},"numpy":{"url":"https://numpy.org/doc/stable"},"scipy":{"url":"https://docs.scipy.org/doc/scipy"},"matplotlib":{"url":"https://matplotlib.org/stable"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main"},"simpeg":{"url":"https://docs.simpeg.xyz/latest"},"geoana":{"url":"https://geoana.simpeg.xyz"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master"}},"thumbnail":"/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-f8431d25d6d77e8b4ff5cdccedc9d3e9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-a1a5f99158a0a16b320fa6421f91835e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-ec1d656f70f6b7344928d0bd60daaca1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/user-tutorials"},"routes/$":{"config":{"title":"SimPEG User Tutorials","options":{"logo":"/user-tutorials/build/simpeg-logo-8e384bdbcd0a580c9ad2f1e67fcc0bfe.png","logo_text":"User Tutorials","analytics_plausible":"simpeg.xyz"},"myst":"1.3.8","nav":[{"title":"SimPEG","children":[{"title":"Project website","url":"https://simpeg.xyz"},{"title":"Documentation","url":"https://docs.simpeg.xyz"}]}],"actions":[{"title":"Learn More","url":"https://mystmd.org/guide","internal":false,"static":false}],"projects":[{"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"subject":"SimPEG User Tutorials","title":"SimPEG User Tutorials","description":"SimPEG user tutorials","authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/simpeg/user-tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"references":{"python":{"url":"https://docs.python.org/3"},"numpy":{"url":"https://numpy.org/doc/stable"},"scipy":{"url":"https://docs.scipy.org/doc/scipy"},"matplotlib":{"url":"https://matplotlib.org/stable"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main"},"simpeg":{"url":"https://docs.simpeg.xyz/latest"},"geoana":{"url":"https://geoana.simpeg.xyz"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master"}},"thumbnail":"/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-f8431d25d6d77e8b4ff5cdccedc9d3e9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-a1a5f99158a0a16b320fa6421f91835e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-ec1d656f70f6b7344928d0bd60daaca1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"kind":"Notebook","sha256":"72e5ac0c5d919e3680ecd37d6b9ecabe391ed5d61caab725a9028a22ea3e0c1f","slug":"inv-gravity-anomaly-3d","location":"/notebooks/03-gravity/inv_gravity_anomaly_3d.ipynb","dependencies":[],"frontmatter":{"title":"3D Inversion of Gravity Anomaly Data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"github":"https://github.com/simpeg/user-tutorials","subject":"SimPEG User Tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"exports":[{"format":"ipynb","filename":"inv_gravity_anomaly_3d.ipynb","url":"/user-tutorials/build/inv_gravity_anomaly_-cab2be719500649c684aa73c68282f80.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"caution","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Intermediate notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FyOJ8OzuQ9"}],"key":"jCfLcoiee5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial focusses on intermediate level functionality within SimPEG. Basic functionality within SimPEG is not discussed in detail, as we assume the user is already familiar.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TkPahx3sUg"}],"key":"K8MnceKZhs"}],"key":"RestFpZQdo"}],"key":"MchV8YATTi"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Light-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uoT6gS8ydl"}],"key":"UaddJLfaT6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial requires minimal computational resources and can be executed quickly in the background while other computer processes are running.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S6sXkaWNkk"}],"key":"fmVvBlVCzM"}],"key":"ixeDatCDdP"}],"key":"WKpb6ndgzO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cWQsCW8al5"}],"key":"c4k0sLwpZO"},{"type":"text","value":" Devin C. Cowan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bvm3kvFVFn"}],"key":"mnWP0tOEGi"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V5nJYxxSAT"}],"key":"v8Za6ihtr2"},{"type":"text","value":" gravity anomaly, integral formulation, inversion, sparse norm, tensor mesh, tree mesh.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"icx8c6Gn67"}],"key":"aCICqfS1zw"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TE032kEwpS"}],"key":"J4wGORY24E"},{"type":"text","value":" Here we invert gravity anomaly data to recover a density contrast model. We demonstrate two approaches for recovering a density contrast model:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"o6Kg0sELlq"}],"key":"ORA0CQNpb9"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Weighted least-squares inversion for a tensor mesh","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZdgQQdHkOq"}],"key":"KiojpZqksQ"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Iteratively re-weighted least-squares (IRLS) inversion for a tree mesh","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ViES4SlpD5"}],"key":"mXq79d81Ev"}],"key":"pqRLjDvR9M"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"se8XQX075s"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"weighted least-squares","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"glvqAciobW"}],"key":"o4bW6gOpN2"},{"type":"text","value":" approach is a great introduction to geophysical inversion with SimPEG. One drawback however, is that it recovers smooth structures which may not be representative of the true model. To recover sparse and/or blocky structures, we also demonstrate the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"EIFO05KyoO"},{"type":"emphasis","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"iteratively re-weighted least-squares","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"affkb4UTD0"}],"key":"OUznhNruMI"},{"type":"text","value":" approach. Because this tutorial focusses primarily on inversion-related functionality, we urge the reader to become familiar with functionality explained in the ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"G8nVJV6iPg"},{"type":"link","url":"/fwd-gravity-anomaly-3d","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Gravity Anomaly Data","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"cmZAfJ4zNf"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","dataUrl":"/fwd-gravity-anomaly-3d.json","internal":true,"protocol":"file","key":"GbJKRcFVeY"},{"type":"text","value":" tutorial before working through this one.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Il9zzc3TlT"}],"key":"iKoQz4iJI9"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"PzQPCex3zq"}],"key":"PtVplLg5Mk"}],"key":"csMLN27WXe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"How geophysical inversion is carried out using SimPEG.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"aHg6rGRFXE"}],"key":"OrN9IFLGD0"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"How to assign appropriate uncertainties to gravity anomaly data.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"XqDR2aVABC"}],"key":"TX1kol1uOT"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"How to design a suitable mesh for gravity inversion when using the integral formulation.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ZBGlEIGbwH"}],"key":"h5LsCxV8Ry"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"How to choose and set parameters for the inversion.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"HG54IZEOm3"}],"key":"CGJ49rZGif"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"How to define directives that are applied and updated throughout the inversion.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"bNk9078Fw2"}],"key":"k1AV5Mqh0V"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"How to applying the sensitivity weighting generally used in 3D gravity inversion.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"ZCJhaGDlp9"}],"key":"X5MmPr6ZO5"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"How to invert data using weighted least-squares and sparse-norm regularization.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"c2hbWdfDcH"}],"key":"me7BVEBnBB"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"How to analyse inversion results.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"TpS023bnxs"}],"key":"LsufIEM5ud"}],"key":"VGkcM7s7jT"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Although we consider gravity anomaly data in this tutorial, the same approach\ncan be used to invert gravity gradiometry data.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"m17TxEZL6W"}],"key":"HMhFysPZb6"}],"key":"BQ6sy6Mb9q"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kFcp7mVvKW"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"gZgbz4aSpc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise.\nAll of the functionality specific to the forward simulation of gravity data are imported from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qnHcwV8QZi"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.potential_fields.gravity.html#module-simpeg.potential_fields.gravity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg​.potential​_fields​.gravity","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dzVMFs3CAe"}],"urlSource":"myst:simpeg#simpeg.potential_fields.gravity","internal":false,"protocol":"xref:sphinx","key":"WehSzl41cG"},{"type":"text","value":" module. Classes required to define the data misfit, regularization, optimization, etc... are imported from elsewhere within SimPEG. We also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AOXwYQ06K6"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/simpeg.utils.html#module-simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fGRNNzHRit"}],"urlSource":"myst:simpeg#simpeg.utils","internal":false,"protocol":"xref:sphinx","key":"hFuzLXTPZt"},{"type":"text","value":". To generate the mesh used for the inversion, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"frmjCdheR2"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VlYI5Mwnxa"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"cyYRpttKmb"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cQnZt9BMn6"}],"key":"kRJ0TlyqDU"}],"key":"jexXnhHHO5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:32.087738Z","iopub.status.busy":"2024-07-24T17:50:32.087152Z","iopub.status.idle":"2024-07-24T17:50:33.960921Z","shell.execute_reply":"2024-07-24T17:50:33.959878Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom simpeg.potential_fields import gravity\nfrom simpeg.utils import plot2Ddata, model_builder, download\nfrom simpeg import (\n    maps,\n    data,\n    data_misfit,\n    inverse_problem,\n    regularization,\n    optimization,\n    directives,\n    inversion,\n)\n\n# discretize functionality\nfrom discretize import TensorMesh, TreeMesh\nfrom discretize.utils import active_from_xyz\n\n# Common Python functionality\nimport os\nimport numpy as np\nfrom scipy.interpolate import griddata\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport tarfile\n\nmpl.rcParams.update({\"font.size\": 14})","key":"WExPfART1B"},{"type":"output","id":"SMTPSsDLg_yzcpWmSg35s","data":[],"key":"zpVvWA95Li"}],"key":"MQAL557Szj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Tutorial Files","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M5oTf5qW1i"}],"identifier":"load-tutorial-files","label":"Load Tutorial Files","html_id":"load-tutorial-files","implicit":true,"key":"t8i5mTZv2c"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For most geophysical inversion projects, a reasonable inversion result can be obtained so long as the practitioner has observed data and topography. For this tutorial, the observed data and topography files are provided. Here, we download and import the observed data and topography into the SimPEG framework.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"huUgzuMf7a"}],"key":"ul2ZDGJqAq"}],"key":"sPaIcx8qKf"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:33.966289Z","iopub.status.busy":"2024-07-24T17:50:33.965981Z","iopub.status.idle":"2024-07-24T17:50:34.467681Z","shell.execute_reply":"2024-07-24T17:50:34.466309Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# URL to download from repository assets\ndata_source = \"https://github.com/simpeg/user-tutorials/raw/main/assets/03-gravity/inv_gravity_anomaly_3d_files.tar.gz\"\n\n# download the data\ndownloaded_data = download(data_source, overwrite=True)\n\n# unzip the tarfile\ntar = tarfile.open(downloaded_data, \"r\")\ntar.extractall()\ntar.close()\n\n# path to the directory containing our data\ndir_path = downloaded_data.split(\".\")[0] + os.path.sep\n\n# files to work with\ntopo_filename = dir_path + \"gravity_topo.txt\"\ndata_filename = dir_path + \"gravity_data.obs\"","key":"bw161X7bLC"},{"type":"output","id":"dm8DmLG8wY1m6z8kTHKPy","data":[{"name":"stdout","output_type":"stream","text":"Downloading https://github.com/simpeg/user-tutorials/raw/main/assets/03-gravity/inv_gravity_anomaly_3d_files.tar.gz\n"},{"name":"stdout","output_type":"stream","text":"   saved to: /home/ssoler/git/user-tutorials/notebooks/03-gravity/inv_gravity_anomaly_3d_files.tar.gz\nDownload completed!\n"}],"key":"Ym2G1NuADr"}],"key":"HpuSDyDJxU"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For this tutorial, the data are organized within basic XYZ files. However, SimPEG does allow the user to import UBC-GIF formatted gravity data files; see ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r8qgHuNfu9"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.utils.io_utils.read_grav3d_ubc.html#simpeg.utils.io_utils.read_grav3d_ubc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"read_grav3d_ubc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ai1MGPaIzS"}],"urlSource":"myst:simpeg#simpeg.utils.io_utils.read_grav3d_ubc","internal":false,"protocol":"xref:sphinx","key":"JfKCiPG0mQ"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I8YBFDXTaA"}],"key":"BWlh3kx01F"}],"key":"lc1bmVka4B"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:34.473474Z","iopub.status.busy":"2024-07-24T17:50:34.473072Z","iopub.status.idle":"2024-07-24T17:50:34.481873Z","shell.execute_reply":"2024-07-24T17:50:34.480491Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Load topography (xyz file)\ntopo_xyz = np.loadtxt(str(topo_filename))\n\n# Load field data (xyz file)\ndobs = np.loadtxt(str(data_filename))","key":"oq9oJebpGw"},{"type":"output","id":"N4kfVybS0ZSbQYHzMiRMj","data":[],"key":"F9qDjtcM0S"}],"key":"QamzJ8Zxp0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Observed Data and Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dWP78V5duj"}],"identifier":"plot-observed-data-and-topography","label":"Plot Observed Data and Topography","html_id":"plot-observed-data-and-topography","implicit":true,"key":"PGTUXhkhIb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we plot the synthetic gravity anomaly data and local topography.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zJiMseaDx0"}],"key":"BpjCxKJOar"}],"key":"amQgj2NNTC"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:34.486181Z","iopub.status.busy":"2024-07-24T17:50:34.485768Z","iopub.status.idle":"2024-07-24T17:50:34.491373Z","shell.execute_reply":"2024-07-24T17:50:34.490277Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define receiver locations and observed data\nreceiver_locations = dobs[:, 0:3]\ndobs = dobs[:, -1]","key":"JY3OkeVSOl"},{"type":"output","id":"hdeVx5nz6SOUMefEnWwIg","data":[],"key":"siSRQzogu0"}],"key":"K2Oy6oSBpP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:34.495756Z","iopub.status.busy":"2024-07-24T17:50:34.495409Z","iopub.status.idle":"2024-07-24T17:50:35.094066Z","shell.execute_reply":"2024-07-24T17:50:35.093295Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(9, 5))\n\nax1 = fig.add_axes([0.05, 0.35, 0.35, 0.6])\nplot2Ddata(\n    receiver_locations,\n    dobs,\n    ax=ax1,\n    dataloc=True,\n    ncontour=40,\n    contourOpts={\"cmap\": \"bwr\"},\n)\nax1.set_title(\"Gravity Anomaly\", pad=15)\nax1.set_xlabel(\"x (m)\")\nax1.set_ylabel(\"y (m)\")\n\ncx1 = fig.add_axes([0.05, 0.18, 0.35, 0.04])\nnorm1 = mpl.colors.Normalize(vmin=-np.max(np.abs(dobs)), vmax=np.max(np.abs(dobs)))\ncbar1 = mpl.colorbar.ColorbarBase(\n    cx1, norm=norm1, orientation=\"horizontal\", cmap=mpl.cm.bwr\n)\ncbar1.set_label(\"$mGal$\", size=16)\n\nax2 = fig.add_axes([0.55, 0.35, 0.35, 0.6])\nplot2Ddata(\n    topo_xyz[:, 0:2],\n    topo_xyz[:, -1],\n    ax=ax2,\n    ncontour=50,\n    contourOpts={\"cmap\": \"gist_earth\"},\n)\nax2.set_title(\"Topography\", pad=15)\nax2.set_xlabel(\"x (m)\")\nax2.set_ylabel(\"y (m)\")\n\ncx2 = fig.add_axes([0.55, 0.18, 0.35, 0.04])\nnorm2 = mpl.colors.Normalize(vmin=np.min(topo_xyz[:, -1]), vmax=np.max(topo_xyz[:, -1]))\ncbar2 = mpl.colorbar.ColorbarBase(\n    cx2, norm=norm2, orientation=\"horizontal\", cmap=mpl.cm.gist_earth\n)\ncbar2.set_label(\"$m$\", size=16)\n\nplt.show()","key":"LhYojniC6i"},{"type":"output","id":"3RQYS6wNzBf67NSUiRKQX","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0bf249abac5c458cc6d71d9bdee73faf","path":"/user-tutorials/build/0bf249abac5c458cc6d71d9bdee73faf.png"},"text/plain":{"content":"\u003cFigure size 900x500 with 4 Axes\u003e","content_type":"text/plain"}}}],"key":"vzo3YyuSvH"}],"key":"kGrbdzwJ7a"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Assign Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e9OUZe4Mde"}],"identifier":"assign-uncertainties","label":"Assign Uncertainties","html_id":"assign-uncertainties","implicit":true,"key":"PQg3AC2nBp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Inversion with SimPEG requires that we define the uncertainties on our data; that is, an estimate of the standard deviation of the noise on our data assuming it is uncorrelated Gaussian with zero mean. An online resource explaining uncertainties and their role in the inversion can be found ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ytfY6OoHQi"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KwF94z8aVy"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"dQ3qq3hbpf"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KiDhbBBd8A"}],"key":"XBAq9j5y9H"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For gravity anomaly data,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gMBq0AFYSD"}],"key":"TolQxLeaJE"},{"type":"text","value":" a constant floor value is generally applied to all data. We usually avoid assigning percent uncertainties because the inversion would prioritize fitting the background over fitting anomalies. The floor value for the uncertainties may be chosen based on some knowledge of the instrument error, or it may be chosen as some fraction of the largest anomaly value. For this tutorial, the floor uncertainty assigned to all data is 2.5% of the maximum observed gravity anomaly value. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ro8ULKZfpY"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For gravity gradiometry data,","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ISuyyIi4jy"}],"key":"m9uKMxB3KF"},{"type":"text","value":" you may choose to assign a different floor value to each data component.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KlUKYlnPbk"}],"key":"IPmlTgputo"}],"key":"K0Xr3FlYYk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.099828Z","iopub.status.busy":"2024-07-24T17:50:35.099521Z","iopub.status.idle":"2024-07-24T17:50:35.105071Z","shell.execute_reply":"2024-07-24T17:50:35.104269Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"maximum_anomaly = np.max(np.abs(dobs))\nfloor_uncertainty = 0.02 * maximum_anomaly\nuncertainties = floor_uncertainty * np.ones(np.shape(dobs))\nprint(\"Floor uncertainty: {}\".format(floor_uncertainty))","key":"T1moyS6cIu"},{"type":"output","id":"8aXHsFp-tMKbH6_7nUcsB","data":[{"name":"stdout","output_type":"stream","text":"Floor uncertainty: 0.00037204\n"}],"key":"xzUJKcxkjP"}],"key":"xDT2oni1Eh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Survey","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lCcrIqGYtK"}],"identifier":"define-the-survey","label":"Define the Survey","html_id":"define-the-survey","implicit":true,"key":"w8jEe9WqyK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here, we define the survey geometry. The survey consists of a 160 m x 160 m grid of equally spaced receivers located 5 m\nabove the surface topography. For a more comprehensive description of constructing gravity surveys in SimPEG, see the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"diKk1Qq5no"},{"type":"link","url":"/fwd-gravity-anomaly-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Gravity Anomaly Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hHdxxyrcJa"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","dataUrl":"/fwd-gravity-anomaly-3d.json","internal":true,"protocol":"file","key":"fRRaEXmdmF"},{"type":"text","value":" tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qYym3buxBx"}],"key":"Dv4v6i6a8N"}],"key":"swdz9Du1zt"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.110340Z","iopub.status.busy":"2024-07-24T17:50:35.109975Z","iopub.status.idle":"2024-07-24T17:50:35.115710Z","shell.execute_reply":"2024-07-24T17:50:35.114801Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the receivers. The data consist of vertical gravity anomaly measurements.\n# The set of receivers must be defined as a list.\nreceiver_list = gravity.receivers.Point(receiver_locations, components=\"gz\")\nreceiver_list = [receiver_list]\n\n# Define the source field\nsource_field = gravity.sources.SourceField(receiver_list=receiver_list)\n\n# Define the survey\nsurvey = gravity.survey.Survey(source_field)","key":"CGrMraGtUs"},{"type":"output","id":"rY2uS7mcycDeJ5cVcGliI","data":[],"key":"CApws525ES"}],"key":"KP4Nj5boo0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hcVaMYW2mT"}],"identifier":"define-the-data","label":"Define the Data","html_id":"define-the-data","implicit":true,"key":"CG1OHCKVgJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The SimPEG ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Gqe7qqh1gy"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data.Data.html#simpeg.data.data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LtEgCe6NiU"}],"urlSource":"myst:simpeg#simpeg.data.Data","internal":false,"protocol":"xref:sphinx","key":"av52g4gFXi"},{"type":"text","value":" class is required for inversion and connects the observed data, uncertainties and survey geometry.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RznTlKEHQK"}],"key":"dTmczwg0i1"}],"key":"p4QLN6SoFY"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.119301Z","iopub.status.busy":"2024-07-24T17:50:35.118959Z","iopub.status.idle":"2024-07-24T17:50:35.124138Z","shell.execute_reply":"2024-07-24T17:50:35.123111Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"data_object = data.Data(survey, dobs=dobs, standard_deviation=uncertainties)","key":"Xe1awakAuc"},{"type":"output","id":"KAPMBgA7MvLg5upIR78Hn","data":[],"key":"sDnB5uTGjj"}],"key":"eZ1YVG3fm1"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Weighted Least-Squares Inversion on a Tensor Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"woRkfyGWlD"}],"identifier":"weighted-least-squares-inversion-on-a-tensor-mesh","label":"Weighted Least-Squares Inversion on a Tensor Mesh","html_id":"weighted-least-squares-inversion-on-a-tensor-mesh","implicit":true,"key":"SnU8732qX1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we provide a step-by-step best-practices approach for weighted least-squares inversion of gravity anomaly data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TDQRxb3uZn"}],"key":"yDjQwCDpAZ"}],"key":"kHljx5cyVn"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tensor) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JnPjl1EOoE"}],"identifier":"design-a-tensor-mesh","label":"Design a (Tensor) Mesh","html_id":"design-a-tensor-mesh","implicit":true,"key":"Mmcjjtnbbi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Meshes are designed using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LZFxi6I1RT"},{"type":"link","url":"https://discretize.simpeg.xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize package","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fdW0nSZ6M8"}],"urlSource":"https://discretize.simpeg.xyz","key":"gB4cug5kvO"},{"type":"text","value":". Here, we design a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Qdg93eOzeZ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tensor mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LzBkkTjmEH"}],"urlSource":"myst:discretize#discretize.TensorMesh","internal":false,"protocol":"xref:sphinx","key":"luSXriZdRg"},{"type":"text","value":". See the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gzT04QEmJt"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize user tutorials","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W8Rk9fSXFU"}],"urlSource":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","key":"PSAnD7pJXK"},{"type":"text","value":" to learn more about creating meshes. When designing a mesh for gravity inversion, we must consider the spatial wavelengths of the signals contained within the data. If the data spacing is large and/or the signals present in the data are smooth, larger cells can be used to construct the mesh. If the data spacing is smaller and compact anomalies are observed, smaller cells are needed to characterize the structures responsible. And smaller cells are required when the effects of surface topography are significant.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pHg9IBTFxF"}],"key":"CNcAuXgVXu"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"General rule of thumb:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kswderB8nU"}],"key":"Jf44QaWZSj"},{"type":"text","value":" The minimum cell size in each direction is at most 0.5 - 1 times the station spacing. And the thickness of the padding is at least 1 - 2 times the width of the survey region.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"J4JgqmZA4c"}],"key":"uxYqm47wqD"}],"key":"iATJEkEY0U"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.128034Z","iopub.status.busy":"2024-07-24T17:50:35.127697Z","iopub.status.idle":"2024-07-24T17:50:35.134740Z","shell.execute_reply":"2024-07-24T17:50:35.133917Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Generate tensor mesh with top at z = 0 m\ndh = 5.0  # minimum cell size\nhx = [(dh, 5, -1.3), (dh, 40), (dh, 5, 1.3)]  # discretization along x\nhy = [(dh, 5, -1.3), (dh, 40), (dh, 5, 1.3)]  # discretization along y\nhz = [(dh, 5, -1.3), (dh, 15)]  # discretization along z\ntensor_mesh = TensorMesh([hx, hy, hz], \"CCN\")\n\n# Shift vertically to top same as maximum topography\ntensor_mesh.origin += np.r_[0.0, 0.0, topo_xyz[:, -1].max()]","key":"FzcuumS5g9"},{"type":"output","id":"XDWuTst_UK9FgaD3NPRxf","data":[],"key":"dntfRwmxM5"}],"key":"lk63KIruQz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iYRYTjOKRR"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells","implicit":true,"key":"I2XefSb5K9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Whereas cells below the Earth’s surface contribute towards the simulated gravity anomaly, air cells do not.\nThe set of mesh cells used in the forward simulation are referred to as ‘active cells’. Unused cells (air cells) are ‘inactive cells’. Here, the discretize ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hI9WsJt6qd"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KFqa1Y7ztw"}],"urlSource":"myst:discretize#discretize.utils.active_from_xyz","internal":false,"protocol":"xref:sphinx","key":"ycMszS5euH"},{"type":"text","value":" utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ipf5KfIDB7"},{"type":"inlineCode","value":"bool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VJe7hyFiXh"},{"type":"text","value":" array.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"efPXRgSIQ1"}],"key":"XP7dUnGR7s"}],"key":"eQeqorzFBH"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.139123Z","iopub.status.busy":"2024-07-24T17:50:35.138748Z","iopub.status.idle":"2024-07-24T17:50:35.195173Z","shell.execute_reply":"2024-07-24T17:50:35.194453Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"active_tensor_cells = active_from_xyz(tensor_mesh, topo_xyz)\nn_tensor_active = int(active_tensor_cells.sum())","key":"fg0kMQljOg"},{"type":"output","id":"YnpX_VjS2l0XCegiQeiMG","data":[],"key":"T4l1BjkTX0"}],"key":"RgMzn4v0NA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from the Model to Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x3uOmQVTzl"}],"identifier":"mapping-from-the-model-to-active-cells","label":"Mapping from the Model to Active Cells","html_id":"mapping-from-the-model-to-active-cells","implicit":true,"key":"m9LoYitXfE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For whatever model we choose, we must define a mapping from the set of model parameters (a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dpE6Sv1WjJ"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1D numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mfQsy0KRDi"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"xref:sphinx","key":"opwYhGya68"},{"type":"text","value":") to the active cells in the mesh. Mappings are created using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"atDMC7wywl"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.maps.IdentityMap.html#simpeg.maps.identitymap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simpeg.maps","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GdbohLqdMB"}],"urlSource":"myst:simpeg#simpeg.maps.IdentityMap","internal":false,"protocol":"xref:sphinx","key":"PwQWft38qa"},{"type":"text","value":" module. For the tutorial exercise, the model is the density contrast values for all active cells. As such, our mapping is an identity mapping, whose dimensions are equal to the number of active cells.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NGIIn6rpaV"}],"key":"in9hdL7Sfi"}],"key":"CezqK4WMO7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.199514Z","iopub.status.busy":"2024-07-24T17:50:35.199250Z","iopub.status.idle":"2024-07-24T17:50:35.203140Z","shell.execute_reply":"2024-07-24T17:50:35.202539Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tensor_model_map = maps.IdentityMap(nP=n_tensor_active)","key":"Tr2X71JUgb"},{"type":"output","id":"9iC42w7Qma-9aGj4ULlij","data":[],"key":"MqQu0fUgd2"}],"key":"tk55arARPM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting/Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GEyCnJ3qhu"}],"identifier":"starting-reference-models","label":"Starting/Reference Models","html_id":"starting-reference-models","implicit":true,"key":"BnQgvdhVpY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Z64WZ0okec"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"starting model","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JdrM3L3RVh"}],"key":"TE00yj23HY"},{"type":"text","value":" defines a reasonable starting point for the inversion and does not necessarily represent an initial estimate of the true model. Because the integral formulation used to solve the gravity forward simulation is linear, the optimization problem we must solve is a linear least-squares problem, making the choice in starting model insignificant. It should be noted that the starting model ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g5sDcQfeDM"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"cannot be vector of zeros,","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"laWrejtrjf"}],"key":"jcJB4cDp4G"},{"type":"text","value":" otherwise the inversion will be unable to compute a gradient direction at the first iteration. For gravity inversion, the starting model is frequently a constant vector with a very small value.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gO4SmncGa0"}],"key":"sTTzi9x9kV"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fUTwU4e1BV"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"reference model","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DqlDVkbKMc"}],"key":"gLRplYpjYD"},{"type":"text","value":" is used to include a-prior information. The impact of the reference model on the inversion will be discussed in another tutorial. Assuming the contribution from all background structures has been removed from the gravity anomaly data, and assuming we have not a-priori information, the reference model for basic inversion of gravity data is zero.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HkeNbShKBv"}],"key":"HvrapLP4Nk"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Notice that the length of the starting and reference models is equal to the number of active mesh cells!!!","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uyKILbC5Zr"}],"key":"f15TDqUDl3"}],"key":"zn33thF31m"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.207503Z","iopub.status.busy":"2024-07-24T17:50:35.207240Z","iopub.status.idle":"2024-07-24T17:50:35.211994Z","shell.execute_reply":"2024-07-24T17:50:35.211238Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"starting_tensor_model = 1e-6 * np.ones(n_tensor_active)\nreference_tensor_model = np.zeros_like(starting_tensor_model)","key":"WNVN4PvuQ2"},{"type":"output","id":"dSXY80PBMET_xMlTJ0r4o","data":[],"key":"uW3xVWK4AG"}],"key":"MaYGkGOjjG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.215439Z","iopub.status.busy":"2024-07-24T17:50:35.215118Z","iopub.status.idle":"2024-07-24T17:50:35.222209Z","shell.execute_reply":"2024-07-24T17:50:35.221525Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Map for ignoring inactive cells when plotting\ntensor_plotting_map = maps.InjectActiveCells(tensor_mesh, active_tensor_cells, np.nan)","key":"jOJwKKII3w"},{"type":"output","id":"tjPYEkFDEeDU_ztujhY6t","data":[],"key":"ZLe5miLyyB"}],"key":"GfVW9aNava"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.225855Z","iopub.status.busy":"2024-07-24T17:50:35.225570Z","iopub.status.idle":"2024-07-24T17:50:35.419411Z","shell.execute_reply":"2024-07-24T17:50:35.418810Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(7, 3))\nax1 = fig.add_axes([0.1, 0.1, 0.73, 0.8])\n\nnorm = mpl.colors.Normalize(vmin=-0.1, vmax=0.1)\ntensor_mesh.plot_slice(\n    tensor_plotting_map * starting_tensor_model,\n    normal=\"Y\",\n    ax=ax1,\n    ind=int(tensor_mesh.shape_cells[1] / 2),\n    grid=True,\n    pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm},\n)\nax1.set_title(\"Starting Model (slice at y = 0 m)\")\n\nax2 = fig.add_axes([0.85, 0.1, 0.03, 0.8])\ncbar = mpl.colorbar.ColorbarBase(\n    ax2, norm=norm, orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n)\ncbar.set_label(\"$g/cm^3$\", rotation=270, labelpad=15, size=16)\n\nplt.show()","key":"TqNn0OzL1B"},{"type":"output","id":"KzAmZSGPI1Qcla9a-yeqw","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"46ff3e21c1af38ff0f166ec4e97215dd","path":"/user-tutorials/build/46ff3e21c1af38ff0f166ec4e97215dd.png"},"text/plain":{"content":"\u003cFigure size 700x300 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"KKPNqZRito"}],"key":"XizQWwjntg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zwFrHld2fv"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"w2eMHAv08c"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A simulation object defining the forward problem is required in order to predict data and calculate misfits for recovered models. A comprehensive description of the simulation object for gravity anomaly data was discussed in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OZODAKErPL"},{"type":"link","url":"/fwd-gravity-anomaly-3d","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Gravity Anomaly Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E0tooRbJBT"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","dataUrl":"/fwd-gravity-anomaly-3d.json","internal":true,"protocol":"file","key":"FK6h3YkLZn"},{"type":"text","value":" tutorial. Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hKwCisZcT7"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.potential_fields.gravity.Simulation3DIntegral.html#simpeg.potential_fields.gravity.Simulation3DIntegral","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D integral formulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Mttqux3wDr"}],"urlSource":"myst:simpeg#simpeg.potential_fields.gravity.simulation.Simulation3DIntegral","internal":false,"protocol":"xref:sphinx","key":"GGCJjNy7Cx"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i162vJtRLg"}],"key":"PIlttFQDjy"}],"key":"dbtGiHimEG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.424361Z","iopub.status.busy":"2024-07-24T17:50:35.424019Z","iopub.status.idle":"2024-07-24T17:50:35.466644Z","shell.execute_reply":"2024-07-24T17:50:35.465850Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_L2 = gravity.simulation.Simulation3DIntegral(\n    survey=survey,\n    mesh=tensor_mesh,\n    rhoMap=tensor_model_map,\n    ind_active=active_tensor_cells,\n    engine=\"geoana\",\n)","key":"UcKKvBGopO"},{"type":"output","id":"pNXfYnRbLxXcygoCyTXVl","data":[],"key":"ObYlm1RcWm"}],"key":"goKE5OHzwu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"o7fU5gjQdt"}],"key":"CSXHDIrrzz"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"By choosing ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bhicWLrGzh"},{"type":"inlineCode","value":"engine=\"choclo\"","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xc70A8U7iT"},{"type":"text","value":" we can make our simulation to run the faster and more memory efficient implementation of the gravity forward that uses ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gL09EL5ubV"},{"type":"link","url":"https://numba.pydata.org/","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Numba","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pHCUQqa2ag"}],"urlSource":"https://numba.pydata.org/","key":"D6OmOPOLHg"},{"type":"text","value":" and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hkV6lNUbuZ"},{"type":"link","url":"https://www.fatiando.org/choclo","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Choclo","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lWYFlW2hU7"}],"urlSource":"https://www.fatiando.org/choclo","key":"A5LnZcdOZb"},{"type":"text","value":" under the hood. To do so, we need to have ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VL3pOc4Bv9"},{"type":"link","url":"https://www.fatiando.org/choclo/latest/install.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Choclo installed","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dKLugqJufT"}],"urlSource":"https://www.fatiando.org/choclo/latest/install.html","key":"vVF3P9na1q"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"erv0MXuoLO"}],"key":"Dzj8OEk6JX"}],"key":"MOrjxdN68C"}],"key":"W8whCFgVfz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CQGmPD2oLh"}],"identifier":"define-the-data-misfit","label":"Define the Data Misfit","html_id":"define-the-data-misfit","implicit":true,"key":"GwxqMOIPOe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To understand the role of the data misfit in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"O09N7qOcd1"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jsrFRhywLL"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/Uncertainties.html","key":"nnYx9BZI0s"},{"type":"text","value":".\nHere, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a87PZk53LA"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.data_misfit.L2DataMisfit.html#simpeg.data_misfit.l2datamisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"L2DataMisfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fbkCC2Hiv4"}],"urlSource":"myst:simpeg#simpeg.data_misfit.L2DataMisfit","internal":false,"protocol":"xref:sphinx","key":"GXUdVBcwQQ"},{"type":"text","value":" class to define the data misfit. In this case, the data misfit is the L2 norm of the weighted residual between the observed data and the data predicted for a given model. When instantiating the data misfit object within SimPEG, we must assign an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NlhwdIgbLc"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PXiM3S5ryx"}],"key":"rwR0N7OuKS"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i6veq6ysj8"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"simulation object","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QxR5RKyM0k"}],"key":"m7IUwQ2WcF"},{"type":"text","value":" as properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xgmc2fLp8F"}],"key":"GSs0aQPxjK"}],"key":"txIHYqXD2Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.471697Z","iopub.status.busy":"2024-07-24T17:50:35.471446Z","iopub.status.idle":"2024-07-24T17:50:35.475502Z","shell.execute_reply":"2024-07-24T17:50:35.474902Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_L2 = data_misfit.L2DataMisfit(data=data_object, simulation=simulation_L2)","key":"va5tSYCU0h"},{"type":"output","id":"YCrs7V8UkIcV6XkMGKjyP","data":[],"key":"ngCpkTsacP"}],"key":"kTyq9XKV7T"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DYrENk5yVt"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization","implicit":true,"key":"iB9bf2nYnA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To understand the role of the regularization in the inversion, please visit ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AXxEyXW44n"},{"type":"link","url":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this online resource","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iNhhgvsXpb"}],"urlSource":"https://giftoolscookbook.readthedocs.io/en/latest/content/fundamentals/ObjectiveFunction.html","key":"USKeTbJQtn"},{"type":"text","value":". Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Trev4isqil"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.WeightedLeastSquares.html#simpeg.regularization.weightedleastsquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"WeightedLeastSquares","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bph1FwkK1i"}],"urlSource":"myst:simpeg#simpeg.regularization.WeightedLeastSquares","internal":false,"protocol":"xref:sphinx","key":"v6NyfmAQDl"},{"type":"text","value":" regularization class to constrain the inversion result. Here, length scales along x, y and z are used to balance the smallness and smoothness terms. And the reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K2Vut7aH0t"}],"key":"O6UqurV2gh"}],"key":"w3WQX9oUy7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.481223Z","iopub.status.busy":"2024-07-24T17:50:35.480978Z","iopub.status.idle":"2024-07-24T17:50:35.586932Z","shell.execute_reply":"2024-07-24T17:50:35.586114Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_L2 = regularization.WeightedLeastSquares(\n    tensor_mesh,\n    active_cells=active_tensor_cells,\n    length_scale_x=1.0,\n    length_scale_y=1.0,\n    length_scale_z=1.0,\n    reference_model=reference_tensor_model,\n    reference_model_in_smooth=False,\n)","key":"z3otv1KaRD"},{"type":"output","id":"sEIIcV-HY_T9A7jW3d0MO","data":[],"key":"zzeypzZa6C"}],"key":"H2jyyy97Hl"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fddNbPo0kb"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm","implicit":true,"key":"JOpqzep1Gv"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jWEAGLgwug"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.InexactGaussNewton.html#simpeg.optimization.inexactgaussnewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"InexactGaussNewton","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eiOTs20wPq"}],"urlSource":"myst:simpeg#simpeg.optimization.InexactGaussNewton","internal":false,"protocol":"xref:sphinx","key":"QPDWeV7C2i"},{"type":"text","value":" class to solve the optimization problem using inexact Gauss-Newton. Reasonable default values have generally been set for the properties of each optimization class. However, the user may choose to set custom values; e.g. the accuracy tolerance for the conjugate gradient solver or the number of line searches.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ArkRVTiCvM"}],"key":"WyBLyJkzCL"}],"key":"TnMYDwRNWb"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.592389Z","iopub.status.busy":"2024-07-24T17:50:35.592029Z","iopub.status.idle":"2024-07-24T17:50:35.596340Z","shell.execute_reply":"2024-07-24T17:50:35.595611Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_L2 = optimization.InexactGaussNewton(\n    maxIter=100, maxIterLS=20, maxIterCG=10, tolCG=1e-2\n)","key":"xHZRHgzNiF"},{"type":"output","id":"0x5AcDxaR4VWrx7YvFnlW","data":[],"key":"l4tXE3dlB9"}],"key":"n2QUmkTIF9"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CxsrzUVoZS"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem","implicit":true,"key":"HgzP64FQtA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kmQMVH2L9n"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inverse_problem.BaseInvProblem.html#simpeg.inverse_problem.baseinvproblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInvProblem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"saWYBjFrtr"}],"urlSource":"myst:simpeg#simpeg.inverse_problem.BaseInvProblem","internal":false,"protocol":"xref:sphinx","key":"J91vUkzlVs"},{"type":"text","value":" class to fully define the inverse problem that is solved at each beta (trade-off parameter) iteration. The inverse problem requires appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TLvC1e8xD6"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"data misfit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"laikdjOrTW"}],"key":"HRvsIvpoRJ"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u96BwRj5vp"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"regularization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"feupCFHO6T"}],"key":"Abzbjh0Fg6"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wNIms9N2r8"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimization","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IDxPnQk1qz"}],"key":"nlujlNuPZb"},{"type":"text","value":" objects.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"enEPKEfPSo"}],"key":"S4VcVNdMkw"}],"key":"OkszjiSsIW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.601516Z","iopub.status.busy":"2024-07-24T17:50:35.601271Z","iopub.status.idle":"2024-07-24T17:50:35.605495Z","shell.execute_reply":"2024-07-24T17:50:35.604547Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_L2 = inverse_problem.BaseInvProblem(dmis_L2, reg_L2, opt_L2)","key":"Job8LDGX31"},{"type":"output","id":"Fwnb-gcjx0OLBg-DwCHYN","data":[],"key":"vGHfK5ZelO"}],"key":"IVMXWZBaIh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E84iXDW4W8"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives","implicit":true,"key":"CicmN1Ngwj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Directives represent operations that are carried out during the inversion. Here, we apply common directives for weighted least-squares inversion of gravity data and describe their roles. These are:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wJcMuw5Xb9"}],"key":"F9acYNVbvl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"h7IzBq3qlH"}],"urlSource":"myst:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"d5ZL51hhnq"},{"type":"text","value":": Apply sensitivity weighting to counteract the natural tendancy of potential field inversion to cluster recovered structures near the receivers. Because the 3D integral formulation is linear, the sensitivity weighting is independent of the model and does not need to be updated throughout the inversion, so we set ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"upibYRQ6Yx"},{"type":"inlineCode","value":"every_iteration=False","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V28J2DE6be"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nWesjG6Dpd"}],"key":"cTi2HK9WeT"}],"key":"wMzRNn61dE"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YiG7kIfsyC"}],"urlSource":"myst:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"nAVBSAJaG5"},{"type":"text","value":": Apply Jacobi preconditioner when solving optimization problem.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jtzR2tS25N"}],"key":"kfcM6Grr88"}],"key":"KiVTEL6Ueg"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gxzM2X40lO"}],"urlSource":"myst:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"XpagHmzXsP"},{"type":"text","value":": Compute and set starting trade-off parameter (beta) based on largest eigenvalues.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qmxLZ9W0Oo"}],"key":"G89ipaBYA6"}],"key":"u1U6lesml9"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DaITsaCIum"}],"urlSource":"myst:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"nNBvnWCwcs"},{"type":"text","value":": Size reduction of the trade-off parameter at every beta iteration, and the number of Gauss-Newton iterations for each beta.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VYROvyvMjf"}],"key":"EEwCGr702k"}],"key":"xYjSegFC4W"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"V4rGOwYWHP"}],"urlSource":"myst:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"GlUwS8d1F6"},{"type":"text","value":": Terminates the inversion when the data misfit equals the target misfit. A ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BGm6OwtOhq"},{"type":"inlineCode","value":"chifact=1","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ZgTmxFpdcQ"},{"type":"text","value":" terminates the inversion when the data misfit equals the number of data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"lL0eNYhWse"}],"key":"q7BNc0JU2j"}],"key":"viSiht5Ex1"}],"key":"vlP6eOzBAW"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"The directive objects are organized in a ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FGN6QcLJVe"},{"type":"inlineCode","value":"list","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"lmtcp1nbic"},{"type":"text","value":". Upon starting the inversion or updating the recovered model at each iteration, the inversion will call each directive within the list ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"AfkOnul1uq"},{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"in order","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FYgRSuqtgV"}],"key":"EuesLlenHx"},{"type":"text","value":". The order of the directives matters, and SimPEG will throw an error if directives are organized into an improper order. Some directives, like the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"pOoDAQ3Rab"},{"type":"inlineCode","value":"BetaEstimate_ByEig","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"UtauI7X5KU"},{"type":"text","value":" are only used when starting the inversion. Other directives, like ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"atS4gcHapJ"},{"type":"inlineCode","value":"UpdatePreconditionner","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ahK3MVerN1"},{"type":"text","value":", are used whenever the model is updated.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"wlZtpYT4Uy"}],"key":"MWMovDHfod"}],"key":"wPPhgS4oZS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.609573Z","iopub.status.busy":"2024-07-24T17:50:35.609275Z","iopub.status.idle":"2024-07-24T17:50:35.615304Z","shell.execute_reply":"2024-07-24T17:50:35.614572Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights = directives.UpdateSensitivityWeights(every_iteration=False)\nupdate_jacobi = directives.UpdatePreconditioner(update_every_iteration=True)\nstarting_beta = directives.BetaEstimate_ByEig(beta0_ratio=10)\nbeta_schedule = directives.BetaSchedule(coolingFactor=2.0, coolingRate=1)\ntarget_misfit = directives.TargetMisfit(chifact=1.0)\n\ndirectives_list_L2 = [\n    sensitivity_weights,\n    update_jacobi,\n    starting_beta,\n    beta_schedule,\n    target_misfit,\n]","key":"sGkI5FQWBe"},{"type":"output","id":"bvHSH3JnCzDoDkVbPJPrT","data":[],"key":"NmDuJ6bxd4"}],"key":"xvggyWhMG8"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bZlLOSGb0H"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion","implicit":true,"key":"Epw0YV7PyG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We define the inversion using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"laxt3QEEXz"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.inversion.BaseInversion.html#simpeg.inversion.baseinversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BaseInversion","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U3T16oEYWC"}],"urlSource":"myst:simpeg#simpeg.inversion.BaseInversion","internal":false,"protocol":"xref:sphinx","key":"DIBHCuf17I"},{"type":"text","value":" class. The inversion class must be instantiated with an appropriate ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"srKl5qNjPB"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"inverse problem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uimaY5Er0r"}],"key":"lygk4y2x2t"},{"type":"text","value":" object and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wfMGpHwvoJ"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"directives list","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ly2fmwPI1M"}],"key":"kfcWSJiQVw"},{"type":"text","value":". The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UT9tgaGO97"},{"type":"inlineCode","value":"run","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A0VY7Liukm"},{"type":"text","value":" method, along with a starting model, is respondible for running the inversion. The output is a 1D numpy.ndarray containing the recovered model parameters","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Bu9efQ1DdE"}],"key":"W4vkWFSnxD"}],"key":"OcecxbsXm0"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:35.619925Z","iopub.status.busy":"2024-07-24T17:50:35.619475Z","iopub.status.idle":"2024-07-24T17:50:41.439734Z","shell.execute_reply":"2024-07-24T17:50:41.438631Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Here we combine the inverse problem and the set of directives\ninv_L2 = inversion.BaseInversion(inv_prob_L2, directives_list_L2)\n\n# Run inversion\nrecovered_tensor_model = inv_L2.run(starting_tensor_model)","key":"GYr1s7ceuW"},{"type":"output","id":"WCcGnF82Vp5wd2n3O7kFa","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\n\n                    simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                    ***Done using the default solver Pardiso and no solver_opts.***\n                    \n"},{"name":"stdout","output_type":"stream","text":"model has any nan: 0\n============================ Inexact Gauss Newton ============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  8.32e+03  5.58e+04  6.08e-07  5.58e+04    2.09e+05      0              \n"},{"name":"stderr","output_type":"stream","text":"/home/ssoler/mambaforge/envs/simpeg-user-tutorials/lib/python3.10/site-packages/simpeg/optimization.py:1072: UserWarning: tol is not a valid keyword for cg and will be ignored\n  Hinv = SolverICG(\n"},{"name":"stdout","output_type":"stream","text":"   1  4.16e+03  2.22e+04  1.25e+00  2.74e+04    4.98e+04      0              \n"},{"name":"stdout","output_type":"stream","text":"   2  2.08e+03  1.48e+04  2.52e+00  2.00e+04    3.74e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  1.04e+03  8.73e+03  4.59e+00  1.35e+04    2.65e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   4  5.20e+02  4.53e+03  7.43e+00  8.39e+03    1.75e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   5  2.60e+02  2.12e+03  1.07e+01  4.89e+03    1.08e+04      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   6  1.30e+02  9.60e+02  1.37e+01  2.74e+03    6.32e+03      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   7  6.50e+01  4.63e+02  1.64e+01  1.52e+03    3.55e+03      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 \u003c= tolF*(1+|f0|) = 5.5789e+03\n1 : |xc-x_last| = 5.3003e-02 \u003c= tolX*(1+|x0|) = 1.0002e-01\n0 : |proj(x-g)-x|    = 3.5454e+03 \u003c= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 3.5454e+03 \u003c= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    \u003c= iter          =      8\n------------------------- DONE! -------------------------\n"}],"key":"ggMOCQrgON"}],"key":"ScZuutz27x"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IFHza8mYVS"}],"identifier":"plot-the-data-misfit","label":"Plot the Data Misfit","html_id":"plot-the-data-misfit","implicit":true,"key":"ptfaTHcJY2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This step is necessary for determining whether the recovered model accurately reproduces observed anomalies. Here, we plot the observed data, predicted data for the recovered model, and the misfit. As we can see, the predicted data fits the background somewhat better than the anomalies. As a result, you may reassign smaller uncertainties in these areas and re-run the inversion in order to better fit the anomalies. We will do this for the iteratively reweighted least-squares inversion.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Pvhg8S4VcQ"}],"key":"VYE5kJ21lx"}],"key":"hcxBGpINqd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:41.445364Z","iopub.status.busy":"2024-07-24T17:50:41.443508Z","iopub.status.idle":"2024-07-24T17:50:41.907631Z","shell.execute_reply":"2024-07-24T17:50:41.906997Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Predicted data with final recovered model.\ndpred = inv_prob_L2.dpred\n\n# Observed data | Predicted data | Data misfit\ndata_array = np.c_[dobs, dpred, dobs - dpred]\n\nfig = plt.figure(figsize=(12, 5))\nplot_title = [\"Observed\", \"Predicted\", \"Data Misfit\"]\nplot_units = [\"mGal\", \"mGal\", \"mGal\"]\n\nax1 = 3 * [None]\nax2 = 3 * [None]\nnorm = 3 * [None]\ncbar = 3 * [None]\ncplot = 3 * [None]\nv_lim = [np.max(np.abs(dobs)), np.max(np.abs(dobs)), np.max(np.abs(dobs - dpred))]\n\nfor ii in range(0, 3):\n    ax1[ii] = fig.add_axes([0.3 * ii + 0.1, 0.2, 0.27, 0.75])\n    norm[ii] = mpl.colors.Normalize(vmin=-v_lim[ii], vmax=v_lim[ii])\n    cplot[ii] = plot2Ddata(\n        receiver_list[0].locations,\n        data_array[:, ii],\n        ax=ax1[ii],\n        ncontour=30,\n        contourOpts={\"cmap\": \"bwr\", \"norm\": norm[ii]},\n    )\n    ax1[ii].set_title(plot_title[ii])\n    ax1[ii].set_xlabel(\"x (m)\")\n    if ii == 0:\n        ax1[ii].set_ylabel(\"y (m)\")\n    else:\n        ax1[ii].set_yticks([])\n\n    ax2[ii] = fig.add_axes([0.3 * ii + 0.1, 0.05, 0.27, 0.05])\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"horizontal\", cmap=mpl.cm.bwr\n    )\n    cbar[ii].ax.locator_params(nbins=3)\n    cbar[ii].set_label(plot_units[ii], labelpad=5)\n\nplt.show()","key":"mQiUocpqXQ"},{"type":"output","id":"Jkn1st-ruRBzb9VrAsJad","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"dbc0d62577be40427df1291063fdb8c0","path":"/user-tutorials/build/dbc0d62577be40427df1291063fdb8c0.png"},"text/plain":{"content":"\u003cFigure size 1200x500 with 6 Axes\u003e","content_type":"text/plain"}}}],"key":"lqJr1hIJRN"}],"key":"iZJBL81P8y"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Recovered Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JtwQ8N3QJR"}],"identifier":"plot-the-recovered-model","label":"Plot the Recovered Model","html_id":"plot-the-recovered-model","implicit":true,"key":"UdbP0lrOOn"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As we can see, weighted least-squares regularization leads to the recovery of smooth models. And even with sensitivity weighting, there is a tendancy for gravity anomaly inversion to place recovered structures near the Earth’s surface.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mmkI8drWUM"}],"key":"do0sRHo8wS"}],"key":"ZFo7u7Xe2Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:41.910690Z","iopub.status.busy":"2024-07-24T17:50:41.910363Z","iopub.status.idle":"2024-07-24T17:50:42.091377Z","shell.execute_reply":"2024-07-24T17:50:42.090635Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot Recovered Model\nfig = plt.figure(figsize=(7, 3))\nax1 = fig.add_axes([0.1, 0.1, 0.73, 0.8])\n\nnorm = mpl.colors.Normalize(\n    vmin=np.min(recovered_tensor_model), vmax=np.max(recovered_tensor_model)\n)\ntensor_mesh.plot_slice(\n    tensor_plotting_map * recovered_tensor_model,\n    normal=\"Y\",\n    ax=ax1,\n    ind=int(tensor_mesh.shape_cells[1] / 2),\n    grid=False,\n    pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm},\n)\nax1.set_title(\"Model slice at y = 0 m\")\n\nax2 = fig.add_axes([0.85, 0.1, 0.03, 0.8])\ncbar = mpl.colorbar.ColorbarBase(\n    ax2, norm=norm, orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n)\ncbar.set_label(\"$g/cm^3$\", rotation=270, labelpad=15, size=16)\n\nplt.show()","key":"fnprXFgTL4"},{"type":"output","id":"-aJEctKnaguOoj5d5t59q","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"975a831f19b18935fe5dde45efcbf15e","path":"/user-tutorials/build/975a831f19b18935fe5dde45efcbf15e.png"},"text/plain":{"content":"\u003cFigure size 700x300 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"cbvNt5bQyJ"}],"key":"hr584b1u5R"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Iteratively Re-weighted Least-Squares (IRLS) Inversion on a Tree Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o9fZmokumT"}],"identifier":"iteratively-re-weighted-least-squares-irls-inversion-on-a-tree-mesh","label":"Iteratively Re-weighted Least-Squares (IRLS) Inversion on a Tree Mesh","html_id":"iteratively-re-weighted-least-squares-irls-inversion-on-a-tree-mesh","implicit":true,"key":"qrxP4XfP9z"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we provide a step-by-step best-practices approach for iteratively IRLS inversion of gravity anomaly data on a tree mesh. Many of the steps are the same as our previous approach. As a result, we will avoid repeating information whenever possible. For the tutorial example, any datum whose normalized data misfit is outside of (-2, 2) will have its uncertainty decreased by a factor of 2.5. This choice was problem dependent!","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wuMOFcJTga"}],"key":"EJa0a6JxZR"}],"key":"WR05j3glZ2"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reassign the Uncertainties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vwNf6fFx1q"}],"identifier":"reassign-the-uncertainties","label":"Reassign the Uncertainties","html_id":"reassign-the-uncertainties","implicit":true,"key":"jVN814GHRO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Prior to performing the IRLS inversion, we decrease the uncertainties at the locations we observed the largest data misfits. Here, our goal is to recover a model that better fits the anomalies.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oSeAuehUTZ"}],"key":"u6uddtSmQw"}],"key":"T23edj70QS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.096895Z","iopub.status.busy":"2024-07-24T17:50:42.096661Z","iopub.status.idle":"2024-07-24T17:50:42.099979Z","shell.execute_reply":"2024-07-24T17:50:42.099362Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute normalized data misfits\nnormalized_data_misfits = (dobs - dpred) / uncertainties","key":"OASBEgeFbg"},{"type":"output","id":"DRE-_eEowng3kyCxExGjJ","data":[],"key":"LYTEzUHgIB"}],"key":"JjD9zrZvDh"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.105491Z","iopub.status.busy":"2024-07-24T17:50:42.105193Z","iopub.status.idle":"2024-07-24T17:50:42.225438Z","shell.execute_reply":"2024-07-24T17:50:42.224841Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the normalized data misfits\nfig = plt.figure(figsize=(6, 3))\nax = fig.add_subplot(111)\nax.plot(np.sort(normalized_data_misfits))\nax.set_title(\"Normalized Data Misfits (sorted)\")\nax.grid()\nplt.show(fig)","key":"IZFG21vd8T"},{"type":"output","id":"lxpqLcwOFBUxdeNms_6ps","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4196f1a825382912512c2252dd138e40","path":"/user-tutorials/build/4196f1a825382912512c2252dd138e40.png"},"text/plain":{"content":"\u003cFigure size 600x300 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"d12Ujlw2wI"}],"key":"MGO1YaDz13"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.229086Z","iopub.status.busy":"2024-07-24T17:50:42.228851Z","iopub.status.idle":"2024-07-24T17:50:42.232800Z","shell.execute_reply":"2024-07-24T17:50:42.232119Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Generate new uncertainties\nnew_uncertainties = uncertainties.copy()\nnew_uncertainties[np.abs(normalized_data_misfits) \u003e 2.0] /= 2.5","key":"ej7GXt9fED"},{"type":"output","id":"VGPscd5XCbSQaJPsNApb8","data":[],"key":"xy0q9WUj79"}],"key":"m6SAKwrOmq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.236283Z","iopub.status.busy":"2024-07-24T17:50:42.235989Z","iopub.status.idle":"2024-07-24T17:50:42.239516Z","shell.execute_reply":"2024-07-24T17:50:42.238990Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Generate new data object\nnew_data_object = data.Data(survey, dobs=dobs, standard_deviation=new_uncertainties)","key":"yeEeZJxaEb"},{"type":"output","id":"6TjCojdzEQVO4Mi_o_Jhk","data":[],"key":"yA0VD7GTVX"}],"key":"b63zvEyjUc"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tree) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rS4DvybBgS"}],"identifier":"design-a-tree-mesh","label":"Design a (Tree) Mesh","html_id":"design-a-tree-mesh","implicit":true,"key":"grIUUgw2p6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we design a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PL29VJXUXj"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tree mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U6Gqemr8OS"}],"urlSource":"myst:discretize#discretize.TreeMesh","internal":false,"protocol":"xref:sphinx","key":"CRyfovR3Xu"},{"type":"text","value":". See the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jt4M21hTsm"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize user tutorials","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hIikqKlsgS"}],"urlSource":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","key":"tfyIYzjazn"},{"type":"text","value":" to learn more about creating tree meshes. The same approach used to construct the tensor mesh used in the weighted least-squares inversion example applies to tree meshes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ByIIEBRQBf"}],"key":"c9vb5DZkEh"}],"key":"SYO0ZnmEQA"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.242874Z","iopub.status.busy":"2024-07-24T17:50:42.242591Z","iopub.status.idle":"2024-07-24T17:50:42.540246Z","shell.execute_reply":"2024-07-24T17:50:42.539356Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dx = 5  # minimum cell width (base tree_mesh cell width) in x\ndy = 5  # minimum cell width (base tree_mesh cell width) in y\ndz = 5  # minimum cell width (base tree_mesh cell width) in z\n\nx_length = 240.0  # domain width in x\ny_length = 240.0  # domain width in y\nz_length = 120.0  # domain width in z\n\n# Compute number of base tree_mesh cells required in x and y\nnbcx = 2 ** int(np.round(np.log(x_length / dx) / np.log(2.0)))\nnbcy = 2 ** int(np.round(np.log(y_length / dy) / np.log(2.0)))\nnbcz = 2 ** int(np.round(np.log(z_length / dz) / np.log(2.0)))\n\n# Define the base tree_mesh\nhx = [(dx, nbcx)]\nhy = [(dy, nbcy)]\nhz = [(dz, nbcz)]\ntree_mesh = TreeMesh([hx, hy, hz], x0=\"CCN\")\n\n# Shift vertically to top same as maximum topography\ntree_mesh.origin += np.r_[0.0, 0.0, topo_xyz[:, -1].max()]\n\n# Refine based on surface topography\ntree_mesh.refine_surface(topo_xyz, padding_cells_by_level=[2, 2], finalize=False)\n\n# Refine box based on region of interest\nwsb_corner = np.c_[-100, -100, 20]\nent_corner = np.c_[100, 100, 100]\n# Note -1 is a flag for smallest cell size\ntree_mesh.refine_box(wsb_corner, ent_corner, levels=[-1], finalize=False)\n\ntree_mesh.finalize()","key":"QkVgksaGKM"},{"type":"output","id":"sM-rAQCh3yq7wvNhn_Hj-","data":[],"key":"O9CXdV704w"}],"key":"LscXDc2Sl6"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BmuBXNLTnz"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells-1","implicit":true,"key":"xxDDvfng2Q"}],"key":"mjYkVQttqP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.544638Z","iopub.status.busy":"2024-07-24T17:50:42.544384Z","iopub.status.idle":"2024-07-24T17:50:42.597733Z","shell.execute_reply":"2024-07-24T17:50:42.597087Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"active_tree_cells = active_from_xyz(tree_mesh, topo_xyz)\nn_tree_active = int(active_tree_cells.sum())","key":"vh3fXNSLe1"},{"type":"output","id":"Sj6_rKu3im0RqHQkA1ZWJ","data":[],"key":"qCgO7a2MCa"}],"key":"LPNRITWbHO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from Model to Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YyB1epslBL"}],"identifier":"mapping-from-model-to-active-cells","label":"Mapping from Model to Active Cells","html_id":"mapping-from-model-to-active-cells","implicit":true,"key":"efvPrxCP4u"}],"key":"WBGZ46LSK9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.602572Z","iopub.status.busy":"2024-07-24T17:50:42.602317Z","iopub.status.idle":"2024-07-24T17:50:42.606142Z","shell.execute_reply":"2024-07-24T17:50:42.605519Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tree_model_map = maps.IdentityMap(nP=n_tree_active)","key":"VvChTcDx64"},{"type":"output","id":"57yPlx2HHXlPYGDGUpBce","data":[],"key":"nm7kOlv6Tw"}],"key":"WlWaj9rkvg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Starting and Reference Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BzjeSFT1dt"}],"identifier":"starting-and-reference-models","label":"Starting and Reference Models","html_id":"starting-and-reference-models","implicit":true,"key":"b8boHVgg64"}],"key":"rVM9KR84Zy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.611118Z","iopub.status.busy":"2024-07-24T17:50:42.610871Z","iopub.status.idle":"2024-07-24T17:50:42.614968Z","shell.execute_reply":"2024-07-24T17:50:42.614229Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"starting_tree_model = 1e-6 * np.ones(n_tree_active)\nreference_tree_model = np.zeros_like(starting_tree_model)","key":"mg2jkkOL8c"},{"type":"output","id":"SDP8VIaQbdnf2jWT99tRA","data":[],"key":"tOxrVT64kS"}],"key":"yjLJC7nqTU"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"totTJuQV05"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation-1","implicit":true,"key":"xHRry2D1ox"}],"key":"BwPtt59erM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.618456Z","iopub.status.busy":"2024-07-24T17:50:42.618145Z","iopub.status.idle":"2024-07-24T17:50:42.681047Z","shell.execute_reply":"2024-07-24T17:50:42.680116Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation_irls = gravity.simulation.Simulation3DIntegral(\n    survey=survey, mesh=tree_mesh, rhoMap=tree_model_map, ind_active=active_tree_cells\n)","key":"XoENQfpriq"},{"type":"output","id":"iLSPYbWa7lvbvSe86-CCY","data":[],"key":"RiPvUPqXHI"}],"key":"MoOY5kEjVb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wan0ZGY1ga"}],"identifier":"define-data-misfit","label":"Define Data Misfit","html_id":"define-data-misfit","implicit":true,"key":"gSr22aifta"}],"key":"fkSgYfTULU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.685756Z","iopub.status.busy":"2024-07-24T17:50:42.685491Z","iopub.status.idle":"2024-07-24T17:50:42.689694Z","shell.execute_reply":"2024-07-24T17:50:42.689094Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dmis_irls = data_misfit.L2DataMisfit(data=new_data_object, simulation=simulation_irls)","key":"XncVjpkj6l"},{"type":"output","id":"tvTs5FUE0fZyxZNC4orBV","data":[],"key":"OepQiaqQCt"}],"key":"YvwMK6vsix"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Regularization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z8ci68pp5A"}],"identifier":"define-the-regularization","label":"Define the Regularization","html_id":"define-the-regularization-1","implicit":true,"key":"OshBMNFNVb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TGj20gEoJS"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.regularization.Sparse.html#simpeg.regularization.sparse","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Sparse","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KDyqqoJBsd"}],"urlSource":"myst:simpeg#simpeg.regularization.Sparse","internal":false,"protocol":"xref:sphinx","key":"EMO2eBos5e"},{"type":"text","value":" regularization class to constrain the inversion result using an IRLS approach. Here, the scaling constants that balance the smallness and smoothness terms are set directly. Equal emphasis on smallness and smoothness is generally applied by using the inverse square of the smallest cell dimension. The reference model is only applied to the smallness term; which is redundant for the tutorial example since we have set the reference model to an array of zeros. Here, we apply a 0-norm to the smallness term and a 1-norm to first-order smoothness along the x, y and z directions.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rGbpUeeriI"}],"key":"U896pYJRrm"}],"key":"gSzgbnaVsD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.693612Z","iopub.status.busy":"2024-07-24T17:50:42.693372Z","iopub.status.idle":"2024-07-24T17:50:42.754759Z","shell.execute_reply":"2024-07-24T17:50:42.753782Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"reg_irls = regularization.Sparse(\n    tree_mesh,\n    active_cells=active_tree_cells,\n    alpha_s=dh**-2,\n    alpha_x=1,\n    alpha_y=1,\n    alpha_z=1,\n    reference_model=reference_tree_model,\n    reference_model_in_smooth=False,\n    norms=[0, 1, 1, 1],\n)","key":"Agc6ep5xeY"},{"type":"output","id":"m3Onc0cvcthbJv9wyWvLG","data":[],"key":"V9LiqQYi3B"}],"key":"gYfYwV9PbN"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Optimization Algorithm","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ID5qxIwR6q"}],"identifier":"define-the-optimization-algorithm","label":"Define the Optimization Algorithm","html_id":"define-the-optimization-algorithm-1","implicit":true,"key":"FOs9qRvvV3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tOzzTFECiy"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.optimization.ProjectedGNCG.html#simpeg.optimization.projectedgncg","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"ProjectedGNCG","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"twucPYA7Q5"}],"urlSource":"myst:simpeg#simpeg.optimization.ProjectedGNCG","internal":false,"protocol":"xref:sphinx","key":"fDmg2ioqBa"},{"type":"text","value":" class to solve the optimization problem using projected Gauss-Newton conjugate gradient. This opimization class allows the user to set upper and lower bounds for the recovered model using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jc2b0EEVMb"},{"type":"inlineCode","value":"upper","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZkoYhyGovN"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CluybMYSez"},{"type":"inlineCode","value":"lower","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TJGPxOstIk"},{"type":"text","value":" properties.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yh7Vok6HrY"}],"key":"VleN8t1fXU"}],"key":"COFSJ3rCKu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.759223Z","iopub.status.busy":"2024-07-24T17:50:42.758984Z","iopub.status.idle":"2024-07-24T17:50:42.763350Z","shell.execute_reply":"2024-07-24T17:50:42.762674Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"opt_irls = optimization.ProjectedGNCG(\n    maxIter=100, lower=-1.0, upper=1.0, maxIterLS=20, maxIterCG=10, tolCG=1e-2\n)","key":"EQR6iPRMg7"},{"type":"output","id":"qDCZQC9baG0Z5936zfx-R","data":[],"key":"H9BGjiGVN7"}],"key":"Tj6Wa3Pta2"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Inverse Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HT0eh9R1qK"}],"identifier":"define-the-inverse-problem","label":"Define the Inverse Problem","html_id":"define-the-inverse-problem-1","implicit":true,"key":"m4QSq4vEy5"}],"key":"r3wk6QOhj3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.767534Z","iopub.status.busy":"2024-07-24T17:50:42.767213Z","iopub.status.idle":"2024-07-24T17:50:42.771180Z","shell.execute_reply":"2024-07-24T17:50:42.770461Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_prob_irls = inverse_problem.BaseInvProblem(dmis_irls, reg_irls, opt_irls)","key":"oB4P9y4YWD"},{"type":"output","id":"OFffeOG3LDLA60Hp9Bczr","data":[],"key":"ISZJUDNO9b"}],"key":"fqj9ciWDJa"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Provide Inversion Directives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pqasLNSpLC"}],"identifier":"provide-inversion-directives","label":"Provide Inversion Directives","html_id":"provide-inversion-directives-1","implicit":true,"key":"HpKLx7Zwxr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we create common directives for IRLS inversion of gravity data and describe their roles. In additon to the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JDlvvLmTFD"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdateSensitivityWeights.html#simpeg.directives.updatesensitivityweights","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"UpdateSensitivityWeights","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Utk2UIkVia"}],"urlSource":"myst:simpeg#simpeg.directives.UpdateSensitivityWeights","internal":false,"protocol":"xref:sphinx","key":"Wj1tpUo41V"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"niWMzsGV9J"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.UpdatePreconditioner.html#simpeg.directives.updatepreconditioner","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"UpdatePreconditioner","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JSI1U3ZKvP"}],"urlSource":"myst:simpeg#simpeg.directives.UpdatePreconditioner","internal":false,"protocol":"xref:sphinx","key":"UNvoZss9Oz"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NXVGuhIkg6"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaEstimate_ByEig.html#simpeg.directives.betaestimate_byeig","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"BetaEstimate_ByEig","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U8MyuiH3UW"}],"urlSource":"myst:simpeg#simpeg.directives.BetaEstimate_ByEig","internal":false,"protocol":"xref:sphinx","key":"DOZb4XF0rH"},{"type":"text","value":"  (described before), inversion with sparse-norms requires the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HLIyHo87H8"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Update_IRLS","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gWfQ6qWe5x"}],"urlSource":"myst:simpeg#simpeg.directives.Update_IRLS","internal":false,"protocol":"xref:sphinx","key":"mzFMr00Jvu"},{"type":"text","value":" directive.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rpRYXpDIma"}],"key":"LyTLwcxSmP"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"You will notice that we don’t use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YUz9S30Gt5"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.BetaSchedule.html#simpeg.directives.betaschedule","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"BetaSchedule","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xjsBsimzoI"}],"urlSource":"myst:simpeg#simpeg.directives.BetaSchedule","internal":false,"protocol":"xref:sphinx","key":"WRZ3qPMdZ7"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QqE55dnFHu"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.TargetMisfit.html#simpeg.directives.targetmisfit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"TargetMisfit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e1BIQeSBXf"}],"urlSource":"myst:simpeg#simpeg.directives.TargetMisfit","internal":false,"protocol":"xref:sphinx","key":"N5i43rVVrk"},{"type":"text","value":" directives. Here, the beta cooling schedule is set in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NatiHGKLvO"},{"type":"link","url":"https://docs.simpeg.xyz/latest/content/api/generated/simpeg.directives.Update_IRLS.html#simpeg.directives.update_irls","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Update_IRLS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IqyWD8YxtX"}],"urlSource":"myst:simpeg#simpeg.directives.Update_IRLS","internal":false,"protocol":"xref:sphinx","key":"KqbSdPJoeH"},{"type":"text","value":" directive using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ymRMQFiyJl"},{"type":"inlineCode","value":"coolingFactor","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FOx493Qu4l"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gVzOP9DS4f"},{"type":"inlineCode","value":"coolingRate","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DihKep92yF"},{"type":"text","value":" properties. The target misfit for the L2 portion of the IRLS approach is set with the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nSgi10YwSH"},{"type":"inlineCode","value":"chifact_start","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ch85okvZye"},{"type":"text","value":" property.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CSQyhQHUEX"}],"key":"Jxb8swLYvx"}],"key":"RkIniLWmyU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.774758Z","iopub.status.busy":"2024-07-24T17:50:42.774451Z","iopub.status.idle":"2024-07-24T17:50:42.780562Z","shell.execute_reply":"2024-07-24T17:50:42.779928Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"sensitivity_weights_irls = directives.UpdateSensitivityWeights(every_iteration=False)\nstarting_beta_irls = directives.BetaEstimate_ByEig(beta0_ratio=10)\nupdate_jacobi_irls = directives.UpdatePreconditioner(update_every_iteration=True)\nupdate_irls = directives.Update_IRLS(\n    coolingFactor=2,\n    coolingRate=1,\n    chifact_start=1.0,\n    f_min_change=1e-4,\n    max_irls_iterations=25,\n)\n\ndirectives_list_irls = [\n    update_irls,\n    sensitivity_weights_irls,\n    starting_beta_irls,\n    update_jacobi_irls,\n]","key":"rdNghMocqv"},{"type":"output","id":"tE-kg2-K_lIitQxnT-742","data":[],"key":"zSM1Rjw0y2"}],"key":"T4wP3KGwHz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define and Run the Inversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GoMEXM4SGK"}],"identifier":"define-and-run-the-inversion","label":"Define and Run the Inversion","html_id":"define-and-run-the-inversion-1","implicit":true,"key":"eWwTCYs1Up"}],"key":"Ou7F74IbDc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:50:42.784574Z","iopub.status.busy":"2024-07-24T17:50:42.784349Z","iopub.status.idle":"2024-07-24T17:51:03.370386Z","shell.execute_reply":"2024-07-24T17:51:03.369483Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"inv_irls = inversion.BaseInversion(inv_prob_irls, directives_list_irls)\nrecovered_tree_model = inv_irls.run(starting_tree_model)","key":"Q6zIhUchqc"},{"type":"output","id":"lZac0JZu_JM_Dpmq9G8iO","data":[{"name":"stdout","output_type":"stream","text":"\nRunning inversion with SimPEG v0.22.1\n\n                    simpeg.InvProblem is setting bfgsH0 to the inverse of the eval2Deriv.\n                    ***Done using the default solver Pardiso and no solver_opts.***\n                    \n"},{"name":"stdout","output_type":"stream","text":"model has any nan: 0\n=============================== Projected GNCG ===============================\n  #     beta     phi_d     phi_m       f      |proj(x-g)-x|  LS    Comment   \n-----------------------------------------------------------------------------\nx0 has any nan: 0\n   0  5.66e+06  1.17e+05  1.34e-08  1.17e+05    1.99e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   1  2.83e+06  9.76e+04  1.53e-03  1.02e+05    1.98e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"   2  1.42e+06  8.57e+04  4.61e-03  9.23e+04    1.97e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   3  7.08e+05  7.04e+04  1.25e-02  7.93e+04    1.97e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   4  3.54e+05  5.31e+04  3.02e-02  6.38e+04    1.96e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   5  1.77e+05  3.60e+04  6.49e-02  4.75e+04    1.94e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   6  8.84e+04  2.14e+04  1.24e-01  3.23e+04    1.93e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   7  4.42e+04  1.10e+04  2.07e-01  2.01e+04    1.92e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   8  2.21e+04  4.93e+03  3.01e-01  1.16e+04    1.88e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"   9  1.11e+04  2.08e+03  3.90e-01  6.39e+03    1.80e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  10  5.53e+03  9.03e+02  4.63e-01  3.46e+03    1.68e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  11  2.76e+03  4.42e+02  5.20e-01  1.88e+03    1.55e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"Reached starting chifact with l2-norm regularization: Start IRLS steps...\nirls_threshold 0.03781349714154632\n"},{"name":"stdout","output_type":"stream","text":"  12  1.38e+03  2.52e+02  9.07e-01  1.51e+03    1.21e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  13  2.47e+03  1.83e+02  1.15e+00  3.02e+03    1.74e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  14  2.03e+03  3.25e+02  1.09e+00  2.53e+03    1.36e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  15  2.03e+03  2.73e+02  1.19e+00  2.68e+03    1.57e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  16  2.03e+03  3.04e+02  1.19e+00  2.73e+03    1.51e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  17  2.03e+03  3.17e+02  1.19e+00  2.74e+03    1.51e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  18  1.64e+03  3.34e+02  1.17e+00  2.25e+03    1.05e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  19  1.64e+03  3.08e+02  1.15e+00  2.19e+03    1.48e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  20  1.35e+03  3.21e+02  1.11e+00  1.82e+03    1.00e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  21  1.35e+03  3.02e+02  1.06e+00  1.73e+03    1.46e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  22  1.35e+03  3.10e+02  9.99e-01  1.66e+03    1.48e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  23  1.12e+03  3.18e+02  9.62e-01  1.40e+03    1.11e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  24  1.12e+03  3.04e+02  9.28e-01  1.34e+03    1.44e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  25  1.12e+03  3.09e+02  8.80e-01  1.29e+03    1.46e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  26  1.12e+03  3.13e+02  8.31e-01  1.24e+03    1.44e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  27  1.12e+03  3.17e+02  7.81e-01  1.19e+03    1.45e+02      0              \n"},{"name":"stdout","output_type":"stream","text":"  28  9.25e+02  3.20e+02  7.55e-01  1.02e+03    8.04e+01      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  29  9.25e+02  3.10e+02  7.11e-01  9.68e+02    1.38e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  30  9.25e+02  3.10e+02  6.62e-01  9.22e+02    1.40e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  31  9.25e+02  3.11e+02  6.32e-01  8.96e+02    1.39e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  32  9.25e+02  3.13e+02  5.75e-01  8.45e+02    1.36e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  33  9.25e+02  3.13e+02  5.29e-01  8.03e+02    1.33e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  34  9.25e+02  3.13e+02  5.10e-01  7.85e+02    1.31e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  35  9.25e+02  3.14e+02  4.77e-01  7.55e+02    1.26e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"  36  9.25e+02  3.13e+02  4.43e-01  7.23e+02    1.22e+02      0   Skip BFGS  \n"},{"name":"stdout","output_type":"stream","text":"Reach maximum number of IRLS cycles: 25\n------------------------- STOP! -------------------------\n1 : |fc-fOld| = 0.0000e+00 \u003c= tolF*(1+|f0|) = 1.1702e+04\n1 : |xc-x_last| = 4.6569e-02 \u003c= tolX*(1+|x0|) = 1.0002e-01\n0 : |proj(x-g)-x|    = 1.2210e+02 \u003c= tolG          = 1.0000e-01\n0 : |proj(x-g)-x|    = 1.2210e+02 \u003c= 1e3*eps       = 1.0000e-02\n0 : maxIter   =     100    \u003c= iter          =     37\n------------------------- DONE! -------------------------\n"}],"key":"ejDj0T14as"}],"key":"b8Wd2QXuRu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the Data Misfit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fz06Zx7MyK"}],"identifier":"plot-the-data-misfit","label":"Plot the Data Misfit","html_id":"plot-the-data-misfit-1","implicit":true,"key":"IS4AY10nXi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we plot the observed data, predicted and misfit for the IRLS inversion. As we can see from the misfit map, the observed data is now fit equally at all locations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KqXhqq2MWm"}],"key":"KdVXJlolAi"}],"key":"DAuuShtDs1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:51:03.375741Z","iopub.status.busy":"2024-07-24T17:51:03.373941Z","iopub.status.idle":"2024-07-24T17:51:03.840964Z","shell.execute_reply":"2024-07-24T17:51:03.839875Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Predicted data with final recovered model.\ndpred_new = inv_prob_irls.dpred\n\n# Observed data | Predicted data | Data misfit\ndata_array = np.c_[dobs, dpred_new, dobs - dpred_new]\n\nfig = plt.figure(figsize=(12, 5))\nplot_title = [\"Observed\", \"Predicted\", \"Data Misfit\"]\nplot_units = [\"mGal\", \"mGal\", \"mGal\"]\n\nax1 = 3 * [None]\nax2 = 3 * [None]\nnorm = 3 * [None]\ncbar = 3 * [None]\ncplot = 3 * [None]\nv_lim = [np.max(np.abs(dobs)), np.max(np.abs(dobs)), np.max(np.abs(dobs - dpred_new))]\n\nfor ii in range(0, 3):\n    ax1[ii] = fig.add_axes([0.3 * ii + 0.1, 0.2, 0.27, 0.75])\n    norm[ii] = mpl.colors.Normalize(vmin=-v_lim[ii], vmax=v_lim[ii])\n    cplot[ii] = plot2Ddata(\n        receiver_list[0].locations,\n        data_array[:, ii],\n        ax=ax1[ii],\n        ncontour=30,\n        contourOpts={\"cmap\": \"bwr\", \"norm\": norm[ii]},\n    )\n    ax1[ii].set_title(plot_title[ii])\n    ax1[ii].set_xlabel(\"x (m)\")\n    if ii == 0:\n        ax1[ii].set_ylabel(\"y (m)\")\n    else:\n        ax1[ii].set_yticks([])\n\n    ax2[ii] = fig.add_axes([0.3 * ii + 0.1, 0.05, 0.27, 0.05])\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"horizontal\", cmap=mpl.cm.bwr\n    )\n    cbar[ii].ax.locator_params(nbins=3)\n    cbar[ii].set_label(plot_units[ii], labelpad=5)\n\nplt.show()","key":"U0w9oJKe4g"},{"type":"output","id":"O6G3qlgSh_0UO3loTwy5f","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5af2221ebe833732004fbc1e7f34754e","path":"/user-tutorials/build/5af2221ebe833732004fbc1e7f34754e.png"},"text/plain":{"content":"\u003cFigure size 1200x500 with 6 Axes\u003e","content_type":"text/plain"}}}],"key":"R9KxsOmODX"}],"key":"JoqfBAh4oa"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot True, L2 and IRLS Models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i5avDCcxZf"}],"identifier":"plot-true-l2-and-irls-models","label":"Plot True, L2 and IRLS Models","html_id":"plot-true-l2-and-irls-models","implicit":true,"key":"GK34YS8oeO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here, we compare the models recovered from weighted least-squares and iteratively re-weighted least-squares inversion to the true model.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X21bDzw56l"}],"key":"BEQ6cqnfgG"}],"key":"MFBgPfgHTN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:51:03.845460Z","iopub.status.busy":"2024-07-24T17:51:03.845096Z","iopub.status.idle":"2024-07-24T17:51:03.857965Z","shell.execute_reply":"2024-07-24T17:51:03.856941Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Recreate True Model on a Tensor Mesh\nbackground_density = 0.0\nblock_density = -0.2\nsphere_density = 0.2\n\ntrue_model = background_density * np.ones(n_tensor_active)\n\nind_block = model_builder.get_indices_block(\n    [-50, -15, 50], [-20, 15, 70], tensor_mesh.cell_centers[active_tensor_cells]\n)\ntrue_model[ind_block] = block_density\n\nind_sphere = model_builder.get_indices_sphere(\n    np.r_[35.0, 0.0, 60.0], 14.0, tensor_mesh.cell_centers[active_tensor_cells]\n)\ntrue_model[ind_sphere] = sphere_density","key":"ZW1gCvsj0I"},{"type":"output","id":"Gzzn63ivIzPLeejqqzABi","data":[],"key":"jYVEMiHhCc"}],"key":"kbSJVkmmGz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-24T17:51:03.861366Z","iopub.status.busy":"2024-07-24T17:51:03.861133Z","iopub.status.idle":"2024-07-24T17:51:04.373352Z","shell.execute_reply":"2024-07-24T17:51:04.372738Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot all models\nmesh_list = [tensor_mesh, tensor_mesh, tree_mesh]\nind_list = [active_tensor_cells, active_tensor_cells, active_tree_cells]\nmodel_list = [true_model, recovered_tensor_model, recovered_tree_model]\ntitle_list = [\"True Model\", \"L2 Tensor Model\", \"IRLS Tree Model\"]\ncplot = 3 * [None]\ncbar = 3 * [None]\nnorm = 3 * [None]\n\nfig = plt.figure(figsize=(7, 8))\nax1 = [fig.add_axes([0.1, 0.7 - 0.3 * ii, 0.75, 0.23]) for ii in range(0, 3)]\nax2 = [fig.add_axes([0.88, 0.7 - 0.3 * ii, 0.025, 0.23]) for ii in range(0, 3)]\n\nfor ii, mesh in enumerate(mesh_list):\n    plotting_map = maps.InjectActiveCells(mesh, ind_list[ii], np.nan)\n    max_abs = np.max(np.abs(model_list[ii]))\n    norm[ii] = mpl.colors.Normalize(vmin=-max_abs, vmax=max_abs)\n\n    cplot[ii] = mesh.plot_slice(\n        plotting_map * model_list[ii],\n        normal=\"Y\",\n        ax=ax1[ii],\n        ind=int(mesh.shape_cells[1] / 2),\n        grid=False,\n        pcolor_opts={\"cmap\": mpl.cm.RdYlBu_r, \"norm\": norm[ii]},\n    )\n    ax1[ii].set_xlim([-150, 150])\n    ax1[ii].set_ylim([topo_xyz[:, -1].max() - 100, topo_xyz[:, -1].max()])\n    if ii \u003c 2:\n        ax1[ii].set_xlabel(\"\")\n        ax1[ii].set_xticks([])\n    ax1[ii].set_title(title_list[ii])\n\n    cbar[ii] = mpl.colorbar.ColorbarBase(\n        ax2[ii], norm=norm[ii], orientation=\"vertical\", cmap=mpl.cm.RdYlBu_r\n    )\n    cbar[ii].set_label(\"$g/cm^3$\", labelpad=0)","key":"Y9eCLlsUqs"},{"type":"output","id":"AIzAJGzKc1Q_4O8SFtJf9","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7097d700ed56128bc35d6c70dbfd32c3","path":"/user-tutorials/build/7097d700ed56128bc35d6c70dbfd32c3.png"},"text/plain":{"content":"\u003cFigure size 700x800 with 6 Axes\u003e","content_type":"text/plain"}}}],"key":"vQjra7eATa"}],"key":"QaycGv1T79"}],"key":"v1dI5LvL3v"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"3D Forward Simulation of Gravity Gradiometry Data","url":"/fwd-gravity-gradiometry-3d","group":"SimPEG User Tutorials"},"next":{"title":"Magnetics","url":"/magnetics-index","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"},"project":{"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"subject":"SimPEG User Tutorials","title":"SimPEG User Tutorials","description":"SimPEG user tutorials","authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/simpeg/user-tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"references":{"python":{"url":"https://docs.python.org/3"},"numpy":{"url":"https://numpy.org/doc/stable"},"scipy":{"url":"https://docs.scipy.org/doc/scipy"},"matplotlib":{"url":"https://matplotlib.org/stable"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main"},"simpeg":{"url":"https://docs.simpeg.xyz/latest"},"geoana":{"url":"https://geoana.simpeg.xyz"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master"}},"thumbnail":"/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-f8431d25d6d77e8b4ff5cdccedc9d3e9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-a1a5f99158a0a16b320fa6421f91835e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-ec1d656f70f6b7344928d0bd60daaca1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/user-tutorials/build/manifest-AF659DBA.js";
import * as route0 from "/user-tutorials/build/root-MROHD4U6.js";
import * as route1 from "/user-tutorials/build/routes/$-INRYMPN2.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/user-tutorials/build/entry.client-J4K7GZUA.js");</script></body></html>