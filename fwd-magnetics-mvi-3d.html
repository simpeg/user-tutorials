<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models - SimPEG User Tutorials</title><meta property="og:title" content="3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models - SimPEG User Tutorials"/><meta name="generator" content="mystmd"/><meta name="description" content="SimPEG user tutorials"/><meta property="og:description" content="SimPEG user tutorials"/><meta name="keywords" content="geophysics, inversions, python, open-source"/><meta name="image" content="/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png"/><meta property="og:image" content="/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/user-tutorials/build/_assets/app-KFPMNUQ2.css"/><link rel="stylesheet" href="/user-tutorials/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="/myst-theme.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script defer="" data-domain="simpeg.xyz" src="https://plausible.io/js/plausible.js"></script><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/user-tutorials/"><div class="p-1 mr-3 dark:bg-white dark:rounded"><img src="/user-tutorials/build/simpeg-logo-8e384bdbcd0a580c9ad2f1e67fcc0bfe.png" class="h-9" alt="User Tutorials" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5">User Tutorials</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0" data-headlessui-state=""><div class="inline-block"><button class="inline-flex items-center justify-center w-full py-1 mx-2 font-medium rounded-md text-md text-stone-900 dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" id="headlessui-menu-button-:Rpiop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span>SimPEG</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="ml-2 -mr-1 text-violet-200 hover:text-violet-100"><path fill-rule="evenodd" d="M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div></div></div><div class="flex-grow block"></div><button class="theme rounded-full border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"><div class="relative" data-headlessui-state=""><div><button class="flex text-sm bg-transparent rounded-full focus:outline-none" id="headlessui-menu-button-:Rciop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open Menu</span><div class="flex items-center text-stone-200 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="p-1"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="hidden sm:block"><a href="https://mystmd.org/guide" target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 mx-1 mt-0 leading-none border rounded text-md border-stone-700 dark:border-white text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 hover:bg-neutral-100">Learn More</a></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white"><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a class="py-2 grow" href="/">SimPEG</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R5d8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R5d8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="SimPEG User Tutorials" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/user-tutorials/">SimPEG User Tutorials</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Gravity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/gravity-index">Gravity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rbd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rbd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Magnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/magnetics-index">Magnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rfd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rfd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Direct Current Resistivity" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/dcr-index">Direct Current Resistivity</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rjd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rjd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Induced Polarization" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/ip-index">Induced Polarization</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rnd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rnd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Frequency-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/fdem-index">Frequency-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rrd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rrd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Time-Domain Electromagnetics" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/user-tutorials/tdem-index">Time-Domain Electromagnetics</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rvd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rvd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-none pr-2 smallcaps">SimPEG User Tutorials</div><div class="flex-grow"></div><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer" class="opacity-50 hover:opacity-100 text-inherit hover:text-inherit" aria-label="Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mx-1"><title>Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)</title><path d="M12 2.2c2.7 0 5 1 7 2.9.9.9 1.6 2 2.1 3.1.5 1.2.7 2.4.7 3.8 0 1.3-.2 2.6-.7 3.8-.5 1.2-1.2 2.2-2.1 3.1-1 .9-2 1.7-3.2 2.2-1.2.5-2.5.7-3.7.7s-2.6-.3-3.8-.8c-1.2-.5-2.2-1.2-3.2-2.1s-1.6-2-2.1-3.2-.8-2.4-.8-3.7c0-1.3.2-2.5.7-3.7S4.2 6 5.1 5.1C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C5.6 7.1 5 8 4.6 9c-.4 1-.6 2-.6 3s.2 2.1.6 3c.4 1 1 1.8 1.8 2.6S8 19 9 19.4c1 .4 2 .6 3 .6s2.1-.2 3-.6c1-.4 1.9-1 2.7-1.8 1.5-1.5 2.3-3.3 2.3-5.6 0-1.1-.2-2.1-.6-3.1-.4-1-1-1.8-1.7-2.6C16.1 4.8 14.2 4 12 4zm-.1 6.4l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.5.3-1 .4-1.5.4-.9 0-1.6-.3-2.1-.8-.5-.6-.8-1.3-.8-2.3 0-.9.3-1.7.8-2.2.6-.6 1.3-.8 2.1-.8 1.2 0 2.1.4 2.6 1.4zm5.6 0l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.4.2-.9.3-1.4.3-.9 0-1.6-.3-2.1-.8s-.8-1.3-.8-2.2c0-.9.3-1.7.8-2.2.5-.5 1.2-.8 2-.8 1.2 0 2.1.4 2.6 1.4z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1"><title>Credit must be given to the creator</title><path d="M12 2.2c2.7 0 5 .9 6.9 2.8 1.9 1.9 2.8 4.2 2.8 6.9s-.9 5-2.8 6.8c-2 1.9-4.3 2.9-7 2.9-2.6 0-4.9-1-6.9-2.9-1.8-1.7-2.8-4-2.8-6.7s1-5 2.9-6.9C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C4.8 8 4 9.9 4 12c0 2.2.8 4 2.4 5.6C8 19.2 9.8 20 12 20c2.2 0 4.1-.8 5.7-2.4 1.5-1.5 2.3-3.3 2.3-5.6 0-2.2-.8-4.1-2.3-5.7C16.1 4.8 14.2 4 12 4zm2.6 5.6v4h-1.1v4.7h-3v-4.7H9.4v-4c0-.2.1-.3.2-.4.1-.2.2-.2.4-.2h4c.2 0 .3.1.4.2.2.1.2.2.2.4zm-4-2.5c0-.9.5-1.4 1.4-1.4s1.4.5 1.4 1.4c0 .9-.5 1.4-1.4 1.4s-1.4-.5-1.4-1.4z"></path></svg></a><a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer" title="Code License: MIT License (MIT)" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="mx-1 inline-block opacity-60 hover:opacity-100 hover:text-[#599F46]"><path d="M13.2 15.6c1.4-.5 2.1-1.6 2.1-3.3S13.8 8.9 12 8.9c-1.9 0-3.3 1.6-3.3 3.3 0 1.8.8 3 2.2 3.4l-2.3 5.9c-3.1-.8-6.3-4.6-6.3-9.3 0-5.5 4.3-10 9.7-10s9.8 4.5 9.8 10c0 4.7-3.1 8.5-6.3 9.3l-2.3-5.9z"></path></svg></a><a href="https://github.com/simpeg/user-tutorials" title="GitHub Repository: simpeg/user-tutorials" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models</h1><header class="mt-4 not-prose"><div class="grid grid-cols-1 sm:grid-cols-2 gap-y-1"><div class="pb-2 text-xs font-thin uppercase">Authors</div><div class="pb-2 text-xs font-thin uppercase">Affiliations</div><div><span class="font-semibold text-sm"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2mkfop:" data-state="closed">Devin Cowan</button></span></div><div class="text-sm"><div>University of British Columbia<!-- --> </div></div><div><span class="font-semibold text-sm"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2qkfop:" data-state="closed">Santiago Soler</button></span></div><div class="text-sm"><div>University of British Columbia<!-- --> </div></div></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="E3KA77JNFA" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-green-600 hint"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Introductory notebook</div></div><div class="px-4 py-1"><p>This tutorial teaches basic functionality within SimPEG and is a good entry point for new users.</p></div></aside></div><div id="CQfEreqY9v" class="relative group/block article-grid subgrid-gap col-screen"><aside class="my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden rounded border-l-4 border-green-600 hint"><div class="m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"></path></svg><div class="text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Light-weight notebook</div></div><div class="px-4 py-1"><p>This tutorial requires minimal computational resources and can be executed quickly in the background while other computer processes are running.</p></div></aside></div><div id="uv1wuDEz16" class="relative group/block article-grid subgrid-gap col-screen"><p><strong>Author:</strong> Devin C. Cowan</p><p><strong>Keywords:</strong> gradiometry, magnetic vector model, forward simulation, integral formulation, tree mesh.</p><p><strong>Summary:</strong> Here we use the module <a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics" rel="noreferrer">SimPEG<wbr/>.potential<wbr/>_fields<wbr/>.magnetics</a> to simulate magnetic gradiometry data for a magnetic vector model. We use the <a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics.Simulation3DIntegral" rel="noreferrer">3D integral formulation</a> and carry out the forward simulation on a tree mesh.</p><p><strong>Learning Objectives:</strong></p><ul><li>How to simulate magnetic data for 3D structures with SimPEG.</li><li>How to create magnetic gradiometry surveys; i.e. managing multiple data components.</li><li>How to design tensor meshes for magnetic simulations using the integral formulation.</li><li>How to construct a magnetic vector model.</li><li>How to predict magnetic gradiometry data for a magnetic vector model.</li><li>How to include surface topography in the forward simulation.</li><li>What are the units of the magnetic vector model and resulting data.</li></ul></div><div id="WuW5JefluV" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="import-modules" class="relative group"><span class="heading-text">Import Modules</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#import-modules" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Here, we import all of the functionality required to run the notebook for the tutorial exercise. All of the functionality specific to simulating magnetic data are imported from <a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics" rel="noreferrer">SimPEG<wbr/>.potential<wbr/>_fields<wbr/>.magnetics</a>.
We also import some useful utility functions from <a target="_blank" href="myst:SimPEG#SimPEG.utils" rel="noreferrer">SimPEG.utils</a>. To simulate magnetic data, we need to define our problem geometry on a numerical grid (or mesh).
To generate the mesh, we used the <a target="_blank" href="https://discretize.simpeg.xyz/en/main" rel="noreferrer">discretize</a> package.</p></div><div id="pzIduRUJ0k" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># SimPEG functionality
from SimPEG.potential_fields import magnetics
from SimPEG.utils import plot2Ddata, model_builder, mat_utils
from SimPEG import maps

# discretize functionality
from discretize import TreeMesh
from discretize.utils import mkvc, active_from_xyz

# Common Python functionality
import numpy as np
from scipy.interpolate import LinearNDInterpolator
from scipy.constants import mu_0
import matplotlib as mpl

mpl.rcParams.update({&quot;font.size&quot;: 14})
import matplotlib.pyplot as plt
import os

save_output = False  # Optional</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gLykGYuAf0pW-YANdQHYl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>/tmp/ipykernel_1150364/2320886569.py:2: FutureWarning: Importing `SimPEG` is deprecated. please import from `simpeg`.
  from SimPEG.potential_fields import magnetics
</span></code></pre></div></div></div><div id="MlbSvc3w2S" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-topography" class="relative group"><span class="heading-text">Define the Topography</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-topography" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Surface topography is defined as an (N, 3) <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a> for 3D simulations.
Here, we create basic topography for the forward simulation.
For user-specific simulations, you may load topography from an XYZ file.</p></div><div id="vZLLWkyoEK" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">[x_topo, y_topo] = np.meshgrid(np.linspace(-200, 200, 41), np.linspace(-200, 200, 41))
z_topo = (
    -15 * np.exp(-(x_topo**2 + y_topo**2) / 80**2)
    + 100.0
    + 0.5 * np.random.rand(*x_topo.shape)
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xMjVaT0TZJ8S78X4OmunV" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="oiXKqevqnu" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(6, 6))
ax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=&quot;3d&quot;)
ax.set_zlim([z_topo.max() - 40, z_topo.max()])
ax.plot_surface(x_topo, y_topo, z_topo, color=&quot;r&quot;, edgecolor=&quot;k&quot;, linewidth=0.5)
ax.set_box_aspect(aspect=None, zoom=0.85)
ax.set_xlabel(&quot;X (m)&quot;, labelpad=10)
ax.set_ylabel(&quot;Y (m)&quot;, labelpad=10)
ax.set_zlabel(&quot;Z (m)&quot;, labelpad=10)
ax.set_title(&quot;Topography (Exaggerated z-axis)&quot;, fontsize=16, pad=-20)
ax.view_init(elev=20.0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Ggc6Q3UzG66rO-tUMURQp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/0dc58280f37a36289e12a2f861692a1f.png" alt="&lt;Figure size 600x600 with 1 Axes&gt;"/></div></div><div id="DKcLTEzx8N" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">x_topo, y_topo, z_topo = mkvc(x_topo), mkvc(y_topo), mkvc(z_topo)
topo_xyz = np.c_[x_topo, y_topo, z_topo]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="28gLROGfK27lmZrWvc0d1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="W9noSv1WFU" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-survey" class="relative group"><span class="heading-text">Define the Survey</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-survey" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Surveys within SimPEG generally require the user to create and connect three types of objects:</p><ul><li><a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics.receivers.Point" rel="noreferrer">receivers</a>: which define the locations of field measurements and type of data being measured.</li><li><a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics.sources.UniformBackgroundField" rel="noreferrer">sources</a>: the passive or active sources responsible for generating geophysical responses, and their associated receivers.</li><li><a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics.Survey" rel="noreferrer">survey</a>: the object which stores and organizes all of the sources and receivers.</li></ul><p>Here, we define the survey that will be used for the forward simulation. Magnetic surveys are simple to create. The user only needs an (N, 3) <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a> to define the xyz locations of the observation locations, the field components being measured, and the Earth’s inducing field. For the tutorial simulation, the receivers are located 10 m above the surface topography and spaced 10 m apart.</p></div><div id="jlRj5KmDW4" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define the observation locations as an (N, 3) numpy array or load them.
x = np.linspace(-80.0, 80.0, 17)
y = np.linspace(-80.0, 80.0, 17)
x, y = np.meshgrid(x, y)
x, y = mkvc(x.T), mkvc(y.T)
fun_interp = LinearNDInterpolator(np.c_[x_topo, y_topo], z_topo)
z = fun_interp(np.c_[x, y]) + 10  # Flight height 10 m above surface.
receiver_locations = np.c_[x, y, z]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="q3X9FRlGk76-tzRTYSUnT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iQccIzRiJl" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define the component(s) of the field we want to simulate as strings within
# a list. Here we measure the x, y and z derivatives of the Bz anomaly at
# each observation location.
components = [&quot;bxz&quot;, &quot;byz&quot;, &quot;bzz&quot;]

# Use the observation locations and components to define the receivers. To
# simulate data, the receivers must be defined as a list.
receiver_list = magnetics.receivers.Point(receiver_locations, components=components)
receiver_list = [receiver_list]

# Define the inducing field
field_inclination = 90   # inclination [deg]
field_declination = 0    # declination [deg]
field_amplitude = 50000  # amplitude [nT]

source_field = magnetics.sources.UniformBackgroundField(
    receiver_list=receiver_list,
    amplitude=field_amplitude,
    inclination=field_inclination,
    declination=field_declination
)

# Define the survey
survey = magnetics.survey.Survey(source_field)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="cRduJ4seAitIvn1K4SlZ2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FpkuYrkxyW" class="relative group/block article-grid subgrid-gap col-screen"><p>If desired, we can extract various objects and properties from the objects used to generate the survey. E.g.</p></div><div id="CoeylsvdUb" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">print(&quot;# of locations: {}&quot;.format(survey.nRx))  # number of receiver locations
print(&quot;# of data: {}&quot;.format(survey.nD))  # number of data that will be simulated
print(survey.source_field.inclination)  # inclination of the source field
print(survey.source_field.receiver_list[0])  # the receiver object
print(receiver_list[0].locations[:5, :])  # the first 5 receiver locations</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Orputn7nB4QGBk8eTQnJX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span># of locations: 289
# of data: 867
90.0
&lt;SimPEG.potential_fields.magnetics.receivers.Point object at 0x7f8e015b1ff0&gt;
[[-80.         -80.         108.28415949]
 [-70.         -80.         107.62363668]
 [-60.         -80.         106.94483474]
 [-50.         -80.         106.73146121]
 [-40.         -80.         105.82237729]]
</span></code></pre></div></div></div><div id="dgn4w5lVub" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="design-a-tree-mesh" class="relative group"><span class="heading-text">Design a (Tree) Mesh</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#design-a-tree-mesh" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Meshes are designed using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main" rel="noreferrer">discretize</a> package. See the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html" rel="noreferrer">discretize user tutorials</a> to learn more about creating meshes.
Here, the forward simulation is computed for a <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh" rel="noreferrer">tree mesh</a>. If you wanted to generate a <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh" rel="noreferrer">tensor mesh</a> instead, you can use the code snippet from the <a target="_blank" href="fwd_gravity_anomaly_3d.ipynb" rel="noreferrer">3D Forward Simulation of Total Magnetic Intensity Data</a> tutorial.</p><p>The integral formulation for magnetics essentially sums the independent contribution for every magnetized voxel cell in the mesh. Since the kernel function that computes the contribution for a single cell is an analytic solution, small cells are not required to accurately compute the contributions from coarse structures with constant magnetization (e.g. a rectangular prism). For complex structures however, or to define surface topography more accurately, finer cells may be needed. Furthermore, cells do not need to be cubic. <strong>Since the analytic solution is only valid outside the magnetized region, please do no place receivers within the Earth.</strong></p><p>Here, a core cell width of 5 m is used within our survey region. Padding is used to extend the mesh outside the immediate survey area. The mesh will be plotted after we define our density contrast model.</p></div><div id="MHCwuJ4oKu" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">dx = 5  # minimum cell width (base mesh cell width) in x
dy = 5  # minimum cell width (base mesh cell width) in y
dz = 5  # minimum cell width (base mesh cell width) in z

x_length = 240.0  # domain width in x
y_length = 240.0  # domain width in y
z_length = 120.0  # domain width in z

# Compute number of base mesh cells required in x and y
nbcx = 2 ** int(np.round(np.log(x_length / dx) / np.log(2.0)))
nbcy = 2 ** int(np.round(np.log(y_length / dy) / np.log(2.0)))
nbcz = 2 ** int(np.round(np.log(z_length / dz) / np.log(2.0)))

# Define the base mesh. Top defined at z = 0 m.
hx = [(dx, nbcx)]
hy = [(dy, nbcy)]
hz = [(dz, nbcz)]
mesh = TreeMesh([hx, hy, hz], x0=&quot;CCN&quot;)

# Shift vertically to top same as maximum topography
mesh.origin += np.r_[0.0, 0.0, z_topo.max()]

# Refine based on surface topography
mesh.refine_surface(topo_xyz, padding_cells_by_level=[2, 2], finalize=False)

# Refine box based on region of interest
wsb_corner = np.c_[-100, -100, 20]
ent_corner = np.c_[100, 100, 100]
# Note -1 is a flag for smallest cell size
mesh.refine_box(wsb_corner, ent_corner, levels=[-1], finalize=False)

mesh.finalize()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VzZe_VUes9llc5dzn1fmR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="bQCqoPLFAe" class="relative group/block article-grid subgrid-gap col-screen"><p>If desired, we can extract various properties of the mesh. E.g.</p></div><div id="Pqc9AVw7i3" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">print(&quot;# of cells: {}&quot;.format(mesh.n_cells))  # Number of cells
print(&quot;# of x-faces: {}&quot;.format(mesh.n_faces_x))  # Number of x-faces
print(&quot;Origin: {}&quot;.format(mesh.origin))  # bottom-southewest corner
print(&quot;Max cell volume: {}&quot;.format(mesh.cell_volumes.max()))  # Largest cell size
print(mesh.cell_centers[0:5, :])  # Cell center locations</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="NVpLURMPnaA83C09m1l8g" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span># of cells: 42032
# of x-faces: 41884
Origin: [-160.         -160.          -59.50381597]
Max cell volume: 64000.0
[[-140.         -140.          -39.50381597]
 [-100.         -140.          -39.50381597]
 [-140.         -100.          -39.50381597]
 [-100.         -100.          -39.50381597]
 [-140.         -140.            0.49618403]]
</span></code></pre></div></div></div><div id="sIPv6iwcEq" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-active-cells" class="relative group"><span class="heading-text">Define the Active Cells</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Whereas cells below the Earth’s surface contribute towards the simulated magnetic anomaly, air cells do not.
The set of mesh cells used in the forward simulation are referred to as ‘active cells’. Unused cells (air cells) are ‘inactive cells’. Here, the discretize <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz" rel="noreferrer">active_from_xyz</a> utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a <code>bool</code> array.</p></div><div id="bcDDnb0Mn7" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Indices of the active mesh cells from topography (e.g. cells below surface)
active_cells = active_from_xyz(mesh, topo_xyz)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="UBOV-35atY06GgoGgIYen" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UM07cQZxuZ" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="mapping-from-the-model-to-active-cells" class="relative group"><span class="heading-text">Mapping from the Model to Active Cells</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-from-the-model-to-active-cells" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For example, the model may be defined as the logarithms of the physical property values, or be parameters defining a layered Earth. When simulating magnetic data using the integral formulation, we must define a mapping from the set of model parameters to the active cells in the mesh. Mappings are created using the <a target="_blank" href="myst:SimPEG#SimPEG.maps.IdentityMap" rel="noreferrer">SimPEG.maps</a> module. For the tutorial exercise, the model is the density contrast values for all active cells. As such, our mapping is an identity mapping, whose dimensions are equal to the number of active cells.</p></div><div id="UFhBiMbTsC" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define mapping from model to active cells. The model consists of a density
# contrast value for each cell below the Earth&#x27;s surface.
n_active = int(active_cells.sum())
model_map = maps.IdentityMap(nP=3 * n_active)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7zH1R-0qX1v29OKfou72O" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="N8eZ8mApei" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-magnetic-vector-model" class="relative group"><span class="heading-text">Define the Magnetic Vector Model</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-magnetic-vector-model" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Magnetic vector models are defined by three-component effective susceptibilities. Where <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>M</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>n</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\vec{M}_{ind}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1163em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> represents the induced magnetization, <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>M</mi><mo>⃗</mo></mover><mrow><mi>r</mi><mi>e</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\vec{M}_{rem}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1163em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> represents the remanent magnetization, and <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>H</mi><mo>⃗</mo></mover><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\vec{H}_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1163em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> is the inducing magnetic field intensity, the magnetic vector model defines the components of:</p><div id="WiEhclaa81" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi>χ</mi><mo>⃗</mo></mover><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mover accent="true"><mi>M</mi><mo>⃗</mo></mover><mrow><mi>i</mi><mi>n</mi><mi>d</mi></mrow></msub><mo>+</mo><msub><mover accent="true"><mi>M</mi><mo>⃗</mo></mover><mrow><mi>r</mi><mi>e</mi><mi>m</mi></mrow></msub></mrow><mrow><mo fence="true">∣</mo><msub><mover accent="true"><mi>H</mi><mo>⃗</mo></mover><mn>0</mn></msub><mo fence="true">∣</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\vec{\chi}_{eff} = \frac{\vec{M}_{ind} + \vec{M}_{rem}}{\left | \vec{H}_0 \right |}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">χ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">ff</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.3453em;vertical-align:-1.702em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6433em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.162em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.162em;"><span style="top:-1.966em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.564em;"><span class="pstrut" style="height:2.616em;"></span><span style="height:0.616em;width:0.3333em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/></svg></span></span><span style="top:-3.172em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.65em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.162em;"><span style="top:-1.966em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.564em;"><span class="pstrut" style="height:2.616em;"></span><span style="height:0.616em;width:0.3333em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/></svg></span></span><span style="top:-3.172em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.65em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.392em;"><span class="pstrut" style="height:3.162em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.839em;"><span class="pstrut" style="height:3.162em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1522em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.702em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#WiEhclaa81" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->1<!-- -->)</a></div></div><p>As a result, <strong>magnetic vector models in SimPEG are defined using SI units</strong>.
To create a magnetic vector model, we must</p><ol start="1"><li>Compute the induced magnetization vector for each cell by multiplying the susceptibility <!-- -->χ<!-- --> by the inducing magnetic field intensity <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>H</mi><mo>⃗</mo></mover><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\vec{H}_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1163em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>. The resulting quantity has units A/m.</li><li>Define the remanent magnetization vector for each cell, once again in A/m.</li><li>Sum the induced and remanent contributions.</li><li>Normalize by the amplitude of inducing magnetic field intensity; i.e. <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">∣</mo><msub><mover accent="true"><mi>H</mi><mo>⃗</mo></mover><mn>0</mn></msub><mo fence="true">∣</mo></mrow><annotation encoding="application/x-tex">\left | \vec{H}_0 \right |</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.812em;vertical-align:-0.65em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.162em;"><span style="top:-1.966em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.564em;"><span class="pstrut" style="height:2.616em;"></span><span style="height:0.616em;width:0.3333em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/></svg></span></span><span style="top:-3.172em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.65em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1799em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.162em;"><span style="top:-1.966em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.564em;"><span class="pstrut" style="height:2.616em;"></span><span style="height:0.616em;width:0.3333em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/></svg></span></span><span style="top:-3.172em;"><span class="pstrut" style="height:2.616em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.65em;"><span></span></span></span></span></span></span></span></span></span></span></span> in units A/m. The resulting quantity is unitless (SI).</li><li>Re-organize the quantity as a 1D <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" rel="noreferrer">numpy.ndarray</a> organized by vector component; i.e. np.r_[chi_1, chi_2, chi_3]</li></ol><p>Here, the model consists of a susceptible and remanently magnetized sphere within a negligibly susceptible host. The horizontal components of the induced and remanent magnetization has been balance so that they cancel out, and the net magnetization is downward. We plot the magnetic vector models using the <a target="_blank" href="https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.plot_slice.html#discretize.treemesh.plot_slice" rel="noreferrer">plot_slice</a> method.</p></div><div id="SUQgGu8yB2" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define susceptibility values for each unit in SI
background_susceptibility = 0.0001
sphere_susceptibility = 0.01</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="P6bEefGHJdYbgYfKWpKGY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="FxDVXQW22f" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Compute the induced magnetization vector (A/m) for every active cell
susceptibility_model = background_susceptibility * np.ones(n_active)
ind_sphere = model_builder.get_indices_sphere(
    np.r_[0.0, 0.0, 55.0], 16.0, mesh.cell_centers
)
ind_sphere = ind_sphere[active_cells]
susceptibility_model[ind_sphere] = sphere_susceptibility

# Compute the unit direction of the inducing field in Cartesian coordinates
field_direction = mat_utils.dip_azimuth2cartesian(field_inclination, field_declination)

# Inducing magnetic field intensity (A/m)
H0 = 1e-9 * field_amplitude * field_direction / mu_0

# Compute induced magnetization
induced_magnetization = np.outer(
    susceptibility_model, H0
)  # (n_active, 3) numpy.ndarray</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="P380lCPwNZQthPpqRQ_Pz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="hYC5VyXD0G" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Define the remanent magnetization vector (A/m) for every active cell.
# inclination (deg), declination (deg), amplitude (A/m)
remanence_inclination = 45.0
remanence_declination = 210.0
remanence_amplitude = 0.39788735751313814

remanent_magnetization = np.zeros_like(induced_magnetization)
remanent_magnetization_sphere = remanence_amplitude * mat_utils.dip_azimuth2cartesian(
    remanence_inclination, remanence_declination
)
remanent_magnetization[ind_sphere, :] = remanent_magnetization_sphere</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="sP-v2OhfjIurZs-anGzFL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="yOxYsmEGwL" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Compute total magnetization (A/m) for all active cells
total_magnetization = induced_magnetization + remanent_magnetization

# Define effective susceptibility model as a vector np.r_[chi_x, chi_y, chi_z]
model = mkvc(total_magnetization) / np.linalg.norm(H0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="HQxbH_HPZbemsYdFE4XR9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="XLZDfO9onj" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre"># Mapping to ignore inactive cells when plotting MVI amplitude
plotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)

# MVI model organized into (N, 3) numpy.ndarray
plotting_model = total_magnetization / np.linalg.norm(H0)

# Amplitude of MVI
model_amplitude = np.sqrt(np.sum(plotting_model**2, axis=1))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8vw5FHqBiwAMjf_ACt7Tb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="czg9mfdkAx" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(14, 4))

norm = mpl.colors.Normalize(vmin=0, vmax=np.max(model_amplitude))

ax1 = fig.add_axes([0.05, 0.12, 0.5, 0.78])
mesh.plot_slice(
    plotting_map * model_amplitude,
    normal=&quot;Y&quot;,
    ax=ax1,
    ind=int(mesh.h[1].size / 2),
    grid=True,
    pcolor_opts={&quot;cmap&quot;: mpl.cm.plasma, &quot;norm&quot;: norm},
)
ax1.set_title(&quot;MVI Model at y = 0 m (amplitude)&quot;)
ax1.set_xlabel(&quot;x (m)&quot;)
ax1.set_ylabel(&quot;z (m)&quot;)

ax2 = fig.add_axes([0.62, 0.12, 0.25, 0.78])
mesh.plot_slice(
    plotting_map * plotting_model,
    v_type=&quot;CCv&quot;,
    view=&quot;vec&quot;,
    normal=&quot;Y&quot;,
    ax=ax2,
    ind=int(mesh.h[1].size / 2),
    grid=True,
    pcolor_opts={&quot;cmap&quot;: mpl.cm.plasma, &quot;norm&quot;: norm},
    quiver_opts={
        &quot;pivot&quot;: &quot;mid&quot;,
        &quot;width&quot;: 0.01,
        &quot;headwidth&quot;: 3.0,
        &quot;headlength&quot;: 3.0,
        &quot;headaxislength&quot;: 3.0,
        &quot;scale&quot;: 0.25,
    },
)
ax2.set_title(&quot;MVI Model at y = 0 m&quot;)
ax2.set_xlim([-25, 25])
ax2.set_ylim([30, 80])
ax2.set_xlabel(&quot;x (m)&quot;)
ax2.set_ylabel(&quot;z (m)&quot;)

cx = fig.add_axes([0.89, 0.12, 0.02, 0.78])
cbar = mpl.colorbar.ColorbarBase(
    cx, norm=norm, orientation=&quot;vertical&quot;, cmap=mpl.cm.plasma
)
cbar.set_label(&quot;SI&quot;, rotation=270, labelpad=15)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="HwSIJWXDcqMWmhbkWRiE8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/d9891e1ce5c6f40df12e7db8c848307c.png" alt="&lt;Figure size 1400x400 with 3 Axes&gt;"/></div></div><div id="VVSIupTPMK" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="define-the-forward-simulation" class="relative group"><span class="heading-text">Define the Forward Simulation</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-forward-simulation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In SimPEG, the physics of the forward simulation is defined by creating an instance of an appropriate simulation class.
In this case, we use the simulation class for the <a target="_blank" href="myst:SimPEG#SimPEG.potential_fields.magnetics.Simulation3DIntegral" rel="noreferrer">3D integral formulation</a>. To fully define the forward simulation, we need to connect the simulation object to:</p><ul><li>the survey</li><li>the mesh</li><li>the indices of the active cells</li><li>the mapping from the model to the active cells</li><li>the model type: “scalar” for susceptibility model, “vector” for magnetic vector model</li></ul><p>This is accomplished by setting each one of the aforementioned items as a property of the simulation object. Additional keyword arguments can also be set which impact the forward simulation. Because we are only simulating data for a single model, there is no benefit to storing the sensitivities for the forward simulation. <code>store_sensitivities</code> property to <em>‘forward_only’</em></p></div><div id="hi2uhccPRw" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">simulation = magnetics.simulation.Simulation3DIntegral(
    survey=survey,
    mesh=mesh,
    model_type=&quot;vector&quot;,
    chiMap=model_map,
    ind_active=active_cells,
    store_sensitivities=&quot;forward_only&quot;,
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="kao960SfbsiYSensaybEg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="RA6MHJbdSe" class="relative group/block article-grid subgrid-gap col-screen"><h2 id="simulate-magnetic-gradiometry-data" class="relative group"><span class="heading-text">Simulate Magnetic Gradiometry Data</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#simulate-magnetic-gradiometry-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Once any simulation within SimPEG has been properly constructed, simulated data for a given model vector can be computed using the <a target="_blank" href="myst:SimPEG#SimPEG.simulation.BaseSimulation.dpred" rel="noreferrer">dpred</a> method. In SimPEG, magnetic gradiometry data values are in <strong>nT/m.</strong></p></div><div id="lUGtqUgoIW" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">dpred = simulation.dpred(model)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="eGn-gB9t6tz-DjgpyScpw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="O9jC8CZufq" class="relative group/block article-grid subgrid-gap col-screen"><p>Data are ordered by component, then by location. Here, we reshape the predicted data vector into an array for easier plotting.</p></div><div id="U6GQMyLx1k" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">n_loc = survey.nRx  # Number of receiver locations
n_comp = len(components)  # Number of data components
dpred_plotting = np.reshape(dpred, (n_loc, n_comp))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="kSu0JKPxIidoKyXRpOGBe" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="t25pYmx5nr" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre style="display:block;overflow-x:auto;padding:0.8rem;background:#1E1E1E;color:#DCDCDC"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(10, 3))
v_max = np.max(np.abs(dpred))

ax = 3 * [None]
cplot = 3 * [None]
comp_list = [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;]

norm = mpl.colors.Normalize(vmin=-v_max, vmax=v_max)

for ii in range(0, 3):
    ax[ii] = fig.add_axes([0.1 + ii * 0.26, 0.15, 0.25, 0.78])
    cplot[ii] = plot2Ddata(
        receiver_locations,
        dpred_plotting[:, ii],
        ax=ax[ii],
        ncontour=60,
        contourOpts={&quot;cmap&quot;: &quot;bwr&quot;, &quot;norm&quot;: norm},
    )
    ax[ii].set_title(r&quot;$\partial B_z /\partial {}$&quot;.format(comp_list[ii]))
    ax[ii].set_xlabel(&quot;x (m)&quot;)
    if ii == 0:
        ax[ii].set_ylabel(&quot;y (m)&quot;)
    else:
        ax[ii].set_yticks([])

cx = fig.add_axes([0.89, 0.13, 0.02, 0.79])
cbar = mpl.colorbar.ColorbarBase(cx, norm=norm, orientation=&quot;vertical&quot;, cmap=mpl.cm.bwr)
cbar.set_label(&quot;$nT/m$&quot;, rotation=270, labelpad=10, size=12)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="QI9e7_wTmbpwd6yJooLkB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/user-tutorials/build/62a727abba9e5d595f38da666260fc44.png" alt="&lt;Figure size 1000x300 with 4 Axes&gt;"/></div></div><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/fwd-magnetics-induced-3d"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>3D Forward Simulation of TMI Data</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/user-tutorials/inv-magnetics-induced-3d"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">SimPEG User Tutorials</div>3D Inversion of TMI Data to Recover a Susceptibility Model</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/user-tutorials/build/entry.client-J4K7GZUA.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-YSSYBPCA.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-Z2EBYAAY.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-YAIQ7LUU.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-HTHE5KDW.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-JCLNTD6A.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-NF5NQVJX.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-5CFTM6YW.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/user-tutorials/build/root-MROHD4U6.js"/><link rel="modulepreload" href="/user-tutorials/build/_shared/chunk-625TU2HY.js"/><link rel="modulepreload" href="/user-tutorials/build/routes/$-INRYMPN2.js"/><script>window.__remixContext = {"url":"/fwd-magnetics-mvi-3d","state":{"loaderData":{"root":{"config":{"title":"SimPEG User Tutorials","options":{"logo":"/user-tutorials/build/simpeg-logo-8e384bdbcd0a580c9ad2f1e67fcc0bfe.png","logo_text":"User Tutorials","analytics_plausible":"simpeg.xyz"},"myst":"1.3.8","nav":[{"title":"SimPEG","children":[{"title":"Project website","url":"https://simpeg.xyz"},{"title":"Documentation","url":"https://docs.simpeg.xyz"}]}],"actions":[{"title":"Learn More","url":"https://mystmd.org/guide","internal":false,"static":false}],"projects":[{"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"subject":"SimPEG User Tutorials","title":"SimPEG User Tutorials","description":"SimPEG user tutorials","authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/simpeg/user-tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"references":{"python":{"url":"https://docs.python.org/3"},"numpy":{"url":"https://numpy.org/doc/stable"},"scipy":{"url":"https://docs.scipy.org/doc/scipy"},"matplotlib":{"url":"https://matplotlib.org/stable"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main"},"simpeg":{"url":"https://docs.simpeg.xyz/latest"},"geoana":{"url":"https://geoana.simpeg.xyz"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master"}},"thumbnail":"/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-f8431d25d6d77e8b4ff5cdccedc9d3e9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-a1a5f99158a0a16b320fa6421f91835e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-ec1d656f70f6b7344928d0bd60daaca1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/user-tutorials"},"routes/$":{"config":{"title":"SimPEG User Tutorials","options":{"logo":"/user-tutorials/build/simpeg-logo-8e384bdbcd0a580c9ad2f1e67fcc0bfe.png","logo_text":"User Tutorials","analytics_plausible":"simpeg.xyz"},"myst":"1.3.8","nav":[{"title":"SimPEG","children":[{"title":"Project website","url":"https://simpeg.xyz"},{"title":"Documentation","url":"https://docs.simpeg.xyz"}]}],"actions":[{"title":"Learn More","url":"https://mystmd.org/guide","internal":false,"static":false}],"projects":[{"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"subject":"SimPEG User Tutorials","title":"SimPEG User Tutorials","description":"SimPEG user tutorials","authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/simpeg/user-tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"references":{"python":{"url":"https://docs.python.org/3"},"numpy":{"url":"https://numpy.org/doc/stable"},"scipy":{"url":"https://docs.scipy.org/doc/scipy"},"matplotlib":{"url":"https://matplotlib.org/stable"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main"},"simpeg":{"url":"https://docs.simpeg.xyz/latest"},"geoana":{"url":"https://geoana.simpeg.xyz"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master"}},"thumbnail":"/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-f8431d25d6d77e8b4ff5cdccedc9d3e9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-a1a5f99158a0a16b320fa6421f91835e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-ec1d656f70f6b7344928d0bd60daaca1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"kind":"Notebook","sha256":"d15b5cc6f8afd1ee5db83f4da5ca3f2420698f785f94964669a7f95e0028f0b7","slug":"fwd-magnetics-mvi-3d","location":"/notebooks/04-magnetics/fwd_magnetics_mvi_3d.ipynb","dependencies":[],"frontmatter":{"title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"github":"https://github.com/simpeg/user-tutorials","subject":"SimPEG User Tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"exports":[{"format":"ipynb","filename":"fwd_magnetics_mvi_3d.ipynb","url":"/user-tutorials/build/fwd_magnetics_mvi_3d-5e55d756108daac8c23735e0179a7e72.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Introductory notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RTDnNW03l0"}],"key":"Cx29iraGIW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial teaches basic functionality within SimPEG and is a good entry point for new users.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r5i0p0XAB0"}],"key":"HEtJXsgf0J"}],"key":"b23tj20sW7"}],"key":"E3KA77JNFA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"admonition","class":"hint","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Light-weight notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dNiBEuj4Fx"}],"key":"tcB7NRrAUB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This tutorial requires minimal computational resources and can be executed quickly in the background while other computer processes are running.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DHt3NMEQ2c"}],"key":"tg8vp9w5dM"}],"key":"IUAkXY12QL"}],"key":"CQfEreqY9v"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZECrHlhu84"}],"key":"CXKNlNQ8r6"},{"type":"text","value":" Devin C. Cowan","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZglrvSPMgY"}],"key":"O7x0gUeZX7"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Keywords:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"S91Bh6ZDhi"}],"key":"hAFXhYh9v7"},{"type":"text","value":" gradiometry, magnetic vector model, forward simulation, integral formulation, tree mesh.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e9Zb0FNVLC"}],"key":"sCaerW4VXm"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HyiWNUz90i"}],"key":"LK9V151slC"},{"type":"text","value":" Here we use the module ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lxqqbhoVP9"},{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"SimPEG​.potential​_fields​.magnetics","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zNfqMPCaQX"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics","key":"PMLFdTTQhr"},{"type":"text","value":" to simulate magnetic gradiometry data for a magnetic vector model. We use the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"cWaHjpBeHX"},{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics.Simulation3DIntegral","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"3D integral formulation","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"St6nY7F191"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics.Simulation3DIntegral","key":"j3jbySmRgq"},{"type":"text","value":" and carry out the forward simulation on a tree mesh.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TfAdk2wqnN"}],"key":"ajsYBOSjVd"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Learning Objectives:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"NPj4YSrkn9"}],"key":"gx36JjzH8Y"}],"key":"PWIcPWYYC5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"How to simulate magnetic data for 3D structures with SimPEG.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"TCjabkVyy1"}],"key":"OWQyOVtyFw"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"How to create magnetic gradiometry surveys; i.e. managing multiple data components.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"C9RK1RSfVz"}],"key":"upy9Ae6H1Z"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"How to design tensor meshes for magnetic simulations using the integral formulation.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"b2RdSiCAIf"}],"key":"W0yJVeKjAN"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"How to construct a magnetic vector model.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"b3FAmE6DcI"}],"key":"lf1uVZNJ9P"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"How to predict magnetic gradiometry data for a magnetic vector model.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Ow6rIGKTMI"}],"key":"vDbYJADnf1"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"How to include surface topography in the forward simulation.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"N7RFj5mnG0"}],"key":"sOAzkEM6sI"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"What are the units of the magnetic vector model and resulting data.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"le39bTTyRu"}],"key":"HyBklGSkF8"}],"key":"uHSLYIiLDU"}],"key":"uv1wuDEz16"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import Modules","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ayMXSGwPT7"}],"identifier":"import-modules","label":"Import Modules","html_id":"import-modules","implicit":true,"key":"fWhhJ8S2t2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here, we import all of the functionality required to run the notebook for the tutorial exercise. All of the functionality specific to simulating magnetic data are imported from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Oz2GoonDF7"},{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG​.potential​_fields​.magnetics","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i3R26caejz"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics","key":"azuW9iFFsC"},{"type":"text","value":".\nWe also import some useful utility functions from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l1T8vVVcJs"},{"type":"link","url":"myst:SimPEG#SimPEG.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG.utils","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Nwi16sKaiY"}],"urlSource":"myst:SimPEG#SimPEG.utils","key":"vkm3JxrBNr"},{"type":"text","value":". To simulate magnetic data, we need to define our problem geometry on a numerical grid (or mesh).\nTo generate the mesh, we used the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vDnhs76aHx"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t04c85Snpy"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"WyQpoF3C77"},{"type":"text","value":" package.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mJ450mpfoV"}],"key":"vuwPHQIDbD"}],"key":"WuW5JefluV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:40.085205Z","iopub.status.busy":"2024-07-17T17:48:40.084713Z","iopub.status.idle":"2024-07-17T17:48:42.142070Z","shell.execute_reply":"2024-07-17T17:48:42.141263Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# SimPEG functionality\nfrom SimPEG.potential_fields import magnetics\nfrom SimPEG.utils import plot2Ddata, model_builder, mat_utils\nfrom SimPEG import maps\n\n# discretize functionality\nfrom discretize import TreeMesh\nfrom discretize.utils import mkvc, active_from_xyz\n\n# Common Python functionality\nimport numpy as np\nfrom scipy.interpolate import LinearNDInterpolator\nfrom scipy.constants import mu_0\nimport matplotlib as mpl\n\nmpl.rcParams.update({\"font.size\": 14})\nimport matplotlib.pyplot as plt\nimport os\n\nsave_output = False  # Optional","key":"wSXzMop3kF"},{"type":"output","id":"gLykGYuAf0pW-YANdQHYl","data":[{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_1150364/2320886569.py:2: FutureWarning: Importing `SimPEG` is deprecated. please import from `simpeg`.\n  from SimPEG.potential_fields import magnetics\n"}],"key":"gdxytjdTM6"}],"key":"pzIduRUJ0k"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Topography","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kzlpLEOANV"}],"identifier":"define-the-topography","label":"Define the Topography","html_id":"define-the-topography","implicit":true,"key":"KU3I8ZYkrg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Surface topography is defined as an (N, 3) ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BPW6mQqnMW"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AsXKgCk91T"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"xref:sphinx","key":"a2i8dVI1LZ"},{"type":"text","value":" for 3D simulations.\nHere, we create basic topography for the forward simulation.\nFor user-specific simulations, you may load topography from an XYZ file.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sjZVkfHt0m"}],"key":"vzwkLPUnUv"}],"key":"MlbSvc3w2S"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.147116Z","iopub.status.busy":"2024-07-17T17:48:42.146819Z","iopub.status.idle":"2024-07-17T17:48:42.151770Z","shell.execute_reply":"2024-07-17T17:48:42.151173Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"[x_topo, y_topo] = np.meshgrid(np.linspace(-200, 200, 41), np.linspace(-200, 200, 41))\nz_topo = (\n    -15 * np.exp(-(x_topo**2 + y_topo**2) / 80**2)\n    + 100.0\n    + 0.5 * np.random.rand(*x_topo.shape)\n)","key":"mIn0sn9ENy"},{"type":"output","id":"xMjVaT0TZJ8S78X4OmunV","data":[],"key":"Hddn4499tn"}],"key":"vZLLWkyoEK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.156290Z","iopub.status.busy":"2024-07-17T17:48:42.155950Z","iopub.status.idle":"2024-07-17T17:48:42.504667Z","shell.execute_reply":"2024-07-17T17:48:42.503985Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(6, 6))\nax = fig.add_axes([0.1, 0.1, 0.8, 0.8], projection=\"3d\")\nax.set_zlim([z_topo.max() - 40, z_topo.max()])\nax.plot_surface(x_topo, y_topo, z_topo, color=\"r\", edgecolor=\"k\", linewidth=0.5)\nax.set_box_aspect(aspect=None, zoom=0.85)\nax.set_xlabel(\"X (m)\", labelpad=10)\nax.set_ylabel(\"Y (m)\", labelpad=10)\nax.set_zlabel(\"Z (m)\", labelpad=10)\nax.set_title(\"Topography (Exaggerated z-axis)\", fontsize=16, pad=-20)\nax.view_init(elev=20.0)","key":"WUy1EZ8orS"},{"type":"output","id":"Ggc6Q3UzG66rO-tUMURQp","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0dc58280f37a36289e12a2f861692a1f","path":"/user-tutorials/build/0dc58280f37a36289e12a2f861692a1f.png"},"text/plain":{"content":"\u003cFigure size 600x600 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"bmvQXKk23z"}],"key":"oiXKqevqnu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.510375Z","iopub.status.busy":"2024-07-17T17:48:42.510148Z","iopub.status.idle":"2024-07-17T17:48:42.514826Z","shell.execute_reply":"2024-07-17T17:48:42.514014Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"x_topo, y_topo, z_topo = mkvc(x_topo), mkvc(y_topo), mkvc(z_topo)\ntopo_xyz = np.c_[x_topo, y_topo, z_topo]","key":"bxymD1IV0S"},{"type":"output","id":"28gLROGfK27lmZrWvc0d1","data":[],"key":"Bo5lU0DtBs"}],"key":"DKcLTEzx8N"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Survey","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N2GA1h50s3"}],"identifier":"define-the-survey","label":"Define the Survey","html_id":"define-the-survey","implicit":true,"key":"RJEUPEqnk6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Surveys within SimPEG generally require the user to create and connect three types of objects:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dnXrQiiKRD"}],"key":"lEaWLeCdJz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics.receivers.Point","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"receivers","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Wrn4YctDoa"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics.receivers.Point","key":"dpvs1OUNTX"},{"type":"text","value":": which define the locations of field measurements and type of data being measured.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fCavmtlfyr"}],"key":"a44TnIREwN"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics.sources.UniformBackgroundField","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"sources","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KfWbfq30tl"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics.sources.UniformBackgroundField","key":"PQRkuGsQsy"},{"type":"text","value":": the passive or active sources responsible for generating geophysical responses, and their associated receivers.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OOSQ6dlsur"}],"key":"uwxQi9LveF"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics.Survey","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"survey","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"NX4ABtDSyb"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics.Survey","key":"XR4zacav4w"},{"type":"text","value":": the object which stores and organizes all of the sources and receivers.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gRuGVwcKb3"}],"key":"SirB3B2HK2"}],"key":"D2Rp8q4ODM"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Here, we define the survey that will be used for the forward simulation. Magnetic surveys are simple to create. The user only needs an (N, 3) ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"yn7mH24I6y"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"y5eYL2pzPb"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"xref:sphinx","key":"tU4rFvnFkY"},{"type":"text","value":" to define the xyz locations of the observation locations, the field components being measured, and the Earth’s inducing field. For the tutorial simulation, the receivers are located 10 m above the surface topography and spaced 10 m apart.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"bpxxD4baEf"}],"key":"TSENCp0Ixk"}],"key":"W9noSv1WFU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.518207Z","iopub.status.busy":"2024-07-17T17:48:42.517834Z","iopub.status.idle":"2024-07-17T17:48:42.551108Z","shell.execute_reply":"2024-07-17T17:48:42.550383Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the observation locations as an (N, 3) numpy array or load them.\nx = np.linspace(-80.0, 80.0, 17)\ny = np.linspace(-80.0, 80.0, 17)\nx, y = np.meshgrid(x, y)\nx, y = mkvc(x.T), mkvc(y.T)\nfun_interp = LinearNDInterpolator(np.c_[x_topo, y_topo], z_topo)\nz = fun_interp(np.c_[x, y]) + 10  # Flight height 10 m above surface.\nreceiver_locations = np.c_[x, y, z]","key":"b75duJOjgb"},{"type":"output","id":"q3X9FRlGk76-tzRTYSUnT","data":[],"key":"YClzuTseOU"}],"key":"jlRj5KmDW4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.554513Z","iopub.status.busy":"2024-07-17T17:48:42.554187Z","iopub.status.idle":"2024-07-17T17:48:42.559127Z","shell.execute_reply":"2024-07-17T17:48:42.558523Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the component(s) of the field we want to simulate as strings within\n# a list. Here we measure the x, y and z derivatives of the Bz anomaly at\n# each observation location.\ncomponents = [\"bxz\", \"byz\", \"bzz\"]\n\n# Use the observation locations and components to define the receivers. To\n# simulate data, the receivers must be defined as a list.\nreceiver_list = magnetics.receivers.Point(receiver_locations, components=components)\nreceiver_list = [receiver_list]\n\n# Define the inducing field\nfield_inclination = 90   # inclination [deg]\nfield_declination = 0    # declination [deg]\nfield_amplitude = 50000  # amplitude [nT]\n\nsource_field = magnetics.sources.UniformBackgroundField(\n    receiver_list=receiver_list,\n    amplitude=field_amplitude,\n    inclination=field_inclination,\n    declination=field_declination\n)\n\n# Define the survey\nsurvey = magnetics.survey.Survey(source_field)","key":"EHRSB9lVPq"},{"type":"output","id":"cRduJ4seAitIvn1K4SlZ2","data":[],"key":"mntBwbMRJH"}],"key":"iQccIzRiJl"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If desired, we can extract various objects and properties from the objects used to generate the survey. E.g.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kzNpugekHY"}],"key":"ziOttpCZjc"}],"key":"FpkuYrkxyW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.562662Z","iopub.status.busy":"2024-07-17T17:48:42.562431Z","iopub.status.idle":"2024-07-17T17:48:42.567533Z","shell.execute_reply":"2024-07-17T17:48:42.566918Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"# of locations: {}\".format(survey.nRx))  # number of receiver locations\nprint(\"# of data: {}\".format(survey.nD))  # number of data that will be simulated\nprint(survey.source_field.inclination)  # inclination of the source field\nprint(survey.source_field.receiver_list[0])  # the receiver object\nprint(receiver_list[0].locations[:5, :])  # the first 5 receiver locations","key":"SgkxPWxKzV"},{"type":"output","id":"Orputn7nB4QGBk8eTQnJX","data":[{"name":"stdout","output_type":"stream","text":"# of locations: 289\n# of data: 867\n90.0\n\u003cSimPEG.potential_fields.magnetics.receivers.Point object at 0x7f8e015b1ff0\u003e\n[[-80.         -80.         108.28415949]\n [-70.         -80.         107.62363668]\n [-60.         -80.         106.94483474]\n [-50.         -80.         106.73146121]\n [-40.         -80.         105.82237729]]\n"}],"key":"lzuPXZWziC"}],"key":"CoeylsvdUb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Design a (Tree) Mesh","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BWbpvLlX5P"}],"identifier":"design-a-tree-mesh","label":"Design a (Tree) Mesh","html_id":"design-a-tree-mesh","implicit":true,"key":"o61Liy4jBS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Meshes are designed using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RRWLGQjuv8"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nuqOJvh29i"}],"urlSource":"https://discretize.simpeg.xyz/en/main","key":"A8RPsNm0PS"},{"type":"text","value":" package. See the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DabMcAwkg8"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"discretize user tutorials","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pIrdi4EhVh"}],"urlSource":"https://discretize.simpeg.xyz/en/main/tutorials/mesh_generation/index.html","key":"aynxfkV2vI"},{"type":"text","value":" to learn more about creating meshes.\nHere, the forward simulation is computed for a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u3QaLEyslP"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.html#discretize.treemesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tree mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j6b5qvj2rZ"}],"urlSource":"myst:discretize#discretize.TreeMesh","internal":false,"protocol":"xref:sphinx","key":"qjJDX5O3Zy"},{"type":"text","value":". If you wanted to generate a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Lg9aU8YHaj"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TensorMesh.html#discretize.tensormesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"tensor mesh","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BurWdcIOYE"}],"urlSource":"myst:discretize#discretize.TensorMesh","internal":false,"protocol":"xref:sphinx","key":"O7EBu9N0dj"},{"type":"text","value":" instead, you can use the code snippet from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YtK0xPjuRl"},{"type":"link","url":"fwd_gravity_anomaly_3d.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D Forward Simulation of Total Magnetic Intensity Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zxkr5e5oTF"}],"urlSource":"fwd_gravity_anomaly_3d.ipynb","key":"qSJMC6273h"},{"type":"text","value":" tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jGP8hxezNn"}],"key":"NyI15268eZ"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The integral formulation for magnetics essentially sums the independent contribution for every magnetized voxel cell in the mesh. Since the kernel function that computes the contribution for a single cell is an analytic solution, small cells are not required to accurately compute the contributions from coarse structures with constant magnetization (e.g. a rectangular prism). For complex structures however, or to define surface topography more accurately, finer cells may be needed. Furthermore, cells do not need to be cubic. ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"DMQU854c8j"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Since the analytic solution is only valid outside the magnetized region, please do no place receivers within the Earth.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WsRdPsClH5"}],"key":"f3bUnldEDY"}],"key":"YOm0BmUOYX"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Here, a core cell width of 5 m is used within our survey region. Padding is used to extend the mesh outside the immediate survey area. The mesh will be plotted after we define our density contrast model.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Ip1s8DG5am"}],"key":"l99hApPtSY"}],"key":"dgn4w5lVub"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.570659Z","iopub.status.busy":"2024-07-17T17:48:42.570425Z","iopub.status.idle":"2024-07-17T17:48:42.860281Z","shell.execute_reply":"2024-07-17T17:48:42.859414Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dx = 5  # minimum cell width (base mesh cell width) in x\ndy = 5  # minimum cell width (base mesh cell width) in y\ndz = 5  # minimum cell width (base mesh cell width) in z\n\nx_length = 240.0  # domain width in x\ny_length = 240.0  # domain width in y\nz_length = 120.0  # domain width in z\n\n# Compute number of base mesh cells required in x and y\nnbcx = 2 ** int(np.round(np.log(x_length / dx) / np.log(2.0)))\nnbcy = 2 ** int(np.round(np.log(y_length / dy) / np.log(2.0)))\nnbcz = 2 ** int(np.round(np.log(z_length / dz) / np.log(2.0)))\n\n# Define the base mesh. Top defined at z = 0 m.\nhx = [(dx, nbcx)]\nhy = [(dy, nbcy)]\nhz = [(dz, nbcz)]\nmesh = TreeMesh([hx, hy, hz], x0=\"CCN\")\n\n# Shift vertically to top same as maximum topography\nmesh.origin += np.r_[0.0, 0.0, z_topo.max()]\n\n# Refine based on surface topography\nmesh.refine_surface(topo_xyz, padding_cells_by_level=[2, 2], finalize=False)\n\n# Refine box based on region of interest\nwsb_corner = np.c_[-100, -100, 20]\nent_corner = np.c_[100, 100, 100]\n# Note -1 is a flag for smallest cell size\nmesh.refine_box(wsb_corner, ent_corner, levels=[-1], finalize=False)\n\nmesh.finalize()","key":"Hv2m6TPeCY"},{"type":"output","id":"VzZe_VUes9llc5dzn1fmR","data":[],"key":"o4I2XPU2sL"}],"key":"MHCwuJ4oKu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If desired, we can extract various properties of the mesh. E.g.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hFeIYBNiXv"}],"key":"vqKrD0B0fG"}],"key":"bQCqoPLFAe"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.864622Z","iopub.status.busy":"2024-07-17T17:48:42.864387Z","iopub.status.idle":"2024-07-17T17:48:42.877077Z","shell.execute_reply":"2024-07-17T17:48:42.876455Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"# of cells: {}\".format(mesh.n_cells))  # Number of cells\nprint(\"# of x-faces: {}\".format(mesh.n_faces_x))  # Number of x-faces\nprint(\"Origin: {}\".format(mesh.origin))  # bottom-southewest corner\nprint(\"Max cell volume: {}\".format(mesh.cell_volumes.max()))  # Largest cell size\nprint(mesh.cell_centers[0:5, :])  # Cell center locations","key":"p2tMhcibDm"},{"type":"output","id":"NVpLURMPnaA83C09m1l8g","data":[{"name":"stdout","output_type":"stream","text":"# of cells: 42032\n# of x-faces: 41884\nOrigin: [-160.         -160.          -59.50381597]\nMax cell volume: 64000.0\n[[-140.         -140.          -39.50381597]\n [-100.         -140.          -39.50381597]\n [-140.         -100.          -39.50381597]\n [-100.         -100.          -39.50381597]\n [-140.         -140.            0.49618403]]\n"}],"key":"GNd4PrG8eE"}],"key":"Pqc9AVw7i3"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xoe7J69Beo"}],"identifier":"define-the-active-cells","label":"Define the Active Cells","html_id":"define-the-active-cells","implicit":true,"key":"L2P0eSEWvD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Whereas cells below the Earth’s surface contribute towards the simulated magnetic anomaly, air cells do not.\nThe set of mesh cells used in the forward simulation are referred to as ‘active cells’. Unused cells (air cells) are ‘inactive cells’. Here, the discretize ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hs5e3kgkqZ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.utils.active_from_xyz.html#discretize.utils.active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"active_from_xyz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HRPevWM8Bc"}],"urlSource":"myst:discretize#discretize.utils.active_from_xyz","internal":false,"protocol":"xref:sphinx","key":"dKUf7vs1GM"},{"type":"text","value":" utility function is used to find the indices of the active cells using the mesh and surface topography. The output quantity is a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l04rAaxWDP"},{"type":"inlineCode","value":"bool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IVpUX41MaF"},{"type":"text","value":" array.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Thhzb5TERH"}],"key":"wj2TMFcuJ2"}],"key":"sIPv6iwcEq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.882377Z","iopub.status.busy":"2024-07-17T17:48:42.882152Z","iopub.status.idle":"2024-07-17T17:48:42.933741Z","shell.execute_reply":"2024-07-17T17:48:42.933028Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Indices of the active mesh cells from topography (e.g. cells below surface)\nactive_cells = active_from_xyz(mesh, topo_xyz)","key":"WNdnEpFBEK"},{"type":"output","id":"UBOV-35atY06GgoGgIYen","data":[],"key":"asW0qGdnFq"}],"key":"bcDDnb0Mn7"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping from the Model to Active Cells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f5rLGQNMPx"}],"identifier":"mapping-from-the-model-to-active-cells","label":"Mapping from the Model to Active Cells","html_id":"mapping-from-the-model-to-active-cells","implicit":true,"key":"bh2k7JEqC7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In SimPEG, the term ‘model’ is not synonymous with the physical property values defined on the mesh. For example, the model may be defined as the logarithms of the physical property values, or be parameters defining a layered Earth. When simulating magnetic data using the integral formulation, we must define a mapping from the set of model parameters to the active cells in the mesh. Mappings are created using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eWeJlE7iwj"},{"type":"link","url":"myst:SimPEG#SimPEG.maps.IdentityMap","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"SimPEG.maps","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NurNEAFZTN"}],"urlSource":"myst:SimPEG#SimPEG.maps.IdentityMap","key":"XN4ZcuAX1C"},{"type":"text","value":" module. For the tutorial exercise, the model is the density contrast values for all active cells. As such, our mapping is an identity mapping, whose dimensions are equal to the number of active cells.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iygK2XhDcw"}],"key":"e86jHjdBc6"}],"key":"UM07cQZxuZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.937088Z","iopub.status.busy":"2024-07-17T17:48:42.936761Z","iopub.status.idle":"2024-07-17T17:48:42.940493Z","shell.execute_reply":"2024-07-17T17:48:42.939865Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define mapping from model to active cells. The model consists of a density\n# contrast value for each cell below the Earth's surface.\nn_active = int(active_cells.sum())\nmodel_map = maps.IdentityMap(nP=3 * n_active)","key":"FtC5pLERMW"},{"type":"output","id":"7zH1R-0qX1v29OKfou72O","data":[],"key":"CqlWE1PGGK"}],"key":"UFhBiMbTsC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Magnetic Vector Model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DZyST8neSS"}],"identifier":"define-the-magnetic-vector-model","label":"Define the Magnetic Vector Model","html_id":"define-the-magnetic-vector-model","implicit":true,"key":"ko4zqpbGq1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Magnetic vector models are defined by three-component effective susceptibilities. Where ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dehHNkahfH"},{"type":"inlineMath","value":"\\vec{M}_{ind}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eM\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\vec{M}_{ind}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1163em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eM\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1522em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ein\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"HtyUPc3s0A"},{"type":"text","value":" represents the induced magnetization, ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ww9DZ5oYv8"},{"type":"inlineMath","value":"\\vec{M}_{rem}","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eM\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmrow\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\vec{M}_{rem}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1163em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eM\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1522em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ere\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"wEEU4JTO4x"},{"type":"text","value":" represents the remanent magnetization, and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z9xWGOJCBP"},{"type":"inlineMath","value":"\\vec{H}_0","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eH\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\vec{H}_0\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1163em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1799em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"xDCGlx97OX"},{"type":"text","value":" is the inducing magnetic field intensity, the magnetic vector model defines the components of:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VMG30k6ALf"}],"key":"BGjqzM5IYw"},{"type":"math","value":"\\vec{\\chi}_{eff} = \\frac{\\vec{M}_{ind} + \\vec{M}_{rem}}{\\left | \\vec{H}_0 \\right |}","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eχ\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi\u003ef\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eM\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eM\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmrow\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmo fence=\"true\"\u003e∣\u003c/mo\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eH\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003cmo fence=\"true\"\u003e∣\u003c/mo\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\vec{\\chi}_{eff} = \\frac{\\vec{M}_{ind} + \\vec{M}_{rem}}{\\left | \\vec{H}_0 \\right |}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.0001em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.714em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eχ\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1799em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1944em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ee\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\"\u003eff\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:3.3453em;vertical-align:-1.702em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.6433em;\"\u003e\u003cspan style=\"top:-2.11em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.162em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"minner\"\u003e\u003cspan class=\"mopen\"\u003e\u003cspan class=\"delimsizing mult\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.162em;\"\u003e\u003cspan style=\"top:-1.966em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.564em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan style=\"height:0.616em;width:0.3333em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.172em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.65em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1799em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"delimsizing mult\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.162em;\"\u003e\u003cspan style=\"top:-1.966em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.564em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan style=\"height:0.616em;width:0.3333em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.172em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.65em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.392em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.162em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.839em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.162em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eM\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1522em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ein\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eM\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1522em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ere\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.702em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"1","key":"WiEhclaa81"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"As a result, ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AFd5jISR2N"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"magnetic vector models in SimPEG are defined using SI units","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"PEBGTJcL70"}],"key":"cWBzTttAsR"},{"type":"text","value":".\nTo create a magnetic vector model, we must","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"odtrPewM02"}],"key":"HExbaMjouZ"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Compute the induced magnetization vector for each cell by multiplying the susceptibility ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"xnNolktz7a"},{"type":"text","value":"χ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"qVKZg9h6uV"},{"type":"text","value":" by the inducing magnetic field intensity ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"dSXQvkAKQW"},{"type":"inlineMath","value":"\\vec{H}_0","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eH\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\vec{H}_0\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1163em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1799em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"SSxdFDVbTd"},{"type":"text","value":". The resulting quantity has units A/m.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"DzKHOuEn9Q"}],"key":"mUrRZUORsZ"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Define the remanent magnetization vector for each cell, once again in A/m.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"c8noCiMuhe"}],"key":"HrTfpWPjrX"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Sum the induced and remanent contributions.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"j0VBQtN3Pb"}],"key":"JYArG2bwxt"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Normalize by the amplitude of inducing magnetic field intensity; i.e. ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BXvfOCdBnj"},{"type":"inlineMath","value":"\\left | \\vec{H}_0 \\right |","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo fence=\"true\"\u003e∣\u003c/mo\u003e\u003cmsub\u003e\u003cmover accent=\"true\"\u003e\u003cmi\u003eH\u003c/mi\u003e\u003cmo\u003e⃗\u003c/mo\u003e\u003c/mover\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003cmo fence=\"true\"\u003e∣\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\left | \\vec{H}_0 \\right |\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.812em;vertical-align:-0.65em;\"\u003e\u003c/span\u003e\u003cspan class=\"minner\"\u003e\u003cspan class=\"mopen\"\u003e\u003cspan class=\"delimsizing mult\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.162em;\"\u003e\u003cspan style=\"top:-1.966em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.564em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan style=\"height:0.616em;width:0.3333em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.172em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.65em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord accent\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.9663em;\"\u003e\u003cspan style=\"top:-3em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.2523em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"accent-body\" style=\"left:-0.1799em;\"\u003e\u003cspan class=\"overlay\" style=\"height:0.714em;width:0.471em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"delimsizing mult\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.162em;\"\u003e\u003cspan style=\"top:-1.966em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.564em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan style=\"height:0.616em;width:0.3333em;\"\u003e\u003csvg xmlns=\"http://www.w3.org/2000/svg\" width='0.3333em' height='0.616em' style='width:0.3333em' viewBox='0 0 333.33000000000004 616' preserveAspectRatio='xMinYMin'\u003e\u003cpath d='M145 0 H188 V616 H145z M145 0 H188 V616 H145z'/\u003e\u003c/svg\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.172em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.616em;\"\u003e\u003c/span\u003e\u003cspan class=\"delimsizinginner delim-size1\"\u003e\u003cspan\u003e∣\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.65em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"EQOPBxBzhX"},{"type":"text","value":" in units A/m. The resulting quantity is unitless (SI).","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"H5rd1ayNqA"}],"key":"tnZXjIVNB9"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Re-organize the quantity as a 1D ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"RsC6F3U7lQ"},{"type":"link","url":"https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"numpy.ndarray","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"RTIiTtlamh"}],"urlSource":"myst:numpy#numpy.ndarray","internal":false,"protocol":"xref:sphinx","key":"FUAutTIVKe"},{"type":"text","value":" organized by vector component; i.e. np.r_[chi_1, chi_2, chi_3]","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"uOg1APod8T"}],"key":"gzAVZWpJap"}],"key":"jOqnwo6SKS"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Here, the model consists of a susceptible and remanently magnetized sphere within a negligibly susceptible host. The horizontal components of the induced and remanent magnetization has been balance so that they cancel out, and the net magnetization is downward. We plot the magnetic vector models using the ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"EDPBQDcxrJ"},{"type":"link","url":"https://discretize.simpeg.xyz/en/main/api/generated/discretize.TreeMesh.plot_slice.html#discretize.treemesh.plot_slice","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"plot_slice","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"VAEo8Vwcp0"}],"urlSource":"myst:discretize#discretize.TreeMesh.plot_slice","internal":false,"protocol":"xref:sphinx","key":"pbUOLp2aAZ"},{"type":"text","value":" method.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"MKkzAW0z76"}],"key":"VVSxv4KAjM"}],"key":"N8eZ8mApei"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.944284Z","iopub.status.busy":"2024-07-17T17:48:42.943984Z","iopub.status.idle":"2024-07-17T17:48:42.948020Z","shell.execute_reply":"2024-07-17T17:48:42.947303Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define susceptibility values for each unit in SI\nbackground_susceptibility = 0.0001\nsphere_susceptibility = 0.01","key":"iD1xVjHrtN"},{"type":"output","id":"P6bEefGHJdYbgYfKWpKGY","data":[],"key":"MiXXEkWI0m"}],"key":"SUQgGu8yB2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.951325Z","iopub.status.busy":"2024-07-17T17:48:42.951012Z","iopub.status.idle":"2024-07-17T17:48:42.958661Z","shell.execute_reply":"2024-07-17T17:48:42.957943Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute the induced magnetization vector (A/m) for every active cell\nsusceptibility_model = background_susceptibility * np.ones(n_active)\nind_sphere = model_builder.get_indices_sphere(\n    np.r_[0.0, 0.0, 55.0], 16.0, mesh.cell_centers\n)\nind_sphere = ind_sphere[active_cells]\nsusceptibility_model[ind_sphere] = sphere_susceptibility\n\n# Compute the unit direction of the inducing field in Cartesian coordinates\nfield_direction = mat_utils.dip_azimuth2cartesian(field_inclination, field_declination)\n\n# Inducing magnetic field intensity (A/m)\nH0 = 1e-9 * field_amplitude * field_direction / mu_0\n\n# Compute induced magnetization\ninduced_magnetization = np.outer(\n    susceptibility_model, H0\n)  # (n_active, 3) numpy.ndarray","key":"OgbHpVRZH8"},{"type":"output","id":"P380lCPwNZQthPpqRQ_Pz","data":[],"key":"tWRQ0GFMda"}],"key":"FxDVXQW22f"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.961957Z","iopub.status.busy":"2024-07-17T17:48:42.961726Z","iopub.status.idle":"2024-07-17T17:48:42.966309Z","shell.execute_reply":"2024-07-17T17:48:42.965667Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the remanent magnetization vector (A/m) for every active cell.\n# inclination (deg), declination (deg), amplitude (A/m)\nremanence_inclination = 45.0\nremanence_declination = 210.0\nremanence_amplitude = 0.39788735751313814\n\nremanent_magnetization = np.zeros_like(induced_magnetization)\nremanent_magnetization_sphere = remanence_amplitude * mat_utils.dip_azimuth2cartesian(\n    remanence_inclination, remanence_declination\n)\nremanent_magnetization[ind_sphere, :] = remanent_magnetization_sphere","key":"kU3tb8rsum"},{"type":"output","id":"sP-v2OhfjIurZs-anGzFL","data":[],"key":"bElNSa3HuQ"}],"key":"hYC5VyXD0G"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.969947Z","iopub.status.busy":"2024-07-17T17:48:42.969668Z","iopub.status.idle":"2024-07-17T17:48:42.974834Z","shell.execute_reply":"2024-07-17T17:48:42.974163Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute total magnetization (A/m) for all active cells\ntotal_magnetization = induced_magnetization + remanent_magnetization\n\n# Define effective susceptibility model as a vector np.r_[chi_x, chi_y, chi_z]\nmodel = mkvc(total_magnetization) / np.linalg.norm(H0)","key":"HkhuHNWmQL"},{"type":"output","id":"HQxbH_HPZbemsYdFE4XR9","data":[],"key":"NBymBj9J9D"}],"key":"yOxYsmEGwL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.978399Z","iopub.status.busy":"2024-07-17T17:48:42.978106Z","iopub.status.idle":"2024-07-17T17:48:42.987954Z","shell.execute_reply":"2024-07-17T17:48:42.987318Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Mapping to ignore inactive cells when plotting MVI amplitude\nplotting_map = maps.InjectActiveCells(mesh, active_cells, np.nan)\n\n# MVI model organized into (N, 3) numpy.ndarray\nplotting_model = total_magnetization / np.linalg.norm(H0)\n\n# Amplitude of MVI\nmodel_amplitude = np.sqrt(np.sum(plotting_model**2, axis=1))","key":"jLXgV4ZyHb"},{"type":"output","id":"8vw5FHqBiwAMjf_ACt7Tb","data":[],"key":"rScx0kBF90"}],"key":"XLZDfO9onj"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:42.991242Z","iopub.status.busy":"2024-07-17T17:48:42.991011Z","iopub.status.idle":"2024-07-17T17:48:43.433606Z","shell.execute_reply":"2024-07-17T17:48:43.432840Z"},"scrolled":false},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(14, 4))\n\nnorm = mpl.colors.Normalize(vmin=0, vmax=np.max(model_amplitude))\n\nax1 = fig.add_axes([0.05, 0.12, 0.5, 0.78])\nmesh.plot_slice(\n    plotting_map * model_amplitude,\n    normal=\"Y\",\n    ax=ax1,\n    ind=int(mesh.h[1].size / 2),\n    grid=True,\n    pcolor_opts={\"cmap\": mpl.cm.plasma, \"norm\": norm},\n)\nax1.set_title(\"MVI Model at y = 0 m (amplitude)\")\nax1.set_xlabel(\"x (m)\")\nax1.set_ylabel(\"z (m)\")\n\nax2 = fig.add_axes([0.62, 0.12, 0.25, 0.78])\nmesh.plot_slice(\n    plotting_map * plotting_model,\n    v_type=\"CCv\",\n    view=\"vec\",\n    normal=\"Y\",\n    ax=ax2,\n    ind=int(mesh.h[1].size / 2),\n    grid=True,\n    pcolor_opts={\"cmap\": mpl.cm.plasma, \"norm\": norm},\n    quiver_opts={\n        \"pivot\": \"mid\",\n        \"width\": 0.01,\n        \"headwidth\": 3.0,\n        \"headlength\": 3.0,\n        \"headaxislength\": 3.0,\n        \"scale\": 0.25,\n    },\n)\nax2.set_title(\"MVI Model at y = 0 m\")\nax2.set_xlim([-25, 25])\nax2.set_ylim([30, 80])\nax2.set_xlabel(\"x (m)\")\nax2.set_ylabel(\"z (m)\")\n\ncx = fig.add_axes([0.89, 0.12, 0.02, 0.78])\ncbar = mpl.colorbar.ColorbarBase(\n    cx, norm=norm, orientation=\"vertical\", cmap=mpl.cm.plasma\n)\ncbar.set_label(\"SI\", rotation=270, labelpad=15)","key":"UJqN8lYJ5o"},{"type":"output","id":"HwSIJWXDcqMWmhbkWRiE8","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d9891e1ce5c6f40df12e7db8c848307c","path":"/user-tutorials/build/d9891e1ce5c6f40df12e7db8c848307c.png"},"text/plain":{"content":"\u003cFigure size 1400x400 with 3 Axes\u003e","content_type":"text/plain"}}}],"key":"MYIjT94o3N"}],"key":"czg9mfdkAx"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the Forward Simulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a2hx5ctFMU"}],"identifier":"define-the-forward-simulation","label":"Define the Forward Simulation","html_id":"define-the-forward-simulation","implicit":true,"key":"IqPPh5a1fZ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In SimPEG, the physics of the forward simulation is defined by creating an instance of an appropriate simulation class.\nIn this case, we use the simulation class for the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vzdiB1smqC"},{"type":"link","url":"myst:SimPEG#SimPEG.potential_fields.magnetics.Simulation3DIntegral","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3D integral formulation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kJJwag6Q5Y"}],"urlSource":"myst:SimPEG#SimPEG.potential_fields.magnetics.Simulation3DIntegral","key":"wlB79prDOZ"},{"type":"text","value":". To fully define the forward simulation, we need to connect the simulation object to:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Q3MkeDqfYG"}],"key":"itjhzMVjyC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"the survey","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"VOSdImQTys"}],"key":"yMnkg3aZ7h"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"the mesh","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"UMhcy3pInI"}],"key":"KGHzEIEqNV"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"the indices of the active cells","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"OizoSMYS9l"}],"key":"XhP4JuYHom"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"the mapping from the model to the active cells","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zd4S5vVaON"}],"key":"F8IAvrE9oH"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"the model type: “scalar” for susceptibility model, “vector” for magnetic vector model","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"fTRKHCBPyY"}],"key":"ldLE4tnJwh"}],"key":"YjyCXjrVnN"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"This is accomplished by setting each one of the aforementioned items as a property of the simulation object. Additional keyword arguments can also be set which impact the forward simulation. Because we are only simulating data for a single model, there is no benefit to storing the sensitivities for the forward simulation. ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"kWC9eutoAT"},{"type":"inlineCode","value":"store_sensitivities","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"pbpyLDpFCs"},{"type":"text","value":" property to ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"fCg25reg69"},{"type":"emphasis","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"‘forward_only’","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ecdw2LWlM9"}],"key":"YrfYlFdE6q"}],"key":"kxnyVBNNtS"}],"key":"VVSIupTPMK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:43.438776Z","iopub.status.busy":"2024-07-17T17:48:43.438541Z","iopub.status.idle":"2024-07-17T17:48:43.492759Z","shell.execute_reply":"2024-07-17T17:48:43.492103Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"simulation = magnetics.simulation.Simulation3DIntegral(\n    survey=survey,\n    mesh=mesh,\n    model_type=\"vector\",\n    chiMap=model_map,\n    ind_active=active_cells,\n    store_sensitivities=\"forward_only\",\n)","key":"zI6YigQ5CI"},{"type":"output","id":"kao960SfbsiYSensaybEg","data":[],"key":"LIafoeZmW3"}],"key":"hi2uhccPRw"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Simulate Magnetic Gradiometry Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W7kSdwVbBB"}],"identifier":"simulate-magnetic-gradiometry-data","label":"Simulate Magnetic Gradiometry Data","html_id":"simulate-magnetic-gradiometry-data","implicit":true,"key":"u1Wl887qqY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Once any simulation within SimPEG has been properly constructed, simulated data for a given model vector can be computed using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SkJBkIg2Ki"},{"type":"link","url":"myst:SimPEG#SimPEG.simulation.BaseSimulation.dpred","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"dpred","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LaxenxTpND"}],"urlSource":"myst:SimPEG#SimPEG.simulation.BaseSimulation.dpred","key":"EFiMnBky4W"},{"type":"text","value":" method. In SimPEG, magnetic gradiometry data values are in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hvBi9iHNcy"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"nT/m.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dytryrjUUf"}],"key":"hiw5eCUJOO"}],"key":"Ow6CxZZR6W"}],"key":"RA6MHJbdSe"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:43.497544Z","iopub.status.busy":"2024-07-17T17:48:43.497305Z","iopub.status.idle":"2024-07-17T17:48:48.529145Z","shell.execute_reply":"2024-07-17T17:48:48.527721Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"dpred = simulation.dpred(model)","key":"GdDGF6fA7Z"},{"type":"output","id":"eGn-gB9t6tz-DjgpyScpw","data":[],"key":"LI5dcp9GMD"}],"key":"lUGtqUgoIW"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data are ordered by component, then by location. Here, we reshape the predicted data vector into an array for easier plotting.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c587M5JhNu"}],"key":"Kqh7vYfmVV"}],"key":"O9jC8CZufq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:48.535107Z","iopub.status.busy":"2024-07-17T17:48:48.533612Z","iopub.status.idle":"2024-07-17T17:48:48.540634Z","shell.execute_reply":"2024-07-17T17:48:48.539818Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"n_loc = survey.nRx  # Number of receiver locations\nn_comp = len(components)  # Number of data components\ndpred_plotting = np.reshape(dpred, (n_loc, n_comp))","key":"wcis3DwyDT"},{"type":"output","id":"kSu0JKPxIidoKyXRpOGBe","data":[],"key":"hG297PDyi3"}],"key":"U6GQMyLx1k"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2024-07-17T17:48:48.546034Z","iopub.status.busy":"2024-07-17T17:48:48.544598Z","iopub.status.idle":"2024-07-17T17:48:49.138239Z","shell.execute_reply":"2024-07-17T17:48:49.137355Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(10, 3))\nv_max = np.max(np.abs(dpred))\n\nax = 3 * [None]\ncplot = 3 * [None]\ncomp_list = [\"x\", \"y\", \"z\"]\n\nnorm = mpl.colors.Normalize(vmin=-v_max, vmax=v_max)\n\nfor ii in range(0, 3):\n    ax[ii] = fig.add_axes([0.1 + ii * 0.26, 0.15, 0.25, 0.78])\n    cplot[ii] = plot2Ddata(\n        receiver_locations,\n        dpred_plotting[:, ii],\n        ax=ax[ii],\n        ncontour=60,\n        contourOpts={\"cmap\": \"bwr\", \"norm\": norm},\n    )\n    ax[ii].set_title(r\"$\\partial B_z /\\partial {}$\".format(comp_list[ii]))\n    ax[ii].set_xlabel(\"x (m)\")\n    if ii == 0:\n        ax[ii].set_ylabel(\"y (m)\")\n    else:\n        ax[ii].set_yticks([])\n\ncx = fig.add_axes([0.89, 0.13, 0.02, 0.79])\ncbar = mpl.colorbar.ColorbarBase(cx, norm=norm, orientation=\"vertical\", cmap=mpl.cm.bwr)\ncbar.set_label(\"$nT/m$\", rotation=270, labelpad=10, size=12)\n\nplt.show()","key":"h2hDDyRSBW"},{"type":"output","id":"QI9e7_wTmbpwd6yJooLkB","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"62a727abba9e5d595f38da666260fc44","path":"/user-tutorials/build/62a727abba9e5d595f38da666260fc44.png"},"text/plain":{"content":"\u003cFigure size 1000x300 with 4 Axes\u003e","content_type":"text/plain"}}}],"key":"KfHAxvBpSO"}],"key":"t25pYmx5nr"}],"key":"ABljWUEcnW"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"3D Forward Simulation of TMI Data","url":"/fwd-magnetics-induced-3d","group":"SimPEG User Tutorials"},"next":{"title":"3D Inversion of TMI Data to Recover a Susceptibility Model","url":"/inv-magnetics-induced-3d","group":"SimPEG User Tutorials"}}},"domain":"http://localhost:3000"},"project":{"license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"},"code":{"id":"MIT","name":"MIT License","osi":true,"free":true,"url":"https://opensource.org/licenses/MIT"}},"subject":"SimPEG User Tutorials","title":"SimPEG User Tutorials","description":"SimPEG user tutorials","authors":[{"nameParsed":{"literal":"Devin Cowan","given":"Devin","family":"Cowan"},"name":"Devin Cowan","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Santiago Soler","given":"Santiago","family":"Soler"},"name":"Santiago Soler","affiliations":["University of British Columbia"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/simpeg/user-tutorials","keywords":["geophysics","inversions","python","open-source"],"affiliations":[{"id":"University of British Columbia","name":"University of British Columbia"}],"references":{"python":{"url":"https://docs.python.org/3"},"numpy":{"url":"https://numpy.org/doc/stable"},"scipy":{"url":"https://docs.scipy.org/doc/scipy"},"matplotlib":{"url":"https://matplotlib.org/stable"},"discretize":{"url":"https://discretize.simpeg.xyz/en/main"},"simpeg":{"url":"https://docs.simpeg.xyz/latest"},"geoana":{"url":"https://geoana.simpeg.xyz"},"sphinx":{"url":"https://www.sphinx-doc.org/en/master"}},"thumbnail":"/user-tutorials/build/title_image-85dfd5678c19b200645848082397acaf.png","exports":[],"bibliography":[],"index":"index","pages":[{"slug":"gravity-index","title":"Gravity","description":"","date":"","thumbnail":"/user-tutorials/build/ae6c6ed278992f609070dbcd57643aba.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-gravity-anomaly-3d","title":"3D Forward Simulation of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-gravity-gradiometry-3d","title":"3D Forward Simulation of Gravity Gradiometry Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-gravity-anomaly-3d","title":"3D Inversion of Gravity Anomaly Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"magnetics-index","title":"Magnetics","description":"","date":"","thumbnail":"/user-tutorials/build/7a8cefd4894c78a7681713eac224fec3.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-magnetics-induced-3d","title":"3D Forward Simulation of TMI Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-magnetics-mvi-3d","title":"3D Forward Simulation of Magnetic Gradiometry Data for Magnetic Vector Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-magnetics-induced-3d","title":"3D Inversion of TMI Data to Recover a Susceptibility Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"dcr-index","title":"Direct Current Resistivity","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-dcr-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-2d","title":"2.5D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-dcr-3d","title":"3D Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-2d","title":"2.5D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-dcr-3d","title":"3D DC Resistivity Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"ip-index","title":"Induced Polarization","description":"","date":"","thumbnail":"/user-tutorials/build/dcip_physics-0bf5970ed7bb7884b5560f835d7d6622.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-ip-2d","title":"2.5D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-ip-3d","title":"3D IP Forward Simulation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-2d","title":"2.5D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-ip-3d","title":"3D IP Inversion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fdem-index","title":"Frequency-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/fem_physics-f8431d25d6d77e8b4ff5cdccedc9d3e9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-fdem-1d","title":"1D Forward Simulation of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-fdem-1d","title":"1D Inversion of Frequency Domain EM Data for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"tdem-index","title":"Time-Domain Electromagnetics","description":"","date":"","thumbnail":"/user-tutorials/build/tem_physics-a1a5f99158a0a16b320fa6421f91835e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"fwd-tdem-1d","title":"1D Forward Simulation for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-tdem-fundamentals","title":"Fundamentals of Finite Volume for TDEM Simulations","description":"","date":"","thumbnail":"/user-tutorials/build/diffusion_distance-ec1d656f70f6b7344928d0bd60daaca1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"fwd-utem-3d","title":"3D Forward Simulation for On-Time Large-Loop Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"inv-tdem-1d","title":"1D Inversion for a Single Sounding","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/user-tutorials/build/manifest-AF659DBA.js";
import * as route0 from "/user-tutorials/build/root-MROHD4U6.js";
import * as route1 from "/user-tutorials/build/routes/$-INRYMPN2.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/user-tutorials/build/entry.client-J4K7GZUA.js");</script></body></html>